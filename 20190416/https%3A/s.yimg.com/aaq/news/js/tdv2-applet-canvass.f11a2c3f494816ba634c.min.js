webpackJsonp([7],{1237:function(e,t,n){"use strict";e.exports={controllerViews:{CanvassApplet:n(2069)},stores:{CanvassCommentFormStore:n(1598),CanvassConfigStore:n(115),CanvassLinkEnhancerStore:n(1845),CanvassSentimentsStore:n(1834),CanvassStore:n(297),CanvassTumblrStore:n(1670)},meta:{dependencies:["tdv2-service-profile"]}}},1312:function(e,t,n){"use strict";function s(e){var t=n(29).ReactI13n.getInstance();t&&t.execute("pageview",{pageParams:{pd:"canvass-"+e,navtype:"client"}})}function a(e,t){var s={sec:"cmmts",subsec:"canvass",outcm:"show"};t&&(s=Object.assign(s,t));var a=n(29).ReactI13n.getInstance();a&&a.execute("beacon",{beaconType:"beaconEvent",arguments:[e,s,s.outcm]})}function o(e){var t={sec:"cmmts",_p:"0",subsec:"canvass",outcm:"clicked"};e&&(t=Object.assign(t,e));var s=n(29).ReactI13n.getInstance();s&&s.execute("beacon",{beaconType:"beaconClick",arguments:[t.sec,t.slk||"-",t._p,t,t.outcm]})}function r(e,t){if(!i[e])throw new Error('There is no I13nModel for "'+e+'"');return t?Object.assign({},i[e],t):i[e]}Object.defineProperty(t,"__esModule",{value:!0}),t.I13nButton=t.I13nAnchor=void 0,t.fireRapidPageView=s,t.fireRapidEvent=a,t.fireRapidClick=o,t.getI13nModel=r;var i=(t.I13nAnchor=(0,n(29).createI13nNode)("a",{bindClickEvent:!0,follow:!0,isLeafNode:!1}),t.I13nButton=(0,n(29).createI13nNode)("button",{bindClickEvent:!0,isLeafNode:!1}),{login:{slk:"login",elm:"cmmt_login",itc:0,outcm:"login"},"comments-open":{slk:"show",elm:"cmmt_open",outcm:"open"},"comments-close":{slk:"hide",elm:"cmmt_open",outcm:"close"},"comments-showMore":{slk:"load more",elm:"cmmt_more",outcm:"more"},"comments-showNew":{slk:"load new",elm:"cmmt_new",outcm:"more"},"comment-delete":{slk:"delete",elm:"cmmt_delete",itc:1,outcm:"delete"},"comment-report-cancel":{slk:"close",elm:"cmmt_abuse",outcm:"close"},"comment-flag":{slk:"abuse",elm:"cmmt_abuse",itc:1,outcm:"open"},"comment-block":{slk:"mute",elm:"cmmt_mute",outcm:"close"},"comment-report-done":{elm:"cmmt_abuse",outcm:"close",itc:1},"comment-post":{slk:"post",elm:"cmmt_post",outcm:"post"},"comment-seemore":{slk:"read more",elm:"cmmt_read",outcm:"read"},guidelines:{slk:"guideline show",elm:"cmmt_guideline"},options:{elm:"cmmt_options",slk:"options",outcm:"options"},"replies-show":{slk:"open replies",elm:"cmmt_more",elmt:"showreply",outcm:"show"},reply:{slk:"open reply",elm:"cmmt_reply",outcm:"focus"},"reply-post":{slk:"post reply",elm:"cmmt_reply",outcm:"post"},react:{slk:"open reactions",elm:"cmmt_react"},vote:{elm:"cmmt_vote",outcm:"rate"},link:{slk:"smartlink",elm:"cmmt_link",itc:0,outcm:"navigate"},"context-link":{elm:"cmmt_ctx",itc:0},"tumblr-icon":{slk:"gif-show",elm:"cmmt_gif",outcm:"show"},"tumblr-post":{elm:"cmmt_gif",outcm:"post"},"link-prvw-close":{slk:"link-prvw-close",elm:"cmmt_link",outcm:"close"},"text-input":{slk:"text-input",elm:"cmmt_text",outcm:"focus"},sort:{elm:"cmmt_sort",outcm:"sort"},"sort-btn":{elm:"cmmt_sort_btn"},"user-avatar-tap":{slk:"open user messages",elm:"cmmt_avatar",outcm:"history"},"user-comments-tap":{slk:"open user messages",elm:"cmmt_history",outcm:"history"},"user-name-tap":{slk:"open user messages",elm:"cmmt_username",outcm:"history"},"user-close-tap":{slk:"close user messages",elm:"cmmt_username",outcm:"history"},"related-tags":{elm:"cmmt_trending_tag"},"sentiments-tap":{slk:"sentiments",elm:"cmmt_sentiments",outcm:"show"},"sentiments-close-tap":{slk:"sentiments close",elm:"cmmt_sentiments",outcm:"hide"}})},1327:function(e,t,n){"use strict";function s(e,t){return t.forEach(function(t){e[t]=e[t].bind(e)}),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,e.exports=t.default},1390:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){d("expand",t);var s=t&&(t.id||t.instanceId);if(!s)return n&&n(new Error("expandMessages requires an instanceId"));var a=e.session.query,i=e.getStore(r.default).getState(),f=e.getStore(o.default),p=f.getCommentsState(s),h=p.get("messageList")||c.default.List(),m={id:s,instanceId:s,isExpanded:(0,l.default)(t,["expanded"],!0)};if(!m.isExpanded||h.size>0||m.isExpanded===p.get("expanded"))e.dispatch("COMMENTS_EXPAND",m),n&&n();else{var g={context:t.uuid||t.context||a.context||"YahooGlobal",contextDisplayText:t.contextDisplayText||p.get("contextDisplayText"),contextUrl:t.contextUrl||p.get("contextUrl"),expanded:!0,index:t.nextIndex||null,instanceId:s,lang:i.lang,messagesPerPage:i.messagesPerPage,namespace:t.namespace||p.get("namespace")||i.namespace,region:i.region,selectedTags:t.selectedTags,sortBy:t.sortBy||p.get("sortBy"),tagsAnd:t.tagsAnd,tagsOr:t.tagsOr,oauthConsumerKey:i.oauthConsumerKey,oauthConsumerSecret:i.oauthConsumerSecret};e.executeAction(u.default,g,function(t,a){f.getCommentsState(s).get("error")||e.dispatch("COMMENTS_EXPAND",m),n&&n()})}}Object.defineProperty(t,"__esModule",{value:!0});var o=s(n(297)),r=s(n(115)),i=s(n(3)),l=s(n(2)),c=s(n(11)),u=s(n(521)),d=(0,i.default)("Canvass:actions:expandMessages");a.displayName="expandMessages",t.default=a,e.exports=t.default},1402:function(e,t){if(void 0===n)var n={};n.CoreArrowDown={name:"CoreArrowDown",height:512,width:512,path:"M500.77 131.432L477.53 108.18c-14.45-14.55-40.11-14.55-54.51 0L255.845 275.363 88.582 108.124c-15.015-14.874-39.363-14.874-54.42.108L10.94 131.486c-14.58 14.44-14.58 40.11-.033 54.442l217.77 217.845c15.004 14.82 39.33 14.874 54.42-.108L500.88 185.82c14.818-14.982 14.87-39.298-.11-54.388z"},void 0!==e&&e.exports&&(e.exports=n.CoreArrowDown)},1467:function(e,t,n){"use strict";e.exports=new(n(2070))},1496:function(e,t,n){"use strict";function s(e){var t=parseInt(e,10);return isNaN(t)?null:(t.toString().length<13&&(t*=1e3),t)}function a(e,t){l.isRegExp(e)&&l.isFunction(t)?c.unshift({channelRegex:e,parseFn:t}):i("add parser failed",e,t)}function o(e){var t,n,s=c.length;if(e)for(n=0;n<s;n++)if(t=c[n],t.channelRegex&&t.channelRegex.test(e.channel))return t.parseFn;return null}function r(e){var t,a;try{t=JSON.parse(e.data)}catch(e){return null}return t&&e.channel===t.chn?(a=[],t.updates.forEach(function(e){var t=s(e.lastUpdatedTs),o={};e.update&&e.update.length&&(e.update.forEach(function(e){"up"===e._op&&n(1668).setObjectValue(o,e.key,e.value)}),a.push({data:o,seq:e.seq,time:e.time,lastUpdatedTs:t}))}),a):null}var i=n(3)("TDPipe:messageParsers"),l={isArray:n(32),isFunction:n(123),isRegExp:n(2074)},c=[];a(/^\/[\/\.\w\d]+$/,function(e){return l.isArray(e.data)?e:[e]}),e.exports={add:a,findParseFn:o,onepushParser:r,parseLastUpdatedTs:s}},1497:function(e,t,n){"use strict";function s(e){var t=e.session.protocol+"://"+e.session.host;try{var n=e.getStore("RouteStore"),s=n.getCurrentNavigate()||{},a=s.url;return a?t+a:location.href}catch(e){return t}}function a(e,t,n,a){var o="https://login.yahoo.com/";if(!e||!e.session)return o+"?.intl=US&.lang=en-US&.done="+encodeURIComponent("https://www.yahoo.com");var r=e.session.dimensions||{},i=e.session.query||{},l=(e.contextUrl||i.contextUrl||s(e))+"?bcmt=1";return t&&(l+="&messageId="+encodeURIComponent(t)),n&&(l+="&replyId="+encodeURIComponent(n)),o+"?.intl="+r.intl+"&.lang="+r.lang+"&.done="+encodeURIComponent(l)+(a?"&.src="+encodeURIComponent(a):"")}Object.defineProperty(t,"__esModule",{value:!0}),t.getRoute=s,t.getLoginUrl=a},1597:function(e,t,n){n(1467).set({btn:"Ff(ss) Fz(14px) Fw(b) Bdw(0) Ta(c) Cur(p) Va(m) Bdrs(4px) O(n)! Lh(n)","btn-primary":"Bgc($c-fuji-blue-1-a) Bgc($c-fuji-blue-3-a):h C(#fff) Bd(n)","btn-secondary":"Bgc(#fff) C($c-fuji-blue-1-a) Bdw(2px) Bdc($c-fuji-blue-1-a) Bd C(#fff):h Bgc($c-fuji-blue-1-a):h","btn-spacing":"Mt(20px) Mb(20px) Px(30px) Py(10px)","btn-fullwidth-sm":"W(100%)--xs Bdrs(2px)--xs Bdw(1px)--xs Fw(600)--xs Py(12px)--xs"}),e.exports=n(1467)},1598:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,function(e){return e&&e.__esModule?e:{default:e}}(n(20)).default)({storeName:"CanvassCommentFormStore",statics:{handlers:{CANVASS_HEARTBEAT_SUCCESS:"heartbeatSuccess",CANVASS_POST_FAILURE:"canvassFailure",CANVASS_POST_SUCCESS:"canvassSuccess"}},initialize:function(){this.state={activeForm:null,commenting:{},errorMessage:""}},canvassFailure:function(e){this.setCommentingState(e.replyId?e.messageId:e.contextId,!1),this.state.errorMessage="CANVASS_NETWORK_ERROR",this.state.messageId=e.messageId,this.state.replyId=null,this.emitChange()},canvassSuccess:function(e){this.setCommentingState(e.replyId?e.messageId:e.contextId,!1),this.state=Object.assign(this.state,e,{errorMessage:"",replyId:e.replyId||null}),this.emitChange()},isActiveForm:function(e){var t=this.state.activeForm;return!!t&&t.messageId===e.messageId&&t.replyId===e.replyId},getActiveForm:function(){return this.state.activeForm||{}},setActiveForm:function(e){this.isActiveForm(e)||(this.state.activeForm={messageId:e.messageId,replyId:e.replyId},this.emitChange())},setFormInactive:function(e){this.isActiveForm(e)&&(this.state.activeForm=e.replyId?{messageId:e.messageId}:null,this.emitChange())},setCommentingState:function(e,t){var n=this.state.commenting[e]||!1;e&&n!==t&&(this.state.commenting=Object.assign({},this.state.commenting),this.state.commenting[e]=t,this.emitChange())},heartbeatSuccess:function(e){var t=e.eventType,n=e.messageId||e.context;"START_TYPING"===t&&n?this.setCommentingState(n,!0):"STOP_TYPING"===t&&n&&this.setCommentingState(n,!1)},getState:function(){return this.state},dehydrate:function(){return this.state},rehydrate:function(e){this.state=e}}),e.exports=t.default},1599:function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),i=(function(e){}(n(0)),function(e){function t(e){s(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={shouldRender:!1},n}return o(t,e),r(t,[{key:"componentDidMount",value:function(){this.setState({shouldRender:!0})}},{key:"render",value:function(){return this.state.shouldRender?this.props.children:null}}]),t}(n(1).Component));t.default=i,e.exports=t.default},1600:function(e,t,n){"use strict";function s(e,t,n){if(!parent)return n&&n();parent===window?window.location.href=t.loginUrl:parent.postMessage(JSON.stringify({context:t.context,isCanvass:!0,loginUrl:t.loginUrl}),"*"),n&&n()}Object.defineProperty(t,"__esModule",{value:!0}),s.displayName="loginUser",t.default=s,e.exports=t.default},1665:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t,s){var a=e.getStore(r.default).getState(),i={lang:a.lang,region:a.region,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret},l=Object.assign({},t,i);if(!l.guid||!l.oauthConsumerSecret||!l.oauthConsumerKey)return s();var c={userId:l.guid,sortBy:l.sortBy||n(507).DEFAULT_SORT,index:l.nextIndex||null,count:l.count||10,lang:l.lang||"en-US",region:l.region||"US",oauthConsumerKey:l.oauthConsumerKey,oauthConsumerSecret:l.oauthConsumerSecret};e.service.read("canvass.getUserMessageHistory",c,{},function(t,n){if(t||!n||n.error)return e.dispatch("CANVASS_USER_HISTORY_GET_FAILURE",t),s&&s();var a=n.canvassMessages||[];e.dispatch("CANVASS_USER_HISTORY_GET_SUCCESS",{messageList:a,instanceId:l.instanceId,count:n.total&&n.total.count||0,startIndex:(0,o.default)(a,[0,"index"],null),nextIndex:(0,o.default)(a,[a.length-1,"index"],null),sortBy:c.sortBy,showNextClicked:l.showNextClicked,guid:l.guid,image:l.image,name:l.name}),s&&s()})}Object.defineProperty(t,"__esModule",{value:!0});var o=s(n(2)),r=s(n(115));a.displayName="loadUserMessages",t.default=a,e.exports=t.default},1666:function(e,t,n){"use strict";function s(e,t,n){if(!parent||parent===window)return n&&n();var s;if(t.hasOwnProperty("height"))s=t.height;else{s=(document.querySelector(".render-target-active")||document.scrollingElement||document.body).scrollHeight}s!==a&&(a=s,parent.postMessage(JSON.stringify({context:t.context,count:t.count||0,height:a,initialized:!0,isCanvass:!0,isExpanded:t.isExpanded}),"*")),n&&n()}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var a;e.exports=t.default},1667:function(e,t,n){"use strict";function s(e){b=h.merge({},v,e),b.subscribeMaxTotalTries=b.subscribeMaxTotalTries||2*b.subscribeMaxTries}function a(){return b}function o(e){return b.publicHost===b.privateHost?O:e.indexOf("*")>0?M:O}function r(e,t,n){var s=g[e],a=h.merge({clientId:s.clientId},n);Object.keys(s.proxies).forEach(function(e){s.proxies[e].emit(t,a)})}function i(e,t){var n=g[t];n.totalTries=n.totalTries?n.totalTries+1:1,(n.tries=n.tries?n.tries+1:1)<=b.subscribeMaxTries&&n.totalTries<=b.subscribeMaxTotalTries&&e.subscribe(t)}function l(e){var t=[];Object.keys(g).forEach(function(n){if(o(n)===e){var s=g[n];s.state=I,s.tries=0,s.clientId="",t.push(n),i(m[e],n)}}),p("resubscribe existing channels",e,t)}function c(e){var t,n,s,a=[],r=[];for(t=0,n=y.length;t<n;t++)s=y[t],o(s)===e?g[s].state!==I&&g[s].state!==T&&(g[s].state=I,i(m[e],s),r.push(s)):a.push(s);y=a,p("subscribe waiting channels",e,r,a)}function u(e){var t=m[e];t.addListener(E,function(t){p("handshake successful="+t.successful,e,t),t.successful&&(l(e),c(e))}),t.addListener(S,function(e){var s=e.subscription,a=g[s];if(!e.successful){if(_.test(e.error))return;return a&&(a.state=k),!x.test(e.error)||a.tries>=b.subscribeMaxTries||a.totalTries>=b.subscribeMaxTotalTries?void r(s,R,{code:"subscribe",message:e.error||"",clientId:e.clientId}):void i(t,s)}a||(a=g[s]={state:null,proxies:{}}),a.state=T,a.clientId=e.clientId,r(s,w,{clientId:e.clientId,tries:a.tries}),t.addListener(s,function(e){var t,a=n(1496).findParseFn(e);(t=a&&a(e))&&r(s,N,{clientId:e.clientId,messages:t})})}),t.addListener(C,function(e){var t=e.subscription,n=g[t];if(!e.successful)return void r(t,R,{code:"unsubscribe",message:e.error||"",clientId:e.clientId});n&&(n.tries=0,n.state=k,r(t,A,{clientId:e.clientId}),delete g[t])})}function d(e){if(m[e])return!0;if(b.shutdown)return!1;var t=m[e]=n(2076).initComet(b[e+"Host"]);return t.config(["subscribe","jsonpTimeout"],b.subscribeTimeout),u(e),"connected"===t.getClientState()&&c(e),!0}function f(e){if(!e)return null;g[e]=g[e]||{state:null,proxies:{}};var t=o(e);if(!d(t))return null;var s=m[t],a=new(n(2082))(e);switch(g[e].proxies[a.id]=a,a.on("close",function(){g[e]&&g[e].proxies&&g[e].proxies[a.id]&&(delete g[e].proxies[a.id],!h.isEmpty(a.proxies)||g[e].state!==T&&g[e].state!==I||s.unsubscribe(e))}),g[e].state){case T:setImmediate(function(){g[e]&&a.emit(w,{clientId:g[e].clientId})});break;case I:break;default:s&&a.state!==T&&a.state!==I&&("connected"===s.getClientState()?(a.tries=0,a.state=I,i(s,e)):y.indexOf(e)<0&&y.push(e))}return a}var p=n(3)("TDPipe:comet"),h={isEmpty:n(211),merge:n(26)};n(69);var m={},g={},y=[],v={publicHost:"https://comet.yahoo.com/comet",privateHost:"https://comet.yahoo.com/comet",shutdown:!1,subscribeMaxTries:1,subscribeTimeout:5e3},b=h.merge({},v),_=/^408:\d+:jsonp timeout$/,x=/^500::jsonp failed$/,S="/meta/subscribe",C="/meta/unsubscribe",E="/meta/handshake",I="opening",T="open",k="closed",M="private",O="public",w="open",A="close",N="message",R="error";e.exports={addParser:n(1496).add.bind(n(1496)),config:s,getCometType:o,getConfigs:a,open:f}},1668:function(e,t,n){"use strict";function s(e,t){var n=setTimeout(e,t);return{timeout:n,cancel:function(){clearTimeout(n)}}}function a(e,t,n){if(t){t=t.split(".");for(var s=e,a=0,o=t.length;a<o;a++)a===o-1?s[t[a]]=n:(void 0===s[t[a]]&&(s[t[a]]={}),s=s[t[a]]);return e}}e.exports={later:s,setObjectValue:a}},1669:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(8)),d=s(n(2084)),f=function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),i(t,[{key:"renderCommentNode",value:function(e,t){var n=this.props,s=n.cpos,a=void 0===s?null:s,o=n.deepLink,r=void 0===o?{}:o,i=e.tags,l=e&&e.meta&&e.meta.contextInfo||{},f=l.url||n.parentContextUrl||"",p=l.displayText||n.parentContextDisplayText||"",h=r.replyId&&r.replyId===e.replyId,m=!h&&!e.replyId&&r.messageId===e.messageId,g=(0,u.default)(n.itemClassName,{"Bgc(#f4f9ff)":h||m}),y=null===a;return c.default.createElement(d.default,{className:g,contextId:e.contextId,cpos:y?t:a,data:e,isReadOnly:n.isReadOnly,key:"comment-"+(e.replyId||e.messageId),messageNamespace:e.namespace,parentContextDisplayText:p,parentContextUrl:f,parentTags:y&&i.length?i:[],pos:y?null:t,replySortBy:n.replySortBy,seeMore:this.context.componentConfig.ui.seeMore,sortBy:n.sortBy})}},{key:"render",value:function(){var e=this.props,t=e.list;return t&&t.length?c.default.createElement("ul",{className:(0,u.default)("comments-list List(n) Ovs(touch) Pos(r)",e.className)},t.map(this.renderCommentNode,this)):null}}]),t}(n(1).PureComponent);f.defaultProps={cpos:null,isReadOnly:!1,itemClassName:"",list:[],sortBy:""},f.contextTypes={componentConfig:l.default.object.isRequired},t.default=f,e.exports=t.default},1670:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e){return e.getIn(["gifs",0,"image","resolutions"])}function o(e){return e.get("blogName","")}Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(11)),i=s(n(318)),l=s(n(2));t.default=(0,i.default)({storeName:"CanvassTumblrStore",statics:{handlers:{TUMBLR_RELOAD:"reloadCache",TUMBLR_LOAD_GIFS:"loadGifs",TUMBLR_LOAD_GIFS_ERROR:"loadGifsError"}},initialize:function(){this._state=r.default.fromJS({data:{}})},reloadCache:function(){return this.emitChange()},loadGifs:function(e){var t=e.key,n=r.default.fromJS(e.data.gifresult),s=(0,l.default)(e,["data","offset"],0),i=n.map(a),c=n.map(o);e.offset&&this.get("data").getIn([t]).size&&(i=this.get("data").getIn([t,"stickers"]).concat(i),c=this.get("data").getIn([t,"authors"]).concat(c)),this.mergeState({data:this.get("data").mergeIn([t],{stickers:i,authors:c,offset:s,error:null})})},loadGifsError:function(e){var t=e.key,n=this.get("data").getIn([t,"error"]),s=e.error||"TUMBLR_LOAD_ERROR";if(s===n)return this.emitChange();var a=null,o=null;e.offset&&this.get("data").getIn([t]).size&&(a=this.get("data").getIn([t,"stickers"]),o=this.get("data").getIn([t,"authors"])),this.mergeState({data:this.get("data").mergeIn([t],{stickers:a,authors:o,offset:e.offset,error:s})})}}),e.exports=t.default},1834:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=s(n(11));t.default=(0,s(n(318)).default)({storeName:"CanvassSentimentsStore",handlers:{CANVASS_GET_SENTIMENTS_SUCCESS:"_getSentimentsSuccess"},initialize:function(){this._state=a.default.fromJS({sentiments:{}})},_getSentimentsSuccess:function(e){e.instanceId&&e.sentiments&&this.mergeState(this._state.setIn(["sentiments",e.instanceId],a.default.fromJS(e.sentiments)))},getSentiments:function(e){return this._state.getIn(["sentiments",e],a.default.List())}}),e.exports=t.default},1835:function(e,t,n){e.exports={comet:n(1667),messageParsers:n(1496),Pipe:n(2083)}},1836:function(e,t,n){(function(t){function s(){this.uri=null,this.catch_up=!1,this.script=null,this.protocol="https://",this.meta={handshake:{channel:"/meta/handshake",version:"1.0",supportedConnectionTypes:["long-polling"]},connect:{channel:"/meta/connect",connectionType:"long-polling"},subscribe:{channel:"/meta/subscribe"},unsubscribe:{channel:"/meta/unsubscribe"},publish:{},disconnect:{channel:"/meta/disconnect"},ack:{channel:"/meta/ack"}},this.ioCfg={method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"}},this.ext={all:{},handshake:{},subscribe:{"Comet-api-version":"1.1","Comet-subscriber-auth-info":null},unsubscribe:{"Comet-api-version":"1.1","Comet-subscriber-auth-info":null},connect:{},publish:{"Comet-api-version":"1.1","Comet-registration-id":"make-up","Comet-opaque-id":"markup","Comet-acknowledge-URI":"www.yahoo.com/ack","Comet-acknowledge-type":"All"},disconnect:{}},this._clientState="unconnected",this._advice={},this._connected=!1,this._config={backoffIncrement:1e3,maxBackoff:1e4,maxNetworkDelay:3e5,delayedSendMaxCount:10,advice:{timeout:6e4,interval:0,reconnect:"retry"},subscribe:{jsonpTimeout:5e3}},this._delayedSendCount=0,this._urlOrigin="",this._backoff=0,this._isLongpollingConnect=!1,this._isSendingQueue=!1,this._isShutdown=!1,this._clientId=null,this._token=null,this._lastMessageId=0,this._outgoing=[],this._subscribeChannel={},this._ioQueue_c2s=null,this._ioQueue_s2c=null,this._jsonp=null,this._listeners={}}function a(e,t,n){var a=e.replace(/https:/,"http:");return"/"===a.substr(-1)&&(a=a.substring(0,a.length-1)),o[a]||(o[a]=new s,o[a]._initXMLHttpRequest(),o[a].clearListeners()),t&&o[a].addListener("/meta/handshake",t),o[a].initBayeux(e,function(e){},n),o[a]}var o={};s.prototype._initXMLHttpRequest=function(){this._ioQueue_c2s=new XMLHttpRequest({xdomain:!0,enablesXDR:!0}),this._ioQueue_s2c=new XMLHttpRequest({xdomain:!0,enablesXDR:!0})},s.prototype.setUri=function(e){if(null!==e){var t=e.toLowerCase();-1!==t.indexOf("https://")?this.protocol="https://":-1!==t.indexOf("http://")&&(this.protocol="http://"),this.uri=e}},s.prototype.initializer=function(){this.setClientState("unconnected")},s.prototype.config=function(e,t){this._config[e]=t},s.prototype._Queue_send=function(e){var t=this;t._batch(e),t.getClientId()&&(t._isSendingQueue||t._outgoing.length<=0||(t._outgoing.forEach(function(e){e=t._patchMessage(e)}),t._IO_send(!0,t._outgoing),t._outgoing=[]))},s.prototype._nextQueueSend=function(){this._Queue_send()},s.prototype._IO_send=function(e,t){var n=this;if(n.uri)if(e){if(n._isSendingQueue||!t)return;n._IO_Queue_Send(t)}else{if(!n.getClientId())return;if(n._isLongpollingConnect||!t)return;n._IO_Longpolling_Send(t)}},s.prototype._IO_Queue_Send=function(e){var t=this;if(t.setTokenHeader(t._token),!t._isShutdown){t._XHRPolling(this._ioQueue_c2s,{data:e,ontimeout:function(){t._isSendingQueue=!1,t._nextQueueSend(),t._handleFailure(e,"500::io failed")},onstart:function(){t._isSendingQueue=!0},oncomplete:function(){t._isSendingQueue=!1,t._nextQueueSend()},onsuccess:function(n){try{var s=JSON.parse(n);t._handleResponse(s)}catch(n){return void t._handleFailure(e,"json parse error")}},onerror:function(){t._handleFailure(e,"500::io failed")}})}},s.prototype._XHRPolling=function(e,t){var n=this,s=JSON.stringify(t.data);e.open(n.ioCfg.method,n.uri);var a;for(a in n.ioCfg.headers)Object.prototype.hasOwnProperty.call(n.ioCfg.headers,a)&&e.setRequestHeader(a,n.ioCfg.headers[a]);(Object.prototype.hasOwnProperty.call(e,"withCredentials")||Object.getPrototypeOf(e).hasOwnProperty("withCredentials"))&&(e.withCredentials=!0),e.timeout=n._config.maxNetworkDelay,e.ontimeout=t.ontimeout,e.onreadystatechange=function(){switch(e.readyState){case 1:t.onstart&&t.onstart();break;case 2:case 3:break;case 4:t.oncomplete&&t.oncomplete(),200===e.status||1223===e.status?t.onsuccess&&t.onsuccess(e.responseText):t.onerror&&t.onerror();break;default:t.onerror&&t.onerror()}},t.onstart&&t.onstart(),e.send(s)},s.prototype._JSONPPolling=function(e){var t=this,n=t.uri+"?callback=Bayeux_Client_SDK_JSONP_Callback";if(n=n+"&data="+encodeURIComponent(JSON.stringify(e.data)),"undefined"!=typeof document){var s=document.createElement("script");t.script&&(t.script.parentNode.removeChild(this.script),t.script=null),s.async=!0,s.src=n,e.onsuccess&&"undefined"!=typeof window&&(window.Bayeux_Client_SDK_JSONP_Callback=e.onsuccess),e.onerror&&(s.onerror=e.onerror);var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(s,a),this.script=s}},s.prototype._IO_Jsonp_Send=function(e){var t=this;if(t.uri){t._JSONPPolling({data:e,onerror:function(){t._handleFailure(e,"500::jsonp failed")},onsuccess:function(e){t._handleResponse(e)}})}},s.prototype._IO_Longpolling_Send=function(e){var t=this;if(t.setTokenHeader(t._token),!t._isShutdown){t._XHRPolling(this._ioQueue_s2c,{data:e,ontimeout:function(){t._handleFailure(e,"500::io failed")},onstart:function(){t._isLongpollingConnect=!0},oncomplete:function(){t._isLongpollingConnect=!1},onsuccess:function(n){try{var s=JSON.parse(n);t._handleResponse(s)}catch(n){return void t._handleFailure(e,"json parse error")}},onerror:function(){t._isLongpollingConnect=!1,t._handleFailure(e,"500::io failed")}})}},s.prototype._handleResponse=function(e){if(void 0!==e&&null!==e){var t=this;e.forEach(function(e){switch(t._updateAdvice(e.advice),e.originalURI=t._urlOrigin,e.channel){case"/meta/handshake":t._handshakeResponse(e);break;case"/meta/connect":t._connectResponse(e);break;case"/meta/disconnect":t._disconnectResponse(e);break;case"/meta/subscribe":t._subscribeResponse(e);break;case"/meta/shutdown":t._shutdownResponse(e);break;case"/meta/unsubscribe":t._unsubscribeResponse(e);break;default:t._messageResponse(e)}})}},s.prototype._updateAdvice=function(e){this._advice=e?this._mixin(!1,{},this._config.advice,e):this._config.advice},s.prototype._handshakeResponse=function(e){var t=this;if(e.successful){t.setClientState("connected"),t._clientId=e.clientId,t._advice.VIP&&t.setUri(t.protocol+t._advice.VIP+"/comet"),t._notifyListeners("/meta/handshake",e),t._Queue_send();switch(t._isDisconnected()?"none":t._advice.reconnect){case"retry":t._resetBackoff(),t._delayedConnect();break;case"handshake":t.setClientState("unconnected"),t._resetBackoff(),t._delayedHandshake();break;case"none":t._disconnect(!1)}}else t._failHandshake(e)},s.prototype._failHandshake=function(e){var t=this;t.setClientState("unconnected"),t._clientId=null,t._notifyListeners("/meta/handshake",e),t._notifyListeners("/meta/unsuccessful",e),"none"!==t._advice.reconnect?(t._increaseBackoff(),t._delayedHandshake()):t._disconnect(!1)},s.prototype._delayedHandshake=function(){var e=this;this._delayedSend(function(){e._handshake()})},s.prototype._subscribeResponse=function(e){e.successful?(this._subscribeChannel[e.subscription]&&!0===this._subscribeChannel[e.subscription]||(this._subscribeChannel[e.subscription]=!0),e.ext["Comet-auth-token"]&&(this._token=e.ext["Comet-auth-token"]),this._notifyListeners("/meta/subscribe",e)):this._failSubscribe(e)},s.prototype._failSubscribe=function(e){this._notifyListeners("/meta/subscribe",e),this._notifyListeners("/meta/unsuccessful",e)},s.prototype._connectResponse=function(e){var t=this;if(!t._isDisconnected())if(t._connected=e.successful){t.setClientState("connected"),t._notifyListeners("/meta/connect",e);var n=t._isDisconnected()?"none":t._advice.reconnect;switch(n){case"retry":t._resetBackoff(),t._delayedConnect();break;case"handshake":t.setClientState("unconnected"),t._resetBackoff(),t._delayedHandshake();break;case"none":t._disconnect(!1)}}else t._failConnect(e)},s.prototype._failConnect=function(e){var t=this;switch(t._notifyListeners("/meta/connect",e),t._notifyListeners("/meta/unsuccessful",e),t._isDisconnected()?"none":t._advice.reconnect){case"retry":case"subscribe":t._delayedConnect(),t._increaseBackoff();break;case"handshake":t.setClientState("unconnected"),t._resetBackoff(),t._delayedHandshake();break;case"none":t._disconnect(!1)}},s.prototype._delayedConnect=function(){var e=this;this._delayedSend(function(){e._connect()})},s.prototype._disconnectResponse=function(e){e.successful?(this._disconnect(!1),this._notifyListeners("/meta/disconnect",e)):this._failDisconnect(e)},s.prototype._shutdownResponse=function(e){this._disconnect(!0),this._isShutdown=!0,this._notifyListeners("/meta/shutdown",e)},s.prototype._failDisconnect=function(e){this._disconnect(!0),this._notifyListeners("/meta/disconnect",e),this._notifyListeners("/meta/unsuccessful",e)},s.prototype._unsubscribeResponse=function(e){e.successful?(this._subscribeChannel[e.subscription]&&!0===this._subscribeChannel[e.subscription]&&delete this._subscribeChannel[e.subscription],this._notifyListeners("/meta/unsubscribe",e)):this._failUnsubscribe(e)},s.prototype._failUnsubscribe=function(e){this._notifyListeners("/meta/unsubscribe",e),this._notifyListeners("/meta/unsuccessful",e)},s.prototype._messageResponse=function(e){if(void 0===e.successful)if(e.data){var t=n(2077);t.sendNotificationReceived({n_app_id:location.origin,n_rcv_ch:"comet"}),this._notifyListeners(e.channel,e),e.id&&this._ackMessage({msgId:e.id,msgChannel:e.channel})}else this._notifyListeners("/meta/unsuccessful",e);else e.successful?this._notifyListeners("/meta/publish",e):this._failMessage(e)},s.prototype._ackMessage=function(e){this._Queue_send(this._createMessage("ack",e))},s.prototype._failMessage=function(e){this._notifyListeners("/meta/publish",e),this._notifyListeners("/meta/unsuccessful",e)},s.prototype._delayedSend=function(e){var t=this,n=t._advice.interval+t._backoff;if(t._config.maxBackoff<=t._backoff?t._delayedSendCount++:t._delayedSendCount=0,t._delayedSendCount>t._config.delayedSendMaxCount){var s=t.uri;if(t.setUri(t._urlOrigin),s===t.uri)return;t._resetBackoff(),t._delayedSendCount=0}setTimeout(e,n)},s.prototype._handshakeFailure=function(e,t){this._failHandshake({successful:!1,failure:!0,channel:"/meta/handshake",request:e,advice:{reconnect:"retry",interval:this._backoff},error:t||"",ext:e.ext||{},id:e.id||""})},s.prototype._connectFailure=function(e,t){this._connected=!1,this._failConnect({successful:!1,failure:!0,channel:"/meta/connect",request:e,advice:{reconnect:"retry",interval:this._backoff},clientId:e.clientId||"",error:t||"",ext:e.ext||{},id:e.id||""})},s.prototype._disconnectFailure=function(e,t){this._failDisconnect({successful:!1,failure:!0,channel:"/meta/disconnect",request:e,advice:{reconnect:"none",interval:0},clientId:e.clientId||"",error:t||"",ext:e.ext||{},id:e.id||""})},s.prototype._subscribeFailure=function(e,t){this._failSubscribe({successful:!1,failure:!0,channel:"/meta/subscribe",request:e,advice:{reconnect:"none",interval:0},clientId:e.clientId||"",subscription:e.subscription||"",error:t||"",ext:e.ext||{},id:e.id||""})},s.prototype._unsubscribeFailure=function(e,t){this._failUnsubscribe({successful:!1,failure:!0,channel:"/meta/unsubscribe",request:e,advice:{reconnect:"none",interval:0},clientId:e.clientId||"",subscription:e.subscription||"",error:t||"",ext:e.ext||{},id:e.id||""})},s.prototype._messageFailure=function(e,t){this._failMessage({successful:!1,failure:!0,channel:e.channel,request:e,advice:{reconnect:"none",interval:0},clientId:e.clientId||"",subscription:e.subscription||"",error:t||"",ext:e.ext||{},id:e.id||""})},s.prototype._handleFailure=function(e,t){var n,s;for(s=0;s<e.length;++s)switch(n=e[s],n.channel){case"/meta/handshake":this._handshakeFailure(n,t);break;case"/meta/connect":this._connectFailure(n,t);break;case"/meta/disconnect":this._disconnectFailure(n,t);break;case"/meta/subscribe":this._subscribeFailure(n,t);break;case"/meta/unsubscribe":this._unsubscribeFailure(n,t);break;default:this._messageFailure(n,t)}},s.prototype._notifyListeners=function(e,t){this._notify(e,t),this._notify(e+"/*",t);var n,s=e.split("/"),a=s.length-1,o=0;for(o=a;o>0;--o)(n=s.slice(0,o).join("/")+"/*")!==e&&this._notify(n,t)},s.prototype._notify=function(e,t){var n=this._listeners[e];n&&n.forEach(function(e){"function"==typeof e.listener&&e.listener(t)})},s.prototype._isDisconnected=function(){return"unconnected"===this._clientState},s.prototype._resetBackoff=function(){this._backoff=0},s.prototype._nextMessageId=function(){return++this._lastMessageId+""},s.prototype._increaseBackoff=function(){this._backoff<this._config.maxBackoff&&(this._backoff+=this._config.backoffIncrement)},s.prototype.merge=function(){for(var e,t,n=0,s=arguments.length,a={};n<s;++n){t=arguments[n];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&(a[e]=t[e])}return a},s.prototype._createMessage=function(e,t){t=t||{};var n=(new Date).valueOf(),s="",a=[],o={};"undefined"!=typeof window&&(s=window.location.host),this.catch_up&&(o={version:"1.2"});var r=this.merge(this.ext.all,this.ext[e],t.ext||{},{timestamp:n,host:s||""});switch(e){case"handshake":a.push(this.merge({id:this._nextMessageId(),ext:r},this.meta[e],o));break;case"connect":a.push(this.merge({id:this._nextMessageId(),ext:r},this.meta[e],{clientId:this.getClientId()}));break;case"subscribe":case"unsubscribe":a.push(this.merge({id:this._nextMessageId(),ext:r},this.meta[e],{clientId:this.getClientId(),subscription:t.channel}));break;case"publish":a.push(this.merge({id:this._nextMessageId(),ext:r},this.meta[e],{clientId:this.getClientId(),channel:t.channel,data:t.data}));break;case"disconnect":a.push(this.merge({id:this._nextMessageId(),ext:r},this.meta[e],{clientId:this.getClientId()}));break;case"ack":a.push(this.merge({id:this._nextMessageId(),ext:r,msgId:t.msgId,msgChannel:t.msgChannel},this.meta[e],{clientId:this.getClientId()}))}return a},s.prototype._handshake=function(e){var t=this;if("unconnected"===t.getClientState()){e&&e.listener&&t._addListener(e,!1),t._clientId=null,t._token=null,t.resetTokenHeader(),t._clearSubscriptions(),t._updateAdvice(t._config.advice);t._IO_send(!0,t._createMessage("handshake",e)),t.setClientState("connecting")}else if("connected"===t.getClientState()){var n={successful:!0,channel:"/meta/handshake",clientId:t._clientId,originalURI:t._urlOrigin};t._notifyListeners("/meta/handshake",n)}},s.prototype._connect=function(e){var t=this;if("connected"===t.getClientState()&&!t._isLongpollingConnect){t._IO_send(!1,t._createMessage("connect",e))}},s.prototype._subscribeJSONP=function(e){if(e&&e.channel&&this.getClientId()&&(!this._subscribeChannel[e.channel]||!0!==this._subscribeChannel[e.channel])){e.listener&&this._addListener(e,!0);this._IO_Jsonp_Send(this._createMessage("subscribe",e))}},s.prototype._unsubscribe=function(e){if(this.getClientId()&&(e&&e.channel&&this.removeListeners(e.channel),e&&e.channel)){this._Queue_send(this._createMessage("unsubscribe",e))}},s.prototype._disconnect=function(e){var t=this;if(e&&(t._ioQueue_c2s.abort(),t._ioQueue_s2c.abort()),t.setClientState("unconnected"),t._clientId=null,t._resetBackoff(),t._outgoing.length>0){var n=t._outgoing;t._outgoing=[],t._handleFailure(n,"500::canceled after disconnect")}t._clearSubscriptions()},s.prototype._patchMessage=function(e){return e.id||(e.id=this._nextMessageId()),e.clientId=this.getClientId(),"/meta/handshake"===e.channel&&delete e.clientId,e},s.prototype._batch=function(){var e=this,t=Array.prototype.slice.call(arguments);(e.isArray(t)||0===t.length)&&t.forEach(function(t){if(t&&e.isArray(t)){var n=0;for(n=0;n<t.length;++n)e._outgoing.push(t[n])}else t&&e._outgoing.push(t)})},s.prototype.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s.prototype._clearSubscriptions=function(){var e,t=this;for(e in t._listeners)if(Object.prototype.hasOwnProperty.call(t._listeners,e)){var n=t._listeners[e];n&&t.isArray(n)&&n.forEach(function(e,t,n){e&&e.isSub&&n.splice(t)})}this._subscribeChannel={}},s.prototype.isDuplicatedListener=function(e,t){var n=0;for(n=0;n<t.length;++n){var s=t[n];if(s&&s.listener&&s.listener.toString()===e.toString())return!0}return!1},s.prototype._addListener=function(e,t,n){e&&e.listener&&"function"==typeof e.listener&&(this._listeners[e.channel]?!n&&this.isDuplicatedListener(e.listener,this._listeners[e.channel])||this._listeners[e.channel].push({listener:e.listener,isSub:t}):this._listeners[e.channel]=[{listener:e.listener,isSub:t}])},s.prototype._mixin=function(e,t,n){var s,a,o=t||{};for(s=2;s<arguments.length;++s){var r=arguments[s];if(void 0!==r&&null!==r)for(a in r)if(Object.prototype.hasOwnProperty.call(r,a)){var i=r[a],l=o[a];if(i===t)continue;if(void 0===i)continue;o[a]=e&&"object"==typeof i&&null!==i?i instanceof Array?this._mixin(e,l instanceof Array?l:[],i):this._mixin(e,{},i):i}}return o},s.prototype.destructor=function(){},s.prototype.getClientState=function(){return this._clientState},s.prototype.setClientState=function(e){this._clientState=e},s.prototype.getClientId=function(){return this._clientId},s.prototype.initBayeux=function(e,t,n){this._urlOrigin=e,this.setUri(e),this.catch_up=n||!1,this._handshake({channel:"/meta/handshake",listener:t})},s.prototype.subscribe=function(e,t){this._subscribeJSONP({channel:e,listener:t})},s.prototype.unsubscribe=function(e){this._unsubscribe({channel:e})},s.prototype.disconnect=function(e){var t=this;if(e&&t._addListener({channel:"/meta/disconnect",listener:e},!1),"unconnected"!==t.getClientState()&&t.getClientId()){t._Queue_send(t._createMessage("disconnect"))}},s.prototype.publishMsg=function(e,t){if(e&&t){this._Queue_send(this._createMessage("publish",{channel:e,data:t}))}},s.prototype.clearListeners=function(){this._listeners={}},s.prototype.addListener=function(e,t,n){n=n||!1,(t||"function"!=typeof t)&&this._addListener({channel:e,listener:t},!1,n)},s.prototype.removeListeners=function(e){this._listeners[e]&&delete this._listeners[e]},s.prototype.setUserInfo=function(e,t){if(e&&t){this.ext.subscribe["Comet-subscriber-auth-info"]={uid:e,user_type:"yahoo",user_cred:t}}},s.prototype.setUserInfoWithCookie=function(e,t){if(e){this.ext.subscribe["Comet-subscriber-auth-info"]={uid:e,user_type:"yahoo",user_cred:"Any Value"}}},s.prototype.setTokenHeader=function(e){if(e){this.ioCfg.headers.Authorization="Basic token="+e}},s.prototype.resetTokenHeader=function(){this.ioCfg.headers.Authorization="Basic token="},s.prototype.setYcaHeader=function(e,t){if(e){this.ioCfg.headers["Yahoo-App-Auth"]=e}if(t){this.ext.publish["Comet-opaque-id"]=t}},Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,s=this.length;n<s;++n)e.call(t,this[n],n,this)});e.exports={Comet:s,initComet:a},t.Comet=s,t.initComet=a}).call(t,n(47))},1837:function(e,t){function n(){for(var e=0,t="",n="";e<16;e++){var s=Math.floor(62*Math.random());n=s<10?s:String.fromCharCode(s<36?s+55:s+61),t+=n}return t+","+Math.random()}function s(e,t){if(e.length>32){var n="Invalid key length for "+e+". Must be <= 32";throw new Error(n)}if(!/^[\w\-_\u0080-\uFFFF]+$/.exec(e)){var s="Invalid key "+e;throw new Error(s)}if(!/^[\u0002\u0020-\uFFFF]+$/.exec(t)){var a="Invalid value for "+e;throw new Error(a)}}function a(e){for(var t in e)e.hasOwnProperty(t)&&s(t,e[t])}function o(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function r(e,t){for(var n in t)t.hasOwnProperty(n)&&(s(n,t[n]),e[n]=t[n])}function i(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function l(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(s(n,e[n]),t[n]=e[n]);return t}function c(){(this.newTime=function(){this.date=new Date,this.ts=Math.floor(this.date.getTime()/1e3),this.ms=this.date.getMilliseconds()})()}Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),e.exports={cacheBuster:n,validate:s,validateObj:a,absorb:o,absorbValid:r,clone:i,cloneValid:l,time:new c}},1838:function(e,t,n){"use strict";function s(e,t,n){function s(t,s){if(t||!s||s.error)return e.dispatch("CANVASS_VOTE_FAILURE",t),n();e.dispatch("CANVASS_VOTE_SUCCESS",c),n()}var o={},r="clear"===t.voteType?"delete":"update",i=t.replyId?"canvass.voteReply_ns":"canvass.voteMessage_ns",l=e.getStore(a.default).getState(),c=Object.assign({lang:l.lang,region:l.region,oauthConsumerKey:l.oauthConsumerKey,oauthConsumerSecret:l.oauthConsumerSecret},t);"update"===r?e.service.update(i,c,o,{},function(e,t){s(e,t)}):"delete"===r&&e.service.delete(i,c,{},function(e,t){s(e,t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var a=function(e){return e&&e.__esModule?e:{default:e}}(n(115));e.exports=t.default},1839:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),c=s(n(0)),u=s(n(1)),d=s(n(1327)),f=(0,n(29).createI13nNode)("textarea",{bindClickEvent:!0}),p=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,d.default)(n,["onKeyDown"]),n.state={height:"auto",rows:n.props.rows},n}return r(t,e),l(t,[{key:"componentDidMount",value:function(){var e=this.props.value,t=e&&e.length;if(t){var s=(0,n(10).findDOMNode)(this);s&&(s.value=e,s.setSelectionRange&&s.setSelectionRange(t,t))}}},{key:"componentDidUpdate",value:function(e,t){t.rows!==this.state.rows&&this.context.handleResize()}},{key:"onKeyDown",value:function(e){if("Enter"===e.key&&this.setState({rows:this.state.rows+1}),"Backspace"===e.key&&1!==this.state.rows){var t=e.target.value.split("\n");t[t.length-1]||this.setState({rows:this.state.rows-1})}}},{key:"render",value:function(){var e=Object.assign({},this.props);return delete e.hasAutoExpand,delete e.value,u.default.createElement(f,i({},e,{i13nModel:(0,n(1312).getI13nModel)("text-input"),onKeyDown:this.onKeyDown,rows:this.state.rows,style:{resize:"none"}}))}}]),t}(n(1).PureComponent);p.defaultProps={className:"text-area",hasAutoExpand:!0},p.contextTypes={handleResize:c.default.func.isRequired},t.default=p,e.exports=t.default},1840:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(1327)),d=s(n(2)),f=s(n(1600)),p=s(n(512)),h=function(e){function t(e,s){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=(0,d.default)(s,["componentConfig","ui","loginSrc"]);return(0,u.default)(r,["setLoginLink"]),r.state={loginUrl:(0,n(1497).getLoginUrl)(s,e.messageId,e.replyId,i)},r}return r(t,e),i(t,[{key:"componentWillMount",value:function(){this.onLoginClick=this.onLoginClick.bind(this)}},{key:"componentDidMount",value:function(){this.loginLink.focus()}},{key:"handleClickOutside",value:function(e){this.props.handleToggleToolTip()}},{key:"onLoginClick",value:function(){var e=this.context;e.executeAction(f.default,{context:e.context,loginUrl:this.state.loginUrl})}},{key:"setLoginLink",value:function(e){this.loginLink=(0,n(10).findDOMNode)(e)}},{key:"render",value:function(){var e=this.context,t=this.props,s=t.className,a=e.session.dimensions.authed,o=this.state.loginUrl,r="CANVASS_PLEASE_SIGN_IN"+("2"===a?"_AGAIN":"");return c.default.createElement("div",{className:"tooltip Bgc(#fff) Bd Bdrs(3px) Bdc(#d8dade) Pos(a) Z(1) Whs(nw) Start(50%) TranslateX(-50%)"+(s?" "+s:"")},c.default.createElement(n(1312).I13nAnchor,{className:"tooltip-signin C($fg-link) D(ib) P(10px)",follow:!1,href:o,i13nModel:(0,n(1312).getI13nModel)("login"),onClick:this.onLoginClick,ref:this.setLoginLink,target:"_top"},e.intl.formatMessage({id:r})))}}]),t}(n(1).PureComponent);h.contextTypes={componentConfig:l.default.object.isRequired,context:l.default.string,executeAction:l.default.func.isRequired,intl:l.default.object,session:l.default.object},t.default=(0,p.default)(h),e.exports=t.default},1841:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=s(n(0)),o=s(n(1)),r=s(n(8)),i=s(n(1208)),l=s(n(1599)),c=s(n(1842)),u=(0,n(29).createI13nNode)(i.default,{isLeafNode:!1}),d=function(e,t){var s=e.creator,a=e.fromCommentForm,i=void 0===a?null:a,l=e.imageUrl,c=e.isReadOnly,d=e.isReply,f=t.guid,p=t.intl,h=t.isUserMessageHistory,m=t.handleUserMessages,g=t.pos,y=void 0===g?null:g,v=s===f,b=m&&!h&&!c,_=e.name;_=_||p.formatMessage({id:"CANVASS_ANONYMOUS"});var x=b?m.bind(void 0,s,l,_):null,S=v?p.formatMessage({id:"CANVASS_SEE_MY_HISTORY"}):p.formatMessage({id:"CANVASS_SEE_USERS_HISTORY"},{user:_}),C=(0,r.default)("Bdrs(46.5%) Pos(a) Start(0)",{"Cur(p)":b}),E=b?n(29).I13nButton:n(29).I13nDiv,I=(0,r.default)("D(ib) Fw(b) P(0) Bd(0) M(0) Mend(10px) Fz(14px) Ta(start)",{"C($c-fuji-grey-l)":!b,"C($c-fuji-blue-1-a)":b}),T=d||null!==y?28:40;return[o.default.createElement(u,{bindClickEvent:b,i13nModel:(0,n(1312).getI13nModel)("user-avatar-tap"),key:"avatar",className:C,enableAlphatar:!0,forceLoad:!0,name:_,onClick:x,size:T,src:l,title:h?"":S}),i?null:o.default.createElement(E,{"aria-label":b?S:void 0,bindClickEvent:b,className:I,i13nModel:(0,n(1312).getI13nModel)("user-name-tap"),key:"username",onClick:x},_)]},f=function(e,t){var s=t.intl,a=e.fromCommentForm,i=e.activityAt,u=e.createdAt,f=e.isReply,p=e.replyCount,h=e.sortBy,m=(0,r.default)("Fz(13px)",{"Mend(20px)":!a,"Mt(14px) Fl(start)":a,"Mt(20px)":a&&f}),g="newest"===h&&p&&i&&i!==u,y=t.isUserMessageHistory&&e.replyId&&null===e.pos;return o.default.createElement("div",{className:m},d.call(void 0,e,t),u?o.default.createElement(l.default,null,o.default.createElement("span",{className:"C($c-fuji-grey-g) Fz(12px)"},o.default.createElement("span",{className:y?"Mend(12px)":void 0},s.formatRelative(u)),g?o.default.createElement("span",null,o.default.createElement("i",{"aria-hidden":"true",className:"Mx(8px)"},"•"),s.formatMessage({id:"CANVASS_LAST_REPLY_TIME"},{timeAgo:s.formatRelative(i)})):void 0,y?o.default.createElement("span",{className:"Whs(nw)"},o.default.createElement(n(34).Icon,{asset:c.default,className:"Mend(2px) Mb(2px)",color:"#878c91",cursorClass:"Cur(d)",height:12,width:12,style:{verticalAlign:"middle"}}),s.formatMessage({id:"CANVASS_REPLIED"})):void 0)):null)};f.contextTypes={guid:a.default.string,handleUserMessages:a.default.func,intl:a.default.object.isRequired,isUserMessageHistory:a.default.bool,pos:a.default.number},t.default=f,e.exports=t.default},1842:function(e,t){if(void 0===n)var n={};n.reply={name:"reply",height:20,width:25,path:"M12.8 5.8V2.4c0-.4-.2-.7-.6-.8-.3-.2-.8-.1-1.1.1L.9 8.8c-.2.2-.4.4-.4.7s.2.6.4.8l10.2 7.1c.3.2.7.3 1.1.1.3-.2.6-.5.6-.8v-3.3h1.3c3 0 6.1.6 8.5 5.2.2.3.5.5.9.5h.3c.5-.1.8-.6.7-1C23 7.3 18.5 5.9 12.8 5.8zm-.1 5.6h-1c-.6 0-1 .4-1 .9v2.4L3.2 9.5l7.5-5.2v2.4c0 .5.5.9 1 .9 4.2 0 7.9 0 9.8 6.3-2.9-2.6-6.3-2.6-8.8-2.5z"},void 0!==e&&e.exports&&(e.exports=n.reply)},1843:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(1467)),d=s(n(1327)),f=s(n(2)),p=s(n(1599)),h=s(n(93)),m=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,d.default)(n,["handleClick","handleImgError","handleRemoveImage"]),n}return r(t,e),i(t,[{key:"handleRemoveImage",value:function(e){this.props.onLinkUpdate(!1,!0),(0,n(1312).fireRapidClick)({slk:"link-prvw-close",elm:"cmmt_link",itc:1,outcm:"close"}),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},{key:"handleImgError",value:function(e){e.target.classList.add("D(n)!")}},{key:"handleClick",value:function(){var e=this.props,t=e.enhancedLink;if(e.fromStream){var s=this.context.i13n.getI13nNode().getMergedModel();s.slk="smartlink",s.elm="cmmt_link",s.itc=0,s.outcm="navigate",(0,n(1312).fireRapidClick)(s),t.url&&window.open(t.url)}}},{key:"renderImg",value:function(){var e=this.props.enhancedLink,t=(0,f.default)(e,["image","url"],null);return t&&c.default.createElement(p.default,null,c.default.createElement("img",{alt:e.title,className:"D(b) Bxz(bb) Mih(100px) Mah(200px) Maw(145px) W(a) Mend(5px) P(5px) Fl(start) Maw(n)--xxs W(100%)--xxs Fl(n)--xxs",onError:this.handleImgError,src:t}))}},{key:"render",value:function(){var e=this.props,t=e.enhancedLink,s=e.fromStream,a=this.context,o=a.contextId,r=a.tags;if(!t)return null;var i=t.title,l=void 0===i?"":i,d=t.description,f=void 0===d?"":d,p=t.url,m=p.indexOf("://")>-1?p.split("/")[2]:p.split("/")[0];s||(0,n(1312).fireRapidEvent)("secvw",{slk:"link-prvw-"+p,elm:"cmmnt_link",itc:1,outcm:"show",cat:r,g:o});var g=u.default.dedupe("Cf Bxsh(boxShadow) Mx(14px) panel Pos(r) Miw(150px) Lh(14px) Bgc(#fff) Bg(#fff) Bdrs(3px) Bdc(#d9d9d9) Bds(s) Bdw(1px) Mb(10px)",{"Cur(p) Mx(0) Mb(5px)":s});return c.default.createElement(n(29).I13nDiv,{bindClickEvent:!1,className:g,onClick:this.handleClick},this.renderImg(),c.default.createElement("div",{className:"P(5px)"},!1===s?c.default.createElement(n(1312).I13nButton,{className:"Pos(a) End(-10px) T(-10px) Bgc(#000) Op(0.8) Bdrs(50%) M(0) P(0) W(21px) H(21px)",i13nModel:(0,n(1312).getI13nModel)("link-prvw-close"),onClick:this.handleRemoveImage},c.default.createElement(n(34).Icon,{asset:h.default,width:13,height:13,color:"#fff",className:"Va(bl)!"})):null,c.default.createElement("div",{className:"LineClamp(2,54px) Fz(16px) Pt(5px) C($c-fuji-blue-4-b) Lh(18px) Mah(54px) Fw(500) Ov(h) Tov(e)"},l),c.default.createElement("div",{className:"LineClamp(2,42px) D(n)!--xxs Fz(13px) Mt(10px) Lh(14px) Mah(42px) Ov(h) Tov(e)"},f),c.default.createElement("div",{className:"Fz(11px) Td(n) Fw(n) D(ib) Mt(5px)!--xxs Mt(10px) Ell"},m)))}}]),t}(n(1).PureComponent);m.contextTypes={configStoreState:l.default.object,contextId:l.default.string,cpos:l.default.number,i13n:l.default.object,isUserMessageHistory:l.default.bool,pos:l.default.number,tags:l.default.string,userMessageHistoryGuid:l.default.string},t.default=m,e.exports=t.default},1844:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){var n=e.getStore(x.default),s=e.getStore(_.default),a=e.getStore(y.default),o=a.isActiveForm(t),r=a.getActiveForm();return{guid:n.getGUID(),isActive:o,isHidden:!o&&t.forReply&&(r.messageId===t.messageId||t.replyId),isProfileLoaded:s.isLoaded(),isSignedIn:n.isSignedIn(),userProfile:s.getProfile(),enhancedLink:Object.assign({},e.getStore(b.default).getState()),commentForm:Object.assign({},a.getState()),configStoreState:Object.assign({},e.getStore(v.default).getState())}}Object.defineProperty(t,"__esModule",{value:!0}),t.CommentForm=void 0;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),c=s(n(0)),u=s(n(1)),d=s(n(1467)),f=s(n(1327)),p=s(n(8)),h=s(n(2)),m=s(n(505)),g=s(n(297)),y=s(n(1598)),v=s(n(115)),b=s(n(1845)),_=s(n(299)),x=s(n(92)),S=s(n(2093)),C=s(n(566)),E=s(n(1846)),I=s(n(1600)),T=s(n(2094)),k=s(n(2095)),M=s(n(1841)),O=s(n(1196)),w=s(n(1206)),A=s(n(1843)),N=s(n(2096)),R=s(n(2097)),P=s(n(1839)),L=s(n(2098)),j=t.CommentForm=function(e){function t(e,s){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=(0,h.default)(s,["componentConfig","ui","loginSrc"]);return r.state={activeTab:null,commenting:!1,enableRelatedTags:!1,enhancedLink:!1,enhancedLinkRemoved:!1,errorStatus:null,loginUrl:(0,n(1497).getLoginUrl)(s,e.messageId,e.replyId,i),posting:!1,titleHovered:!1,validComment:!1},(0,f.default)(r,["handleBlur","handleCloseCommentForm","handleFocus","handleHeartbeatInterval","handleKeyUp","handleLinkUpdate","handleLoginLink","handlePaste","handlePost","handleRelatedTags","handleRemoveRelatedTags","handleShowTumblrStickers","handleSubmit","handleTitleClick","handleUserIdle","onKeyDown","onTitleHover"]),r}return r(t,e),l(t,[{key:"componentWillMount",value:function(){var e=this.context;this.canvassStore=e.getStore(g.default),this.commentFormStore=e.getStore(y.default)}},{key:"componentDidMount",value:function(){var e=this;e.handleCommentChanged(!!e.getCommentText()),e.props.isProfileLoaded||e.context.executeAction(C.default),setImmediate(function(){e.handleReplyFormInFocus()})}},{key:"componentWillUnmount",value:function(){this.setCommentingState(!1),clearTimeout(this.heartbeat),clearTimeout(this.userIdleTimer),this.commentFormStore.setFormInactive(this.props)}},{key:"getCommentText",value:function(){return(((0,n(10).findDOMNode)(this.refs.commentText)||{}).value||"").trim()}},{key:"handleCloseCommentForm",value:function(){this.props.handleCloseCommentForm()}},{key:"handleReplyFormInFocus",value:function(){var e=this.props,t=e.isSignedIn?(0,n(10).findDOMNode)(this.refs.commentText):(0,n(10).findDOMNode)(this.refs.loginPrompt);e.replyFormInFocus&&t&&t.focus()}},{key:"componentDidUpdate",value:function(){this.handleReplyFormInFocus(),this.context.handleResize()}},{key:"componentWillReceiveProps",value:function(e){var t=e.enhancedLink,s=e.commentForm,a=e.forReply,o=this.refs.submit,r=this.props,i=!r.isHidden&&e.isHidden,l=void 0;if(o&&this.state.posting&&!s.errorMessage&&(a&&s.messageId===r.messageId&&s.replyId||!a&&s.messageId&&!s.replyId)){this.handleLinkUpdate(!1,!1),this.setState({activeTab:null,commenting:!1,posting:!1,validComment:!1}),l={animated_gif_count:(0,h.default)(s,["details","imageMessageDetails","length"])||0,msg_id:s.replyId||s.messageId,rcv_msg_id:s.replyId?s.messageId:null,smartlink_count:(0,h.default)(s,["details","linkMessageDetails","length"])||0,tags_count:s.tags.length};(0,n(10).findDOMNode)(this.refs.commentText).value="",i=!0}s.messageId===r.messageId&&"CANVASS_NETWORK_ERROR"===s.errorMessage&&(this.setState({errorStatus:"CANVASS_NETWORK_ERROR",posting:!1}),i=!1,this.commentFormStore.initialize(),l={slk:"fail"}),t.messageId!==r.messageId||!t.title||r.enhancedLink&&t.url===r.enhancedLink.url||(this.handleLinkUpdate(t,!1),this.context.getStore(b.default).initialize(),i=!1),e.handleCloseCommentForm&&i&&e.handleCloseCommentForm(),o&&l&&(0,n(1312).fireRapidClick)(Object.assign({},o.getI13nNode().getMergedModel(),l))}},{key:"onKeyDown",value:function(e){"Escape"===e.key&&"tumblrStickers"===this.state.activeTab&&this.setState({activeTab:null})}},{key:"toggleActiveTab",value:function(e){var t=this.state,n=t.activeTab!==e?e:null;this.setState({activeTab:n,enhancedLink:!1}),this.setCommentingState(!!n||t.validComment)}},{key:"enhanceLink",value:function(e){var t=this.props,s=this.state,a=t.configStoreState;if(!s.enhancedLinkRemoved&&!s.enhancedLink&&"tumblrStickers"!==s.activeTab){var o=(0,n(118).matchLinks)(e);o&&this.context.executeAction(S.default,{url:o[0],messageId:t.messageId,lang:a.lang,region:a.region,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret})}}},{key:"handleShowTumblrStickers",value:function(){(0,n(10).findDOMNode)(this.refs.commentText).focus(),this.toggleActiveTab("tumblrStickers")}},{key:"handleLinkUpdate",value:function(e,t){this.getCommentText()||(t=!1),this.setState({activeTab:e&&"linkPreview",enhancedLink:e,enhancedLinkRemoved:t})}},{key:"handleFocus",value:function(){this.commentFormStore.setActiveForm(this.props),this.setState({activeTab:this.state.activeTab,errorStatus:null,posting:!1})}},{key:"handleBlur",value:function(){var e=this.props;e.replyFormInFocus&&e.handleReplyFormBlur()}},{key:"setCommentingState",value:function(e,t){var n=this,s=n.context,a=n.props,o=n.state.commenting!==e;if(o&&n.setState({commenting:e}),t||o){var r=(0,h.default)(s,["componentConfig","ui","presence","enabled"]),i=r||(0,h.default)(s,["componentConfig","ui","presence","heartbeat"]),l=a.configStoreState.notificationInterval;i&&l&&(e&&!n.heartbeat&&(n.heartbeat=setInterval(n.handleHeartbeatInterval,1e3*l)),s.executeAction(k.default,{context:s.context,eventType:e?"START_TYPING":"STOP_TYPING",messageId:a.messageId,namespace:a.messageNamespace||s.namespace}))}}},{key:"handleUserIdle",value:function(){this.setCommentingState(!1)}},{key:"handleHeartbeatInterval",value:function(){if(this.state.commenting){"visible"===(document&&document.visibilityState||"visible")&&this.context.renderTarget.isActive()?this.setCommentingState(!0,!0):this.setCommentingState(!1)}}},{key:"handleCommentChanged",value:function(e){this.props.configStoreState.notificationInterval&&e&&(clearTimeout(this.userIdleTimer),this.userIdleTimer=setInterval(this.handleUserIdle,6e4)),this.state.validComment!==e&&(this.setState({validComment:e}),this.setCommentingState(e))}},{key:"handlePaste",value:function(e){var t=e.clipboardData||e.originalEvent.clipboardData||window.clipboardData,n=t.getData("text");this.handleCommentChanged(this.state.validComment||!!n),this.props.configStoreState.allowSmartlinks&&n&&this.enhanceLink(n)}},{key:"handleKeyUp",value:function(e){var t=this.props.configStoreState.allowSmartlinks,n=e.target.value.trim();n||t&&this.state.enhancedLinkRemoved&&this.setState({enhancedLinkRemoved:!1}),t&&32===e.keyCode&&this.enhanceLink(n),this.handleCommentChanged(!!n)}},{key:"handlePost",value:function(e,t){var s=this.context,a=this.props,o=(0,n(10).findDOMNode)(this.refs.commentText),r=o.value.trim(),i=this.state.enhancedLink;if(!r&&!i&&!e)return void this.setState({errorStatus:"CANVASS_MISSING_COMMENT"});this.setState({errorStatus:null,posting:!0}),this.context.executeAction(T.default,{author:t,content:r,context:s.contextId||s.context,contextDisplayText:s.contextDisplayText,contextUrl:s.contextUrl,enhancedLink:i,forReply:a.forReply||!1,instanceId:s.instanceId,isUserMessageHistory:s.isUserMessageHistory,mentions:a.mentions,messageId:a.messageId,messageNamespace:a.messageNamespace||"",namespace:s.namespace,parentContextDisplayText:a.parentContextDisplayText||"",parentContextUrl:a.parentContextUrl||"",replyId:a.replyId,sticker:e})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.handlePost()}},{key:"handleLoginLink",value:function(){var e=this.context;e.executeAction(I.default,{context:e.context,loginUrl:this.state.loginUrl})}},{key:"renderErrorBox",value:function(){return this.state.errorStatus?u.default.createElement("div",{className:"error-box C($c-fuji-red-2-b) Pstart(12px) Pb(10px)"},u.default.createElement(n(34).Icon,{name:"attention",width:16,height:16,color:"#ff333c",className:"D(ib) Va(tb)! Mend(7px)"}),u.default.createElement(n(36).FormattedMessage,{id:this.state.errorStatus})):null}},{key:"renderLoadingBox",value:function(){return this.state.posting?u.default.createElement("div",{className:"H(100%) Bg(bgLoading) Op(0.7) C($c-fuji-grey-g) Bgz(35px) Pos(a) B(0) W(100%) Z(1)"}):null}},{key:"renderLoginPrompt",value:function(){var e=this.context,t=this.props;if(t.isFullScreen)return null;if(t.isReadOnly)return this.renderCommentsTitle();var s=e.session.dimensions.authed,a=t.deepLink,o=t.forReply,r="CANVASS_SIGN_IN"+("2"===s?"_AGAIN":""),i=o?r+"_POST_REPLY":r+"_POST_COMMENT",l=(0,p.default)("Mb(15px)",{"Mt(18px)":o,"Mend(15px)":a&&!a.replyId});return u.default.createElement("div",{className:l},this.renderCommentsTitle(),this.renderRelatedTags(),u.default.createElement(n(1312).I13nAnchor,{className:"comment-form D(ib) Bxz(bb) W(100%) P(6px) Bds(s) Bdw(1px) Bdc(#e2e2e2) Fz(13px) C($c-fuji-blue-1-a) O(n):h O(n):a",target:"_top",ref:"loginPrompt",follow:!1,href:this.state.loginUrl,onBlur:this.handleBlur,onClick:this.handleLoginLink,onFocus:this.handleFocus,i13nModel:(0,n(1312).getI13nModel)("login",this.getI13nModel())},u.default.createElement("span",{className:"label D(ib) Va(m) Fw(500) Pstart(8px)"},u.default.createElement(n(36).FormattedMessage,{id:i}))))}},{key:"renderRelatedTags",value:function(){var e=this.props,t=this.state.enableRelatedTags;return t&&e.commentsExpanded&&!e.readOnly?u.default.createElement(w.default,{component:"div",transitionName:"action",transitionAppear:!0,transitionAppearTimeout:250,transitionEnterTimeout:250,transitionLeaveTimeout:250},u.default.createElement(N.default,{enableRelatedTags:t,handleRemoveRelatedTags:this.handleRemoveRelatedTags,relatedTags:e.relatedTags,selectedTags:e.selectedTags})):null}},{key:"handleRemoveRelatedTags",value:function(){this.canvassStore.resetRelatedTags(this.context.instanceId),this.setState({enableRelatedTags:!1}),this.context.handleOverlay(!1)}},{key:"handleRelatedTags",value:function(){var e=this.props,t=this.context,s=e.configStoreState;t.handleOverlay(!0),this.setState({enableRelatedTags:!0}),this.context.executeAction(E.default,{context:t.context,instanceId:t.instanceId,lang:s.lang,namespace:t.namespace,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret,region:s.region,tagsAnd:(0,n(118).joinFilterTags)(t.tagsAnd,e.selectedTags),tagsOr:t.tagsOr})}},{key:"handleTitleClick",value:function(){var e=this.props;e.enableTitleClick&&e.count>0&&e.onTitleClick&&e.onTitleClick()}},{key:"onTitleHover",value:function(){var e=this;e.props.enableTitleClick&&e.props.count>0&&e.setState({titleHovered:!e.state.titleHovered})}},{key:"getHeading",value:function(){var e=this.props,t=e.count,n=this.context,s=n.intl,a=n.contextDisplayText,o=n.componentConfig.ui.showContextDisplayText,r=s.formatNumber(t),i="";if(e.commentsExpanded)switch(t){case 0:i=s.formatMessage({id:"CANVASS_BE_THE_FIRST"});break;case 1:i=o&&a?s.formatMessage({id:"CANVASS_HEADING_WITH_ONE_MESSAGE_WITH_TITLE"},{title:a}):s.formatMessage({id:"CANVASS_HEADING_WITH_ONE_MESSAGE"});break;default:i=o&&a?s.formatMessage({id:"CANVASS_HEADING_WITH_MORE_THAN_ONE_MESSAGE_WITH_TITLE"},{count:r,title:a}):s.formatMessage({id:"CANVASS_HEADING_WITH_MORE_THAN_ONE_MESSAGE"},{count:r})}else i=t?s.formatMessage({id:"CANVASS_VIEW_COMMENTS"},{count:r}):s.formatMessage({id:"CANVASS_BE_THE_FIRST"});return i}},{key:"renderHeading",value:function(){var e=this.props,t=this.state,s=e.enableTitleClick&&e.count>0,a=(0,p.default)("comments-title D(ib) Td(n) Bd(0) P(0) Fw(b) Fz(16px)",{"Cur(p)":s,"C($c-fuji-blue-1-a)":t.titleHovered,"C(#000)":!t.titleHovered}),o=(0,n(1312).getI13nModel)(e.commentsExpanded?"comments-open":"comments-close");return u.default.createElement(n(1312).I13nButton,{bindClickEvent:s,className:a,onClick:s?this.handleTitleClick:null,onMouseEnter:s?this.onTitleHover:null,onMouseLeave:s?this.onTitleHover:null,i13nModel:o},u.default.createElement(n(34).Icon,{asset:O.default,className:"comment-icon Mend(7px)",color:this.state.titleHovered?"#188fff":"#000",style:{verticalAlign:"middle"},height:21,width:21}),this.getHeading())}},{key:"renderCommentsTitle",value:function(){var e=this.props;if(e.forReply)return null;var t=e.configStoreState,s=e.isReadOnly,a=e.sentiments,o=t.enableSentiments&&a&&a.size?u.default.createElement(R.default,{className:"Fl(end) Fz(13px) Fw(n) Whs(nw) Pos(r) Cur(p) Z(1)",sentiments:a}):null;return u.default.createElement("div",{className:(0,p.default)("comment-heading Pend(6px) C(#000)",{"Py(15px)":!s,"Pt(15px)":s})},u.default.createElement("div",{className:"D(ib)"},this.renderHeading(),t.enableRelatedTags&&e.commentsExpanded?u.default.createElement(n(1312).I13nButton,{type:"button",onClick:this.handleRelatedTags,className:"related-tags-add-btn Mstart(5px)! Cur(p) O(n):h O(n):a Va(t) P(0) M(0) Bd(n)"},u.default.createElement(n(34).Icon,{name:"plus-circle",style:{verticalAlign:"middle"},width:15,height:15,color:"#188fff"})):null),o)}},{key:"renderActiveTab",value:function(){switch(this.state.activeTab){case"linkPreview":return u.default.createElement(A.default,{enhancedLink:this.state.enhancedLink,onLinkUpdate:this.handleLinkUpdate,fromStream:!1,isUserMessageHistory:this.context.isUserMessageHistory});case"tumblrStickers":return u.default.createElement(L.default,{onStickerClick:this.handlePost});default:return null}}},{key:"getI13nModel",value:function(){var e=this.props;return{cpos:e.forReply?e.cpos:null,reply_lv:e.replyId?2:e.forReply?1:0}}},{key:"renderUploadOptions",value:function(){var e=this.state.activeTab,t=this.context,s=this.props,a=s.forReply,o=s.isFullScreen,r=s.configStoreState.allowAnimatedGIF,i="tumblrStickers"===e?"#188fff":"#878c91",l=d.default.dedupe("Pos(r)",{"Px(2px)":o&&!a,"Pstart(16px) Pb(10px)":!o,"H(20px)":!r,"Pstart(10px)":a}),c="tumblrStickers"===e?{slk:"gif hide",outcm:"hide"}:{slk:"gif show",outcm:"show"};return u.default.createElement("div",{className:l},r?u.default.createElement(n(1312).I13nButton,{"aria-label":t.intl.formatMessage({id:"CANVASS_SHOW_GIFS"}),className:"Va(m) O(n):h O(n):a P(0) M(0) Bd(n)",i13nModel:(0,n(1312).getI13nModel)("tumblr-icon",c),onClick:this.handleShowTumblrStickers,type:"button"},u.default.createElement(n(34).Icon,{name:"gif",height:23,color:i})):null)}},{key:"renderSubmitButton",value:function(){var e=this.props,t=e.forReply,s=e.isFullScreen,a=this.state,o=a.validComment,r=a.enhancedLink,i=r?{elmt:"link",elm:"cmmt_post"}:{elmt:"text",elm:"cmmt_post"},l=(0,p.default)("comment-submit Fw(600) Bgc(t) Bd(n) O(n):h O(n):a M(0)",{"Pt(6px) Px(12px)":s,"P(12px)":!s,"Fz(14px)":t||s,"Fz(16px)":!t&&!s,"C($c-fuji-blue-1-a)":o||r,"C($c-fuji-grey-c)":!o&&!r}),c=u.default.createElement(n(1312).I13nButton,{bindClickEvent:!1,className:l,disabled:o||r?void 0:"disabled",i13nModel:(0,n(1312).getI13nModel)(t?"reply-post":"comment-post",i),ref:"submit",type:"submit"},this.context.intl.formatMessage({id:t?"CANVASS_REPLY":"CANVASS_POST"}));return u.default.createElement("div",{className:"Pos(a) End(0) B(0)"},this.renderGuidelinesLink(),c)}},{key:"renderGuidelinesLink",value:function(){var e=this.context,t=e.componentConfig&&e.componentConfig.guidelineUrl;if(t)return u.default.createElement(n(1312).I13nAnchor,{className:"C(#9ea2af) Fz(14px) Mend(5px)",href:t,i13nModel:(0,n(1312).getI13nModel)("guidelines"),target:"_blank"},e.intl.formatMessage({id:"CANVASS_GUIDELINES"}))}},{key:"renderTextArea",value:function(){var e=this.props,t=e.configStoreState,n=e.deepLink,s=e.forReply,a=e.messageId,o=e.isFullScreen,r=e.value,i=t.allowAnimatedGIF,l=t.enableRelatedTags,c=t.allowSmartlinks,f=this.context.intl,p="smartphone"===(0,h.default)(this.context,["session","dimensions","device"]),m=d.default.dedupe("Bd(n) Fz(14px) Lh(20px) W(100%) Bxsh(n) C($c-fuji-grey-l)",{"P(2px)":o&&!s,"Pstart(16px) Py(12px)":!o,"Pstart(10px) Pt(10px)":s}),g=void 0;g=s?"CANVASS_POST_REPLY":i&&l&&c?p?"CANVASS_POST_COMMENT_SMARTPHONE_LONG":"CANVASS_POST_COMMENT_LONG":"CANVASS_POST_COMMENT";var y=f.formatMessage({id:g}),v=d.default.dedupe("Pos(r) Ov(h) Bgc(#fff)",{"Mend(8px)":n,"My(13px) Bdc($c-fuji-grey-c) Bd Bdrs(2px)":!o,"Mt(8px) Mb(10px)":o,"Mstart(40px) Mt(16px) Mb(13px)":s,"Mstart(50px)":!s});return u.default.createElement("div",{className:v},u.default.createElement(P.default,{ref:"commentText",className:m,key:"textarea-"+a,maxLength:5e3,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste,placeholder:y,rows:1,value:r}),this.renderLoadingBox(),this.renderActiveTab(),this.renderUploadOptions(),this.renderSubmitButton())}},{key:"renderForm",value:function(){var e=this.props,t=e.isFullScreen,s=e.isReadOnly,a=e.userProfile,o=d.default.dedupe("Pos(r)",{"Mstart(20px) Mend(10px)":t}),r=u.default.createElement(n(29).I13nDiv,{className:o,i13nModel:this.getI13nModel()},t?void 0:this.renderCommentsTitle(),t?void 0:this.renderRelatedTags(),s?void 0:u.default.createElement(M.default,{creator:e.guid,fromCommentForm:!0,imageUrl:a.imageUrl,isReply:e.forReply,key:"byline-commentform"+e.messageId,name:a.nickName}),s?void 0:u.default.createElement("form",{className:"Ov(h) W(100%) Cf",encType:"multipart/form-data",onKeyDown:this.onKeyDown,onSubmit:this.handleSubmit,ref:"form"},this.renderTextArea(),this.renderErrorBox()));return t?u.default.createElement("div",{className:"Pos(f) Bgc(#fff) Z(2) B(0) Start(0) End(0) BdT Bdc($c-fuji-grey-c)"},r):r}},{key:"render",value:function(){return this.props.isHidden?null:this.props.isSignedIn?this.renderForm():this.renderLoginPrompt()}}]),t}(n(1).PureComponent);j.contextTypes={componentConfig:c.default.object.isRequired,configStoreState:c.default.object.isRequired,context:c.default.string,contextDisplayText:c.default.string,contextId:c.default.string,contextUrl:c.default.string,executeAction:c.default.func.isRequired,getStore:c.default.func,handleOverlay:c.default.func,handleResize:c.default.func.isRequired,instanceId:c.default.string,intl:c.default.object.isRequired,isUserMessageHistory:c.default.bool,namespace:c.default.string,renderTarget:c.default.object.isRequired,session:c.default.object.isRequired,tags:c.default.string,tagsAnd:c.default.string,tagsOr:c.default.string},j.defaultProps={commentsExpanded:!0},t.default=(0,m.default)(j,[x.default,_.default,b.default,y.default,v.default],i)},1845:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,function(e){return e&&e.__esModule?e:{default:e}}(n(20)).default)({storeName:"CanvassLinkEnhancerStore",statics:{handlers:{CANVASS_GET_ENHANCE_URL_SUCCESS:"canvassEnhancedLinkSuccess"}},initialize:function(){this.state={}},canvassEnhancedLinkSuccess:function(e){this.state=e.data,this.state.messageId=e.messageId,this.emitChange()},getState:function(){return this.state},dehydrate:function(){return this.state},rehydrate:function(e){this.state=e}}),e.exports=t.default},1846:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t,s){var a=e.session.query,i=e.getStore(r.default).getState(),l=t.instanceId,c=t.oauthConsumerKey||i.oauthConsumerKey,u=t.oauthConsumerSecret||i.oauthConsumerSecret,d=t.namespace||a.namespace||i.namespace;if(!l||!u||!c)return s("Required fields missing",null);var f=e.getStore(o.default).getCommentsState(l),p=t.tagsAnd||f.tagsAnd||null,h=t.tagsOr||f.tagsOr||null,m=t.context||a.context||"YahooGlobal";if(f.get("relatedTags"))return s&&s();var g={context:m,count:t.count||10,lang:t.lang||i.lang||"en-US",namespace:d,region:t.region||i.region||"US",oauthConsumerKey:c,oauthConsumerSecret:u};g.query=(0,n(118).createSearchQuery)(p,h,m,d),e.service.read("canvass.getTrendingTags_ns",g,{},function(t,n){return t||!n||n.error?s():(e.dispatch("CANVASS_GET_RELATED_TAGS_SUCCESS",{instanceId:l,relatedTags:n}),s())})}Object.defineProperty(t,"__esModule",{value:!0});var o=s(n(297)),r=s(n(115));a.displayName="loadRelatedTags",t.default=a,e.exports=t.default},1847:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(1327)),d=s(n(8)),f=s(n(512)),p=s(n(521)),h=s(n(1665)),m=s(n(93)),g=s(n(1402)),y=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,u.default)(n,["handleClickOutside","handleFilterClick","handleKeyDown","handleShowMyComments","setSortMenu"]),n.state={menuOpen:!1},n}return r(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({updating:this.props.sortBy!==e.sortBy})}},{key:"componentDidUpdate",value:function(e,t){var n=this;n.state.updating&&setTimeout(function(){n.setState({updating:!1})},1e3),!t.menuOpen&&n.state.menuOpen&&n.sortMenu&&n.sortMenu.focus()}},{key:"handleClickOutside",value:function(){this.setState({menuOpen:!1})}},{key:"handleFilterClick",value:function(e){e&&e.stopPropagation(),this.setState({menuOpen:!this.state.menuOpen})}},{key:"handleKeyDown",value:function(e){e&&27===e.keyCode&&this.state.menuOpen&&(e.preventDefault(),e.stopPropagation(),this.handleClickOutside())}},{key:"handleShowMyComments",value:function(){var e=this.props,t=e.currentUserProfile;this.context.handleUserMessages(e.currentUserGuid,t.imageUrl,t.nickName)}},{key:"handleSort",value:function(e,t){var n=this.context,s=this.props,a=t||[];if(s.sortBy!==e||t!==s.selectedTags){var o=n.instanceId,r=n.userMessageHistoryGuid,i=r?h.default:p.default,l=void 0;l=r?{guid:r,name:s.userMessageHistoryName,image:s.userMessageHistoryImage,sortBy:e,instanceId:o}:{instanceId:o,sortBy:e,tagsAnd:n.tagsAnd,tagsOr:n.tagsOr,selectedTags:a.join(","),context:n.context,contextUrl:n.contextUrl,contextDisplayText:n.contextDisplayText},this.context.executeAction(i,l)}}},{key:"getSortLabel",value:function(e){var t=void 0;switch(e){case n(507).SORT_HIGHEST_RATED:t="CANVASS_SORT_HIGHEST_RATED";break;case n(507).SORT_LATEST:t="CANVASS_SORT_NEWEST";break;case n(507).SORT_NEWEST:t="CANVASS_SORT_RECENT";break;case n(507).SORT_OLDEST:t="CANVASS_SORT_OLDEST";break;case n(507).SORT_MOST_REPLIED:t="CANVASS_SORT_MOST_REPLIED";break;default:return null}return c.default.createElement("span",null,this.context.intl.formatMessage({id:t}))}},{key:"getI13nOverride",value:function(e){return{slk:e}}},{key:"setSortMenu",value:function(e){this.sortMenu=e}},{key:"renderSortOptions",value:function(){if(this.state.menuOpen)return c.default.createElement("ul",{"aria-label":this.context.intl.formatMessage({id:"CANVASS_SORT"}),className:"sorting-tabs Pos(a) Z(1) Bd Bdc($c-fuji-grey-c) Bdrs(3px) Bgc(#fff) Bxsh(boxShadow) Mt(8px) O(n)",ref:this.setSortMenu,role:"menu",tabIndex:"-1"},this.props.arrangement.map(this.renderSortOption,this))}},{key:"renderSortOption",value:function(e){var t=e===this.props.sortBy,s=this.getSortLabel(e);if(!s)return null;var a=(0,d.default)("H(44px)",{selected:t});return c.default.createElement("li",{className:a,key:e},c.default.createElement(n(1312).I13nButton,{className:"sort-by-"+e+" Px(16px) Py(12px) O(n):h O(n):a Cur(p) C($c-fuji-grey-g) Fz(14px) Fw(500) C($c-fuji-blue-1-a):h selected_C($c-fuji-blue-1-a) selected_Fw(b) W(100%) Ta(start)",onClick:this.handleSort.bind(this,e,this.props.selectedTags),role:"menuitem",i13nModel:(0,n(1312).getI13nModel)("sort",this.getI13nOverride(e))},s))}},{key:"handleClickSelectedTag",value:function(e){var t=this.props,n=t.selectedTags,s=void 0===n?[]:n,a=t.sortBy;s=s.filter(function(t){return t!==e}),this.handleSort(a,s)}},{key:"renderSelectedTags",value:function(){var e=this.props,t=e.selectedTags,s=e.selectedTagsCount,a=t&&t.size;if(a>0)return c.default.createElement("div",{className:"D(ib)"},t.map(function(e,t){return c.default.createElement(n(1312).I13nButton,{className:"Fz(12px) Fw(500) Lh(1) P(4px) Pstart(8px) Bdrs(4px) Mend(8px) C(#fff) Bgc($c-fuji-blue-1-a)",i13nModel:{elm:"cmmt_tag",pos:a-1,slk:e},key:"tag-"+t,onClick:this.handleClickSelectedTag.bind(this,e)},"#"+e,c.default.createElement("span",{className:"Fw(n) D(ib) Mx(4px)"},"("+this.context.intl.formatNumber(s)+")"),c.default.createElement(n(34).Icon,{asset:m.default,color:"#fff",height:14,style:{verticalAlign:"text-bottom"},width:14}))},this))}},{key:"renderMyCommentsButton",value:function(){var e=this.context,t=this.props;if(t.myComments&&t.currentUserGuid&&t.currentUserProfile&&!e.isUserMessageHistory)return c.default.createElement(n(1312).I13nButton,{className:"my-comments-button O(n) Fz(14px) Fw(600) C($c-fuji-grey-l) M(0) P(0) Fl(end)",i13nModel:(0,n(1312).getI13nModel)("user-comments-tap",{guid:t.guid}),onClick:this.handleShowMyComments},e.intl.formatMessage({id:"CANVASS_MY_COMMENTS"}))}},{key:"render",value:function(){var e=this,t=e.props,s=t.arrangement,a=t.count,o=t.sortBy,r=e.state.updating;return a<2||Object.keys(s).length<2?null:c.default.createElement("div",{className:"sorting-tabs-container Pos(r) Mt(5px)",onClick:e.handleClickOutside,onKeyDown:e.handleKeyDown},c.default.createElement(n(1312).I13nButton,{"aria-expanded":e.state.menuOpen?"true":void 0,"aria-haspopup":"true","aria-label":e.context.intl.formatMessage({id:"CANVASS_SORT"}),className:"sort-filter-button O(n):h O(n):a Fz(14px) Fw(600) M(0) P(0) Trsdu(.5s) Trsp(color) "+(r?"C($c-fuji-purple-1-a)":"C($c-fuji-grey-l)"),i13nModel:(0,n(1312).getI13nModel)("sort-btn",e.getI13nOverride(o)),onClick:e.handleFilterClick},e.getSortLabel(o),c.default.createElement(n(34).Icon,{asset:g.default,className:"Mstart(5px) Mend(13px) Trsdu(.5s)",color:r?"#5601ec":"#26282a",width:10,height:10,style:{verticalAlign:"middle"}})),e.renderSortOptions(),e.renderSelectedTags(),e.renderMyCommentsButton())}}]),t}(n(1).PureComponent);y.contextTypes={configStoreState:l.default.object.isRequired,context:l.default.string,contextDisplayText:l.default.string,contextUrl:l.default.string,executeAction:l.default.func,handleUserMessages:l.default.func,instanceId:l.default.string,intl:l.default.object,isUserMessageHistory:l.default.bool,tags:l.default.string,tagsAnd:l.default.string,tagsOr:l.default.string,userMessageHistoryGuid:l.default.string},y.defaultProps={arrangement:[],count:0,sortBy:"popular"},t.default=(0,f.default)(y),e.exports=t.default},2069:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){var n=t.instanceId||t.id,s=e.getStore(w.default).getCommentsState(n),a=e.getStore(w.default).getUserCommentsState(),o=e.getStore(L.default),r=e.getStore(R.default),i=e.getStore(A.default).getState(),l=e.getStore(N.default).getState(),c=s.get("deepLink"),u=e.getStore(P.default).getSentiments(n),d=(0,g.default)(t,["componentConfig","ui"],{}),f=s.get("disabled"),p=s.get("sortBy"),h="",m=0,v="",b=s.get("messageList"),_=l.topReplySort&&"popular"===p?"popular":"createdAt",x=s.get("showLoadNext");return(t.context||(0,g.default)(e,["session","query","context"],""))===s.get("context")&&(h=s.get("context"),m=s.get("count"),v=s.get("contextDisplayText")),c&&c.get("replyId")&&(b=y.default.List([c.get("message")]),_="createdAt",x=!1),{commentingState:i.commenting,configStoreState:l,context:h,contextDisplayText:v,contextUrl:s.get("contextUrl"),count:m,deepLink:c?c.toJS():null,disabled:f,expanded:!f&&s.get("expanded",(0,g.default)(d,["expanded"],!0)),guid:o.getGUID(),messages:b,namespace:t.namespace||s.get("namespace")||l.namespace,newMessagesCount:s.get("newMessagesCount"),nextIndex:s.get("nextIndex"),instanceId:n,relatedTags:s.get("relatedTags"),replySortBy:_,selectedTags:s.get("selectedTags"),selectedTagsCount:s.get("selectedTagsCount"),sentiments:u,showLoadNext:x,sortBy:p,tags:s.get("tags"),tagsAnd:s.get("tagsAnd"),tagsOr:s.get("tagsOr"),userActivity:s.get("userActivity"),userComments:a,userProfile:r.getProfile()}}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=s(n(0)),d=s(n(1)),f=s(n(519)),p=s(n(1597)),h=s(n(1327)),m=s(n(8)),g=s(n(2)),y=s(n(11)),v=s(n(512)),b=s(n(39)),_=s(n(121)),x=s(n(1390)),S=s(n(1219)),C=s(n(521)),E=s(n(565)),I=s(n(2071)),T=s(n(1665)),k=s(n(1666)),M=s(n(2072)),O=s(n(505)),w=s(n(297)),A=s(n(1598)),N=s(n(115)),R=s(n(299)),P=s(n(1834)),L=s(n(92)),j=s(n(2073)),F=s(n(1669)),B=s(n(1844)),U=s(n(1206)),D=s(n(1847)),H=s(n(2102)),V=s(n(2104)),G="undefined"!=typeof document?document:null,z="undefined"!=typeof window?window:null,W=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),s=n;return(0,h.default)(s,["handleContainerScroll","handleClick","handleMessage","handleOverlay","handleRefresh","handleRemoveUserComments","handleResize","handleShowMessages","handleToggleComments","handleUserMessages","handleWindowScroll"]),s.state={loadingNextComments:!1,overlay:!1,pollingEnabled:!1,userHistoryTop:"0px"},s.hasEnoughHeight=!0,s.isDwellActive=!1,s.isFullScreen=(0,g.default)(e,["componentConfig","ui","isFullScreen"]),s.isIframe=z&&z!==z.parent,s.isIframeInViewport=s.isIframe&&s.isFullScreen,n}return r(t,e),c(t,[{key:"getChildContext",value:function(){var e=this.props;return{componentConfig:e.componentConfig,configStoreState:e.configStoreState,context:e.context,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,guid:e.guid,instanceId:e.instanceId,namespace:e.namespace,tags:e.tags,tagsAnd:e.tagsAnd,tagsOr:e.tagsOr,handleUserMessages:this.handleUserMessages,handleOverlay:this.handleOverlay,handleResize:this.handleResize}}},{key:"componentWillMount",value:function(){this.loadEventFired=!1}},{key:"componentDidMount",value:function(){var e=this,t=e.context,s=e.props,a=(0,n(10).findDOMNode)(e.refs.canvass),o=s.componentConfig.ui||{};if(e.setupRapidInstance(),e.setupPolling(s.configStoreState.pollingInterval),e.scrollHandler=(0,b.default)("scroll",e.handleWindowScroll,{enableScrollInfo:!0}),a&&o.scrollPagination&&(e.scrollContainer=e.isFullScreen?a.querySelector("#comments-fullscreen"):z)&&e.scrollContainer.addEventListener("scroll",(0,_.default)(e.handleContainerScroll,50)),s.deepLink&&t.renderTarget.isActive()){if(a){var r=s.componentConfig.FIXED_UH_HEIGHT||0,i=G.documentElement;(0,f.default)((i&&i.scrollTop||G.body.scrollTop||0)+a.getBoundingClientRect().top-r-50)}e.handleShowMessages("showExpanded")}z.addEventListener("message",e.handleMessage),e.handleResize(),e.setPollingState(s),e.setDwellState(!!s.expandForRoute||e.isFullScreen)}},{key:"componentWillUnmount",value:function(){var e=this;e.scrollHandler&&e.scrollHandler.unsubscribe(),e.scrollContainer&&e.scrollContainer.removeEventListener("scroll",e.handleContainerScroll),z.removeEventListener("message",e.handleMessage),e.setDwellState(!1),e.setupPolling(0),e.destroyRapidInstance(),e.context.getStore(w.default).resetUserComments()}},{key:"componentDidUpdate",value:function(e,t){var n=this.props;e.expanded===n.expanded&&e.messages===n.messages||this.handleResize(),e.expanded!==n.expanded&&this.setDwellState(n.expanded)}},{key:"setupRapidInstance",value:function(){var e=this;if(e.isFullScreen){var t=n(61).RapidManager&&n(61).RapidManager.getRapidInstance();if(t){if(t.addModuleAPV){var s=z.rapidListeners||{};z.rapidListeners=s,e.destroyRapidInstance(),s.canvassAPV=t.addModuleAPV("comments-fullscreen")}t.beaconAPV&&t.beaconAPV()}}}},{key:"destroyRapidInstance",value:function(){var e=(0,g.default)(z.rapidListeners,["canvassAPV"]);e&&"function"==typeof e.destroy&&(e.destroy(),delete z.rapidListeners.canvassAPV)}},{key:"handleContainerScroll",value:function(){var e=this,t=e.props,s=e.scrollContainer;if(t.expanded&&t.showLoadNext&&!e.state.loadingNextComments){var a=e.refs.shownextbutton,o=(0,n(10).findDOMNode)(a);if(o){var r=s.innerHeight||s.clientHeight;o.getBoundingClientRect().top<r+n(507).SCROLL_BUFFER&&(e.handleShowMessages("showNext"),(0,n(1312).fireRapidClick)(Object.assign({},a.getI13nNode().getMergedModel(),{elmt:"scroll"})))}}}},{key:"handleWindowScroll",value:function(e,t){this.setPollingState(this.props,t)}},{key:"handleClick",value:function(){var e=this;e.setDwellState(e.props.expanded)}},{key:"handleClickOutside",value:function(){var e=this;!e.isIframe&&e.isDwellActive&&e.setDwellState(!1)}},{key:"setDwellState",value:function(e){var t=this;t.context.renderTarget.isActive()&&e!==t.isDwellActive&&!t.isIframe&&(t.isDwellActive=e,t.context.executeAction(M.default,{context:t.props.context,pct:e?"comments":""}))}},{key:"getUserHistoryTop",value:function(e){var t=0,s=e.userComments.get("guid"),a=(0,n(10).findDOMNode)(this.refs.canvass);if(!s||!a||!a.getBoundingClientRect)return"0px";if(this.isFullScreen)return Math.max(Math.floor((z.innerHeight-n(507).USER_HISTORY_HEIGHT)/2)-4,n(507).COMMUNITY_BAR_HEIGHT)+"px";var o=a.getBoundingClientRect(),r=e.componentConfig.FIXED_UH_HEIGHT||0,i=Math.max(r,o.top),l=z.innerHeight-i;this.hasEnoughHeight=o.height>=n(507).USER_HISTORY_HEIGHT;var c=o.top<=0?Math.abs(o.top)+r:o.top<=r?r-o.top:0;if(l<n(507).USER_HISTORY_HEIGHT)t=c;else if(this.hasEnoughHeight){t=z.parent!==z&&this.userHistoryClickPos?Math.max(r,this.userHistoryClickPos-n(507).USER_HISTORY_HEIGHT/3):c+parseInt(l/2-n(507).USER_HISTORY_HEIGHT/2,10);var u=t+n(507).USER_HISTORY_HEIGHT;u>o.height&&(t=o.height-n(507).USER_HISTORY_HEIGHT-100)}else t=0;return t+5+"px"}},{key:"componentWillReceiveProps",value:function(e){var t=this,s=e.context,a=e.tags,o=e.count;if(!t.loadEventFired&&(a||s)){var r=t.context.i13n.getI13nNode().getMergedModel();r.cat=a||"",r.context=s,r.slk="canvass-load",r.t1="a3",r.t2="results",r.t3=o,(0,n(1312).fireRapidEvent)("secvw",r),this.loadEventFired=!0}t.setState({loadingNextComments:!1,userHistoryTop:e.userComments?this.getUserHistoryTop(e):"0px"});var i=e.configStoreState.pollingInterval;t.props.configStoreState.pollingInterval!==i&&(t.setupPolling(i),t.setPollingState(e)),t.props.expanded!==e.expanded&&t.setPollingState(e)}},{key:"setupPolling",value:function(e){var t=this,n=t.timer;n&&(clearInterval(n),t.timer=null),e>0&&!t.props.disabled&&(t.timer=setInterval(t.handleRefresh,1e3*e))}},{key:"setPollingState",value:function(e,t){var s=this,a=(0,n(10).findDOMNode)(s.refs.canvass);if(!a||!e.expanded||e.isReadOnly||void 0===z||!s.context.renderTarget.isActive())return void s.setState({pollingEnabled:!1});var o=!1;if(s.isIframe)o=s.isIframeInViewport;else{var r=t&&t.resize&&t.resize.height||z.innerHeight,i=a.getBoundingClientRect();o=!(i.top>r+20||i.bottom<-20)}e.configStoreState.pollingInterval>0&&s.state.pollingEnabled!==o&&(s.setState({pollingEnabled:o}),o&&(t||s.isIframe)&&s.handleRefresh()),!o&&s.isDwellActive&&s.setDwellState(!1)}},{key:"handleMessage",value:function(e){var t=this;if(e&&e.data&&e.source!==z&&t.refs.canvass){var s=e.data,a=t.props.expanded,o=t.refs.canvass.getI13nNode().getMergedModel();a||"canvass:expand"!==s?a&&"canvass:collapse"===s?(t.handleShowMessages("showCollapsed"),(0,n(1312).fireRapidClick)(Object.assign({},o,(0,n(1312).getI13nModel)("comments-close")))):"canvass:enterViewport"===s?(t.isIframeInViewport=!0,t.setPollingState(t.props)):"canvass:exitViewport"===s&&(t.isIframeInViewport=!1,t.setPollingState(t.props)):(t.handleShowMessages("showExpanded"),(0,n(1312).fireRapidClick)(Object.assign({},o,(0,n(1312).getI13nModel)("comments-open"))))}}},{key:"handleOverlay",value:function(e){this.setState({overlay:e})}},{key:"handleRefresh",value:function(){var e=this.props,t=e.instanceId,s=e.namespace,a=e.selectedTags,o=G&&G.visibilityState||"visible";if(this.state.pollingEnabled&&"visible"===o&&(0,n(10).findDOMNode)(this.refs.canvass)){var r=(0,g.default)(e,["componentConfig","ui"])||{},i=r.sortTabs||{},l=i.polling||i.arrangement||[],c=void 0;-1!==l.indexOf(e.sortBy)?c=E.default:r.presence&&r.presence.readingUsersCount&&(c=I.default),c&&this.context.executeAction(c,{context:e.context,instanceId:t,namespace:s,refresh:!0,selectedTags:a&&a.size?a.join(","):"",tagsAnd:e.tagsAnd,tagsOr:e.tagsOr})}}},{key:"handleResize",value:function(){var e=this.props;e.handleResize&&this.context.executeAction(k.default,{context:e.context,count:e.count,isExpanded:e.expanded})}},{key:"handleShowMessages",value:function(e){var t=this.props,n=t.selectedTags,s=C.default,a={context:t.context,contextUrl:t.contextUrl,contextDisplayText:t.contextDisplayText,instanceId:t.instanceId,namespace:t.namespace,selectedTags:n&&n.size?n.join(","):"",sortBy:t.sortBy,tagsAnd:t.tagsAnd,tagsOr:t.tagsOr};"showNext"===e?(this.setState({loadingNextComments:!0}),a.nextIndex=t.nextIndex,a.showNextClicked=!0):"showNew"===e?(a.showNewClicked=!0,a.sortBy="createdAt"):"showExpanded"===e?(a.expanded=!0,s=x.default):"showCollapsed"!==e||(0,g.default)(t,["componentConfig","ui","isFullScreen"])||(a.expanded=!1,s=x.default),this.context.executeAction(s,a)}},{key:"handleUserMessages",value:function(e,t,n,s){this.context.executeAction(T.default,{guid:e,image:t,name:n,sortBy:"createdAt",instanceId:this.props.instanceId}),s&&(this.userHistoryClickPos=s.clientY,this.userHistoryClickTarget=s.currentTarget)}},{key:"handleRemoveUserComments",value:function(){var e=this;e.handleOverlay(!1),e.context.getStore(w.default).resetUserComments(),e.userHistoryClickTarget&&(e.userHistoryClickTarget.focus(),e.userHistoryClickTarget=null,e.userHistoryClickPos=0)}},{key:"handleToggleComments",value:function(){this.handleShowMessages(this.props.expanded?"showCollapsed":"showExpanded")}},{key:"renderShowNewMessagesButton",value:function(){var e=this,t=this.props,s=t.newMessagesCount,a=this.state.loadingNextComments;if(s&&t.expanded)return d.default.createElement(n(1312).I13nButton,{ref:"shownewbutton",i13nModel:(0,n(1312).getI13nModel)("comments-showNew"),onClick:function(){return e.handleShowMessages("showNew")},className:p.default.get("btn btn-secondary btn-spacing btn-sm-fullwidth","D(b) Mx(a) Pos(r) Mb(0)")},!a&&s?"("+s+") ":"",d.default.createElement(n(36).FormattedMessage,{id:a?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_NEW_COMMENTS"}))}},{key:"renderShowNextButton",value:function(){var e=this,t=this.props;if(t.showLoadNext&&t.expanded)return d.default.createElement(n(1312).I13nButton,{ref:"shownextbutton",i13nModel:(0,n(1312).getI13nModel)("comments-showMore"),onClick:function(){return e.handleShowMessages("showNext")},className:p.default.get("btn btn-secondary btn-spacing btn-sm-fullwidth","showNext D(b) Mx(a) Pos(r)")},d.default.createElement(n(36).FormattedMessage,{id:this.state.loadingNextComments?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_MORE_COMMENTS"}))}},{key:"renderActivityIndicator",value:function(){var e=this.props,t=(0,g.default)(e,["componentConfig","ui","presence","enabled"]);if(e.expanded&&t){var n=e.context,s=(0,g.default)(e,["commentingState",n],!1);return d.default.createElement(j.default,{key:n,cometEnabled:this.state.pollingEnabled,commenting:s,userActivity:e.userActivity})}}},{key:"renderUserCount",value:function(){var e=this.props,t=e.deepLink,n=e.userActivity;if((0,g.default)(e,["componentConfig","ui","presence","readingUsersCount"])&&e.count&&e.expanded&&n)return d.default.createElement(V.default,{className:t&&t.replyId?"Mt(20px) D(n)--maw350":"Mt(5px)",count:n.get("readingUsersCount",0)})}},{key:"renderUserComments",value:function(){var e=this.props,t=e.userComments,n=e.instanceId;if(t.get("guid")&&t.get("instanceId")===n)return d.default.createElement(U.default,{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:300,transitionEnterTimeout:300,transitionLeaveTimeout:300},d.default.createElement(H.default,{handleRemoveUserComments:this.handleRemoveUserComments,isFullScreen:this.isFullScreen,key:"userComments-"+t.get("guid"),top:this.state.userHistoryTop,userComments:t}))}},{key:"renderDisclaimer",value:function(e){var t=e.text;if(e.enable&&t&&t.length)return d.default.createElement("div",{className:"canvass-disclaimer Bd Bdc(#d8dade) P(10px) Mt(10px)"},d.default.createElement(n(34).Icon,{className:"Mend(6px) Fl(start)",color:"#f00",height:20,name:"attention",width:20}),t.map(function(e,t){return d.default.createElement("p",{className:"Mb(6px) Fz(14px) Fw(200)",dangerouslySetInnerHTML:{__html:e},key:t})}))}},{key:"render",value:function(){var e=this,t=e.isFullScreen,s=e.props,a=s.componentConfig,o=s.configStoreState,r=s.context,i=s.contextDisplayText,c=s.contextUrl,u=s.count,f=s.deepLink,p=s.selectedTags,h=s.sortBy,g=e.state.overlay,y=a.isReadOnly,v=!(!f||!f.replyId);if(s.disabled||y&&0===u||!e.context.renderTarget.isActive())return null;var b=s.messages?s.messages.toJS():[],_=a.ui||{},x=void 0,S=void 0,C=void 0,E=void 0,I=void 0;u>0&&(s.expanded||f)&&(f&&f.message&&!v&&(C=d.default.createElement(F.default,{className:"Mstart(-12px) My(15px)",deepLink:f,isReadOnly:y,itemClassName:"P(12px)",list:[f.message],parentContextDisplayText:i,parentContextUrl:c,replySortBy:s.replySortBy,sortBy:h})),v?x=d.default.createElement(n(1312).I13nButton,{className:"C($c-fuji-blue-1-a) Fz(16px) Fw(b) Mt(16px)",onClick:e.handleShowMessages},d.default.createElement(n(34).Icon,{className:"Fl(start) Mstart(-15px) Mend(2px)",color:"#188fff",height:22,name:"caret-left",style:{strokeWidth:1},width:22}),d.default.createElement(n(36).FormattedMessage,{id:"CANVASS_VIEW_ALL_COMMENTS",values:{count:u}})):!y&&b.length>0&&(x=d.default.createElement(D.default,l({},_.sortTabs,{count:u,currentUserGuid:s.guid,currentUserProfile:s.userProfile,key:"sorting-tabs",ref:"sortingtabs",selectedTags:p,selectedTagsCount:s.selectedTagsCount,sortBy:h}))),S=d.default.createElement(F.default,{className:y?"Mstart(-8px)":"Mstart(-12px) Pt(5px)",isReadOnly:y,itemClassName:y?"Mt(10px) P(8px)":"Mt(5px) P(12px)",list:b,ref:"commentlist",parentContextDisplayText:i,parentContextUrl:c,replySortBy:s.replySortBy,sortBy:h}));var T=void 0;v||(T=d.default.createElement(B.default,{commentsExpanded:s.expanded,count:u,enableTitleClick:!_.expanded||_.enableCommentsToggle,isFullScreen:t,isReadOnly:y,onTitleClick:this.handleToggleComments,ref:"commentform",relatedTags:s.relatedTags,selectedTags:s.selectedTags,sentiments:s.sentiments})),r&&!y&&(E=e.renderShowNewMessagesButton(),I=e.renderShowNextButton());var k={cat:s.tags||"",cnv_bkt:o.rankingProfile||o.scoreAlgo,g:r,tags:p.join(",")};return d.default.createElement(n(29).I13nDiv,{"aria-label":e.context.intl.formatMessage({id:"CANVASS_COMMENTS"}),className:(0,m.default)(s.className,_.containerExtraClasses),i13nModel:k,id:s.instanceId,onClick:e.handleClick,ref:"canvass",tabIndex:"-1"},t?T:null,d.default.createElement("div",{id:t?"comments-fullscreen":void 0,className:(0,m.default)("comments-body",{"Pos(f) T(0) B(0) Start(0) End(0) Px(20px) Py(70px) Z(1)":t,"Ov(s) Ovs(touch)":t&&!g,"Ov(h)":t&&g})},g?d.default.createElement("div",{className:"StretchedBox Bgc(#fff) Op(0.7) Z(2)"}):null,t?null:T,e.renderDisclaimer(_.disclaimer),e.renderUserComments(),C,e.renderUserCount(),x,e.renderActivityIndicator(),E,S,I))}}]),t}(n(1).PureComponent);W.defaultProps={className:"tdv2-applet-canvass Lh(1.55em) M(a) smartphone_Px(10px) Pb(25px) Pos(r) O(n)",configStoreState:{},expanded:!0,handleResize:!0},W.contextTypes={executeAction:u.default.func,getStore:u.default.func,i13n:u.default.object,intl:u.default.object,renderTarget:u.default.object.isRequired,session:u.default.object},W.childContextTypes={componentConfig:u.default.object.isRequired,configStoreState:u.default.object.isRequired,context:u.default.string,contextDisplayText:u.default.string,contextUrl:u.default.string,guid:u.default.string,handleOverlay:u.default.func,handleResize:u.default.func,handleUserMessages:u.default.func,instanceId:u.default.string,namespace:u.default.string,session:u.default.object,tags:u.default.string,tagsAnd:u.default.string,tagsOr:u.default.string};var q=(0,v.default)(W);q.initializeAction=S.default,q.componentConfig={name:"componentComments"},t.default=(0,O.default)(q,[w.default,A.default,N.default,R.default,P.default,L.default],i,{session:u.default.object.isRequired}),e.exports=t.default},2070:function(e,t,n){"use strict";function s(e){this._styles={},e&&this.set(e)}function a(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&e[t]&&(n+=" "+t);return n}function o(e){return e?(Array.isArray(e)&&(e=e.join(" ")),"object"==typeof e&&(e=a(e)),e.trim().split(p)):[]}function r(e,t){return e[t.replace(h,"")]=t,e}function i(e){return o(e).reduce(r,{})}function l(e){return Object.keys(e).map(function(t){return e[t]}).join(" ")}function c(e){if(Array.isArray(e))return e.forEach(c,this);Object.keys(e).forEach(function(t){this._styles[t]=m(this._styles[t]||{},i(e[t]))},this)}function u(e,t){var n={};return o(e).forEach(function(e){m(n,this._styles[e])},this),t&&m(n,i(t)),l(n)}function d(e,t){return m(e,i(t))}function f(){return l([].reduce.call(arguments,d,{}))}var p=/\s+/g,h=/\(.+\)/,m=n(45);s.prototype={set:c,get:u,dedupe:f},e.exports=s},2071:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){var s=t.instanceId,a=e.getStore(r.default).getState();if(!s||!a.oauthConsumerSecret||!a.oauthConsumerKey)return n("Required fields missing",null);var i=e.getStore(o.default).getCommentsState(s),l={context:t.context||"YahooGlobal",lang:a.lang,region:a.region,namespace:t.namespace||i.get("namespace")||a.namespace,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret};e.service.read("canvass.getPresence_ns",l,{},function(t,a){if(t||!a)return e.dispatch("CANVASS_PRESENCE_FAILURE",{instanceId:s}),n&&n(t,null);e.dispatch("CANVASS_PRESENCE_SUCCESS",{instanceId:s,userActivity:a}),n&&n()})}Object.defineProperty(t,"__esModule",{value:!0});var o=s(n(297)),r=s(n(115));a.displayName="loadUserActivity",t.default=a,e.exports=t.default},2072:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t,s){var a=e.getStore(r.default),i=a&&a.getI13nConfig()||{},l=(0,o.default)(i.rapid,["dwell_on"]),c=t.pct||(0,o.default)(i.rapid,["keys","pct"]),u=t.context,d=n(61).RapidManager&&n(61).RapidManager.getRapidInstance();d&&l?d.beaconClick("rapidDwell","",0,{g:u},"",function(){d.setRapidAttribute({keys:{pct:c}}),d.beaconClick("rapidDwell","",0,{g:u},"",null,{dwell:"start"}),s&&s()},{dwell:"stop"}):s&&s()}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var o=s(n(2)),r=s(n(95));e.exports=t.default},2073:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(3)),c=s(n(2)),u=s(n(0)),d=s(n(1)),f=s(n(1599)),p=s(n(1206)),h=(0,l.default)("Canvass:components:ActivityIndicator"),m=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),s=e.userActivity;return n.messageReceived=!1,n.pendingMessage=!1,n.state={typingUsersCount:s&&s.get("typingUsersCount")||0},n}return r(t,e),i(t,[{key:"componentDidMount",value:function(){this.props.cometEnabled&&this.openPipe()}},{key:"componentDidUpdate",value:function(e,t){0===t.typingUsersCount&&this.context.handleResize()}},{key:"componentWillUnmount",value:function(){this.closePipe()}},{key:"componentWillReceiveProps",value:function(e){if(this.pendingMessage=this.props.commenting!==e.commenting,!this.messageReceived){this.setState({typingUsersCount:e.userActivity&&e.userActivity.get("typingUsersCount")||0})}e.cometEnabled?this.props.cometEnabled||this.openPipe():this.closePipe()}},{key:"openPipe",value:function(){var e=this,t=e.context,s=t.componentConfig.pipe;if(s&&s.enabled){e.closePipe();var a=t.context,o=e.props.messageNamespace||t.namespace,r="/yahoo/canvass/"+o+"/"+a.replace(/-/g,"");n(1835).comet.config(s.cometConfig);var i=new(n(1835).Pipe)(r,{seqAlgo:"none",closeOnIdle:!0,maxIdle:s.maxPipeIdle});i.on("message",function(t){h("message",t),e.pendingMessage=!1,e.messageReceived=!0,e.setState((0,c.default)(t,["data","data","data"],{}))}),i.on("error",function(t){h("error",t);var n=t&&t.code;n&&"close-failed"!==n&&"open-failed"!==n&&e.closePipe()}),i.on("idle",function(t){h("idle",t),e.closePipe()}),i.open(),e.pipe=i}}},{key:"closePipe",value:function(){this.pipe&&(this.pipe.close(),this.pipe=null,this.messageReceived=!1)}},{key:"render",value:function(){var e=this.props.commenting,t=this.state.typingUsersCount;return t&&(e||!e&&this.pendingMessage)&&t--,t<=0?null:d.default.createElement(f.default,null,d.default.createElement(p.default,{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:0,transitionEnterTimeout:0,transitionLeaveTimeout:300},d.default.createElement("div",{className:"Mt(24px) Pb(12px) H(0) BdT Bdc($c-fuji-grey-c) Ta(c)"},d.default.createElement("span",{className:"Bgc($c-fuji-grey-b) H(24px) Px(10px) Py(0) Pos(r) T(-14px) Bd Bdc($c-fuji-grey-c) Bdrs(5px) D(ib)"},d.default.createElement("span",{className:"C($c-fuji-grey-l) Fz(12px) Fw(500) D(ib) Lh(20px) Va(tt)"},this.context.intl.formatMessage({id:"CANVASS_USERS_COMMENTING"},{count:t})),d.default.createElement("img",{alt:"",className:"Va(m) Mstart(5px)",src:"https://s.yimg.com/dh/ap/default/161130/loading_dots.gif",width:"30",height:"10"})))))}}]),t}(n(1).PureComponent);m.contextTypes={componentConfig:u.default.object.isRequired,context:u.default.string.isRequired,handleResize:u.default.func.isRequired,intl:u.default.object.isRequired,namespace:u.default.string},m.defaultProps={cometEnabled:!0},t.default=m,e.exports=t.default},2074:function(e,t,n){var s=n(2075),a=n(99),o=n(209),r=o&&o.isRegExp;e.exports=r?a(r):s},2075:function(e,t,n){function s(e){return o(e)&&a(e)==r}var a=n(70),o=n(51),r="[object RegExp]";e.exports=s},2076:function(e,t,n){e.exports={comet:n(1836).comet,initComet:n(1836).initComet}},2077:function(e,t,n){function s(e){console.log("Hello from the OnePush beaconing library.");var t=n(2078);n(558).polyfill(),n(2080);var s=t.unregisteredURL(e.spaceID,e.event,e.pageParams);console.log(s),fetch(s,{mode:"no-cors"}).then(function(e){console.log("Beacon sent")})}function a(e){s({spaceID:"2146128169",event:"nsdk_notification_received",pageParams:e})}function o(e){s({spaceID:"2146128169",event:"nsdk_notification_engaged",pageParams:e})}e.exports={sendNotificationReceived:a,sendNotificationEngaged:o}},2078:function(e,t,n){function s(e,t){if("string"!=typeof e&&"number"!=typeof e)throw new Error("Spaceid is REQUIRED");if(parseInt(e)!=e)throw new Error("Spaceid is INVALID");r.time.newTime();var n={_pl:17,_ms:r.time.ms,_ts:r.time.ts,A_v:"YI13N-BG-"+c,_gsqNo:l++};try{t&&r.absorbValid(n,t)}catch(e){throw new Error("pageParams Invalid")}return i(e,"pv",n,null)}function a(e,t,n,s,a){if("string"!=typeof e&&"number"!=typeof e)throw new Error("Spaceid is REQUIRED");if(parseInt(e)!=e)throw new Error("Spaceid is INVALID");if(!t||"string"!=typeof t||!u[t])throw new Error("eventTrigger REQUIRED");if(!n||"string"!=typeof n)throw new Error("eventName REQUIRED");r.time.newTime();var o={_pl:17,_ms:r.time.ms,_ts:r.time.ts,A_v:"YI13N-BG-"+c,etrg:u[t].etrg,usergenf:u[t].usergenf,outcm:n,_gsqNo:l++};try{s&&r.absorbValid(o,s)}catch(e){throw new Error("pageParams Invalid")}if(a){if("object"!=typeof a||Array.isArray(a))throw new Error("interactionParams is INVALID");try{a=r.cloneValid(a)}catch(e){throw new Error("interactionParams are INVALID")}}return i(e,"click",o,a)}function o(e,t,n){if("string"!=typeof e&&"number"!=typeof e)throw new Error("Spaceid is REQUIRED");if(parseInt(e)!=e)throw new Error("Spaceid is INVALID");if(!t||"string"!=typeof t)throw new Error("eventName REQUIRED");r.time.newTime();var s={_pl:17,_ms:r.time.ms,_ts:r.time.ts,A_v:"YI13N-BG-"+c,outcm:t,_gsqNo:l++};try{n&&r.absorbValid(s,n)}catch(e){throw new Error("pageParams Invalid")}return i(e,"lv",s,null)}var r=n(1837),i=n(2079),l=1,c="0.1.3",u={EVENT_TRIGGER_CLICK:{etrg:"click",usergenf:1},EVENT_TRIGGER_PRESS:{etrg:"press",usergenf:1},EVENT_TRIGGER_SWIPE:{etrg:"swipe",usergenf:1},EVENT_TRIGGER_SCROLL:{etrg:"scroll",usergenf:1},EVENT_TRIGGER_HOVER:{etrg:"hover",usergenf:1},EVENT_TRIGGER_DROP:{etrg:"drop",usergenf:1},EVENT_TRIGGER_DRAG:{etrg:"drag",usergenf:1},EVENT_TRIGGER_PINCH:{etrg:"pinch",usergenf:1},EVENT_TRIGGER_ORIENT:{etrg:"orient",usergenf:1}};e.exports={pageViewURL:s,interactionURL:a,unregisteredURL:o}},2079:function(e,t,n){function s(e,t,n,s){var o;o="click"===t?"c":"pv"===t?"b":"p";var r=null,i="";n&&(i=encodeURIComponent(n._R||""),delete n._R,r=function(){var e=[];for(var t in n)n.hasOwnProperty(t)&&e.push(encodeURIComponent(t+""+n[t]));return("c"===o?"&_K=":"&_P=")+e.join("%04").replace(/'/g,"%27")}());var l=function(){if(!s)return"c"===o?"&_C=%04":null;var e=[];for(var t in s)s.hasOwnProperty(t)&&e.push(encodeURIComponent(t+""+s[t]));return("c"===o?"&_C=":"&_L=")+e.join("%04").replace(/'/g,"%27")}(),c="";"p"===o&&"richview"===t&&(c="&_V=R");var u=["?s="+e,c,"&t="+a.cacheBuster(),"&_I=","&_AO=","&_NOL=","&_R="+i,r,l].join("");return["https://geo.yahoo.com/"+o,u].join("")}var a=n(1837);e.exports=s},2080:function(e,t,n){n(2081),e.exports=self.fetch.bind(self)},2081:function(e,t,n){!function(e,n){n(t)}(0,function(e){"use strict";function t(e){return e&&DataView.prototype.isPrototypeOf(e)}function n(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function s(e){return"string"!=typeof e&&(e=String(e)),e}function a(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return b.iterable&&(t[Symbol.iterator]=function(){return t}),t}function o(e){this.map={},e instanceof o?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function r(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function i(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function l(e){var t=new FileReader,n=i(t);return t.readAsArrayBuffer(e),n}function c(e){var t=new FileReader,n=i(t);return t.readAsText(e),n}function u(e){for(var t=new Uint8Array(e),n=new Array(t.length),s=0;s<t.length;s++)n[s]=String.fromCharCode(t[s]);return n.join("")}function d(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function f(){return this.bodyUsed=!1,this._initBody=function(e){this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:b.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:b.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:b.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():b.arrayBuffer&&b.blob&&t(e)?(this._bodyArrayBuffer=d(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):b.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||x(e))?this._bodyArrayBuffer=d(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):b.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},b.blob&&(this.blob=function(){var e=r(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?r(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(l)}),this.text=function(){var e=r(this);if(e)return e;if(this._bodyBlob)return c(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(u(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},b.formData&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}function p(e){var t=e.toUpperCase();return S.indexOf(t)>-1?t:e}function h(e,t){t=t||{};var n=t.body;if(e instanceof h){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new o(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new o(t.headers)),this.method=p(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function m(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),s=n.shift().replace(/\+/g," "),a=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(s),decodeURIComponent(a))}}),t}function g(e){var t=new o;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var n=e.split(":"),s=n.shift().trim();if(s){var a=n.join(":").trim();t.append(s,a)}}),t}function y(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new o(t.headers),this.url=t.url||"",this._initBody(e)}function v(t,n){return new Promise(function(s,a){function o(){i.abort()}var r=new h(t,n);if(r.signal&&r.signal.aborted)return a(new e.DOMException("Aborted","AbortError"));var i=new XMLHttpRequest;i.onload=function(){var e={status:i.status,statusText:i.statusText,headers:g(i.getAllResponseHeaders()||"")};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL"),s(new y("response"in i?i.response:i.responseText,e))},i.onerror=function(){a(new TypeError("Network request failed"))},i.ontimeout=function(){a(new TypeError("Network request failed"))},i.onabort=function(){a(new e.DOMException("Aborted","AbortError"))},i.open(r.method,r.url,!0),"include"===r.credentials?i.withCredentials=!0:"omit"===r.credentials&&(i.withCredentials=!1),"responseType"in i&&b.blob&&(i.responseType="blob"),r.headers.forEach(function(e,t){i.setRequestHeader(t,e)}),r.signal&&(r.signal.addEventListener("abort",o),i.onreadystatechange=function(){4===i.readyState&&r.signal.removeEventListener("abort",o)}),i.send(void 0===r._bodyInit?null:r._bodyInit)})}var b={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};if(b.arrayBuffer)var _=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],x=ArrayBuffer.isView||function(e){return e&&_.indexOf(Object.prototype.toString.call(e))>-1};o.prototype.append=function(e,t){e=n(e),t=s(t);var a=this.map[e];this.map[e]=a?a+", "+t:t},o.prototype.delete=function(e){delete this.map[n(e)]},o.prototype.get=function(e){return e=n(e),this.has(e)?this.map[e]:null},o.prototype.has=function(e){return this.map.hasOwnProperty(n(e))},o.prototype.set=function(e,t){this.map[n(e)]=s(t)},o.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},o.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),a(e)},o.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),a(e)},o.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),a(e)},b.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var S=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];h.prototype.clone=function(){return new h(this,{body:this._bodyInit})},f.call(h.prototype),f.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:0,statusText:""});return e.type="error",e};var C=[301,302,303,307,308];y.redirect=function(e,t){if(-1===C.indexOf(t))throw new RangeError("Invalid status code");return new y(null,{status:t,headers:{location:e}})},e.DOMException=self.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(e,t){this.message=e,this.name=t,this.stack=Error(e).stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}v.polyfill=!0,self.fetch||(self.fetch=v,self.Headers=o,self.Request=h,self.Response=y),e.Headers=o,e.Request=h,e.Response=y,e.fetch=v,Object.defineProperty(e,"__esModule",{value:!0})})},2082:function(e,t,n){"use strict";function s(e){this.id=++a,this.channel=e}var a=0;n(527).inherits(s,n(532).EventEmitter),s.prototype.close=function(){this.emit("close"),this.removeAllListeners()},e.exports=s},2083:function(e,t,n){"use strict";function s(){this._items=[]}function a(){this._item=null,this._ts=null}function o(e,t){this._cfg=i.merge({},l,t),this._channel=e,this._delayTimer=null,this._idleTimer=null,this._channelObj=null,this._meta={channel:this._channel,clientId:null},this._msgQ=null}var r=n(3)("TDPipe:Pipe"),i={merge:n(26),throttle:n(121)},l={closeOnIdle:!0,maxIdle:3e5,throttleInterval:2e3,seqAlgo:"lastUpdatedTs"},c={};c.none=s,s.prototype={empty:function(){return!this._items.length},pop:function(e,t){var n=this._items;return this._items=[],t&&t(null,n)},push:function(e,t){return this._items.push(e),t&&t(null)}},c.lastUpdatedTs=a,a.prototype={empty:function(){return!this._item},setItem:function(e){this._item=e,this._ts=e.lastUpdatedTs},pop:function(e,t){var n=this._item;return n&&e?(this._item=null,e.lastUpdatedTs&&n.lastUpdatedTs&&n.lastUpdatedTs>=e.lastUpdatedTs?t&&t(null,[n]):t&&t(null,null)):t&&t(null,null)},push:function(e,t){if(!e)return void(t&&t(null));if(!e.lastUpdatedTs)return void(t&&t({code:"invalid-seqId",message:"invalid msg. algo=lastUpdated"}));var n=this._ts,s=e.lastUpdatedTs;return null===n?(this.setItem(e),void(t&&t(null))):n===s?(this.setItem(e),void(t&&t(null))):n<s?(this.setItem(i.merge({},this._item,e)),void(t&&t(null))):t&&t({code:"outofsync",message:n+">"+s})}},o.configComet=function(e){n(1667).config(e)},n(527).inherits(o,n(532).EventEmitter),o.prototype.open=function(e){e=i.merge({delay:0},e);var t,s=e.delay,a=Date.now(),o=this;s>0?(t=a+s,this._delayTimer&&t<this._delayTimer.when&&(this._delayTimer.cancel(),this._delayTimer=null),this._delayTimer||(this._delayTimer=n(1668).later(function(){o._open(e)},s),this._delayTimer.when=t)):this._open(e)},o.prototype.close=function(){this._delayTimer&&(this._delayTimer.cancel(),this._delayTimer=null),this._idleTimer&&(this._idleTimer.cancel(),this._idleTimer=null),this._channelObj&&(this._channelObj.close(),this._channelObj=null)},o.prototype._getSeqId=function(){return"lastUpdatedTs"===this._cfg.seqAlgo&&this.lastUpdatedTs?{lastUpdatedTs:this.lastUpdatedTs}:null},o.prototype._setIdleTimer=function(){var e=this;e._idleTimer&&e._idleTimer.cancel(),e._idleTimer=n(1668).later(function(){e._emit("idle",{idleTime:e._cfg.maxIdle})},e._cfg.maxIdle)},o.prototype._open=function(e){if("none"!==this._cfg.seqAlgo&&null===this._getSeqId())return void this._emit("error",{code:"missing-seqId",message:"pipe missing lastUpdatedTs"});if(this._delayTimer&&(this._delayTimer.cancel(),this._delayTimer=null),!this._channelObj){this._channelObj=n(1667).open(this._channel);var t=this;this._channelObj.on("open",function(e){t._meta.clientId=e.clientId,t._emit("open")}),this._channelObj.on("close",function(e){t._msgQ=null,t._emit("close")}),this._channelObj.on("message",this._onMessage.bind(this)),this._channelObj.on("error",this._onError.bind(this))}},o.prototype._onError=function(e){"subscribe"===e.code?this._emit("error",{code:"open-failed",message:e.message,clientId:e.clientId}):"unsubscribe"===e.code&&this._emit("error",{code:"close-failed",message:e.message,clientId:e.clientId})},o.prototype._defaultThrottleMerge=function(e){var t,n={};return e.forEach(function(e){n=i.merge(n,e.data),t=e.lastUpdatedTs}),t&&(n.lastUpdatedTs=t),n},o.prototype._onMessage=function(e){var t=this;if(!t._msgQ){t._msgQ=new(c[t._cfg.seqAlgo]||c.none)}t.throttled_pop=t.throttled_pop||i.throttle(function(){t._msgQ&&!t._msgQ.empty()&&t._msgQ.pop(t._getSeqId(),function(e,n){if(!e&&n&&n.length){var s=(t._cfg.throttleMerge||t._defaultThrottleMerge)(n);t._emit("message",{data:s})}})},t._cfg.throttleInterval,{trailing:!0}),e.messages.forEach(function(e){e&&(t._setIdleTimer(),t._msgQ&&t._msgQ.push({lastUpdatedTs:e.lastUpdatedTs,data:e.data},function(e){e?t._emit("error",e):t.throttled_pop()}))})},o.prototype._emit=function(e,t){r("emit event",e,t),this.emit(e,t),"idle"===e?this._cfg.closeOnIdle&&this.close():"message"===e&&t&&t.lastUpdatedTs&&(this.lastUpdatedTs=n(1496).parseLastUpdatedTs(t.lastUpdatedTs))},e.exports=o},2084:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),c=s(n(0)),u=s(n(1)),d=s(n(1467)),f=s(n(8)),p=s(n(2)),h=s(n(1327)),m=s(n(2085)),g=s(n(2086)),y=s(n(1841)),v=s(n(1599)),b=s(n(1206)),_=s(n(1843)),x=s(n(2089)),S=s(n(2091)),C=(0,n(29).createI13nNode)("li",{isLeafNode:!0}),E=5,I=new RegExp("(\r\n|\r|\n)|"+m.default.URLPATTERN+"|"+m.default.PSEUDOURLPATTERN,"gim"),T=/(\r\n|\r|\n)/g,k=/(\r\n|\r|\n){3,}/g,M=function(e){function t(e,n){a(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));(0,h.default)(s,["handleFeedbackMessage","handleImageLoad","handleMessageClick"]);var r=n.guid,i=e.data.meta,l=void 0===i?{}:i,c=r&&r===(0,p.default)(l,["author","guid"])&&Date.now()/1e3-l.createdAt<=E;return s.state={actionType:null,animClass:c?"Bgc(#fff8e4)":"",imageLoaded:!1,isNew:c,showFeedbackMessage:!1,visible:!1},s}return r(t,e),l(t,[{key:"getChildContext",value:function(){var e=this.props;return{contextId:e.contextId,cpos:e.cpos,pos:e.pos}}},{key:"componentDidMount",value:function(){this.setState({animClass:""})}},{key:"componentWillUnmount",value:function(){clearTimeout(this._timer)}},{key:"shouldComponentUpdate",value:function(e,t){return!(0,n(118).shallowEqual)(this.state,t)||!(0,n(118).shallowEqual)(this.props.data,e.data,["vote","contextId","messageId","replyId"])}},{key:"getI13nModel",value:function(){var e=this.props,t=e.cpos,n=e.data,s=e.pos,a=n.replyId,o={elm:"cmmt_seen",msg_id:a||n.messageId,slk:"seen",cpos:t,pos:null!==s?s:"",reply_lv:a?1:0};return this.context.isUserMessageHistory&&(o.g=this.props.contextId),o}},{key:"renderContextInfo",value:function(){var e=this.context,t=this.props,s=(0,p.default)(t.data,["meta","contextInfo"])||{},a=s.displayText||"",o=s.url||"",r="context-info My(8px) Fz(12px) Fw(b) Lh(14px)";if((e.isUserMessageHistory||e.context!==t.contextId)&&null===t.pos&&a)return o?u.default.createElement(n(1312).I13nAnchor,{className:r+" D(ib) Td(n) C($c-fuji-blue-1-a)",href:o,i13nModel:(0,n(1312).getI13nModel)("context-link"),rel:"noopener noreferrer",target:"_blank"},a):u.default.createElement("div",{className:r+" C($c-fuji-grey-l)"},a)}},{key:"parseMessageForLinks",value:function(){var e=this.props,t=e.data,s=e.isReadOnly,a=t.details.userText;if(a){var o=a.replace(k,"\n\n"),r=void 0,i=[],l="",c={index:0,0:""};for(I.lastIndex=0;null!==(r=I.exec(o));)l=o.slice(c.index+c[0].length,r.index),l.length&&i.push(l),i.push(r[0].indexOf(".")>0?u.default.createElement(n(1312).I13nAnchor,{className:"C($c-fuji-blue-1-a) Td(n)",href:-1===r[0].indexOf("://")?"http://"+r[0].trim():r[0],i13nModel:(0,n(1312).getI13nModel)("link"),key:i.length,rel:"noopener noreferrer nofollow",target:"_blank"},r[0]):u.default.createElement("br",{key:i.length})),c=r;i.push(i.length?o.slice(c.index+c[0].length):o);var d=(0,f.default)("C($c-fuji-grey-l) Mb(2px) Fz(14px) Lh(20px) Pend(8px)",{"LineClamp(3,66px)":s});return u.default.createElement("div",{className:d},i)}}},{key:"renderVideo",value:function(e){if(e&&0!==e.length){var t=this.props,n=e[0],s=n.video,a=n.title,o=n.description;return u.default.createElement(_.default,{enhancedLink:{url:s?s.url:"",title:a,description:o,image:{url:s.coverImage?s.coverImage.url:""}},fromStream:!0,isReply:null!==t.pos,messageId:t.data.messageId,isUserMessageHistory:this.context.isUserMessageHistory})}}},{key:"handleImageLoad",value:function(){this.setState({imageLoaded:!0})}},{key:"renderImage",value:function(e){if(e&&0!==e.length){var t=(0,p.default)(e,[0,"image","resolutions"],[]),s=(0,p.default)(e,[0,"attribution","name"],"");s=s?(0,n(118).trimDescription)(s,30):"";var a=void 0;if(t&&0!==t.length){a=t[0];for(var o=t.length-1;o>=0;o--)if(t[o].width<=375){a=t[o];break}}else a=(0,p.default)(e,[0,"image"]);if(a){return u.default.createElement("div",{className:"Pos(r) D(ib) Lh(12px)"},u.default.createElement(n(80).Img,{key:a.url,className:"W(a) Mah(320px) My(3px) H(a) Maw(100%)",url:a.url,onLoadCallback:this.handleImageLoad,forceLoad:!0,alt:"Image"+s,height:a.height,width:a.width}),(this.state.imageLoaded||this.context.isUserMessageHistory)&&s?u.default.createElement("div",{className:"W(100%) Ta(end) Op(0.6) Bg(gradient) Fz(9px) Fw(b) C($c-fuji-grey-c) Pos(a) End(0) B(3px) Lh(8px) Py(4px)"},u.default.createElement("div",{className:"D(ib) Op(1)"},u.default.createElement(n(36).FormattedMessage,{id:"CANVASS_ATTRIBUTION",values:{author:s,source:u.default.createElement("img",{className:"W(a) Mend(5px) Mstart(2px) Va(bl)",src:"https://s.yimg.com/dh/ap/default/160620/tumblr-logo-transparent-1x.png"})}}))):void 0)}}}},{key:"renderSmartLink",value:function(e){if(e&&0!==e.length){var t=this.props,n=e[0],s=n.url,a=n.title,o=n.description,r=n.coverImages;return u.default.createElement(_.default,{enhancedLink:{url:s,title:a,description:o,image:{url:r&&r[0].url}},fromStream:!0,isReply:null!==t.pos,messageId:t.data.messageId,isUserMessageHistory:this.context.isUserMessageHistory})}}},{key:"shouldEnableSeeMore",value:function(e,t){if(this.props.isReadOnly||!e.enable||!t)return!1;var n=t.userText||"";return n.length>e.maxTextLength||(n.match(T)||[]).length>=e.lines}},{key:"handleMessageClick",value:function(e){if(!e.target.getAttribute("href")&&this.context.isUserMessageHistory){var t=this.props.data,s=(0,p.default)(t,["meta","contextInfo"])||{},a=s.url;if(a){a+=(-1===a.indexOf("?")?"?":"&")+"messageId="+t.messageId,t.replyId&&(a+="&replyId="+t.replyId);window.open(a+"&bcmt=1","_blank").opener=null,(0,n(1312).fireRapidClick)(Object.assign(this.context.i13n.getI13nNode().getMergedModel(),this.getI13nModel(),{elm:"cmmt_body",slk:"deeplink",itc:0}))}}}},{key:"renderMessage",value:function(){var e=this.props,t=e.data,n=e.seeMore,s=void 0===n?{}:n,a=this.context.isUserMessageHistory,o=(0,p.default)(t,["details"],{}),r=a&&!!(0,p.default)(t,["meta","contextInfo","url"]),i=this.parseMessageForLinks(),l=this.shouldEnableSeeMore(s,o),c={isUserMessageHistory:a,lines:s.lines,lineHeight:s.lineHeight};return u.default.createElement("div",{className:"Wow(bw)"+(r?" Cur(p)":""),onClick:this.handleMessageClick},l?u.default.createElement(x.default,c,i):i,this.renderVideo(o.videoMessageDetails)||this.renderSmartLink(o.linkMessageDetails)||this.renderImage(o.imageMessageDetails))}},{key:"renderActionForm",value:function(){var e=this.context,t=this.props,n=t.data,s=n.meta.author;if(!t.isReadOnly)return u.default.createElement(v.default,null,u.default.createElement(g.default,{creator:s.guid,handleFeedbackMessage:this.handleFeedbackMessage,isReadOnly:t.isReadOnly,isUserMessageHistory:e.isUserMessageHistory,messageId:n.messageId,messageNamespace:t.messageNamespace,nickname:s.nickname,parentContextDisplayText:t.parentContextDisplayText,parentContextUrl:t.parentContextUrl,replyId:n.replyId}))}},{key:"renderSocialControl",value:function(){var e=this.context,t=this.props,n=t.data,s=n.meta.author;if(!t.isReadOnly)return u.default.createElement(S.default,{author:s,instanceId:e.instanceId,isUserMessageHistory:e.isUserMessageHistory,key:"social-"+(n.replyId||n.messageId),messageId:n.messageId,messageNamespace:t.messageNamespace,parentContextDisplayText:t.parentContextDisplayText,parentContextUrl:t.parentContextUrl,parentTags:t.parentTags||[],reactionStats:n.reactionStats,replyCount:n.reactionStats.replyCount,replyId:n.replyId,replySortBy:t.replySortBy,sortBy:t.sortBy,userReportedAbuse:n.abuseReason,vote:(n.vote||"").toLowerCase()})}},{key:"handleFeedbackMessage",value:function(e){this.setFeedbackTimer(),this.setState({showFeedbackMessage:!0,actionType:e,visible:!0})}},{key:"setFeedbackTimer",value:function(){null!==this._timer&&clearTimeout(this._timer),this._timer=setTimeout(function(){this.setState({visible:!1}),this._timer=null}.bind(this),2e3)}},{key:"renderFeedbackMessage",value:function(){if(this.state.visible){var e="delete"===this.state.actionType?"CANVASS_DELETED_MESSAGE":"flag"===this.state.actionType?"CANVASS_FLAGGED_MESSAGE":"CANVASS_MUTED_MESSAGE";return u.default.createElement("div",{className:"Pos(a) Start(0) Bxz(bb) W(100%) Bxsh(boxShadow) Py(6px) Px(8px) Fz(13px) C(#000) Bgc($c-fuji-grey-b)"},u.default.createElement(n(34).Icon,{name:this.state.actionType,className:"Px(8px)",color:"#000",style:{verticalAlign:"middle"},width:21,height:21}),u.default.createElement(n(36).FormattedMessage,{id:e}))}}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.pos,s=this.state,a=s.isNew,o=s.showFeedbackMessage,r=t.messageId,l=t.replyId;if(!t.details)return null;var c=t.meta,f=c.createdAt,p=c.author,h=t.lastActivity&&t.lastActivity.activityAt||0,m=p&&p.image?p.image.url:"",g=this.getI13nModel(),v=d.default.dedupe("comment Pend(2px) "+e.className,this.state.animClass,{"Trsde(3s) Trsdu(.5s)":a&&!o,"Mb(40px)":o,"P(0)! M(0)!":o&&!this.state.visible}),_=d.default.dedupe("Pos(r) Pstart(52px)",{"Pstart(40px)":null!==n}),x=a?b.default:C,S=void 0;a&&(S={component:C,transitionName:"action",transitionAppear:!0,transitionAppearTimeout:500,transitionEnter:!1,transitionLeave:!1});var E="comment"+(l||r);return o?u.default.createElement(b.default,{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:500,transitionEnterTimeout:500,transitionLeaveTimeout:1e3},u.default.createElement("li",{key:"feedback"+this.state.visible,className:v},this.renderFeedbackMessage())):u.default.createElement(x,i({key:E,className:v,i13nModel:g},S),u.default.createElement("div",{className:_},u.default.createElement(y.default,{activityAt:1e3*h,createdAt:1e3*f,creator:p.guid,imageUrl:m,isReadOnly:e.isReadOnly,key:"byline-"+(l||r),messageId:t.messageId,name:p.nickname,pos:n,replyCount:t.reactionStats.replyCount,replyId:t.replyId,sortBy:e.sortBy}),this.renderContextInfo(),this.renderMessage(),this.renderActionForm(),this.renderSocialControl()))}}]),t}(n(1).Component);M.contextTypes={componentConfig:c.default.object,configStoreState:c.default.object.isRequired,context:c.default.string,contextDisplayText:c.default.string,contextUrl:c.default.string,executeAction:c.default.func.isRequired,guid:c.default.string,i13n:c.default.object.isRequired,instanceId:c.default.string,intl:c.default.object,isUserMessageHistory:c.default.bool,session:c.default.object,userMessageHistoryGuid:c.default.string},M.childContextTypes={contextId:c.default.string,cpos:c.default.number,pos:c.default.number},M.defaultProps={className:"",contextId:null,cpos:null,data:{},pos:null,sortBy:""},t.default=M,e.exports=t.default},2085:function(e,t){e.exports=Object.freeze({URLPATTERN:"\\b(?:https?|ftp)://[a-z0-9-+&@#/%?=~_|!:,.;]*[a-z0-9-+&@#/%=~_|]",PSEUDOURLPATTERN:"(^|[^/])(www\\.[a-z0-9-+&@#/%?=~_|!:,.;]*[a-z0-9-+&@#/%=~_|])",MENTIONS:"(://|>)?(@([_a-z0-9-]+))",HASHTAGS:"(://[^ <]*|>)?(#([_a-z0-9-]+))"})},2086:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(1597)),d=s(n(1327)),f=s(n(2)),p=s(n(512)),h=s(n(2087)),m=s(n(2088)),g=s(n(1838)),y=s(n(1839)),v=s(n(1840)),b=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,d.default)(n,["closeFlyout","handleAction","handleClickOutside","handleRadioChanged","handleReport","handleToggleFlyout","handleToggleToolTip","openFlyout"]),n.state={selectedAbuseOption:"",flyoutOpened:!1,reportOpened:!1,showTooltip:!1},n}return r(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;t.props.messageId!==e.messageId&&t.setState({flyoutOpened:!1,reportOpened:!1,selectedAbuseOption:"",showTooltip:!1})}},{key:"componentDidUpdate",value:function(e,t){!t.flyoutOpened&&this.state.flyoutOpened&&this.refs.flyout.focus()}},{key:"handleRadioChanged",value:function(e){this.setState({selectedAbuseOption:e.currentTarget.value})}},{key:"handleReport",value:function(){var e=this.context,t=this.props,s=e.intl.formatMessage({id:"CANVASS_FLAG_REASON_ELSE"}),a=this.state.selectedAbuseOption===s?(0,n(10).findDOMNode)(this.refs.reportText).value.trim():this.state.selectedAbuseOption;a?(e.executeAction(g.default,{abuseReason:a,context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId,voteType:"abuse"}),t.handleFeedbackMessage("flag")):this.setState({reportOpened:!1})}},{key:"handleDelete",value:function(){var e=this.context,t=this.props;e.executeAction(m.default,{context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId})}},{key:"handleBlockUser",value:function(){var e=this.context,t=this.props;e.executeAction(h.default,{blockedGuid:t.creator,context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId,userId:e.guid})}},{key:"handleClickOutside",value:function(e){this.closeFlyout()}},{key:"openFlyout",value:function(){this.setState({flyoutOpened:!0})}},{key:"closeFlyout",value:function(){this.setState({flyoutOpened:!1,reportOpened:!1,showTooltip:!1})}},{key:"handleToggleFlyout",value:function(){this.setState({flyoutOpened:!this.state.flyoutOpened,showTooltip:!1})}},{key:"handleToggleToolTip",value:function(){this.setState({showTooltip:!this.state.showTooltip})}},{key:"handleAction",value:function(e){if(!this.context.guid)return void this.setState({showTooltip:!0});var t=this.props,n=void 0!==t.delay?t.delay:2500;"flag"!==e&&(t.handleFeedbackMessage(e),setTimeout(function(){"delete"===e?this.handleDelete():"block"===e&&this.handleBlockUser()}.bind(this),n)),this.setState({flyoutOpened:!1,reportOpened:"flag"===e&&!this.state.reportOpened})}},{key:"renderFlyoutButton",value:function(e){var t="Pos(r) W(100%) H(a) Mih(36px) Z(1) Pend(14px) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag) Cur(p) Py(6px) Pstart(8px) Fz(13px) C($c-fuji-grey-l) Bgc(#fff) Bgc($c-fuji-grey-b):h flyout-button-"+e,s="D(ib) Ta(start) Wow(bw) Pstart(28px) "+("delete"===e?"W(100px)":"W(125px)"),a=this.context.intl,o=void 0;switch(e){case"delete":o=a.formatMessage({id:"CANVASS_DELETE_MESSAGE"});break;case"flag":o=a.formatMessage({id:"CANVASS_FLAG_MESSAGE"});break;case"block":o=a.formatMessage({id:"CANVASS_MUTE_MESSAGE"},{user:this.props.nickname})}return c.default.createElement(n(1312).I13nButton,{onClick:this.handleAction.bind(this,e),i13nModel:(0,n(1312).getI13nModel)("comment-"+e),role:"menuitem",className:t},c.default.createElement("div",{className:"W(40px) D(ib) Pos(a) T(6px) Start(4px)"},c.default.createElement(n(34).Icon,{name:e,className:"Px(8px)",color:"#000",style:{verticalAlign:"middle"},width:21,height:21})),c.default.createElement("div",{className:s},o))}},{key:"renderFlyout",value:function(){if(!this.state.flyoutOpened)return null;var e=this.props.creator===this.context.guid;return c.default.createElement("div",{tabIndex:"-1",role:"menu",ref:"flyout",className:"flyout O(n) Pos(a) T(0) End(25px) W(190px)"},this.renderFlyoutButton(e?"delete":"flag"),!e&&this.renderFlyoutButton("block"),this.renderTooltip())}},{key:"renderTooltip",value:function(){if(this.state.showTooltip)return c.default.createElement(v.default,{className:"Bxsh(boxShadowFlag) Bxz(bb) W(100%)",handleToggleToolTip:this.handleToggleToolTip,messageId:this.props.messageId,replyId:this.props.replyId})}},{key:"renderFlagOption",value:function(e,t){var n=this.props.replyId||this.props.messageId,s="report-option-"+n+"-"+t,a=this.context.intl.formatMessage({id:e});return c.default.createElement("div",{className:"Mb(10px) flag-opts"},c.default.createElement("input",{id:s,onChange:this.handleRadioChanged,type:"radio",name:"options-"+n,className:"Mend(10px) Va(t)",value:a}),c.default.createElement("label",{htmlFor:s},a))}},{key:"renderOverflowButton",value:function(){var e=this,t=e.context,s=e.state.flyoutOpened?"#188fff":"#878c91",a="desktop"===(0,f.default)(t,["session","dimensions","device"]);return c.default.createElement("span",{className:"Pos(a) End(0) T(-3px)",onMouseEnter:a?e.openFlyout:null,onMouseLeave:a?e.closeFlyout:null},e.renderFlyout(),c.default.createElement(n(1312).I13nButton,{className:"O(n):h O(n):a Bd(n) Px(6px) Py(2px)","aria-expanded":this.state.flyoutOpened?"true":void 0,"aria-haspopup":"true","aria-label":t.intl.formatMessage({id:"CANVASS_SEE_MORE"}),onClick:e.handleToggleFlyout,i13nModel:(0,n(1312).getI13nModel)("options")},c.default.createElement(n(34).Icon,{name:"overflow",color:s,width:16,height:16})))}},{key:"renderReportForm",value:function(){var e=this;if(!e.state.reportOpened)return null;var t=e.context,s=t.intl,a=s.formatMessage({id:"CANVASS_REPORT_REASON"}),o=s.formatMessage({id:"CANVASS_FLAG_REASON_ELSE"}),r={outcm:"close"},i="desktop"===(0,f.default)(t,["session","dimensions","device"]),l=u.default.dedupe("D(n) P(6px) W(100%) H(33px) Fz(13px) Lh(12px) Mb(10px) Pstart(10px)",{"D(b)":e.state.selectedAbuseOption===o,"Fz(16px)":!i}),d="P(6px) W(30%) H(33px) Mend(10px) Mt(5px)";return c.default.createElement("div",{className:"Pos(a) End(35px) T(-3px) P(14px) Fz(13px) Lh(16px) C(#000) Z(2) Bgc(#fff) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadow) report-form-container"},c.default.createElement("div",{className:"Mb(10px) Fw(b)"},c.default.createElement(n(36).FormattedMessage,{id:"CANVASS_REPORT_LABEL"})),c.default.createElement("div",{className:"Row"},e.renderFlagOption("CANVASS_FLAG_REASON_INAPPROPRIATE_POST",1),e.renderFlagOption("CANVASS_FLAG_REASON_DOES_NOT_BELONG_HERE",2),e.renderFlagOption("CANVASS_FLAG_REASON_SPAM",3),e.renderFlagOption("CANVASS_FLAG_REASON_COPYRIGHT_VIOLATION",4),e.renderFlagOption("CANVASS_FLAG_REASON_ELSE",5),c.default.createElement(y.default,{ref:"reportText",rows:5,tabIndex:"1",className:l,placeholder:a}),c.default.createElement(n(1312).I13nButton,{type:"button",className:u.default.get("btn btn-secondary",d),onClick:e.handleAction.bind(e,"flag"),i13nModel:(0,n(1312).getI13nModel)("comment-report-cancel",r)},c.default.createElement(n(36).FormattedMessage,{id:"CANVASS_CANCEL"})),c.default.createElement(n(1312).I13nButton,{type:"button",className:u.default.get("btn btn-primary",d),onClick:e.handleReport,i13nModel:(0,n(1312).getI13nModel)("comment-report-done",Object.assign({slk:e.state.selectedAbuseOption},r))},c.default.createElement(n(36).FormattedMessage,{id:"CANVASS_DONE"}))))}},{key:"render",value:function(){return c.default.createElement("div",null,this.renderOverflowButton(),this.renderReportForm())}}]),t}(n(1).PureComponent);b.contextTypes={componentConfig:l.default.object.isRequired,configStoreState:l.default.object.isRequired,contextId:l.default.string,cpos:l.default.number,getStore:l.default.func.isRequired,guid:l.default.string,instanceId:l.default.string,intl:l.default.object.isRequired,isUserMessageHistory:l.default.bool,executeAction:l.default.func.isRequired,pos:l.default.number,session:l.default.object.isRequired,tags:l.default.string,userMessageHistoryGuid:l.default.string},t.default=(0,p.default)(b),e.exports=t.default},2087:function(e,t,n){"use strict";function s(e,t,n){var s=e.getStore(a.default).getState(),o=Object.assign({lang:s.lang,region:s.region,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret},t);e.service.create("canvass.blockUser",o,{},function(t,s){if(t||!s||s.error)return e.dispatch("CANVASS_BLOCK_FAILURE",t),n();e.dispatch("CANVASS_BLOCK_SUCCESS",o),n()})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var a=function(e){return e&&e.__esModule?e:{default:e}}(n(115));e.exports=t.default},2088:function(e,t,n){"use strict";function s(e,t,n){var s=t.replyId?"canvass.deleteReply_ns":"canvass.deleteMessage_ns",o=e.getStore(a.default).getState(),r=Object.assign({lang:o.lang,region:o.region,oauthConsumerKey:o.oauthConsumerKey,oauthConsumerSecret:o.oauthConsumerSecret},t);e.service.delete(s,r,{},function(t,s){if(t||!s||s.error)return e.dispatch("CANVASS_DELETE_FAILURE",t),n();e.dispatch("CANVASS_DELETE_SUCCESS",r),n()})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var a=function(e){return e&&e.__esModule?e:{default:e}}(n(115));e.exports=t.default},2089:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(1327)),d=s(n(1402)),f=s(n(2090)),p=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,u.default)(n,["getWrapperStyles","handleClick"]),n.state={expanded:!1},n}return r(t,e),i(t,[{key:"handleClick",value:function(e){e&&e.stopPropagation(),this.setState({expanded:!this.state.expanded})}},{key:"getWrapperStyles",value:function(){return{maxHeight:this.state.expanded?null:this.props.lines*this.props.lineHeight,overflow:"hidden"}}},{key:"componentDidUpdate",value:function(e,t){t.expanded!==this.state.expanded&&this.context.handleResize()}},{key:"render",value:function(){var e=this.props,t=e.children,s=this.state.expanded,a=s?"CANVASS_SEE_LESS":"CANVASS_SEE_MORE",o=(0,n(1312).getI13nModel)("comment-seemore",{sec:e.isUserMessageHistory?"cmmt_his":"cmmts"});return c.default.createElement("div",{className:"canvass-see-more"},c.default.createElement("div",{className:"see-more-wrapper",style:this.getWrapperStyles()},t),c.default.createElement(n(1312).I13nButton,{"aria-hidden":"true",className:"more-button Fz(13px) Fw(b) P(0) Mt(3px) Mb(6px) Bd(0) C($c-fuji-grey-l) O(n):h O(n):a",i13nModel:o,onClick:this.handleClick},c.default.createElement(n(36).FormattedMessage,{id:a,className:"more-button-label"}),c.default.createElement(n(34).Icon,{asset:s?f.default:d.default,className:"Mstart(5px)",color:"#26282a",style:{verticalAlign:"middle"},width:9,height:9})))}}]),t}(n(1).Component);p.contextTypes={handleResize:l.default.func.isRequired},p.defaultProps={lines:3,lineHeight:20},t.default=p,e.exports=t.default},2090:function(e,t){if(void 0===n)var n={};n.CoreArrowUp={name:"CoreArrowUp",height:49,width:49,path:"M2.053 36.584l2.18 2.18c1.353 1.364 3.76 1.364 5.11 0L25.014 23.09l15.68 15.68c1.408 1.394 3.69 1.394 5.102-.01l2.177-2.18c1.367-1.354 1.367-3.76.003-5.104L27.562 11.053c-1.407-1.39-3.688-1.395-5.102.01L2.043 31.486c-1.39 1.404-1.395 3.684.01 5.1z"},void 0!==e&&e.exports&&(e.exports=n.CoreArrowUp)},2091:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){var n=e.getStore(_.default),s=e.getStore(v.default),a=n.getGUID(),o=t.messageId,r=t.instanceId,i=t.isUserMessageHistory,l=t.replyId,c=l?null:s.getCommentsState(r).get("deepLink"),u=[],d={};return l||(u=s.getReplyList(o,r,i).toJS(),d=s.getReplyListState(o,r,i).toJS()),{deepLink:c&&c.get("messageId")===o?c.toJS():void 0,guid:a,isSignedIn:n.isSignedIn(),list:u,replyListState:d}}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=s(n(0)),d=s(n(1)),f=s(n(1327)),p=s(n(8)),h=s(n(2)),m=s(n(521)),g=s(n(2092)),y=s(n(505)),v=s(n(297)),b=s(n(1598)),_=s(n(92)),x=s(n(1844)),S=s(n(1669)),C=s(n(1842)),E=s(n(2101)),I=s(n(1840)),T=function(e){function t(e,n){a(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));(0,f.default)(s,["getReplies","handleCloseCommentForm","handleRepliesClick","handleReplyClick","handleReplyFormBlur","handleToggleToolTip","handleViewTopClick"]);var r=!(!e.deepLink||!e.deepLink.replyId),i=(0,h.default)(n.componentConfig,["ui","replyPreview"]);return s.state={loadingNextComments:!1,loadingPrevComments:!1,replyFormInFocus:!1,showReplyForm:r,showReplyList:r||i&&e.list.length>0},s}return r(t,e),c(t,[{key:"getReplies",value:function(e){var t=this,n=t.context,s=t.props,a=s.replyListState.nextIndex,o=!0,r=s.replySortBy;"showNext"===e?t.setState({loadingNextComments:!0}):"showPrev"===e?(r="createdAtDesc",a=s.replyListState.prevIndex,t.setState({loadingPrevComments:!0})):s.replyCount>0&&0===s.list.length?(e="showNext",t.setState({loadingNextComments:!0})):o=!1,o&&n.executeAction(g.default,{action:e,context:n.contextId,count:10,index:a,instanceId:n.instanceId,isUserMessageHistory:n.isUserMessageHistory,messageId:s.messageId,namespace:s.messageNamespace,sortBy:r,tags:n.tags})}},{key:"handleCloseCommentForm",value:function(){this.setState({replyFormInFocus:!1,showReplyForm:!1})}},{key:"handleRepliesClick",value:function(){var e=!this.state.showReplyList;this.getReplies("replies"),this.setState({openedBy:"replies",replyFormInFocus:!1,showReplyForm:e,showReplyList:e})}},{key:"handleReplyClick",value:function(){var e=this.state,t="reply"!==e.openedBy||!e.showReplyForm;t&&this.context.getStore(b.default).setActiveForm(this.props),this.setState({openedBy:"reply",replyFormInFocus:t,showReplyForm:t,showReplyList:!!t&&e.showReplyList})}},{key:"handleReplyFormBlur",value:function(){this.setState({replyFormInFocus:!1})}},{key:"handleToggleToolTip",value:function(){this.setState({showToolTip:!this.state.showToolTip})}},{key:"handleViewTopClick",value:function(){var e=this.context;e.executeAction(m.default,{instanceId:e.instanceId,context:e.contextId,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,selectedTags:"",sortBy:"popular",tagsAnd:e.tagsAnd,tagsOr:e.tagsOr})}},{key:"renderReplyButton",value:function(){var e=this,t=e.state,s=e.props.replyCount,a=e.context.intl,o="reply"!==t.openedBy||!t.showReplyForm,r=!t.showReplyList,i="O(n):h O(n):a P(0) Bd(n) Cur(p) Fz(12px) Fw(500) C($c-fuji-grey-g) D(ib) Mend(20px)";return d.default.createElement("div",{className:"D(ib)"},d.default.createElement(n(1312).I13nButton,{bindClickEvent:o,className:"reply-button "+i,i13nModel:(0,n(1312).getI13nModel)("reply"),key:o?"show-reply":"hide-reply",onClick:this.handleReplyClick},d.default.createElement(n(34).Icon,{asset:C.default,color:"#878c91",height:15,className:"Mend(5px)"}),a.formatMessage({id:"CANVASS_REPLY"})),s>0?d.default.createElement(n(1312).I13nButton,{bindClickEvent:r,className:"replies-button "+i,i13nModel:(0,n(1312).getI13nModel)("replies-show"),key:r?"show-replies":"hide-replies",onClick:this.handleRepliesClick},a.formatMessage({id:"CANVASS_REPLIES"})+" ("+a.formatNumber(s)+")"):void 0)}},{key:"renderLoadingMessage",value:function(e){return d.default.createElement("div",{className:"loading-msg Fz(14px) Fw(b) Lh(n) C($c-fuji-grey-g) D(ib) "+e},this.context.intl.formatMessage({id:"CANVASS_LOADING_MORE_COMMENTS"}))}},{key:"renderShowNextButton",value:function(e){var t=this,s=t.props,a=t.state;if(a.showReplyList)return a.loadingNextComments?t.renderLoadingMessage(e):s.replyListState.showLoadNext?d.default.createElement(n(1312).I13nButton,{i13nModel:(0,n(1312).getI13nModel)("comments-showMore"),onClick:function(){return t.getReplies("showNext")},className:"show-next-button Fz(14px) Fw(b) C($c-fuji-blue-1-a) Bd(0) P(0) Mx(0) "+e},t.context.intl.formatMessage({id:"popular"===s.replySortBy?"CANVASS_SHOW_MORE_REPLIES":"CANVASS_SHOW_OLDER_REPLIES"})):void 0}},{key:"renderShowPrevButton",value:function(e){var t=this;if(this.state.showReplyList)return this.state.loadingPrevComments?this.renderLoadingMessage(e):this.props.replyListState.prevIndex?d.default.createElement(n(1312).I13nButton,{i13nModel:(0,n(1312).getI13nModel)("comments-showMore"),onClick:function(){return t.getReplies("showPrev")},className:"show-prev-button Fz(14px) Fw(b) C($c-fuji-blue-1-a) Bd(0) P(0) Mx(0) "+e},this.context.intl.formatMessage({id:"CANVASS_SHOW_NEWER_REPLIES"})):void 0}},{key:"renderReplyBox",value:function(){var e=this.state;if(e.showReplyForm||e.showReplyList)return d.default.createElement("div",{className:"reply-box"},this.renderCommentForm(),this.renderShowPrevButton("My(10px)"),this.renderCommentList(),this.renderShowNextButton("Mt(10px) Mb(5px) Mstart(40px)"))}},{key:"renderCommentForm",value:function(){if(this.state.showReplyForm){var e=this.props,t=e.author,n=void 0===t?{}:t,s=e.deepLink,a=e.replyId,o=n.nickname;return d.default.createElement(x.default,{cpos:this.context.cpos,deepLink:s,forReply:!0,handleCloseCommentForm:this.handleCloseCommentForm,handleReplyFormBlur:this.handleReplyFormBlur,mentions:a&&o?[{guid:n.guid,nickname:o}]:null,messageId:e.messageId,messageNamespace:e.messageNamespace||null,parentContextDisplayText:e.parentContextDisplayText,parentContextUrl:e.parentContextUrl,parentTags:e.parentTags||[],replyFormInFocus:this.state.replyFormInFocus,replyId:a,value:a&&o?"@"+o+" ":""})}}},{key:"renderCommentList",value:function(){var e=this.props,t=this.state;if(t.showReplyList){var n=(0,p.default)("Mstart(-10px)",{"Pt(10px)":!t.showReplyForm});return d.default.createElement(S.default,{className:n,cpos:this.context.cpos,deepLink:e.deepLink,itemClassName:"Py(10px) Pstart(10px)",key:"commentlist3",list:e.list,parentContextDisplayText:e.parentContextDisplayText,parentContextUrl:e.parentContextUrl})}}},{key:"getThumbProps",value:function(e){var t=this.context,s=this.props,a={contextId:t.contextId,isSignedIn:s.isSignedIn,messageId:s.messageId,messageNamespace:s.messageNamespace,onToggleToolTip:this.handleToggleToolTip,reactionStats:s.reactionStats,replyId:s.replyId,thumbName:e,vote:s.vote,voteType:e},o=e&&n(507).THUMB_PROPS[e];return o&&(a=Object.assign({selectedColor:o.color,selectedIcon:o.icon},a,o),delete a.color),a}},{key:"renderThumbs",value:function(){var e=this,t=e.props,n=(0,h.default)(e.context,["componentConfig","ui","thumbs"],["up"]),s=n.length;return d.default.createElement("div",{className:"D(ib) Pos(r)"},n.map(function(t,n){var a=(0,p.default)("O(n):h O(n):a  Bgc(t) Bdc(t) M(0) P(0) Bd(n)",{"Mend(12px)":n<s-1});return d.default.createElement(E.default,l({},e.getThumbProps(t),{className:a,key:t,showCount:s>1}))}),e.state.showToolTip?d.default.createElement(I.default,{handleToggleToolTip:e.handleToggleToolTip,messageId:t.messageId,replyId:t.replyId}):void 0)}},{key:"componentDidUpdate",value:function(e,t){var n=this.state;(e.list||[]).length===(this.props.list||[]).length&&t.showReplyForm===n.showReplyForm&&t.showReplyList===n.showReplyList||this.context.handleResize()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=this.state,s={};if(e.messageId!==t.messageId||e.replyId!==t.replyId||e.sortBy!==t.sortBy||!e.deepLink&&t.deepLink){s={loadingPrevComments:!1,loadingNextComments:!1,replyFormInFocus:!1,showReplyForm:!1,showReplyList:(0,h.default)(context.componentConfig,["ui","replyPreview"])&&e.list.length>0}}else n.loadingNextComments&&e.replyListState.nextIndex!==t.replyListState.nextIndex&&(s.loadingNextComments=!1),n.loadingPrevComments&&e.replyListState.prevIndex!==t.replyListState.prevIndex&&(s.loadingPrevComments=!1);this.setState(s)}},{key:"render",value:function(){return d.default.createElement("div",{className:this.props.className},this.renderReplyButton(),this.renderThumbs(),this.renderReplyBox())}}]),t}(n(1).PureComponent);T.contextTypes={componentConfig:u.default.object,configStoreState:u.default.object.isRequired,contextId:u.default.string,contextUrl:u.default.string,contextDisplayText:u.default.string,cpos:u.default.number,executeAction:u.default.func.isRequired,getStore:u.default.func.isRequired,handleResize:u.default.func.isRequired,instanceId:u.default.string,intl:u.default.object,isUserMessageHistory:u.default.bool,oauthConsumerKey:u.default.string,oauthConsumerSecret:u.default.string,pos:u.default.number,tags:u.default.string,userMessageHistoryGuid:u.default.string},T.defaultProps={className:"Pos(r) Pt(5px)",list:[],replyListState:{},replySortBy:"createdAt"},t.default=(0,y.default)(T,[_.default,v.default],i),e.exports=t.default},2092:function(e,t,n){"use strict";function s(e,t,n){var s=t.action||"showNext",o=t.isUserMessageHistory,r=t.instanceId,i=t.sortBy,l=e.getStore(a.default).getState(),c=Object.assign({lang:l.lang,region:l.region,namespace:l.namespace,oauthConsumerKey:l.oauthConsumerKey,oauthConsumerSecret:l.oauthConsumerSecret},t);delete c.isUserMessageHistory,delete c.instanceId,e.service.read("canvass.getReplies_ns",c,{},function(t,a){if(t||!a||a.error)return e.dispatch("CANVASS_REPLIES_FAILURE",t),n();var l=a,u=l.length,d={action:s,instanceId:r,isUserMessageHistory:o,messageId:c.messageId,sortBy:i};"showPrev"===s&&(l.reverse(),d.prevIndex=u===c.count?l[0].index:null),d.replyList=l,e.dispatch("CANVASS_REPLIES_SUCCESS",d),n()})}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return e&&e.__esModule?e:{default:e}}(n(115));s.displayName="loadReplies",t.default=s,e.exports=t.default},2093:function(e,t,n){"use strict";function s(e,t,n){e.service.read("canvass.smartlinks",t,{},function(s,a){if(s||!a||a.error)return e.dispatch("CANVASS_GET_ENHANCE_URL_FAILURE",s),n();e.dispatch("CANVASS_GET_ENHANCE_URL_SUCCESS",{data:a,messageId:t.messageId}),n()})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,e.exports=t.default},2094:function(e,t,n){"use strict";function s(e){return e.mimeType="image/gif",e}function a(e,t,n){var a=e.getStore(o.default).getState();t=Object.assign({lang:a.lang,region:a.region,namespace:a.namespace,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret},t);var r=t.content,i=t.sticker,l=t.forReply,c=t.enhancedLink,u="TEXT",d={userText:r,contextUrl:t.parentContextUrl||t.contextUrl,contextDisplayText:t.parentContextDisplayText||t.contextDisplayText,details:[],mentions:t.mentions||[],visibilityType:"PUBLIC"};if(Array.isArray(i)&&i.length?u="IMAGE":c&&(u="LINK"),"IMAGE"===u){var f=Object.assign({},i[0]);f.animated=!0,f=s(f),f.resolutions=i.map(s),d.details=[{type:"IMAGE",image:f,attribution:{name:t.author||"",source:"tumblr"}}]}else"LINK"===u&&(delete c.messageId,d.details=[c]);d=JSON.stringify(d),e.service.create(l?"canvass.replyMessage_ns":"canvass.postMessage_ns",{context:t.context,messageId:t.messageId,namespace:t.messageNamespace||t.namespace,lang:t.lang,region:t.region,oauthConsumerKey:t.oauthConsumerKey,oauthConsumerSecret:t.oauthConsumerSecret},d,{},function(s,a){if(s||!a||a.error)return e.dispatch("CANVASS_POST_FAILURE",t),n();a.inReplyTo=t.replyId,a.instanceId=t.instanceId,a.isUserMessageHistory=t.isUserMessageHistory,e.dispatch("CANVASS_POST_SUCCESS",a),n()})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var o=function(e){return e&&e.__esModule?e:{default:e}}(n(115));e.exports=t.default},2095:function(e,t,n){"use strict";function s(e,t,n){var s=e.getStore(a.default).getState(),o=JSON.stringify({eventType:t.eventType,messageId:t.messageId}),r={context:t.context,eventType:t.eventType,namespace:t.namespace||s.namespace,lang:s.lang,region:s.region,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret};e.service.create("canvass.sendHeartbeat_ns",r,o,{},function(t,s){t||!s||s.error?e.dispatch("CANVASS_HEARTBEAT_FAILURE",t):e.dispatch("CANVASS_HEARTBEAT_SUCCESS",r),n()})}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return e&&e.__esModule?e:{default:e}}(n(115));s.displayName="sendHeartbeat",t.default=s,e.exports=t.default},2096:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(1597)),d=s(n(1327)),f=s(n(307)),p=s(n(2)),h=s(n(11)),m=s(n(512)),g=s(n(521)),y=s(n(1846)),v=s(n(93)),b=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,d.default)(n,["handleNewSearch","handleRelatedTagsLoadEvent","handleSelectTag"]),n.state={relatedTags:n.props.relatedTags,selectedTags:n.props.selectedTags},n}return r(t,e),i(t,[{key:"handleRelatedTagsLoadEvent",value:function(){var e=this.context,t=this.state,s=t.relatedTags,a=t.selectedTags,o=this.getUpdatedRelatedTags(s,a,e.tagsAnd),r=e.i13n.getI13nNode().getMergedModel();r.cat=a&&a.size?a.join(","):"",r.elm="cmmt_side_convo",r.slk=o?o.size:0,(0,n(1312).fireRapidEvent)("secvw",r)}},{key:"componentWillReceiveProps",value:function(e){this.loadEventFired||(this.loadEventFired=!0,this.handleRelatedTagsLoadEvent()),this.setState({relatedTags:e.relatedTags,enableRelatedTags:e.enableRelatedTags})}},{key:"componentWillMount",value:function(){this.loadEventFired=!1}},{key:"handleClickOutside",value:function(e){this.props.handleRemoveRelatedTags()}},{key:"handleNewSearch",value:function(){var e=this.context;e.executeAction(g.default,{instanceId:e.instanceId,context:e.context,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,tagsAnd:e.tagsAnd,tagsOr:e.tagsOr,selectedTags:this.state.selectedTags.join(",")}),this.props.handleRemoveRelatedTags(),(0,n(1312).fireRapidPageView)("trendingTags")}},{key:"removeSelectedTag",value:function(e){var t=(0,f.default)(this.state.selectedTags);if(t&&t.size){var n=t.filter(function(t){return e!==t});this.setState({selectedTags:n}),this.handleGetNewRelatedTags(n)}}},{key:"handleGetNewRelatedTags",value:function(e){var t=this.context;t.executeAction(y.default,{context:t.context,tagsAnd:(0,n(118).joinFilterTags)(t.tagsAnd,e),tagsOr:t.tagsOr,instanceId:t.instanceId})}},{key:"handleSelectTag",value:function(e){var t=this.state.selectedTags?(0,f.default)(this.state.selectedTags):h.default.List(),n=t.push(e.get("tag"));this.setState({selectedTags:n}),this.handleGetNewRelatedTags(n)}},{key:"renderSelectedTags",value:function(){var e=this.state.selectedTags;if(e&&e.size){var t={pos:e&&e.size||0,outcm:"remove"};return c.default.createElement("div",{className:"Mb(10px)"},e.map(function(e,s){var a="#"+e;return c.default.createElement(n(1312).I13nButton,{key:e,className:"D(ib) Cur(p) Wob(ba) Mb(8px) Mend(8px) Fz(13px) Px(6px) Py(3px) Bgc(#cfe8ff) Bdrs(3px)",i13nModel:(0,n(1312).getI13nModel)("related-tags",Object.assign({slk:a,cpos:s},t)),onClick:this.removeSelectedTag.bind(this,e)},c.default.createElement("span",null,a),c.default.createElement("div",{className:"D(ib) Pos(r) Ta(c) T(2px) Mstart(8px) W(16px) H(16px) Bdc(t) Bdrs(50%) C($c-fuji-grey-g) Bgc($c-fuji-blue-1-a):h"},c.default.createElement(n(34).Icon,{asset:v.default,width:13,height:13,color:"#878c91",className:"Va(bl)! Fill(#fff)!:h Stk(#fff)!:h"})))},this))}}},{key:"getUpdatedRelatedTags",value:function(e,t,n){if(e&&e.size){var s=n?n.split(","):[],a=t&&t.size?t.join(",").split(","):[],o=s.concat(a);return e.filter(function(e){return-1===o.indexOf(e.get("tag"))})}}},{key:"renderTags",value:function(){var e=this.state,t=e.relatedTags,s=e.selectedTags,a=this.context.tagsAnd,o=this.getUpdatedRelatedTags(t,s,a),r=s&&s.size;if(!o||0===o.size)return c.default.createElement("div",{className:"Mt(4px) Fz(11px) C($c-fuji-grey-f) Lh(14px)"},c.default.createElement(n(36).FormattedMessage,{id:r?"CANVASS_RELATED_TAGS_NO_MORE_TAGS_TO_FILTER_MESSAGE":"CANVASS_RELATED_TAGS_CURRENTELY_NO_TAGS_TO_FILTER_MESSAGE"}),c.default.createElement("span",null," "),r?c.default.createElement(n(36).FormattedMessage,{id:"CANVASS_RELATED_TAGS_APPLY_MESSAGE"}):void 0);var i={pos:t&&t.size||0,outcm:"select"};return c.default.createElement("div",{className:"Mt(6px) relatedTags"},o.map(function(e,t){var s="#"+e.get("tag");return c.default.createElement(n(1312).I13nButton,{key:s,className:"D(ib) Wob(ba) Cur(p) Mb(8px) Mend(8px) Fz(13px) Px(6px) Py(3px) Bgc(#cfe8ff) Bdrs(3px) Bgc($c-fuji-blue-1-a):h C(#fff):h",i13nModel:(0,n(1312).getI13nModel)("related-tags",Object.assign({slk:s,cpos:t},i)),onClick:this.handleSelectTag.bind(this,e)},s)},this))}},{key:"renderHeading",value:function(){var e=this.context.tagsAnd;e=e?"#"+e.replace(/,/g,", #"):"";var t=this.state.selectedTags&&this.state.selectedTags.size;return c.default.createElement("div",{className:"Mb(8px) Fz(15px) Fw(b)"},e?e+" +":t?c.default.createElement(n(36).FormattedMessage,{id:"CANVASS_SELECTED_TAGS"}):void 0,!t&&e?c.default.createElement("div",{className:"D(ib) W(65px) Mstart(5px) BdB Bdc(#bfbfc5) Bdbw(1px)"}):void 0)}},{key:"render",value:function(){var e="smartphone"===(0,p.default)(this.context,["session","dimensions","device"]),t=u.default.dedupe("related-tags ignore-react-onclickoutside W(260px) Pos(a) T(45px) Px(20px) Pt(15px) Pb(20px) Bgc(#fff) Z(3) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag)",{"Start(75px)":!e}),s=!(this.props.selectedTags&&this.props.selectedTags.size||this.state.selectedTags&&this.state.selectedTags.size),a=s?null:this.handleNewSearch,o=u.default.dedupe("Mt(16px) Fz(13px) M(0) Lh(n) H(35px) W(70px)",{"Cur(d)! C($c-fuji-grey-e) Bgc($c-fuji-grey-c) Bgc($c-fuji-grey-c):h":s});return c.default.createElement("div",{className:t},c.default.createElement(n(1312).I13nButton,{className:"related-tags-close-btn Pos(a) End(0) T(0) O(n)",i13nModel:(0,n(1312).getI13nModel)("related-tags",{slk:"cancel"}),onClick:this.props.handleRemoveRelatedTags},c.default.createElement(n(34).Icon,{asset:v.default,width:16,height:16,color:"#b9bdc5",className:"Fill(#000)!:h"})),this.renderHeading(),this.renderSelectedTags(),c.default.createElement("div",{className:"C($c-fuji-grey-l)"},c.default.createElement(n(36).FormattedMessage,{id:"CANVASS_RELATED_TAGS_FILTER_MESSAGE"})),this.renderTags(),c.default.createElement(n(1312).I13nButton,{onClick:a,i13nModel:(0,n(1312).getI13nModel)("related-tags",{slk:"apply"}),className:u.default.get("btn btn-primary",o)},c.default.createElement(n(36).FormattedMessage,{id:"CANVASS_APPLY"})))}}]),t}(n(1).PureComponent);b.contextTypes={componentConfig:l.default.object.isRequired,configStoreState:l.default.object,context:l.default.string,contextDisplayText:l.default.string,contextUrl:l.default.string,executeAction:l.default.func,getStore:l.default.func,i13n:l.default.object,instanceId:l.default.string,session:l.default.object,tags:l.default.string,tagsAnd:l.default.string,tagsOr:l.default.string},t.default=(0,m.default)(b),e.exports=t.default},2097:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(1327)),d=s(n(2)),f=s(n(93)),p=function(e){function t(e,n){a(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,u.default)(s,["handleCloseFlyout","handleOpenFlyout","handleToggleFlyout","renderFlyout"]),s.state={flyoutOpened:!1,isDesktop:"desktop"===(0,d.default)(n.session,["dimensions","device"])},s}return r(t,e),i(t,[{key:"handleToggleFlyout",value:function(){this.setState({flyoutOpened:!this.state.flyoutOpened})}},{key:"handleOpenFlyout",value:function(){this.setState({flyoutOpened:!0})}},{key:"handleCloseFlyout",value:function(){this.setState({flyoutOpened:!1})}},{key:"renderFlyout",value:function(e){if(this.state.flyoutOpened){var t=void 0,s=e.POSITIVE,a=e.NEUTRAL,o=e.NEGATIVE;return t=s>=a&&s>=o?c.default.createElement(n(36).FormattedHTMLMessage,{id:"CANVASS_SENTIMENTS_POSITIVE",values:{className:"C($c-fuji-green-1-b)"}}):a>=s&&a>=o?c.default.createElement(n(36).FormattedHTMLMessage,{id:"CANVASS_SENTIMENTS_NEUTRAL",values:{className:"C($c-fuji-orange-b)"}}):c.default.createElement(n(36).FormattedHTMLMessage,{id:"CANVASS_SENTIMENTS_NEGATIVE",values:{className:"C($c-fuji-red-2-a)"}}),c.default.createElement("div",{className:"arrow_box Pos(a) End(0) W(150px) Whs(pl) Ta(c) Fw(500) T(28px) P(12px) Bgc(#fff) Z(3) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag)"},this.state.isDesktop?null:c.default.createElement(n(1312).I13nButton,{i13nModel:(0,n(1312).getI13nModel)("sentiments-close-tap"),onClick:this.handleCloseFlyout,className:"sentiments-close-btn Pos(a) End(0) P(0) Mend(2px) T(0) O(n)"},c.default.createElement(n(34).Icon,{asset:f.default,width:16,height:16,color:"#b9bdc5"})),t)}}},{key:"renderSentiment",value:function(e,t,n){return c.default.createElement("span",null,c.default.createElement("span",{className:"W(15px) H(15px) D(ib) Va(tt) Bgz(330%) Bg(sentimentsImg) "+n}),c.default.createElement("span",{className:"Pstart(3px) Fz(11px) Fw(b) "+t},e+"%"))}},{key:"componentDidUpdate",value:function(e,t){var s=this.state.flyoutOpened;t.flyoutOpened!==s&&s&&this.state.isDesktop&&(0,n(1312).fireRapidClick)(Object.assign({},this.context.i13n.getI13nNode().getMergedModel(),(0,n(1312).getI13nModel)("sentiments-tap"),{itc:2}))}},{key:"render",value:function(){var e=this.props.sentiments,t=this.state.isDesktop;if(!e||0===e.size)return null;var s={},a=0;return e.forEach(function(e){var t=e.get("count");s[e.get("sentiment")]=t,a+=t}),a<=0?null:(s.POSITIVE=Math.round(s.POSITIVE/a*100)||0,s.NEUTRAL=Math.round(s.NEUTRAL/a*100)||0,s.NEGATIVE=100-s.POSITIVE-s.NEUTRAL,c.default.createElement(n(29).I13nDiv,{bindClickEvent:!t,className:this.props.className,i13nModel:(0,n(1312).getI13nModel)("sentiments-tap"),onClick:t?null:this.handleToggleFlyout,onMouseEnter:this.handleOpenFlyout,onMouseLeave:this.handleCloseFlyout},this.renderFlyout(s),this.renderSentiment(s.POSITIVE,"C($c-fuji-green-1-b) Pend(6px)","Bgp(0)"),this.renderSentiment(s.NEUTRAL,"C($c-fuji-orange-b) Pend(6px)","Bgpx(50%)"),this.renderSentiment(s.NEGATIVE,"C($c-fuji-red-2-a)","Bgpx(100%)")))}}]),t}(n(1).PureComponent);p.contextTypes={i13n:l.default.object,intl:l.default.object,session:l.default.object},t.default=p,e.exports=t.default},2098:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){return{tumblrData:e.getStore(g.default).get("data")}}Object.defineProperty(t,"__esModule",{value:!0}),t.TumblrStickers=void 0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=s(n(0)),d=s(n(1)),f=s(n(1467)),p=s(n(311)),h=s(n(2099)),m=s(n(505)),g=s(n(1670)),y=s(n(2100)),v="popular",b=700,_=(0,n(36).defineMessages)({placeholder:{id:"CANVASS_SEARCH_GIF"}}),x=t.TumblrStickers=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isLoading:!0,search:v},n.handleSearch=(0,p.default)(n.handleSearch.bind(n),b),n}return r(t,e),c(t,[{key:"componentWillMount",value:function(){this.context.executeAction(h.default,{})}},{key:"handleSearch",value:function(){var e=this.refs.search&&this.refs.search.value||v;this.setState({isLoading:!0,search:e});var t={search:e},s=this.props.tumblrData.getIn([e,"offset"]);t.offset=s||0,this.context.executeAction(h.default,t),(0,n(1312).fireRapidEvent)("secvw",{slk:"gif-search-"+e,elm:"cmmt_gif",outcm:"show",context:this.context.context,cat:this.context.tags,itc:1,t3:s||!1})}},{key:"componentWillReceiveProps",value:function(e){e.tumblrData&&this.setState({isLoading:!1})}},{key:"render",value:function(){var e=this.state,t=e.isLoading,n=e.search,s=this.props.tumblrData,a=s.getIn([n,"error"]),o=this.context.intl,r=s.getIn([n,"stickers"]),i=s.getIn([n,"authors"]),c=parseInt(s.getIn([n,"offset"]),10);r=r?r.toJS():[];var u=f.default.dedupe("canvass-tumblr-stickers Pos(r) Pb(15px) H(145px) tumblr D(b) W(100%)",{"H(65px)":!this.state.isLoading&&!r.length});return d.default.createElement("div",{className:u},d.default.createElement(y.default,l({},this.props,{authors:i,error:a,handleSearch:this.handleSearch,isLoading:t,offset:c,stickers:r,tumblrData:void 0})),d.default.createElement("input",{"aria-label":o.formatMessage({id:"CANVASS_SEARCH_GIFS"}),autoFocus:!0,className:"D(ib) M(0) Bd(n) H(21px) Bxsh(n) O(n) Fz(16px) canvass-tumblr-stickers-search Pos(r) B(-16px) Start(50px) Z(1)",onInput:this.handleSearch,ref:"search",placeholder:o.formatMessage(_.placeholder),type:"text"}))}}]),t}(n(1).PureComponent);x.contextTypes={context:u.default.string,executeAction:u.default.func.isRequired,intl:u.default.object,tags:u.default.string},t.default=(0,m.default)(x,[g.default],i)},2099:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){var s=e.getStore(o.default).getState(),a=Object.assign({lang:s.lang,region:s.region,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret},t),l=t.search||i,c=e.getStore(r.default),u=c.get(["data",l]);if(u&&u.get("stickers")&&!t.offset)return e.dispatch("TUMBLR_RELOAD"),n();e.service.read("popular"===l?"canvass.getPopularGifs":"canvass.getGifs",a,function(s,a){!s&&a&&a.gifresult&&0!==a.gifresult.length?e.dispatch("TUMBLR_LOAD_GIFS",{key:l,data:a,offset:t.offset||0}):e.dispatch("TUMBLR_LOAD_GIFS_ERROR",{key:l,error:s,offset:t.offset||0}),n()})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var o=s(n(115)),r=s(n(1670)),i="popular";e.exports=t.default},2100:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Stickers=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(1327)),d=s(n(311)),f=(0,n(29).createI13nNode)("div",{bindClickEvent:!0}),p=300,h=t.Stickers=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,u.default)(n,["handlePostSticker"]),n.onScroll=(0,d.default)(n.onScroll.bind(n),p),n}return r(t,e),i(t,[{key:"componentDidMount",value:function(){this.paginating=!1}},{key:"componentDidUpdate",value:function(){this.paginating&&this.scrollContainer&&!this.props.isLoading&&setTimeout(function(){this.scrollContainer.scrollLeft+=50,this.paginating=!1}.bind(this),0)}},{key:"handlePostSticker",value:function(e,t){this.props.onStickerClick&&this.props.onStickerClick(e,t)}},{key:"onScroll",value:function(){if((this.scrollContainer=this.refs.sticker)&&this.scrollContainer.getBoundingClientRect){var e=this.scrollContainer.getBoundingClientRect();this.props.offset&&!this.props.error&&e&&this.scrollContainer.scrollLeft+e.width+200>=this.scrollContainer.scrollWidth&&(this.paginating=!0,this.props.handleSearch())}}},{key:"renderErrorBox",value:function(){var e=this.props.stickers;return!this.props.error||e&&e.length?null:c.default.createElement("div",{className:"stickers-error-box H(100%) Bg(#fff) Ta(c) C($c-fuji-grey-g) Pos(a) W(100%) Z(1)"},c.default.createElement("span",{className:"Pos(r) T(45%)"},c.default.createElement(n(36).FormattedMessage,{id:"CANVASS_NO_GIFS_FOUND"})))}},{key:"renderLoadingBox",value:function(){return this.props.isLoading?c.default.createElement("div",{className:"stickers-loading-box H(100%) Bg(bgLoading) Op(0.5) Ta(c) C($c-fuji-grey-g) Pos(a) W(100%) Z(1)"}):null}},{key:"renderStickersList",value:function(){var e=this.props.stickers;if(!e||!e.length)return null;return c.default.createElement("div",{className:"Pos(r) D(b) Bgc(#fff) Maw(100%)!"},c.default.createElement("div",{className:"Row Pos(r)"},c.default.createElement("div",{ref:"sticker",className:"stickers-list H(100%) Ovx(s) Ovy(h) Whs(nw) W(100%) Ovs(touch)",onScroll:this.onScroll},e.map(this.renderItem,this))))}},{key:"renderItem",value:function(e,t){for(var s=this.context,a=this.props,o=a.authors,r=a.overlayClasses,i=a.overlayLabelClasses,l=e[e.length-1],u=e.length-1;u>=0;u--)if(e[u].height>=145){l=e[u];break}var d=l,p=d.url,h=(0,n(1312).getI13nModel)("tumblr-post",{slk:"gif-"+p,context:s.context,cat:s.tags});return c.default.createElement(f,{i13nModel:h,key:p,onClick:this.handlePostSticker.bind(this,e,o.get(t)),className:"D(ib) Pos(r) Mend(4px) sticker-item"},c.default.createElement("img",{className:"Cur(p)",height:145,width:Math.round(145/l.height*l.width),src:p}),c.default.createElement("div",{className:r},c.default.createElement("p",{className:i},c.default.createElement(n(36).FormattedMessage,{id:"CANVASS_POST"}))))}},{key:"render",value:function(){return c.default.createElement("div",{className:"H(100%) Va(t) Pstart(16px) Pos(r) Maw(100%)! stickers"},this.renderLoadingBox()||this.renderErrorBox(),this.renderStickersList())}}]),t}(n(1).PureComponent);h.contextTypes={context:l.default.string,tags:l.default.string},h.defaultProps={overlayClasses:"sticker-overlay W(100%) H(100%) Pos(a) T(0) Start(0) Bg(overlaySticker):h Op(0) Op(1):h Trsdu(.42s) Cur(p)",overlayLabelClasses:"post-label Pos(r) Ta(c) Fw(600) Fz(14px) W(54px) H(20px) T(50%) Start(50%) Translate(-50%,-50%) P(6px) C(#fff) Bgc(#222) Bdrs(2px)",stickers:[]},t.default=h},2101:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(2)),d=s(n(121)),f=s(n(1838)),p=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={hover:!1},n}return r(t,e),i(t,[{key:"onMouseEnter",value:function(){this.setState({hover:!0})}},{key:"onMouseLeave",value:function(){this.setState({hover:!1})}},{key:"handleRating",value:function(e){var t=this.context,n=this.props;t.executeAction(f.default,{context:n.contextId,isUserMessageHistory:t.isUserMessageHistory||null,instanceId:t.instanceId,messageId:n.messageId,namespace:n.messageNamespace,voteType:e===n.voteType?"clear":n.voteType,replyId:n.replyId,pos:"number"==typeof t.pos?t.pos:null})}},{key:"bindHandleRating",value:function(e){var t={trailing:!1};this.handleVote=(0,d.default)(this.handleRating.bind(this,e.vote),1500,t)}},{key:"componentWillMount",value:function(){var e=this;"desktop"===(0,u.default)(e.context,["session","dimensions","device"])&&(e.handleMouseEnter=e.onMouseEnter.bind(e),e.handleMouseLeave=e.onMouseLeave.bind(e)),e.bindHandleRating(e.props)}},{key:"componentWillReceiveProps",value:function(e){this.bindHandleRating(e)}},{key:"render",value:function(){var e=this,t=e.props,s=t.vote,a=t.voteType,o=t.thumbName,r=t.size,i=e.context.intl,l=e.handleVote,u=void 0,d=void 0,f=void 0;u=e.state.hover||s===a?t.selectedColor:t.color,f=s===a?t.selectedIcon:t.icon,d=(0,n(1312).getI13nModel)("vote",{rcv_msg_id:t.replyId||t.messageId,slk:s===a?"undo vote "+o:"vote "+o});var p=(t.replyId||t.messageId)+f,h=t.reactionStats[a+"VoteCount"]||0,m=i.formatNumber(h),g=m+" "+i.formatMessage({id:"CANVASS_REACTION_"+o.toUpperCase()});return t.isSignedIn||(l=t.onToggleToolTip),c.default.createElement(n(1312).I13nButton,{"aria-label":g,className:t.className,onClick:l,onMouseEnter:e.handleMouseEnter,onMouseLeave:e.handleMouseLeave,i13nModel:d},c.default.createElement(n(34).Icon,{asset:f,color:u,height:r,key:p,style:{verticalAlign:"middle"},width:r}),h>0?c.default.createElement("span",{className:"D(ib) Mstart(4px) Va(m) Fz(12px) C($c-fuji-grey-g)"},m):void 0)}}]),t}(n(1).PureComponent);p.contextTypes={configStoreState:l.default.object.isRequired,executeAction:l.default.func.isRequired,instanceId:l.default.string,intl:l.default.object,isUserMessageHistory:l.default.bool,pos:l.default.number,session:l.default.object},p.defaultProps={className:"O(n) M(0) P(0) Bd(n)",color:"#878c91",reactionStats:{},selectedColor:"#188fff",size:14,thumbName:"up",voteType:"up"},t.default=p,e.exports=t.default},2102:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(1597)),d=s(n(1327)),f=s(n(2)),p=s(n(512)),h=s(n(1665)),m=s(n(93)),g=s(n(1669)),y=s(n(1847)),v=s(n(2103)),b=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,d.default)(n,["handleKeyDown","handleLoadEvent","handleShowMessages","onScrollHandler"]),n.state={loadingNextComments:!1},n}return r(t,e),i(t,[{key:"getChildContext",value:function(){return{isUserMessageHistory:!0,userMessageHistoryGuid:this.props.userComments.get("guid")}}},{key:"handleClickOutside",value:function(){this.props.handleRemoveUserComments&&this.props.handleRemoveUserComments()}},{key:"handleKeyDown",value:function(e){e&&27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.handleClickOutside())}},{key:"handleLoadEvent",value:function(){var e=this.context.i13n.getI13nNode().getMergedModel();e.slk="canvass-load",(0,n(1312).fireRapidEvent)("secvw",e)}},{key:"onScrollHandler",value:function(e){var t=this.scrollingElement,n=t.scrollTop,s=t.scrollHeight,a=t.clientHeight,o=e.deltaY,r=o>0;return r&&o>s-a-n?(t.scrollTop=s,this.cancelScrollEvent(e)):!r&&-o>n?(t.scrollTop=0,this.cancelScrollEvent(e)):void 0}},{key:"cancelScrollEvent",value:function(e){return e.stopImmediatePropagation(),e.preventDefault(),e.returnValue=!1,!1}},{key:"componentDidMount",value:function(){this.context.handleOverlay(!0),this.scrollingElement=(0,n(10).findDOMNode)(this.refs.usercomments),this.scrollingElement.addEventListener("wheel",this.onScrollHandler,!1),this.scrollingElement.focus(),this.handleLoadEvent(),(0,n(1312).fireRapidPageView)("userHistory")}},{key:"componentWillUnmount",value:function(){this.scrollingElement.removeEventListener("wheel",this.onScrollHandler,!1)}},{key:"componentWillReceiveProps",value:function(e){this.setState({loadingNextComments:!1})}},{key:"componentDidUpdate",value:function(e,t){e.userComments.get("guid")!==this.props.userComments.get("guid")&&this.handleLoadEvent()}},{key:"handleShowMessages",value:function(e){var t=this.props.userComments,n={guid:t.get("guid"),image:t.get("image"),name:t.get("name"),sortBy:t.get("sortBy"),instanceId:this.context.instanceId};"showNext"===e&&(this.setState({loadingNextComments:!0}),n.nextIndex=t.get("nextIndex"),n.showNextClicked=!0),this.context.executeAction(h.default,n)}},{key:"renderShowNextButton",value:function(){var e=this;return this.props.userComments.get("showLoadNext")?c.default.createElement(n(1312).I13nButton,{i13nModel:(0,n(1312).getI13nModel)("comments-showMore"),onClick:function(){return e.handleShowMessages("showNext")},className:u.default.get("btn btn-secondary btn-spacing btn-sm-fullwidth","showMore D(b) Mx(a) Pos(r)")},c.default.createElement(n(36).FormattedMessage,{id:this.state.loadingPreviousComments?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_MORE_COMMENTS"})):null}},{key:"render",value:function(){var e=this.context,t=this.props,s=t.isFullScreen,a=t.userComments,o=a.get("messageList"),r=a.get("count"),i=a.get("guid"),l=a.get("image"),d=a.get("name"),p=a.get("sortBy"),h=o&&o.size?o.toJS():[],b=u.default.dedupe("user-comments Pos(a) Ovx(s) Ovs(touch) O(n) Bxz(bb) Start(50%) W(90%) Mstart(-45%) Bgc(#fff) Z(9) Bd Bdrs(5px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag) ",{"Pos(f)":s}),_={height:r?n(507).USER_HISTORY_HEIGHT:"auto",top:t.top};return s&&r&&(_.height=Math.min(window.innerHeight-2*n(507).COMMUNITY_BAR_HEIGHT,n(507).USER_HISTORY_HEIGHT)),c.default.createElement(n(29).I13nDiv,{"aria-label":e.intl.formatMessage({id:"CANVASS_SEE_USERS_HISTORY"},{user:d}),className:b,i13nModel:{sec:"cmmt_his"},onKeyDown:this.handleKeyDown,ref:"usercomments",role:"dialog",style:_,tabIndex:"-1"},c.default.createElement(n(1312).I13nButton,{"aria-label":e.intl.formatMessage({id:"CANVASS_CANCEL"}),className:"user-comments-close-btn O(n):a O(n):h Pos(a) Z(1) M(10px) P(0) End(0) T(0)",i13nModel:(0,n(1312).getI13nModel)("user-close-tap"),onClick:t.handleRemoveUserComments},c.default.createElement(n(34).Icon,{asset:m.default,width:30,height:30,color:"#fff",className:"close-icon Cur(p)"})),c.default.createElement(v.default,{className:"user-info",key:"userinfo",creator:i,name:d,imageUrl:l,count:r,isUserMessageHistory:!0}),r>0?c.default.createElement("div",{className:"Px(24px) Pt(12px)"},c.default.createElement(y.default,{arrangement:(0,f.default)(e.componentConfig,["ui","sortTabs","arrangement"]),key:"usercomments-sorting-tabs",count:r,userMessageHistoryName:d,userMessageHistoryImage:l,sortBy:p}),c.default.createElement(g.default,{list:h,sortBy:p,itemClassName:"Py(12px)"}),this.renderShowNextButton()):null)}}]),t}(n(1).PureComponent);b.contextTypes={componentConfig:l.default.object.isRequired,configStoreState:l.default.object,contextDisplayText:l.default.string,contextUrl:l.default.string,executeAction:l.default.func,handleOverlay:l.default.func,i13n:l.default.object,intl:l.default.object,instanceId:l.default.string,session:l.default.object},b.childContextTypes={isUserMessageHistory:l.default.bool,userMessageHistoryGuid:l.default.string},t.default=(0,p.default)(b),e.exports=t.default},2103:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(0)),c=s(n(1)),u=s(n(1208)),d=function(e){function t(e){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),i(t,[{key:"renderCommentsCount",value:function(){var e=this.props.count,t=this.context.intl,s=void 0;return s=1===e?"1 "+t.formatMessage({id:"CANVASS_COMMENT"}):t.formatNumber(e)+" "+t.formatMessage({id:"CANVASS_COMMENTS"}),c.default.createElement("div",{className:"user-comments-count Pt(10px) Fz(12px) Fw(600) C(#fff)"},c.default.createElement(n(34).Icon,{className:"comment-icon Mend(5px)",color:"#fff",cursorClass:"Cur(d)",height:14,name:"comments",style:{verticalAlign:"middle"},width:14}),s)}},{key:"renderAvatar",value:function(e){var t=this.context,s=this.props,a=s.imageUrl;if(s.creator===t.guid){var o=t.session.dimensions,r="https://login.yahoo.com/account/personalinfo/?.intl="+o.intl+"&.lang="+o.lang;return c.default.createElement(n(1312).I13nAnchor,{className:"avatar W(60px) Fl(start) Mend(20px) Pos(r)",href:r,target:"_blank",title:t.intl.formatMessage({id:"CANVASS_EDIT_PROFILE"})},c.default.createElement(u.default,{src:a,name:e,enableAlphatar:!0,size:60}),c.default.createElement("div",{className:"StretchedBox Bg(gradient) Bdrs(48%) Op(0.7)"}),c.default.createElement(n(34).Icon,{className:"Pos(a) B(6px) Start(20px)",color:"#fff",name:"camera",height:20,width:20}))}return c.default.createElement(u.default,{src:a,name:e,enableAlphatar:!0,size:60,className:"avatar W(60px) Fl(start) Mend(20px)"})}},{key:"getUserProfile",value:function(){var e=this.props.name||this.context.intl.formatMessage({id:"CANVASS_ANONYMOUS"});return c.default.createElement("div",{key:e,className:"user-profile"},this.renderAvatar(e),c.default.createElement("div",{className:"username Pt(4px) Fw(b) Fz(20px) C(#fff)"},e),this.renderCommentsCount())}},{key:"render",value:function(){return c.default.createElement("div",{className:"user-info P(24px) Pb(20px) Pend(36px) Cf Bgc(#1276b9)",style:{backgroundImage:"url(https://s.yimg.com/cv/ae/comments/userbg.png)"}},this.getUserProfile())}}]),t}(n(1).PureComponent);d.contextTypes={guid:l.default.string,intl:l.default.object,session:l.default.object},t.default=d,e.exports=t.default},2104:function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=s(n(2105)),c=(s(n(0)),s(n(1))),u=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={updating:!1},n}return r(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({updating:this.props.count!==e.count})}},{key:"componentDidUpdate",value:function(){var e=this;e.state.updating&&setTimeout(function(){e.setState({updating:!1})},500)}},{key:"render",value:function(){var e=this.props,t=e.className,s=e.count,a=this.state.updating;return s?c.default.createElement("div",{className:"Fl(end) Fz(14px) Fw(500) Trsdu(.5s) Trsp(color) "+(t||"")+" "+(a?"C($c-fuji-purple-1-a)":"C($c-fuji-grey-g)")},c.default.createElement(n(34).Icon,{asset:l.default,className:"Mend(6px)",color:"#5601ec",height:18,style:{verticalAlign:"text-bottom"},width:18}),c.default.createElement(n(36).FormattedMessage,{id:"CANVASS_USERS_VIEWING",values:{count:s}})):null}}]),t}(n(1).PureComponent);t.default=u,e.exports=t.default},2105:function(e,t){if(void 0===n)var n={};n["groups-fill"]={name:"groups-fill",height:16,width:16,path:"M5 7.667c-1.196 0-2.167-.97-2.167-2.167S3.803 3.333 5 3.333c1.197 0 2.167.97 2.167 2.167S6.197 7.667 5 7.667zM13.167 5.5c0 1.197-.97 2.167-2.167 2.167S8.833 6.697 8.833 5.5 9.803 3.333 11 3.333c1.197 0 2.167.97 2.167 2.167zm1.48 4.38c-.09-.083-.175-.167-.277-.244-.794-.59-2.008-.97-3.37-.97-.343 0-.643.03-.85.058-.086.01-.157.022-.206.03l-.088.016c-.003 0-.005.003-.01.004-.218.037-.44.074-.644.13.12.09.226.187.33.286.504.49.8 1.063.8 1.682v2.13h4.334c.366 0 .667-.302.667-.668V11.27c0-.514-.258-.988-.686-1.39zM8 9.396c-.78-.45-1.833-.73-3-.73-1.362 0-2.575.378-3.37.97-.102.076-.188.16-.275.243-.43.402-.688.876-.688 1.39v1.064c0 .367.3.667.667.667h8v-1.728c0-.514-.258-.988-.686-1.39-.088-.084-.174-.168-.277-.245-.112-.085-.237-.164-.37-.24z"},void 0!==e&&e.exports&&(e.exports=n["groups-fill"])}});