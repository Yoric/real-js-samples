"undefined"==typeof nhn&&(nhn={}),nhn.Autocomplete=$Class({$init:function(oInputManager,oDataManager,oViewManager,oOption){this._oIM=oInputManager,this._oDM=oDataManager,this._oVM=oViewManager,this.option({cookieName:"autocomplete"}),this.option(oOption),this._bUse=this._initUse(),this._bUse||this._oVM.setButtonImage("unuse"),this._oIM._setAutocomplete(this),this._oIM._setDataManager(oDataManager),this._oIM._setViewManager(oViewManager),this._oDM._setAutocomplete(this),this._oDM._setViewManager(oViewManager),this._oVM._setAutocomplete(this),this._oVM._setInputManager(oInputManager)},getViewManager:function(){return this._oVM},request:function(){this._oDM._request(this._oIM.getValue())},doAction:function(){this._oIM.change()},show:function(){this._oVM.show()},hide:function(){this._oVM.hide()},use:function(){this.fireEvent("onUse")&&($Cookie().set(this.option("cookieName"),"use",21900,"naver.com"),this._bUse=!0)},unuse:function(){this.fireEvent("onUnuse")&&(this.hide(),$Cookie().set(this.option("cookieName"),"unuse",21900,"naver.com"),this._bUse=!1,this._oVM.setButtonImage("unuse"))},setUse:function(bUse){(this._bUse=bUse)||(this.hide(),this._oVM.setButtonImage("unuse"))},isUse:function(){return this._bUse},setButtonImage:function(sType){this._oVM.setButtonImage(sType)},_initUse:function(){var sCookie=$Cookie().get(this.option("cookieName"));return!sCookie||"use"==sCookie}}).extend(jindo.Component),nhn.AcInputManager=$Class({$init:function(elInput){this._el=elInput,this._wel=$Element(this._el),this._oAgent=$Agent().navigator(),this._sValue=this._wel.text(),this._attachEvent()},getValue:function(){return this._wel.text()},setValue:function(sValue){this._sValue=sValue,this._wel.text(sValue)},setSearchParameter:function(welSelect){var oData={searchType:"general",displayChannelId:""};if(welSelect){var searchType=welSelect.data("searchType");"channel"===(oData.searchType=searchType)&&(oData.displayChannelId=welSelect.data("displayChannelId"))}for(var key in oData)this._wel.data(key,oData[key])},change:function(){this._oDM._request(this._wel.text())},_setAutocomplete:function(oAutocomplete){this._oAuto=oAutocomplete},_setDataManager:function(oDataManager){this._oDM=oDataManager},_setViewManager:function(oViewManager){this._oVM=oViewManager},_attachEvent:function(){$Fn(this._onFocus,this).attach(this._el,"focus"),$Fn(this._onBlur,this).attach(this._el,"blur"),$Fn(this._onKeyup,this).attach(this._el,"keyup"),$Fn(this._onKeydown,this).attach(this._el,"keydown"),$Fn(this._onClickDoc,this).attach(document,"click")},_onFocus:function(we){this._oAuto.fireEvent("onFocus"),this._oItvID&&window.clearInterval(this._oItvID),this._oItvID=window.setInterval($Fn(this._onWatch,this).bind(we),200)},_onBlur:function(we){this._oAuto.fireEvent("onBlur"),this._oItvID&&(window.clearInterval(this._oItvID),this._oItvID=null)},_onKeyup:function(we){this._sValue!=this._wel.text()&&(this._sValue=this._wel.text(),this._onChange())},_onKeydown:function(we){if(this._oAuto.isUse()&&this._wel.text()){var oKey=we.key();oKey.down||oKey.up||9==oKey.keyCode?(oKey.up||9==oKey.keyCode&&oKey.shift?this._oVM.up(we):this._oVM.down(we))&&we.stop():oKey.enter?this._oVM.enter(we):oKey.right?this._oVM.right(we):oKey.left&&this._oVM.left(we)}},_onWatch:function(we){this._sValue!=this._wel.text()&&(this._sValue=this._wel.text(),this._onChange())},_onChange:function(we){this.setSearchParameter(null),this._oDM._request(this._wel.text())},_onClickDoc:function(we){var el=we.element;el&&(el==this._el?this._oVM.isShow()?this._oVM.hide():(this._sValue=this._wel.text(),this._oDM._request(this._sValue)):this._oVM.hide())}}),nhn.AcDataManager=$Class({$init:function(sURL,sType,sMethod,oParameter){for(var sKey in this._sURL=sURL,this._sType=sType||"jsonp",this._sMethod=sMethod||"get",this._oParam={q:null,q_enc:"UTF-8",st:100,frm:"test",r_format:"json",r_enc:"UTF-8",r_unicode:"0",t_koreng:"1"},oParameter)this._oParam[sKey]=oParameter[sKey]},_setAutocomplete:function(oAutocomplete){this._oAuto=oAutocomplete},_setViewManager:function(oViewManager){this._oVM=oViewManager},_request:function(sQuery){if(!this._oAuto.isUse())return!1;if(this._sQuery=sQuery.replace(/^\s+/g,""),this._sQuery){if(this._htCache){if(this._htCache[this._sQuery])return void this._oVM.paint(this._htCache[this._sQuery])}else this._htCache={};if(!this._oAjax){var self=this;this._oAjax=new $Ajax(this._sURL,{type:this._sType,method:this._sMethod,callbackid:"$3361",onload:function(res){var oData=res.json();self._handleJSON(self._sQuery,oData)}})}this._oParam.q=this._sQuery,this._oAjax.abort(),this._oAjax.request(this._oParam)}else this._oVM.paint({query:[],answer:[],data:[]})},_handleJSON:function(sQuery,oData){try{for(var aData=[],i=0;i<oData.items.length;i++){aData[i]=[];var aSlot=oData.items[i];if(0<aSlot.length)for(var j=0;j<aSlot.length;j++)aData[i][j]=aSlot[j]}this._htCache[sQuery]={query:oData.query,answer:oData.answer,data:aData},this._oVM.paint(this._htCache[sQuery])}catch(e){try{this._oVM.paint({query:[],answer:[],data:[]})}catch(e){}}}}),nhn.AcViewManager=$Class({$init:function(elView,elButton,oOption){for(var sKey in this.el=elView,this.wel=$Element(elView),(this.elBtn=elButton)&&(this.welBtn=$Element(this.elBtn)),this.oOption={order:"asc",listSelector:"",listbox:"_resultBox",strMax:50,listMax:[15,15,15],buttonImg:{show:"https://ssl.pstatic.net/sstatic/search/images11/btn_atcmp_up_on.gif",hide:"https://ssl.pstatic.net/sstatic/search/images11/btn_atcmp_down_on.gif",unuse:"https://ssl.pstatic.net/sstatic/search/images11/btn_atcmp_down_off2.gif"}},oOption)this.oOption[sKey]=oOption[sKey];this.oAgent=$Agent().navigator()},_setAutocomplete:function(oAutocomplete){this.oAuto=oAutocomplete},_setInputManager:function(oInputManager){this.oIM=oInputManager},paint:function(oData){},enter:function(we){},up:function(we){},down:function(we){},left:function(we){},right:function(we){},toggle:function(){this.wel.visible()?this.hide():this.show()},show:function(){if(!this.oAuto.isUse())return!1;if(this.oAuto.fireEvent("onShow")&&(this.wel.show(),this.setButtonImage("show"),"IFRAME"==this.wel.$value().tagName.toUpperCase())){var elBody=this.wel.$value().contentWindow.document.body,nHeight=this.oAgent.ie?elBody.scrollHeight:elBody.clientHeight;this.wel.height(nHeight)}},hide:function(){if(!this.oAuto.isUse())return!1;this.oAuto.fireEvent("onHide")&&(this.wel.hide(),this.setButtonImage("hide"))},isShow:function(){return this.wel.visible()},setButtonImage:function(sType){var elImage;this.welBtn&&((elImage="IMG"==this.welBtn.$value().tagName.toUpperCase()?this.welBtn.$value():$$.getSingle("img",this.welBtn.$value()))&&("show"==sType?(elImage.src=this.oOption.buttonImg.show,elImage.title=elImage.alt="자동완성 접기"):"hide"==sType?(elImage.src=this.oOption.buttonImg.hide,elImage.title=elImage.alt="자동완성 펼치기"):"unuse"==sType?(elImage.src=this.oOption.buttonImg.unuse,elImage.title=elImage.alt="자동완성 켜기"):this.oOption.buttonImg[sType]&&(elImage.src=this.oOption.buttonImg[sType])))}}),tvcast.pc.AcViewManager=$Class({$init:function(elView,elButton,oOption){this._welSelect=null,this._setElement(),this._attachEvent()},up:function(we){return this._welSelect&&(this._welSelect.removeClass("atcmp_on"),this._welSelect=this._getPrev(this._welSelect)),this._welSelect?(this._welSelect.addClass("atcmp_on"),this.oIM.setValue(this._welSelect.last().last().text()),this.oIM.setSearchParameter(this._welSelect),this.show(),!0):(this.hide(),!1)},down:function(we){we.key().keyCode;return!(this._welSelect&&(this._welSelect.removeClass("atcmp_on"),this._welSelect=this._getNext(this._welSelect),!this._welSelect))&&(this._welSelect||(this._welSelect=this._getFirst()),this._welSelect&&(this._welSelect.addClass("atcmp_on"),this.oIM.setValue(this._welSelect.last().last().text()),this.oIM.setSearchParameter(this._welSelect),this.show()),!0)},paint:function(oData){this._sUserQuery=this.oIM.getValue(),this._welSelect=null;for(var i=0;i<this._aResultBox.length;i++)this._aResultBox[i].innerHTML="",this._aResultBox[i].style.display="none";var aQuery=oData.query,aData=oData.data,aMax=this.oOption.listMax,aTotal=this._getSlotItemCount(aData),aCount=this._filterSlotItemCountWithMaxOption(aTotal,aMax),nTotal=function(aData){for(var nResult=0,i=0;i<aData.length;i++)nResult+=aData[i];return nResult}(aCount),nRank=1,aList=[],elBox=this._aResultBox[1],sTemplate=this._aTemplate[1];if(aData[2]&&elBox){for(var j=0;j<aData[2].length;j++){elBox.style.display="block";var sTagName=(aValue=aData[2][j])[0],oValue={rank:nRank++,txt:this._trim(this._cutStr(sTagName,this.oOption.strMax)),in_txt:this._trim(sTagName),encoded:encodeURIComponent(sTagName)};if(aList[aList.length]=this._applyTemplate(sTemplate,oValue,aQuery),nRank>aCount[2])break}elBox.innerHTML=aList.join("")}else elBox&&(elBox.innerHTML="");nRank=1,aList=[],elBox=this._aResultBox[2],sTemplate=this._aTemplate[2];if(aData[1]&&elBox){for(j=0;j<aData[1].length;j++){elBox.style.display="block";var aValue,sChannelName=(aValue=aData[1][j])[0][0],sChannelNameEmblemUrl=aValue[1][0],sChannelNameLink=aValue[2][0];oValue={imageTag:this.oOption.sAutoTemplateImageTag,rank:nRank++,txt:this._trim(this._cutStr(sChannelName,this.oOption.strMax)),in_txt:this._trim(sChannelName),encoded:encodeURIComponent(sChannelName),emblemUrl:sChannelNameEmblemUrl,linkUrl:sChannelNameLink};if(aList[aList.length]=this._applyTemplate(sTemplate,oValue,aQuery),nRank>aCount[1])break}elBox.innerHTML=aList.join("")}else elBox&&(elBox.innerHTML="");this._welWords.hide(),this._nResultCount=nTotal,0<this._nResultCount?(this._welAlert.hide(),this._welWords.show(),this._welSearch.show(),this.show()):this.hide()},_applyTemplate:function(sTemplate,htData,aQuery){var htTemp={};for(var sKey in htData)htTemp[sKey]=htData[sKey],"txt"==sKey&&(htTemp.txt=this._highlight(htData.txt,aQuery)),htData.propertyIsEnumerable(sKey)&&(sTemplate=sTemplate.replace(new RegExp("@"+sKey+"@","g"),htTemp[sKey]));return sTemplate=htData.txt==htData.in_txt?sTemplate.replace(/title=\"\"/,""):sTemplate.replace(/title=\"\"/,'title="'+htData.in_txt+'"')},_select:function(we){if(this._setParameter(we)&&this.oAuto.fireEvent("onSelect")){this.oIM.setValue(this._welSelect.last().last().text()),this.oIM.setSearchParameter(this._welSelect);var welForm=$Element(this.oAuto.option("formId"));welForm&&welForm.fireEvent("submit")}},_getCount:function(aData){for(var nCount=0,i=0;i<aData.length;i++)nCount+=aData[i].length;return nCount},_getSlotItemCount:function(aData){for(var aCount=[],i=0;i<aData.length;i++)aCount[i]=aData[i].length;return aCount},_filterSlotItemCountWithMaxOption:function(aData,aMax){for(var aResult=[],i=0;i<aData.length;i++)aResult[i]=aData[i]>aMax[i]?aMax[i]:aData[i];return aResult},_setElement:function(){this._aResultBox=$$("ul._resultBox",this.el),this._aTemplate=[];for(var i=0;i<this._aResultBox.length;i++){var elBox=this._aResultBox[i];this._aTemplate[i]=elBox?elBox.innerHTML.replace(/^\s+|\s+$/g,""):null,0==i&&(this._welWords=$Element(this._aResultBox[i].parentElement))}this._welAlert=this.wel.query("p._alert");var welFooter=this.wel.query("._footer");this._welSearch=welFooter.query("._search"),this._welUnuseBtn=welFooter.query("._unuse_btn"),this._welUseGuide=welFooter.query("._use_guide")},_attachEvent:function(){this.welBtn&&this.welBtn.parent()&&this.welBtn.parent().attach({click:$Fn(this._onClickBtn,this).bind()}),$Fn(this._onMouseover,this).attach(this.el,"mouseover"),$Fn(this._onClick,this).attach(this.el,"click"),this._htEvent||(this._htEvent=[],this._htEvent.useGuideShow=$Fn(function(){this._welUseGuide.show()},this).bind(),this._htEvent.useGuideHide=$Fn(function(){this._welUseGuide.hide()},this).bind()),this._welUnuseBtn.attach({mouseover:this._htEvent.useGuideShow,focus:this._htEvent.useGuideShow,mouseout:this._htEvent.useGuideHide,blur:this._htEvent.useGuideHide,click:$Fn(function(we){window.clickcr(we.element,"STA.soff","","",we),this.oAuto.unuse()},this).bind()})},_onMouseover:function(we){var el=we.element;return(!this._welAnswer||!this._welAnswer.isParentOf(el))&&(!(!el||!el.tagName||"SPAN"!=el.tagName.toUpperCase())&&(!(!(el=el.parentNode)||!el.tagName||"A"!=el.tagName.toUpperCase())&&(!(!(el=el.parentNode)||!el.tagName||"LI"!=el.tagName.toUpperCase())&&(this._welSelect&&this._welSelect.removeClass("atcmp_on"),this._welSelect=$Element(el),void this._welSelect.addClass("atcmp_on")))))},_onClick:function(we){this._welSelect&&this._select(we)},_onClickBtn:function(we){try{if(this.isShow())return void this.hide();if(0==this.oAuto.isUse())return this.oAuto.use(),void(this.oIM.getValue()?this.oAuto.request():this._toggleAlertView("자동완성 기능이 활성화되었습니다."));0<this._nResultCount?this.toggle():this._toggleAlertView("현재 자동완성 기능을 사용하고 계십니다.")}finally{we.stop()}},_toggleAlertView:function(sAlertText){this._welAlert.text(sAlertText),this._welWords.hide(),this._welSearch.hide(),this._welAlert.show(),this.toggle()},_trim:function(sValue){return sValue.replace(/^\s+|\s+$/g,"")},_cutStr:function(sValue,nLength){for(var nPosition=sValue.length,nCount=0,i=0;i<sValue.length;i++){var nCode=sValue.charAt(i).charCodeAt(0);if((44032<=nCode&&nCode<=552013||12593<=nCode&&nCode<=12643)&&(nCount+=2),nCount+=73==nCode&&74==nCode?1:65<=nCode&&nCode<=90?2:1,Math.floor(nCount)>nLength){nPosition=i;break}}return nPosition<sValue.length?sValue.substring(0,nPosition)+"...":sValue},_setParameter:function(we){var el=void 0===we._element?we.element:we._element;try{return"EM"==el.tagName&&(el=el.parentNode),"SPAN"==el.tagName&&(el=el.parentNode),"LI"==el.parentNode.tagName}catch(e){return!1}},_highlight:function(sText,aQuery){for(var i=0;i<aQuery.length;i++){var sReturn=this._makeStrong(sText,aQuery[i]);if(""!=sReturn)return sReturn}return sText},_makeStrong:function(sText,sQuery){for(var escRegExp=new RegExp("[.*+?|()\\[\\]{}\\\\]","g"),sTmp=sQuery.replace(/()/g," ").replace(/^\s+|\s+$/g,""),sTmpCharacters=sTmp.match(/\S/g),aTmp=[],i=0,cnt=sTmpCharacters.length;i<cnt;i++)aTmp.push(sTmpCharacters[i].replace(/[\S]+/g,"["+sTmpCharacters[i].toLowerCase().replace(escRegExp,"\\$&")+"|"+sTmpCharacters[i].toUpperCase().replace(escRegExp,"\\$&")+"] ").replace(/[\s]+/g,"[\\s]*"));sTmp="("+aTmp.join("")+")";var sReturn="",regQuery=new RegExp(sTmp);return regQuery.test(sText)&&(sReturn=sText.replace(regQuery,"<em class='atcpkw'>"+RegExp.$1+"</em>")),sReturn},_getFirst:function(){for(var i=0;i<this._aResultBox.length;i++)if(this._aResultBox[i].childNodes.length)return $Element(this._aResultBox[i]).first();return null},_getLast:function(){for(var i=this._aResultBox.length-1;0<=i;i--)if(this._aResultBox[i].childNodes.length)return $Element(this._aResultBox[i]).last()},_getNext:function(welCurrent){for(var i=0;i<this._aResultBox.length;i++){var welResultBox=$Element(this._aResultBox[i]);if(welCurrent.isChildOf(welResultBox)){var welNext=welCurrent.next();if(welNext)return welNext;for(var j=i+1;j<this._aResultBox.length;j++)if(this._aResultBox[j].childNodes.length)return $Element(this._aResultBox[j]).first();break}}return null},_getPrev:function(welCurrent){for(var i=0;i<this._aResultBox.length;i++){var welResultBox=$Element(this._aResultBox[i]);if(welCurrent.isChildOf(welResultBox)){var welPrev=welCurrent.prev();if(welPrev)return welPrev;for(var j=i-1;j<i;j++)if(this._aResultBox[j].childNodes.length)return $Element(this._aResultBox[j]).last();break}}return null}}).extend(nhn.AcViewManager);