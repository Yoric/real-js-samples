"use strict";StackExchange.tagEditor=function(e,t,n,r){function i(){U=!0}function o(){if("undefined"==typeof mt){for(var e=StackExchange.tagEditor.requiredTags,t=[],n=0;n<e.length;n++)t.push(f(e[n]).replace(/[.+]/g,"\\$&"));mt=new RegExp("^(?:"+t.join("|")+")$")}return mt}function a(){if(!r.ignoreRequired){var e=StackExchange.tagEditor.requiredTags;if(e&&/^ ?$/.test(ut.val())){var t=o();0===ct.add(dt).children().filter(function(){return t.test($(this).text())}).length&&R(StackExchange.tagEditor.requiredTags)}}}function s(e,t){var n=W(e);if(r.tagMenus&&n.data("tag-menu-tagname",e),!t){if(n.hasClass("s-tag")){var i="<svg style='pointer-events:none;' class='svg-icon iconClearSm' width='12' height='12' viewBox='0 0 14 14'><path d='M12 3.41L10.59 2 7 5.59 3.41 2 2 3.41 5.59 7 2 10.59 3.41 12 7 8.41 10.59 12 12 10.59 8.41 7z'></path></svg>",o=$("<a>",{"class":"js-delete-tag s-tag--dismiss","title":r.tooltipDeleteTag||"Remove tag"});o.append($(i)),n.append(o)}else n.append($("<span>",{"class":"js-delete-tag delete-tag","title":r.tooltipDeleteTag||"Remove tag"}));X.trigger("tagSpanCreated",[n])}return r.tagSpanCreated&&r.tagSpanCreated(n),n}function l(e){var t=$([]),n=$([]);switch(e){case Ct.all:t=ct.find(".rendered-element"),n=dt.find(".rendered-element");break;case Ct.left:t=ct.find(".rendered-element:last");break;case Ct.right:n=dt.find(".rendered-element:first");break;case Ct.all_left:t=ct.find(".rendered-element");break;case Ct.all_right:n=dt.find(".rendered-element")}return{"pre":t,"post":n}}function c(e){e=e||Ct.all;var t=l(e),n=t.pre.map(function(e,t){return $(t).text()}).get(),r=n.join(" ");r.length&&(r+=" ");var i=t.post.map(function(e,t){return $(t).text()}).get(),o=i.join(" ");o.length&&ut.val().length&&(o=" "+o);var a=ut.val();return n=n.concat(i),{"text":r+ut.val()+o,"lengthBeforeInput":r.length,"val":a,"tags":n}}function u(t){t=t||c(),setTimeout(function(){e.trigger("tageditor:renderedchange",[t.tags,t.val])}),w()}function d(){var e=ut.val();return(""===e||" "===e)&&0===ct.add(dt).children().filter(function(){return!/^\s*$/.test($(this).text())}).length}function f(e){return r.getTagNameFromData?r.getTagNameFromData(e):e.Name}function p(e){e=e||Ct.all;var t=ut.caret(),n=ut[0].selectionDirection,r=l(e);if(r.pre.add(r.post).length){var i=c(e);ut.val(i.text),r.pre.remove(),r.post.remove(),ut.caret(t.start+i.lengthBeforeInput,t.end+i.lengthBeforeInput),ot&&(ut[0].selectionDirection=n),N(),u()}}function h(e){if(r.operators&&r.operators.test(e))return $("<span class='rendered-element'/>").text(e);var t=s(e).addClass("rendered-element");return g(e)||t.addClass("invalid-tag temp-tag__danger").attr("title",r.tooltipInvalidTag||"invalid tag"),t}function g(e){return r.invalid&&r.invalid[e]?!1:r.isTagValid&&!r.isTagValid(e)?!1:!0}function m(t){if(!vt){var n;if(n=t?{"start":ut.val().length,"end":ut.val().length}:ut.caret(),-1==n.start&&(n.start=n.end=0),!ot&&n.start!==n.end)return p(),w(),void 0;var i=ut.val(),o=i.substr(0,n.start),s=i.substr(n.end),l=ut[0].selectionDirection,f=r.customCleanUpSplitRegex||/[,;\s]+/,g=(o+"!").split(f);g[g.length-1]="!"===g[g.length-1]?"":g[g.length-1].slice(0,-1);var m=s.split(f),v=g.pop(),y=v.length;v+=i.substring(n.start,n.end),v+=m.shift(),g=G(g.join(" ")),m=G(m.join(" "));var b,x=!!g.length||!!m.length;for(b=0;b<g.length;b++)h(g[b]).appendTo(ct);for(b=0;b<m.length;b++)h(m[b]).appendTo(dt);v!==ut.val()&&ut.val(v);var k=X.find(".rendered-element"),S=K(k.map(function(e,t){return $(t).text()}));b=0,k.filter(function(){return!S[b++]}).remove();var C=c(),E=$.trim(C.text);E!=e.val()&&(e.val(E).trigger("change"),StackExchange.MarkdownEditor&&!r.ignoreStyleCode&&styleCode.updateLangdivDelayed.trigger(E.split(/ /g))),x&&u(C),U&&(ut.caret(y,y+n.end-n.start),ot&&(ut[0].selectionDirection=l),T(),a()),w(),d()?ut.attr("placeholder",H):ut.attr("placeholder","")}}function v(e,t,n,r){var i,o;if("string"==typeof e)o=e;else{if(!e.length)return;i=e,o=i.text()}for(var a=G(ut.val()),s=0;s<a.length;s++)h(a[s]).appendTo(ct);if(ut.val(o),i){var l=$($.unique(i.prevAll(".rendered-element").get()));i.nextAll(".rendered-element").prependTo(dt),l.appendTo(ct),i.remove()}else dt.find(".rendered-element").appendTo(ct);(U||!n)&&ut.focus(),t&&ut.caret(0,0),r||u()}function y(e){var t=e.val(),n="c_"+t;if(n in $t)return $t[n];var r=$("<span />").css({"font-family":e.css("font-family"),"font-size":e.css("font-size"),"display":"inline-block"});r.text(e.val()),r.insertAfter(e);var i=r.innerWidth();return r.remove(),$t[n]=i,i}function b(e){r.multiLine||e!==Et&&(ct.add(ut).add(dt).css({"position":"relative","left":e}),Et=e)}function w(){it&&(Q=X.innerWidth());var e=y(ut)+19,t=ct.outerWidth();if(r.multiLine||dt.children().length||(e=Math.max(e,Q-t-8)),ut.css("width",e),r.multiLine){var n=ut.position().top,i=n;if(i>0&&lt>i+st)return;if(n+X.scrollTop()+st<lt)return X.scrollTop(0),void 0;X.scrollTop(n-(lt-st)/2+X.scrollTop())}else{if(t+Et>0&&Q>t+Et+e)return;if(Q>t+e)return b(0),void 0;b(-t+(Q-e)/2)}}function x(e,t){var n;n=e>0?dt.find("> *"):ct.find("> *");for(var r,i,o=ut.position(),a=ut.val().length,s=a>0?ut.caret().start/a:.5,l=o.left+ut.width()*s,c=0;c<n.length;c++){var u=n.eq(e>0?c:n.length-c-1),d=u.position();if("undefined"!=typeof i){if(d.top!==i)break}else{var f=Math.abs(d.top-o.top);if(!(f>st/2))continue;i=d.top}var h=d.left+u.width()/2;if(0>e&&l>h||e>0&&h>l){r=r||u;break}r=u}if(r){if(t){for(;r.parent().length;)p(e>0?Ct.right:Ct.left);ut.caret(0,ut.val().length)}else v(r);return!0}return!1}function k(){xt=!0,setTimeout(function(){xt=!1},0)}function S(){var e=G(ut.val())[0];if(e){var t=$("<span data-tag-name='"+e+"'/>");L(t)}}function C(e){if(!ot&&e.shiftKey&&_t[e.which]||e.ctrlKey&&65===e.which)return p(),!0;var t,n,i=ut.caret(),o=ut[0].selectionDirection,a="forward"===o?i.end:i.start,s=a===ut.val().length,l=0===a;switch(e.which){case 37:return l?(t=ct.find(".rendered-element:last"),t.length?(e.shiftKey?p(Ct.left):v(t),e.shiftKey):!0):!0;case 39:return s?(n=dt.find(".rendered-element:first"),n.length?(e.shiftKey?p(Ct.right):v(n,!0),e.shiftKey):!0):!0;case 8:return l?(t=ct.find(".rendered-element:last"),t.length?(ut.val(t.text()+ut.val()),ut.caret(t.text().length,t.text().length),t.remove(),u(),!1):!0):!0;case 46:return s?(n=dt.find(".rendered-element:first"),n.length?(ut.val(ut.val()+n.text()),ut.caret(a,a),n.remove(),u(),!1):!0):!0;case 38:if(r.multiLine&&x(-1,e.shiftKey))return!1;case 36:return t=ct.find(".rendered-element:first"),t.length?(e.shiftKey?p(Ct.all_left):v(t,!0),e.shiftKey):!0;case 40:var c=Y.children("div:first");if(c.length)return k(),c.focus(),!1;if(r.multiLine&&x(1,e.shiftKey))return!1;case 35:return n=dt.find(".rendered-element:last"),n.length?(e.shiftKey?p(Ct.all_right):v(n),e.shiftKey):!0;case 9:k(),r.renderErrorTagIfNoResults&&!_()&&S();break;case 13:if(_())return!1;break;case 32:if(r.spaceSelectsTopSuggestion===!1)return!1;if(r.spaceSelectsTopSuggestion&&_())return L(Y.children("div:first")),!1}return!0}function E(e){return 27===e.which&&Y.length>0?(N(),e.preventDefault(!0),e.stopPropagation(),!1):!0}function _(){return!!Y.length&&!Y.hasClass("no-results")}function T(){var e=G(ut.val())[0];return e&&(r.searchTermModifier&&(e=r.searchTermModifier(e)),r.allowUpperCaseTagNames&&(e=e.toLocaleLowerCase())),kt!==e?(kt=e,e&&e.length?(A(e,function(t){e===kt&&U&&R(t,e)}),void 0):(yt()||N(),void 0)):void 0}function A(e,t){var n=P(e);Tt[n]?t(Tt[n]):At.trigger(e,t)}function I(){return r.tagApiUrl||"/filter/tags"}function P(e){return I()+"|"+e}function R(e,t){Y.remove(),vt=!1;var n=lt;r.multiLine&&(n=X.height());var i=e.length;if(0===i)return Y=$("<div class='tag-suggestions no-results box-border fs-cation fc-light c-default'>No results found</div>").css({"position":"absolute","left":X.position().left,"top":X.position().top+n+1,"width":J}).insertAfter(X),void 0;Y=$("<div class='tag-suggestions js-tag-suggestions box-border' />").css({"position":"absolute","left":X.position().left,"top":X.position().top+n+1,"width":J}).insertAfter(X);var o={};X.find(".rendered-element").each(function(){o[$(this).text()]=!0});for(var a=r.suggestionTagBoxRenderer||O,s=0;s<e.length;s++)if(o[f(e[s])]!==!0){var l=a(e[s],t).appendTo(Y).attr("tabindex",ft||0);M(l),s%F!==0||tt||l.css("clear","both")}Y.on({"keydown":D,"keyup":B,"click":function(e){$(e.target).is("a")||L($(this))},"focus":function(){xt&&1===i?L($(this)):vt=!0},"blur":function(){vt=!1}},"div")}function O(e,t){var n=$("<div />").css("width",tt?"auto":et).data("tag-name",e.SynonymOf||f(e));t&&(t=t.replace(/-/g,"").replace(/\*+/g,"	").replace(/([^\t])(?=[^\t])/g,"$1-*").replace(/\+/g,"\\+").replace(/\./g,"\\.").replace(/\t/g,".*"));var r=s(f(e),!0),i=r.html();if(t&&(i=i.replace(new RegExp("("+t+")"),"<span class='match'>$1</span>")),tt&&r.addClass("m0"),n.append(r.html(i)),e.Count&&!tt&&n.append($("<span class='item-multiplier' />").html("&times;&nbsp;"+e.Count)),V&&!tt){var o="";if(e.Excerpt&&(o=e.Excerpt),o.length&&n.append($("<p />").text(o)),e.Synonyms&&e.Synonyms.length)for(var a=$("<p >also:</p>").appendTo(n),l=e.Synonyms.split(/\|/),c=0;c<l.length;c++)o=l[c],t&&(o=o.replace(new RegExp("("+t+")"),"<span class='match'>$1</span>")),c>0&&(o=", "+o),a.append("<span>"+o+"</span>")}if(z&&!tt){var u=e.InfoUrl;u||(u=(e.IsDiverged?StackExchange.options.site.routePrefix:"")+"/tags/"+encodeURIComponent(e.SynonymOf||f(e))+"/info"),n.append("<p class='more-info'><a href='"+u+"' target='_blank'>learn more</a></p>")}return n}function M(e){var t=e.find("p.more-info");"undefined"==typeof St&&(St=et-5-t.outerWidth());var n=e.find(".rendered-element:first").outerWidth()+e.find(".item-multiplier").outerWidth();n>St&&t.find("a").text("info")}function L(e){ut.val(e.data("tag-name")),N(),v(""),m()}function j(e){StackExchange.options.enableLogging&&(console.log("tag editor new: "+e),"string"!=typeof e&&console.log(e))}function N(){Y.remove(),Y=$(),vt=!1,At.cancel()}function D(e){var t;switch(e.which){case 39:case 40:return $(this).next("div").focus(),!1;case 37:return $(this).prev("div").focus(),!1;case 38:return t=$(this).prev("div"),t.length?t.focus():ut.focus(),!1;case 13:return L($(this)),!1;case 32:return r.spaceSelectsTopSuggestion&&L($(this)),!1}}function B(e){return 27===e.which?(N(),ut.focus(),e.stopPropagation(),!1):!0}var U;if("undefined"==typeof n)try{U=e.is(":focus")}catch(q){U=!1}else U=n;if(e.bind("focus",i),!e.is(":visible"))return t=t||0,3>t?(setTimeout(function(){e.unbind("focus",i),StackExchange.tagEditor(e,t+1,U,r)},300),void 0):(e.unbind("focus",i),$("body.review-task-page").length||StackExchange.debug.log("tag box is invisible, couldn't start tag editor"),void 0);r||(r={});var F=r.columns||3,V="undefined"==typeof r.excerpts||r.excerpts,z="undefined"==typeof r.learnMore||r.learnMore,H=e.attr("placeholder")||"",W=r.renderTag||function(e){return window.tagRenderer(e,null,"span",r.useStacksClasses)},K=r.customFilterTags||function(e){var t={};return e.map(function(e){return/^\s*$/.test(e)?!1:t[e]===!0?!1:(r.operators&&r.operators.test(e)||(t[e]=!0),!0)})},G=r.customSafeTags||function(e){var t=StackExchange.helpers.sanitizeAndSplitTags(e,!1,!!r.operators,r.allowUpperCaseTagNames)||[];return e&&$.trim(e)&&j('safeTags("{0}") => {1}'.formatUnicorn(e,t.toString())),t},Y=$();e.unbind("focus",i);var Q=e.innerWidth(),X=$("<div class='tag-editor' />").insertAfter(e);r.extraTagEditorCssClass&&X.addClass(r.extraTagEditorCssClass),["padding-right","padding-left","box-sizing","margin-top","margin-bottom"].forEach(function(t){X.css(t,e.css(t))});var Z="border-box"===e.css("box-sizing");Z&&(Q+=parseInt(X.css("border-right-width"),10)+parseInt(X.css("border-left-width"),10));var J=r.suggestionsWidth||Q,et=(J-12)/F|0,tt=r.responsiveIsh&&150>et;X.css("width",Q);var nt=e.css("display");e.hide();var rt=getComputedStyle(e[0]).width,it=/%$/.test(rt);it&&X.css("width",rt),"inline"===nt&&X.css("display","inline-block"),r.multiLine&&X.addClass("multi-line");var ot="selectionDirection"in e[0],at=W("test").appendTo(X),st=Z?X.outerHeight():X.innerHeight(),lt=r.multiLine?e.innerHeight():st;at.remove(),Z&&(lt+=parseInt(X.css("border-top-width"),10)+parseInt(X.css("border-bottom-width"),10)),X.css("height",lt);var ct=$("<span />").appendTo(X),ut=$("<input type='text' autocomplete='off' tabIndex='0'/>").appendTo(X).val(e.val()+" ").attr("placeholder",H),dt=$("<span />").appendTo(X),ft=e.attr("tabIndex"),pt=e.attr("id");if(pt){var ht=$("label[for='"+pt+"']");if(ht.length){var gt="tageditor-replacing-"+pt+"--input";ut.attr("id",gt),ht.attr("for",gt)}}ft&&ut.attr("tabIndex",ft),e.hasClass("s-input")&&(X.addClass("s-input").css({"paddingTop":0,"paddingBottom":0}),ut.addClass("s-input"));var mt,vt=!1,yt=function(){return r.showAllWhenEmptyAndFocused&&r.getDataPromise&&d()?(r.getDataPromise("").done(function(e){R(e.slice(0,StackExchange.settings.mentions.maxNumUsersInDropdown))}),!0):!1},bt=U;ut.focus(function(t,n){U=!0,a(),bt||(n||e.triggerHandler("focus",!0),bt=!0),yt()});var wt=!1;X.mousedown(function(){wt=!0,$(document).one("mouseup",function(){setTimeout(function(){U||(e.triggerHandler("blur"),bt=!1),wt=!1},0)})}),ut.blur(function(){U=!1,setTimeout(function(){vt||(N(),m(),wt||(e.triggerHandler("blur"),bt=!1)),wt=!1},0)}),e.focus(function(e,t){t||ut.trigger("focus",!0)}),ut.on({"keydown":C,"keyup":E,"input":function(){setTimeout(m,0)}}),X.delegate(".rendered-element","click",function(e){var t=$(this);$(e.target).hasClass("js-delete-tag")&&t.text(""),v(t),m()}),X.click(function(e){e.target===this&&(v(""),m())}),X.on("rerender",function(){p(),m(!0)});var xt,kt,St,Ct={"left":1,"right":2,"all_left":3,"all_right":4,"all":5},$t={},Et=0,_t={"35":!0,"36":!0,"37":!0,"38":!0,"39":!0,"40":!0},Tt={},At=StackExchange.helpers.DelayedReaction(function(e,t){StackExchange.helpers.addSpinner(X,{"position":"absolute","right":10,"top":lt/2-2});var n=null;if(r.getDataPromise)n=r.getDataPromise(e);else{var i=I(),o={"q":e,"newstyle":!0};r.alterQueryParametersBeforeSend&&r.alterQueryParametersBeforeSend(o),n=$.get(i,o,"json")}n.done(function(n){Tt[P(e)]=n,StackExchange.helpers.removeSpinner(),t(n)})},400,{"sliding":!0});m(!0),StackExchange.tagEditor.ready.resolve(),e[0].func_clear=function(){e.val(""),ut.val("").blur(),X.find(".rendered-element").remove()},e[0].func_add=function(e){var t=ut.val();ut.val(e),v(t,!1,!0),m()},e[0].func_finish=function(){v("")},e[0].func_redraw=function(){var t=e.val();e.val(""),ut.val("").blur(),X.find(".rendered-element").remove(),ut.val(t),v("",!1,!0,!0),m()}},StackExchange.tagEditor.ready=$.Deferred();