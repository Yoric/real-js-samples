function asyncGeneratorStep(e,t,i,o,n,r,l){try{var s=e[r](l),a=s.value}catch(c){return void i(c)}s.done?t(a):Promise.resolve(a).then(o,n)}function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise(function(o,n){function r(e){asyncGeneratorStep(s,o,n,r,l,"next",e)}function l(e){asyncGeneratorStep(s,o,n,r,l,"throw",e)}var s=e.apply(t,i);r(void 0)})}}define(["common/user-agent-analyzer","common/cmp","modules/playerNeo","modules/visibilityManager"],function(e,t,i,o){"use strict";function n(e){this.blockSelector=".js-player-video:not(.js-player-video-initialized)",this.playerNeoSelector=".player-neo",this.videoCollection=[],this.forceStart=!!e,this.active=null,this.lastScrollTop=0,this.isOnWebmobile=!1,this.disabledScrollToPlay=!1,this.needReactivate=[],this.isFullScreen=!1,this.populateVideoCollection(),this.ClickToPlayHeaderVideo(),"desktop"===s.device?(this.isOnWebmobile=!1,this.setWindowListeners()):this.isOnWebmobile=!0,this.noPauseOnBlur=document.location.search.indexOf("pause=0")>-1&&"https://www.lci.fr"!==document.location.origin,this.isIE=s.is({browser:"IE"}),o.add(this.onVisibilityChange.bind(this))}function r(e){return e.player.getContainer().getBoundingClientRect().top+e.player.getContainer().offsetHeight/2>0&&e.player.getContainer().getBoundingClientRect().bottom-e.player.getContainer().offsetHeight/2<window.innerHeight}function l(){return document.webkitIsFullScreen||document.mozIsFullScreen||document.isFullScreen||document.webkitFullscreenElement||document.mozFullscreenElement||document.msFullscreenElement||document.fullscreenElement}var s=e.analyze();return Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var e=this.length-1;e>=0;e--)this[e]&&this[e].parentElement&&this[e].parentElement.removeChild(this[e])},n.prototype.ClickToPlayHeaderVideo=function(){var e=document.querySelector("#xl-hdr-art-plyr-pstr");return e&&t.hasCookieConsent()?void e.parentNode.removeChild(e):void(e&&t.get55CC().then(function(){e.parentNode.removeChild(e)}))},n.prototype.populateVideoCollection=function(){Array.prototype.forEach.call(document.querySelectorAll(this.blockSelector),function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e,o){var n,r,l,s,a,c,u,d,h,p,y;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.querySelector(this.playerNeoSelector),r=document.getElementById("xl-hdr-art-plyr-pstr"),l=e.querySelector(".iframe-ratio"),s=e.querySelector(".spinner"),a=e.querySelector("div[id]"),null!==n){t.next=11;break}return a.style.height="100%",s.remove(),l.remove(),null!==r&&r.remove(),t.abrupt("return");case 11:return c=n.dataset.autostart,u=!n.dataset.disablescroll,d=n.dataset.live||"video",h=new i({frame:n}),t.next=17,h.getPlayerInstance();case 17:p=t.sent,y={id:o,player:p,playerNeo:h,type:d,scrollToPlay:u,autoStart:c,el:e,isReady:!1},e.classList.add("js-player-video-initialized"),this.videoCollection.push(y),this.showPlayer(y);case 22:case"end":return t.stop()}},t,this)}));return function(t,i){return e.apply(this,arguments)}}().bind(this))},n.prototype.setActive=function(e){void 0!==e&&null!==e?(e=parseInt(e),this.active="number"!=typeof e||isNaN(e)?null:e):this.active=null,this.pauseAllInactiveVideos()},n.prototype.setVideoMode=function(e,t){this.videoCollection[e].mode=t},n.prototype.setDataId=function(e){var t=e.el.querySelector(this.playerNeoSelector);t.setAttribute("data-key",e.id)},n.prototype.getVideoKey=function(e){var t=null;if(e){var i=e.el.querySelector(this.playerNeoSelector);t=i.dataset.key}return t},n.prototype.pauseAllInactiveVideos=function(){this.videoCollection.forEach(function(e){if(this.active!==e.id){var t=e.player;t.setPause()}}.bind(this))},n.prototype.onVideoReady=function(e,t){var i=e.el.querySelector(this.playerNeoSelector),o=e.el.querySelector(".iframe-ratio"),n=e.el.querySelector(".spinner"),r=e.el.querySelector(".imageVideo");e.isReady||(e.isReady=!0,o.style.display="none",n&&(n.style.opacity=0),r&&(r.style.opacity=0),i.classList.remove("invisible"),this.setDataId(e),this.setPlayerListeners(e,this.isOnWebmobile),this.handleOnStart(e))},n.prototype.showPlayer=function(e){var t=e.player;this.forceStart&&null!==t.currentCatalog?this.onVideoReady(e):t.addEventListener("onReady",this.onVideoReady.bind(this,e))},n.prototype.setWindowListeners=function(){},n.prototype.setPlayerListeners=function(e){var t=e.player;t.addEventListener("onUserPlay",this.handleClickPlayButton.bind(this,e)),t.addEventListener("onUserPause",this.handleClickPlayButton.bind(this,e)),t.addEventListener("onStart",this.handleClickPlayButton.bind(this,e))},n.prototype.handleFullScreenEnter=function(){this.isFullScreen=!0},n.prototype.handleFullScreenExit=function(){this.isFullScreen=!1},n.prototype.handleScroll=function(){if(null===this.active)this.launchVisibleVideo();else if(!r(this.videoCollection[this.active])&&!l()){var e=this.videoCollection[this.active].player;e.setPause(),this.setActive(null),this.launchVisibleVideo()}},n.prototype.handleOnStart=function(e){if(1===parseInt(e.autoStart)){var t=this.getVideoKey(e);this.setActive(t)}},n.prototype.handlePlay=function(e){this.setActive(e)},n.prototype.handlePause=function(e){this.active===parseInt(e)&&this.setActive(null)},n.prototype.setPlayerMute=function(e,t){if(!this.isOnWebmobile){var i=t?"setMute":"setUnMute";e[i]()}},n.prototype.handleClickPlayButton=function(e){var t=this.getVideoKey(e);this.setActive(t),this.disabledScrollToPlay||(this.disabledScrollToPlay=!0,window.removeEventListener("scroll",this.debounceScroll))},n.prototype.detectScrollDirection=function(){var e=window.pageYOffset||document.documentElement.scrollTop,t=e>this.lastScrollTop?"down":"up";return this.lastScrollTop=e,t},n.prototype.launchVisibleVideo=function(){var e=this.videoCollection.filter(function(e){return r(e)&&e.scrollToPlay&&"live"!==e.type});if(e.length>0){var t="down"===this.detectScrollDirection()?0:e.length-1,i=e[t],o=this.getVideoKey(i),n=i.player;this.setActive(o),this.setPlayerMute(n,!1),n.setPlay()}},n.prototype.onVisibilityChange=function(e){this.noPauseOnBlur||("visible"===e&&0!==this.needReactivate.length?this.needReactivate.forEach(function(e){return e.player.setPlay()}):"hidden"===e&&(this.needReactivate=this.videoCollection.filter(function(e){return r(e)&&"LIVE_STATE"!==e.player.getState()&&e.playerNeo.isPub}),this.needReactivate.forEach(function(e){return e.player.setPause()})))},n});