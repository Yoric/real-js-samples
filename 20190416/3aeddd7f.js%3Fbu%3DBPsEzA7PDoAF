(function(){try{(function(){var n={L_Link_Generating_Text:"Creating the link â€¦",L_Link_GenerationFailed_Text:"There was a problem creating the link. Try again.",L_Permalink_Prompt:"Share this map",L_TaskBar_Label_SearchBox:"Search Term",L_TaskBar_Label_Clear:"Clear Search Term",L_TaskBar_Label_Search:"Search",L_TaskBar_Label_Directions:"Directions",L_TaskBar_Label_Traffic:"Traffic",L_TaskBar_Label_Favorites:"My Places",L_TaskBar_Label_More:"More",L_SearchNearbyTransit:"Nearby Transit",L_SearchNearbyParking:"Parking",L_Permalink_Email_Button_Tooltip:"Email link",L_Print_Submit:"Print",L_PrintPreview:"Print Preview",L_PrintMapAndText:"Map & Text",L_PrintMapOnly:"Map only",L_PrintTextOnly:"Text only",L_PermalinkCopy_Text:"Copy",L_PermalinkEmail_Text:"Email",L_Permalink_Email_Button_Text:"Email",L_PermalinkFacebook_Text:"Facebook",L_PermalinkTwitter_Text:"Twitter",L_Twitter_Tag_Text:"on #BingMaps",L_PermalinkHeaderPrompt_Text:"Share",L_PermalinkLink_Text:"Link",L_PermalinkPrompt_Text:"Select the cards above that you would like to share",L_Link_TooManyItemsSelected_Text:"Unable to share. Please unselect some items and try sharing in smaller groupings (5-10 items at a time).",L_Link_EmailTitleManyCards_Text:"Bing Maps session shared with you",L_Link_EmailFooter_Text:"Shared from Bing Maps",L_LengthenButton_Text:"Show full URL",L_ShortenButton_Text:"Shorten",L_EditMapDone_Text:"Done",L_EditMap_Text:"Move or zoom map",L_SlideOutMenu_MapType:"Map",L_SlideOutMenu_MapType_Road:"Road View",L_SlideOutMenu_MapType_Aerial:"Aerial View",L_SlideOutMenu_MapType_Birdseye:"Birds View",L_SlideOutMenu_SeeAllCards:"See all card",L_SlideOutMenu_BingHome:"Bing Home",L_SlideOutMenu_Feedback:"Feedback",L_SlideOutMenu_ExitPreview:"Exit preview",L_PrintNotes:"Notes",L_PrintNotesWatermark:"Type your notes here",L_PermalinkEmbed_Text:"Embed",L_Menu_Exit_Text:"Previous Version",L_Menu_Feedback_Text:"Feedback",L_TaskBar_Label_Print:"Print",L_TaskBar_Label_Embed:"Embed a map",L_TaskBar_Label_Share:"Share",L_Menu_Tips_Text:"Tips",L_TaskBar_Label_Fullscreen:"Full Screen",TaskBarLogoTitle:"Back to Bing search",BEV2DetailsInstruction:"1. In cards",BEV2Introduction:"New and crisp Bird's Eye imagery is available in many metropolitan areas.",BEV2TransientLensInstruction:"2. Right-click on the map",BEV2WelcomeText:"Bird's Eye has changed",BEV2ImageIntroduction:"There are two ways of viewing the new Bird's Eye.",BEV2TipNote:"Note: Bird's Eye may not be available in your area as outdated imagery is no longer available.",L_CategoryLayerDropdownButton:"All {0}",L_CategoryLayerDropdownTitle:"Show on map",L_CategoryLayer_Schools:"Schools",L_CategoryLayer_Transit:"Transit",L_CategoryLayer_Commutability:"Commute",ShareEmailToolTip:"Send in email",ShareFBToolTip:"Share to Facebook",ShareTwitterToolTip:"Post to Twitter",L_CmtControlTitleText:"Move the car on the map to see a 15 min commute range.",L_CmtControlAddLocationText:"Add location",L_CmtControlCommuteTime30Text:"30 min",L_CmtControlCommuteTime45Text:"45 min",L_CmtControlCommuteTime60Text:"1 hr",L_CmtControlCommuteTime15Text:"15 min",L_CmtControlCommutePeak_Text:"Peak",L_CmtControlCommuteOffPeak_Text:"Off Peak",L_CmtControlPushpinTitle:"A",L_CmtControlPushpinTwoTitle:"B",L_CmtEditText:"Options",L_CmtDoneText:"Done",L_CmtPlaceHolderText:"Commute to (e.g. work, home, school)",L_CmtTitle:"{time} min commute to {addresses} in {trafficCondition} traffic",L_CmtTitleAddresses:"both {addr1} and {addr2}",ShareClose:"Close",ShareUrlLabel:"Copy URL",L_CategoryUserTip_Header:"Show on map",L_CategoryUserTip_Message1:"We've turned on the map layers you selected",L_CategoryUserTip_Message2:"Pan and Zoom to see more results",L_ZoomInUserTip_Message:"Zoom in or use filters to narrow your search",L_Tooltip_Itinerary_Saved_Text:"Itinerary saved to My Places",L_Tooltip_Rename_Button:"Rename",L_Tooltip_Update_Button:"Update",SearchGhostText:"Search for places, itineraries, or businesses"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("InternalControls",n):window.$MicrosoftMaps8.ResourcesObject=n})();var i=window.$MicrosoftMaps8,r=i.Internal,vi=r.TaskData,ou=i.Anchor,su=i.GlobalConfig.features.autosuggest,yi=i.CommonControls.AutosuggestViewModel,pi=i.CommonControls.AutosuggestV2,wi=r._BaseMapTemplateSelector,hu=r.BaseTask,kt=r.BaseTaskViewModel,cu=i.BitmapImageTemplate,dt=vi.CollectionActions,it=r._ComponentNames,ot=r.Control,nt=r.ControlTemplate,f=i.DataHandlerKeys,lu=r._Debug,au=i.DefaultTemplateSelector,bi=i.CommonControls.DropdownItem,l=r._EntryPoints,a=r._FeatureNames,vu=i.GlobalConfig.features.feedback,yu=i.FiltersBarModuleViewModel,pu=i.FiltersBar,wu=i.FiltersBarItem,bu=i.FiltersBarItemData,ku=r.GeolocationProvider,n=r._Gimme,s=i.GlobalConfig,e=i.GlobalDataEventHandler,h=r._Helper,du=i.CommonControls.IDropDownListData,gu=i.ImageFromCssHelper,ct=i.ImageryMapLayer,o=r._JSEvent,ki=i.Layer,nf=i.LocationRect,d=r._LoggerConstants,tf=r.MapInteractionBehavior,ft=r.MapHelper,gt=i.Location,rf=i.MapsFeedback,p=i.MapTypeId,di=i.MapView,lt=i.CommonControls.ModalDialogViewModel,uf=i.MoveableSimplePointPrimitive,gi=r._Network,ff=i.GlobalConfig.features.notification,nr=r._ObservableObject,ni=r._ObservableCollection,ef=r._OverlayEntity,tr=r._Overlay,st=i.Point,ir=i.CommonControls.PopOutButtonViewModel,of=s.features.parking,w=r.Permalink,sf=i.PrimitiveOverlayHelper,g=i.GlobalConfig.features.print,rr=r.PrintContent,ur=i.Pushpin,t=i.ResourceManager.InternalControls,fr=r.ReverseGeocoder,er=i.CommonControls.SearchBoxAutosuggestDataModel,hf=r.SDKPrimitiveTemplateSelector,cf=i.SimplePointPrimitive,ti=i.Size,b=i.GlobalConfig.features.sharing,rt=r.SharingInstrumentationAction,or=r.TaskData.TimeTypes,ii=i.LabelVisibility,lf=r._StreetsidePerfConstants,af=i.GlobalConfig.features.streetside,u=i.GlobalConfig.features.taskBar,vf=r._TaskDataHandlerHelper,sr=i.CommonControls.TaskBarDropdownViewModel,c=i.TaskTypes,yf=s.features.traffic,pf=r._Url,wf=i.MouseEventArgs,at=i.VectorMapLayer,bf=i.VenueMaps,ri=r.TaskData.Waypoint,vt=i.ZoomLevel,hr='<div>    <div class="sliBack" event:click="clickBackgroundHandler"><\/div>    <div class="sliMenu">        <ItemsControl ItemsSource="{Binding menuItems}">            <ItemsControl.Template>                <DataTemplate>                    <ul class="sliMenuList"><ItemsPresenter /><\/ul>                <\/DataTemplate>            <\/ItemsControl.Template>            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li class="{Binding type}" >                        <a href="#" id="{Binding htmlId}" class="{Binding cssClass}" event:click="clickHandler">                            <TextBlock text="{Binding name}" />                        <\/a>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <\/div>  <\/div>',cr='<div class="bm_categorySearchContainer" data-tag="ShowMeControls" >    <div class="recommendedCategoryContainer">        <div class="showMeImage">            <span class="showMeIcon" role="presentation"><\/span>        <\/div>        <div><a style:display="{TemplateBinding ShowCreateAlertButton Converter=boolToDisplay}" onclick="javascript:sj_evt.fire(\'createAlertClicked\')">Create Alert<\/a><\/div>        <ItemsControl ItemsSource="{TemplateBinding CategoryList}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <div>                        <a class="recommendedCategory" data-tag="recommendedCategory" style:display="{Binding Recommended Converter=boolToDisplay}" event:click="onItemClick" role="checkbox" aria-checked="{Binding Checked}" href="#">                            <span class="{Binding Checked Converter=itemCheckedClass}"><\/span>                            <span class="{Binding Icon}"><\/span>                            <span class="categoryName">                                <TextBlock Text="{Binding Name}" />                            <\/span>                        <\/a>                    <\/div>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/div>    <div class="{TemplateBinding CheckCount Converter=countClassConverter}" data-tag="CategoryDropdown">        <MultiselectDropdown ItemList="{TemplateBinding CategoryList}" ButtonName="{TemplateBinding DropdownButtonName}" DropdownTitle="{TemplateBinding dropdownTitle}" ButtonIcon="moreIcon" />    <\/div><\/div>',lr='<div class="bm_BirdsEyeV2Dialog">    <div class="bm_BEMessageTitleContainer" data-tag="BEMessageTitleContainer">        <div class="BEV2TitleText" title="{TemplateBinding resources.BEV2WelcomeText}">            <TextBlock Text="{TemplateBinding resources.BEV2WelcomeText}" />        <\/div>    <\/div>    <div class="bm_BEMessageContainer" data-tag="BEMessageContainer">        <div class="bm_BEV2Introduction" title="{TemplateBinding resources.BEV2Introduction}">            <TextBlock Text="{TemplateBinding resources.BEV2Introduction}" />        <\/div>    <\/div>    <div class="bm_BEImageIntroContainer" data-tag="BEImageIntroContainer">        <div class="bm_ImageIntroText" title="{TemplateBinding resources.BEV2ImageIntroduction}">            <TextBlock Text="{TemplateBinding resources.BEV2ImageIntroduction}" />        <\/div>    <\/div>    <div class="bm_BEImagesContainer" data-tag="BEImagesContainer">        <div class="bm_DetailsImageContainer" data-tag="DetailsImageContainer">            <div class="bm_DetailsInstructionText" title="{TemplateBinding resources.BEV2DetailsInstruction}">                <TextBlock Text="{TemplateBinding resources.BEV2DetailsInstruction}" />            <\/div>            <img src="" class="bm_DetailsBEV2Image" data-tag="DetailsBEV2Image"/>        <\/div>        <div class="bm_TransientImageContainer" data-tag="TransientImageContainer">            <div class="bm_TransientInstructonText" title="{TemplateBinding resources.BEV2TransientLensInstruction}">                <TextBlock Text="{TemplateBinding resources.BEV2TransientLensInstruction}" />            <\/div>            <img src="" class="bm_TransientBEV2Image" data-tag="TransientBEV2Image" />        <\/div>    <\/div>    <div class="bm_BEv2TipNoteContainer" data-tag="BEv2TipNoteContainer">        <div class="bm_BEv2NoteText" title="TemplateBinding resources.BEV2TipNote">            <TextBlock Text="{TemplateBinding resources.BEV2TipNote}"/>        <\/div>    <\/div><\/div>',yt='<div id="cmt_container" class="cmt_container collapsed" event:mouseover="stopEvent" event:mouseenter="stopEvent" event:click="stopEvent" event:mousedown="stopEvent" event:mouseup="stopEvent" event:mouseout="stopEvent" event:contextmenu="stopEvent" event:focus="stopEvent">    <div id="cmt_topArea" class="cmt_topArea">        <div id="cmt_titleWrapper" class="cmt_titleWrapper">            <div id="cmt_title" class="cmt_title">{commuteControlTitle}<\/div>        <\/div>        <button id="cmt_edit" class="cmt_button" event:click="onEditClicked" event:touchstart="onEditClicked">{editText}<\/button>        <button id="cmt_done" class="cmt_button hidden" event:click="onDoneClicked" event:touchstart="onDoneClicked">{doneText}<\/button>    <\/div>    <div id="cmt_body" class="cmt_body hidden">        <div class="cmt_addresses" id="cmt_addresses">            <div class="cmt_addressDiv" id="cmt_addressDivOne">                <input type="text" class="cmt_address" id="cmt_addressOne" placeholder="{placeHolder}" value="{StaticBinding addressValue Mode=TwoWay}" />                <div id="cmt_delete_1" class="cmt_delete hidden" event:click="onDeleteClicked" event:touchstart="onDeleteClicked"><\/div>            <\/div>            <div class="cmt_addressDiv hidden" id="cmt_addressDivTwo">                <input type="text" class="cmt_address" id="cmt_addressTwo" placeholder="{placeHolder}" value="{StaticBinding addressTwoValue Mode=TwoWay}" />                <div id="cmt_delete_2" class="cmt_delete" event:click="onDeleteClicked" event:touchstart="onDeleteClicked"><\/div>            <\/div>        <\/div>        <div class="cmt_settings">            <div class="cmt_timeArea">                <button id="cmt_time15" class="cmt_button cmt_time selected" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime15}<\/button>                <button id="cmt_time30" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime30}<\/button>                <button id="cmt_time45" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime45}<\/button>                <button id="cmt_time60" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime60}<\/button>            <\/div>            <div class="cmt_Depart">                <button id="cmt_peak" class="cmt_button selected" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commutePeak}<\/button>                <button id="cmt_offpeak" class="cmt_button" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commuteOffPeak}<\/button>            <\/div>        <\/div>        <div id="cmt_BtmArea" class="cmt_BtmArea" event:click="onAddLocClicked" event:touchstart="onAddLocClicked">            <div id="cmt_addIcon" class="cmt_addIcon"><\/div>            <div id="cmt_addAdr" class="cmt_addAddr">{commuteAddLoc}<\/div>        <\/div>    <\/div>    <div id="cmt_loader" class="cmt_loader">        <div id="cmt_spinner" class="cmt_spinner"><\/div>    <\/div><\/div>',ht='<div class="taskBar" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">    <ul>        <li class="sbElement">            <a href="/" class="logo" data-tag="TaskBar.Logo"><\/a>        <\/li>        <li class="inputbox">            <div id="maps_sb_container" data-tag="maps_sb_container">                <div class="searchbox">                    <input id="maps_sb" type="search" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" data-tag="TaskBar.SearchBox"><\/input>                    <a href="#" class="clrSb" title="{Binding resources.L_TaskBar_Label_Clear}" role="button" data-tag="TaskBar.SearchBoxCancel"><\/a>                <\/div>            <\/div>            <div class="searchButton">                <a href="#" class="searchIcon" data-instrumentation="{Binding searchInstData}" title="{Binding resources.L_TaskBar_Label_Search}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />            <\/div>        <\/li>    <\/ul>    <ItemsControl ItemsSource="{Binding taskBarItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="actions"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li style:display="{Binding isActive Converter=boolToDisplay}" class="action">                    <a href="#" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}">                        <span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">                            <TextBlock Text="{Binding name}" />                        <\/span>                    <\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>        <div class="clear"><\/div><\/div>',ar='<div class="printDialog" data-tag="printDialog">    <p class="printDlgHdr">        <div class="printPreviewTitle">            <TextBlock Text="{TemplateBinding resources.L_PrintPreview}" />        <\/div>        <div class="mapAndTextPrint">            <ul>                <li>                    <div class="printMapAndText mapTextOptions selected" data-tag="printMapAndText" event:click="onMapTextClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintMapAndText}" />                    <\/div>                <\/li>                <li>                    <div class="printMapOnly mapTextOptions" data-tag="printMapOnly" event:click="onMapOnlyClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintMapOnly}" />                    <\/div>                <\/li>                <li>                    <div class="printTextOnly mapTextOptions" data-tag="printTextOnly" event:click="onTextOnlyClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintTextOnly}" />                    <\/div>                <\/li>            <\/ul>        <\/div>    <\/p>    <div>        <div class="printContent" data-tag="printContent" event:mousewheel="onMouseWheel">            <div class="printHeader" style:display="block">                <img class="bingMapsLogo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAAATCAMAAADS32EkAAAAP1BMVEX///9RUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFAbX/lHAAAAFHRSTlMAECAwQFBgcHSAkKCwuMDQ4Obw8rSbhEIAAAGTSURBVHhe1ZLdjtwwCEY/DHbqn2KX8v7P2mGSrLKNVrPSqBc9F8jGcGQh4KMk/AP8gfznXi8IkIa85+WEK14RgH17z1t8bnz3vj+H5e6ryYc31QKAhMD8OFNkuVZhRiCQeOd9lVKORmKkshtypsO7+ROrCHzGeYO4QJc9yEB9FuhRsJrxXOoSD9oXQbTbsElINoYfXrJdfLR5JZ6enl6vRDbBrkL1LOhAsQ7UAcSnW4H4IJB21HrZB6rr4l0Aim9PrwHojuoJwDq8DKQIst+ROyTuKIbaL17kq7ch+urTG6nqGB4CPbxnIAW4T58KmYiEI+mU0yv6aQ59X7Krt33670dQJN8SysULbFbDW06rr4zADUBzvnqLF4D97o0RY+g5hyhAcrj/6H5Q6dy91ZYPXL00fXS/eyGLUCy8mlAsIxNo4fdP34n0gW7DrRFYGa0dv+BuVvXuRbc1s0K0u3kFmunM+HUZwWvWwB1KEUWRhBBwJPs5ghdkjtqCrxD9u8FiBC/xoOP7XqSM7yDbxvgabrjwB0awHHyuA7RgAAAAAElFTkSuQmCC" />            <\/div>            <div class="baseMapPrint" data-tag="baseMapPrint">                <div>                        <ul>                            <li data-tag="baseMapNotes" class="baseMapNotes">                                <table>                                    <tr>                                        <td>                                            <div>                                                <TextBlock Text="{TemplateBinding resources.L_PrintNotes}" />                                            <\/div>                                        <\/td>                                    <\/tr>                                    <tr>                                        <td>                                            <div class="baseMapTextArea screenNotes">                                                <textarea rows="9" cols="45" id="baseMapNotes" class="baseMapNotes" style:color="black" placeholder="{TemplateBinding resources.L_PrintNotesWatermark}" maxlength="{TemplateBinding notesMaxCharSize}"> <\/textarea>                                            <\/div>                                            <div class="printedNotes">                                                                                            <\/div>                                        <\/td>                                    <\/tr>                                <\/table>                            <\/li>                            <li data-tag="baseMapMiniMap" class="baseMapOverviewMap">                                <img src="{TemplateBinding overviewContextMap}" />                            <\/li>                        <\/ul>                        <div>                                <div class="printArea" data-tag="printArea">                                    <div class="printMap" data-tag="printMap">                                    <\/div>                                <\/div>                        <\/div>                <\/div>            <\/div>            <div class="taskPrintContent" data-tag="taskPrintContent">            <\/div>        <\/div>            <div class="printFooter" style:display="block">            <p class="printDlgFoot printButton">                <a class="textButton" event:click="onPrintClick" href="#" role="button" data-tag="printButton">                    <TextBlock Text="{TemplateBinding resources.L_Print_Submit}" />                <\/a>            <\/p>        <\/div>    <\/div><\/div>',vr='<div class="bm_sharePanel" data-tag="Share.SharePanel">    <div class="header text" data-tag="Share.HeaderText">        <div class="shareTitleIcon" data-tag="shareTitleIcon"><\/div>        <div class="shareTitle">            <h2>                <TextBlock text="{StaticBinding resources.L_PermalinkHeaderPrompt_Text}" />            <\/h2>        <\/div>        <a href="#" class="panelClose" title="{StaticBinding resources.ShareClose}" data-tag="Share.CloseButton" data-share=\'{ "action": "closeShare" }\'><div class="icon svg"><\/div><\/a>    <\/div>    <div class="content">        <div class="body">            <div class="textAndEmbed">                <div class="shareTextTitle">                    <TextBlock text="{StaticBinding resources.L_PermalinkHeaderPrompt_Text}" />                <\/div>                <div class="text" style:display="{Binding hasAtLeastOneSharableStack Converter=boolToDisplay}">                    <TextBlock text="{StaticBinding resources.L_PermalinkPrompt_Text}" />                <\/div>            <\/div>            <input class="text urlBox" data-tag="Share.UrlBox" type="text" value="{Binding permalinkString}" onclick="this.select();" aria-label="{StaticBinding resources.ShareUrlLabel}" />            <div class="linkBox">                <a href="#" class="{Binding sharingLinkAvailable Converter=availableToLinkClass}" id="linkStyleButton" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}" style:visibility="{Binding enableSharingVisibility}" data-tag="Share.ToggleLinkLength" event:click="toggleLinkLength" role="button">                    <TextBlock text="{Binding isShortPermalinkDisplayed Converter=displayStateToLinkText}" />                <\/a>                <a href="#" class="{Binding sharingLinkAvailable Converter=availableToLinkClass}" id="copyButton" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}" style:visibility="{Binding enableSharingVisibility}" data-tag="Share.Copy" event:click="copyToClipboard" role="button">                    <TextBlock text="{StaticBinding resources.L_PermalinkCopy_Text}" />                <\/a>            <\/div>            <div class="errorMessage" data-tag="Share.ErrorMessage" style:visibility="{Binding errorMessage Converter=errorMessageToVisibility}">                <TextBlock text="{Binding errorMessage}" />            <\/div>        <\/div>        <div class="footer" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}">            <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="facebookIcon" style:visibility="{Binding enableSocialSharing}" data-tag="Share.Facebook" event:click="openFacebook" role="button" title="{StaticBinding resources.ShareFBToolTip}"><\/a>            <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="twitterIcon" style:visibility="{Binding enableSocialSharing}" data-tag="Share.Twitter" event:click="openTwitter" role="button" title="{StaticBinding resources.ShareTwitterToolTip}"><\/a>            <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="emailIcon" data-tag="Share.Email" event:click="openEmail" role="button" title="{StaticBinding resources.ShareEmailToolTip}"><\/a>        <\/div>    <\/div><\/div>',yr='<div class="sharePrompt">    <TextBlock text="{TemplateBinding resources.L_Permalink_Prompt}" /><\/div><input class="shareUrlBox" data-tag="Share.UrlBox" type="text" value="{TemplateBinding permalinkString}" onclick="this.select();" readonly="readonly" /><a href="#" class="shareUrlShortenLink" data-tag="Share.ShortenButton" event:click="shortenClick"><TextBlock text="{TemplateBinding shortenButtonText}" /><\/a><a href="#" class="submitBtn padded" data-tag="Share.EmailButton" event:click="emailClick" role="button">    <TextBlock text="{TemplateBinding resources.L_Permalink_Email_Button_Text}" /><\/a>',ht='<div class="{Binding className}" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">    <ul>        <li class="sbElement">            <a href="/" class="b_logoArea" alt="{Binding resources.TaskBarLogoTitle}" title="{Binding resources.TaskBarLogoTitle}">                <h1 class="b_logo b_taskLogo"><\/h1>            <\/a>        <\/li>        <li class="inputbox">            <div id="maps_sb_container" data-tag="maps_sb_container">                <div class="searchbox">                    <input id="maps_sb" type="search" role="combobox" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" autocomplete="off" aria-haspopup="true" aria-expanded="{Binding asExpanded}" aria-controls="as_containerSearch" aria-autocomplete="both" aria-activedescendant="{Binding selectedSuggestionId}" data-tag="TaskBar.SearchBox"><\/input>                    <div class="searchButton">                        <a href="#" class="searchIcon" tabindex="-1" data-instrumentation="{Binding searchInstData}" title="{Binding resources.L_TaskBar_Label_Search}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />                    <\/div>                <\/div>                <div class="as_container" id="as_containerSearch" aria-owns="maps_sb" style:visibility="hidden"><\/div>            <\/div>        <\/li>    <\/ul>    <ItemsControl ItemsSource="{Binding taskBarItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="actions"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li style:display="{Binding isActive Converter=boolToDisplay}" class="action">                    <a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}">                        <span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">                            <TextBlock Text="{Binding name}" />                        <\/span>                    <\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="clear"><\/div>    <div class="partnerPageNavBar" style="display: none;">        <div class="b_scopebar">            <ul class="bm_partnerNavBarList"><\/ul>        <\/div>    <\/div>    <div class="bm_contextualAndShowMe" data-tag="contextualAndShowMe">        <div id="bm_contexualAndRelatedContainer">            <!-- Container for contextual taskbar -->            <div id="bm_contextualTaskbarContainer" data-tag="contextFilters">            <\/div>            <!-- Container for Related Searches in taskbar -->            <div id="bm_relatedSearchesTaskbarContainer" class="bm_relatedSearchesTaskbarContainer" style="display: none;" data-tag="contextRelatedSrch">            <\/div>            <!-- Container for Directions search along the route in taskbar -->            <div id="bm_directionsTaskbarContainer" class="bm_directionsTaskbarContainer" style="display: none;" data-tag="contextDirSatrCat">            <\/div>        <\/div>        <!-- Container for the category layer dropdown -->        <div id="bm_categoryLayerDropdownContainer">        <\/div>    <\/div>    <!-- The following is the close button for local overlay on serp -->    <div class="overlayCloseBtn">        <a role="button" class="overlayCloseLink" title="{StaticBinding resources.L_CloseTask_Text}" event:click="onOverlayCloseButtonClicked">            <div class="icon svg"><\/div>        <\/a>    <\/div><\/div>',pr='<div class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <div class="tooltipsText">        <a class="tooltipsClose" href="#" title="{TemplateBinding resources.L_Tooltip_Close_Text}" event:click="closeClicked" style:display="{TemplateBinding ShowClose Converter=boolToDisplay}">        <\/a>        <div class="tooltipsMessage">            <TextBlock Text="{TemplateBinding resources.L_Tooltip_Itinerary_Saved_Text}" />        <\/div>        <div class="tooltipsMessage secondLine" style:display="{TemplateBinding showEditName Converter=boolToNotDisplay}">            <TextBlock Text="{TemplateBinding Name}" />            <TextBlock Text="{TemplateBinding separator}" />            <a class="bm_renameLink" href="#" event:click="renameClicked"><TextBlock Text="{TemplateBinding resources.L_Tooltip_Rename_Button}" /><\/a>        <\/div>        <div class="nameInputContainer" style:display="{TemplateBinding showEditName Converter=boolToDisplay}">            <input type="text" class="nameEditBox" maxlength="100" value="{StaticBinding Name Mode=TwoWay}" event:keydown="onKeyPressed" />            <a href="#" class="bm_tooltipSaveButton" event:click="onSaveLinkClick" event:touchend="onSaveLinkClick">                <TextBlock Text="{TemplateBinding resources.L_Tooltip_Update_Button}" />            <\/a>        <\/div>    <\/div><\/div>',wr='<div class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}" event:mouseenter="onTipHoverOver" event:mouseleave="onTipHoverOut">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <a class="tooltipsClose" href="#" title="{TemplateBinding resources.L_Tooltip_Close_Text}" event:click="closeClicked" style:display="{TemplateBinding ShowClose Converter=boolToDisplay}">    <\/a>    <div class="tooltipsText">        <div class="tooltipsHeader" style:display="{TemplateBinding Title Converter=nullToDisplayNone}">            <TextBlock Text="{TemplateBinding Title}" />        <\/div>        <ItemsControl ItemsSource="{TemplateBinding MessageLines}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <div class="tooltipsMessage">                        <TextBlock Text="{Binding $self$}" />                    <\/div>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <div class="tooltipsLinkMessage" style:display="{TemplateBinding Link Converter=nullToDisplayNone}">            <span>                <TextBlock Text="{TemplateBinding PreLink}" />            <\/span>            <a href="#" event:click="onLinkClicked" class="tooltipsLink">                <TextBlock Text="{TemplateBinding Link}" />            <\/a>            <span>                <TextBlock Text="{TemplateBinding PostLink}" />            <\/span>        <\/div>        <div style:display="{TemplateBinding SignInTitle Converter=nullToDisplayNone}">            <SignInPopUpControl SignInMessage="{TemplateBinding SignInTitle}" event:signedIn="onSignedIn" />        <\/div>    <\/div><\/div>',v=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ui=function(n){function i(){var i=this,r=t;return i=n.call(this,lr,"bm_BirdsEyeV2DialogContainer",{onCloseClick:function(n){return i._onCloseClick(n)}},{},r)||this}return v(i,n),i.prototype.showBEDialog=function(){this.OpenDialog()},i.prototype._onCloseClick=function(n){n&&n.preventDefault();this.CloseDialog();this.dispose()},i}(lt),br=function(r){function u(n,f,e){var o=r.call(this,e)||this;return yt=yt.replace("{commuteControlTitle}",t.L_CmtControlTitleText).replace("{commuteAddLoc}",t.L_CmtControlAddLocationText).replace("{commuteTime30}",t.L_CmtControlCommuteTime30Text).replace("{commuteTime45}",t.L_CmtControlCommuteTime45Text).replace("{commuteTime60}",t.L_CmtControlCommuteTime60Text).replace("{commuteTime15}",t.L_CmtControlCommuteTime15Text).replace("{commutePeak}",t.L_CmtControlCommutePeak_Text).replace("{commuteOffPeak}",t.L_CmtControlCommuteOffPeak_Text).replace("{editText}",t.L_CmtEditText).replace("{doneText}",t.L_CmtDoneText).replace("{placeHolder}",t.L_CmtPlaceHolderText).replace("{placeHolder}",t.L_CmtPlaceHolderText),o.setTemplate(new nt(yt,{stopEvent:function(n){return o._stopEvent(n)},onAddLocClicked:function(){return o._onAddLocClicked()},onDeleteClicked:function(n){return o._onDeleteClicked(n)},onTimeClicked:function(n){return o._onTimeClicked(n)},onPeakClicked:function(n){return o._onPeakClicked(n)},onEditClicked:function(){return o._onEditClicked()},onDoneClicked:function(){return o._onDoneClicked()}})),o._map=n,o._cmtFeatureConfig=s.features.commutability,o.defineProperty("addressValue"),o.defineProperty("addressTwoValue"),o._secondAddrEnabled=!1,o._time=u._defaultSelectedTime,o._departureTime=o._cmtFeatureConfig.peakTime,o._location=o._map.getBounds(!0).center,o._pushpinLayer=new ki("Commutability_Layer"),o._pushpin=new i.Pushpin(o._location,{icon:u._iconSvg,draggable:!0,text:t.L_CmtControlPushpinTitle}),o._pushpinLayer.add(o._pushpin),i.Events.addHandler(o._pushpin,"dragend",function(n){return o._pushpinDragEnd(o._pushpin,n)}),o._isochroneOptions={intersectionOptions:{fillColor:o._cmtFeatureConfig.intersectFillColor,strokeColor:o._cmtFeatureConfig.isochroneStrokeColor,strokeThickness:o._cmtFeatureConfig.isochroneStrokeThickness,secondaryStrokeColor:o._cmtFeatureConfig.isochroneSecondaryStrokeColor,secondaryStrokeThickness:o._cmtFeatureConfig.isochroneSecondaryStrokeThickness},showIntersection:!!o._cmtFeatureConfig.showIntersection,showUnion:!!o._cmtFeatureConfig.showUnion,showIsochrones:!!o._cmtFeatureConfig.showIsochrones,applyCardinalSpline:typeof o._cmtFeatureConfig.applyCardinalSpline=="boolean"?o._cmtFeatureConfig.applyCardinalSpline:!1},o._isochroneLayer=f,o._isochroneLayer.attachMap(o._map),o._isochroneLayer.setOptions(o._isochroneOptions),o._updateCompleteHandler=function(){return o._updateIsochroneCompleted()},o._isochroneLayer.downloadCompleted.add(o._updateCompleteHandler),o._isochroneLayers=[],i.loadModule("Microsoft.Maps.AutoSuggest",function(){var r=o._cmtFeatureConfig.autoSuggestMaxResult||5,n={maxResults:r,map:o._map,serpOptions:{showMyLocation:!0,suggestionTypes:"place,business,address",selectFirstOnEnter:!0}},t=i.AutosuggestManager;o._asManagerOne=new t(n);o._asManagerOne.attachAutosuggest("#cmt_addressOne","#cmt_addressDivOne",function(n){o._processAutoSuggestResult(n.location,n.formattedSuggestion,!0);k.logAddressChange(l.Autosuggest,!1)});o._asManagerTwo=new t(n);o._asManagerTwo.attachAutosuggest("#cmt_addressTwo","#cmt_addressDivTwo",function(n){o._processAutoSuggestResult(n.location,n.formattedSuggestion,!1);k.logAddressChange(l.Autosuggest,!0)});o.disposables.push(o._asManagerOne,o._asManagerTwo)}),o}return v(u,r),u.prototype.attachIsochrone=function(){this._map.getLayers().insertAll([this._isochroneLayer,this._pushpinLayer]);k.logColtrolActivation()},u.prototype.detachIsochrone=function(){this._map.getLayers().remove(this._isochroneLayer);this._map.getLayers().remove(this._pushpinLayer);k.logColtrolDeactivation()},u.prototype.dispose=function(){var n,t,i;for(this.detachIsochrone(),n=0,t=this._isochroneLayers;n<t.length;n++)i=t[n],i.dispose();this._isochroneLayer&&this._isochroneLayer.dispose();this._pushpinLayer.dispose();r.prototype.dispose.call(this);h._clearDisposables(this.disposables);h._nullifyClass(this)},u.prototype.postInit=function(){var f=this,e,r,t;if((this._cmtContainer=n("#cmt_container"),this._cmtContainer)&&(this._title=n("#cmt_title"),this._addAddressButton=n("#cmt_BtmArea"),this._addressesSection=n("#cmt_addresses"),this._address=n("#cmt_addressOne"),this._addressOneClose=n("#cmt_delete_1"),this._addressTwo=n("#cmt_addressTwo"),this._addressTwoContainer=n("#cmt_addressDivTwo"),this._editButton=n("#cmt_edit"),this._doneButton=n("#cmt_done"),this._peakButton=n("#cmt_peak"),this._loader=n("#cmt_loader"),this._currentSelectedTimeElement=n(".cmt_time.selected"),this._currentSelectedDepartureElement=n(".cmt_Depart .selected"),this._setControlBusy(!1),this._cmtFeatureConfig.prefetch))for(e=i.IsochroneLayer,r=0;r<u._times.length;r++){if(u._times[r]===this._time){this._isochroneLayers.push(this._isochroneLayer);this._isochroneLayer.downloadError.add(function(n){return f._handleIsochroneError(n)});continue}t=new e;t.setOptions(this._isochroneOptions);t.attachMap(this._map);t.downloadError.add(function(n){return f._handleIsochroneError(n)});this._isochroneLayers.push(t)}},u.prototype._stopEvent=function(n){n.stopPropagation()},u.prototype._onEditClicked=function(){var r=n("#cmt_body"),t,i;r.remove_class("hidden");this._cmtContainer.remove_class("collapsed");this._editButton.add_class("hidden");this._doneButton.remove_class("hidden");this._adjustAutosuggestWidth();t=this._map.getNavigationBar().getLocateMeControl();i=t&&t.getGeochainControl();i&&i.setIsCollapsed(!0);k.logButtonClick(this._editButton.get_attr("id"))},u.prototype._onDoneClicked=function(){var t=n("#cmt_body");t.add_class("hidden");this._cmtContainer.add_class("collapsed");this._doneButton.add_class("hidden");this._editButton.remove_class("hidden");k.logButtonClick(this._doneButton.get_attr("id"))},u.prototype._onAddLocClicked=function(){var n=this;this._downloadingIsochrone||this._addAddressButton.has_class("hidden")||(this._addAddressButton.add_class("hidden"),this._addressOneClose.remove_class("hidden"),this._addressTwoContainer.remove_class("hidden"),this._secondAddrEnabled=!0,this.setAddressTwoValue(""),this._addressTwo.set_attr("value",""),this._locationTwo=this._map.getBounds(!0).center,this._pushpinTwo=new ur(this._locationTwo,{icon:u._iconSvg,draggable:!0,text:t.L_CmtControlPushpinTwoTitle}),this._pushpinLayer&&this._pushpinLayer.add(this._pushpinTwo),i.Events.addHandler(this._pushpinTwo,"dragend",function(t){return n._pushpinDragEnd(n._pushpinTwo,t)}),this._cmtContainer.add_class("expanded"),this._addressesSection.add_class("expanded"),this._adjustAutosuggestWidth(),k.logButtonClick(this._addAddressButton.get_attr("id")))},u.prototype._onDeleteClicked=function(n){if(!this._downloadingIsochrone){var t=n.target,i=t.id;i==="cmt_delete_1"&&(this._location=this._locationTwo,this._pushpin.setLocation(this._location),this.setAddressValue(this.getAddressTwoValue()),this._address.set_attr("value",this.getAddressValue()));this._addAddressButton.remove_class("hidden");this._addressOneClose.add_class("hidden");this._addressTwoContainer.add_class("hidden");this._cmtContainer.remove_class("expanded");this._addressesSection.remove_class("expanded");this._pushpinLayer.remove(this._pushpinTwo);this._secondAddrEnabled=!1;this._updateMapView();this._updateIsochrone();this._updateTitle();this._adjustAutosuggestWidth()}},u.prototype._onTimeClicked=function(t){var f=t.target,i=f.id,r;this._downloadingIsochrone||i===this._currentSelectedTimeElement.get_attr("id")||n("#"+i).has_class("disabled")||(r=u._timeButtonIds.indexOf(i),this._changeSelectedTime(r),k.logButtonClick(i))},u.prototype._onPeakClicked=function(t){var r=t.target,i=r.id;this._downloadingIsochrone||i===this._currentSelectedDepartureElement.get_attr("id")||(this._departureTime=i==="cmt_peak"?this._cmtFeatureConfig.peakTime:this._cmtFeatureConfig.offPeakTime,this._currentSelectedDepartureElement.remove_class("selected"),this._currentSelectedDepartureElement=n("#"+i),this._currentSelectedDepartureElement.add_class("selected"),this._updateIsochrone(),this._updateTitle(),k.logButtonClick(i))},u.prototype._processAutoSuggestResult=function(n,t,i){var r=i?this._location:this._locationTwo;gt.areEqual(r,n,!0)||(i?(this._location=n,this.setAddressValue(t),this._pushpin.setLocation(n)):(this._locationTwo=n,this.setAddressTwoValue(t),this._pushpinTwo.setLocation(n)),this._updateMapView(),this._updateIsochrone(),this._updateTitle())},u.prototype._updateIsochrone=function(){var i,n,t,f,r,e;for(this._resetTimeButtons(),this.getAddressValue()||this._reverseGeocode(this._location,1),this.getAddressValue()!==this._address.get_attr("value")&&this._address.set_attr("value",this.getAddressValue()),this._secondAddrEnabled&&this._addressTwo.set_attr("value",this.getAddressTwoValue()),i=null,(!this._peakButton||this._peakButton.has_class("selected"))&&(i="timeWithTraffic"),n=0;n<u._times.length;n++)(t=u._times[n],this._cmtFeatureConfig.prefetch||t===this._time)&&(f=this._buildRequest(t,i,1),r=[f],this._secondAddrEnabled&&this.getAddressTwoValue()&&(e=this._buildRequest(t,i,2),r.push(e)),t===this._time?(this._setControlBusy(!0),this._isochroneLayer.setRequests(r)):this._isochroneLayers&&this._isochroneLayers.length>n&&this._isochroneLayers[n]&&this._isochroneLayers[n].setRequests(r))},u.prototype._buildRequest=function(n,t,i){var u=this._location,f=this._cmtFeatureConfig.isochroneOneFillColor,r;return i===2&&(u=this._locationTwo,f=this._cmtFeatureConfig.isochroneTwoFillColor),r={maxTime:n,startPoint:u,departTime:this._departureTime,optimize:t,displayOptions:{fillColor:f,strokeColor:this._cmtFeatureConfig.isochroneStrokeColor}},r.displayOptions.strokeThickness=this._cmtFeatureConfig.isochroneStrokeThickness,r.displayOptions.secondaryStrokeColor=this._cmtFeatureConfig.isochroneSecondaryStrokeColor,r.displayOptions.secondaryStrokeThickness=this._cmtFeatureConfig.isochroneSecondaryStrokeThickness,r},u.prototype._updateMapView=function(){var i=[this._location];this._locationTwo&&!gt.areEqual(this._location,this._locationTwo)&&i.push(this._locationTwo);var n=this._map.getMode().getMapViewForLocationsInView(i),r=vt.fromLocation(n.cameraLocation,!1),u=this._map.getMercatorZoomLevel();if(r>u){var t=this._map.getViewportPadding(),f=this._map.getViewport(),e=new st(t.left,t.top),o=new st(f.pixelWidth-t.right,f.pixelHeight-t.bottom),s=new st((e.x+o.x)/2,(e.y+o.y)/2);n=this._map.getMode().getMapViewZoomedAboutLocationAtPoint(n,n.cameraLocation,s,u-r)}this._map.setView(n)},u.prototype._adjustAutosuggestWidth=function(){var n=this._address.get_size().width;this._asManagerOne.setOptions({serpOptions:{width:n}});this._asManagerTwo.setOptions({serpOptions:{width:n}})},u.prototype._pushpinDragEnd=function(n,t){n===this._pushpin?(this._location=t.location,this._reverseGeocode(t.location,1),k.logAddressChange(l.POI,!1)):n===this._pushpinTwo&&(this._locationTwo=t.location,this._reverseGeocode(t.location,2),k.logAddressChange(l.POI,!0));this._downloadingIsochrone?this._updateWhenDownloadFinish=!0:(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},u.prototype._updateIsochroneCompleted=function(){this._setControlBusy(!1);this._updateWhenDownloadFinish&&(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},u.prototype._updateTitle=function(){var u=this.getAddressValue(),i=u&&u.split(",")[0],n,r,f;this._secondAddrEnabled&&this.getAddressTwoValue()&&(n=this.getAddressTwoValue(),n&&(n=n.split(",")[0]),i!==n&&(i=t.L_CmtTitleAddresses.replace("{addr1}",i).replace("{addr2}",n)));r=this._peakButton.has_class("selected")?t.L_CmtControlCommutePeak_Text:t.L_CmtControlCommuteOffPeak_Text;r=r.toLowerCase();f=t.L_CmtTitle.replace("{time}",this._time).replace("{addresses}",i).replace("{trafficCondition}",r);this._title.set_text(f);var e=parseInt(this._title.get_style("height")),o=parseInt(this._title.get_style("lineHeight")),s=Math.round(e/o);s===1?this._title.set_style({padding:"9px 0px"}):this._title.set_style({padding:"0px"})},u.prototype._setControlBusy=function(n){this._downloadingIsochrone=n;n?(this._loader&&this._loader.remove_class("hidden"),this._cmtContainer&&this._cmtContainer.add_class("disabled")):(this._cmtContainer&&this._cmtContainer.remove_class("disabled"),this._loader&&this._loader.add_class("hidden"))},u.prototype._handleIsochroneError=function(t){var f=t.isochroneLayer,i,e,r;if(f&&(i=0,i=this._cmtFeatureConfig.prefetch?this._isochroneLayers.indexOf(f):u._times.indexOf(this._time),e=u._timeButtonIds[i],r=n("#"+e),(r&&r.has_class("selected")||!this._cmtFeatureConfig.prefetch)&&(this._setControlBusy(!1),this._changeSelectedTime(0)),!r.has_class("disabled")))while(i<u._timeButtonIds.length)this._enableTimeButton(i,!1),i++},u.prototype._changeSelectedTime=function(n){if(this._selectTimeButton(n),this._cmtFeatureConfig.prefetch){this._isochroneLayer.downloadCompleted.remove(this._updateCompleteHandler);var t=this._map.getLayers();t.remove(this._isochroneLayer);this._isochroneLayer=this._isochroneLayers[n];this._isochroneLayer.downloadCompleted.add(this._updateCompleteHandler);t.insert(this._isochroneLayer);this._isochroneLayer.downloading||this._isochroneLayer.getIsochrones().length!==0||this._updateIsochrone()}else this._updateIsochrone();this._isochroneLayer.downloading&&this._setControlBusy(!0);this._updateTitle()},u.prototype._selectTimeButton=function(t){if(t>=0){this._currentSelectedTimeElement.remove_class("selected");var i=u._timeButtonIds[t];this._currentSelectedTimeElement=n("#"+i);this._currentSelectedTimeElement&&this._currentSelectedTimeElement.add_class("selected");this._time=u._times[t]}},u.prototype._resetTimeButtons=function(){for(var f,r,t=0,i=u._timeButtonIds;t<i.length;t++)f=i[t],r=n("#"+f),r&&r.remove_class("disabled")},u.prototype._enableTimeButton=function(t,i){var r=n("#"+u._timeButtonIds[t]);r&&(i?r.remove_class("disabled"):r.add_class("disabled"))},u.prototype._reverseGeocode=function(n,t){var i=this,r=new fr;r.reverseGeocode(n,function(r){var u="";u=r&&r.success&&r.addressList&&r.addressList.length>0&&r.addressList[0].formattedAddress?r.addressList[0].formattedAddress:n.latitude.toFixed(4)+","+n.longitude.toFixed(4);t===1?(i.setAddressValue(u),i._address.set_attr("value",u)):(i.setAddressTwoValue(u),i._addressTwo.set_attr("value",u));i._updateTitle()})},u._timeButtonIds=["cmt_time15","cmt_time30","cmt_time45","cmt_time60"],u._defaultSelectedTime=15,u._times=[15,30,45,60],u._iconSvg='<svg width="24" height="31" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M11 0C4.924 0 0 4.924 0 11c.011 1.666.708 3.474 1.68 5.348 1.668 3.173 4.223 6.517 6.125 8.822a91.61 91.61 0 0 0 2.517 2.898.906.906 0 0 0 1.35 0 91.509 91.509 0 0 0 2.516-2.898 76.508 76.508 0 0 0 2.587-3.306c1.278-1.734 2.561-3.648 3.54-5.516C21.292 14.474 21.99 12.667 22 11 22 4.924 17.076.002 11 0z" id="a"/><path id="b" d="M0 .25h12v7.008H0z"/><path id="d" d="M0 9.75h12V1H0z"/><\/defs><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" fill-rule="nonzero"><use fill="#111" fill-rule="evenodd" xlink:href="#a"/><path stroke="#FFF" d="M11-.5c6.352.002 11.5 5.149 11.5 11.503-.01 1.617-.6 3.386-1.742 5.577-.907 1.73-2.117 3.595-3.58 5.58a76.458 76.458 0 0 1-2.604 3.328c-.75.91-1.638 1.926-2.53 2.915a1.406 1.406 0 0 1-2.094 0 89.323 89.323 0 0 1-2.531-2.915c-2.55-3.09-4.732-6.15-6.184-8.91C.097 14.382-.489 12.618-.5 11-.5 4.648 4.648-.5 11-.5z"/><\/g><g transform="translate(6 7.75)"><mask id="c" fill="#fff"><use xlink:href="#b"/><\/mask><path d="M2.88 5.12a1.25 1.25 0 1 0-1.76 1.777A1.25 1.25 0 0 0 2.88 5.12zM10 3H1a1 1 0 0 0-1 1v1.39a2.09 2.09 0 0 1 3.48-.87c.396.391.619.923.62 1.48h2.8a2.1 2.1 0 1 1 4.2 0h.9V5a2 2 0 0 0-2-2zM8.11 5.11A1.25 1.25 0 1 0 9 4.75a1.25 1.25 0 0 0-.88.37l-.01-.01zM7.29.54a.997.997 0 0 0-.71-.29h-4a1 1 0 0 0-.89.55L1 2.25h8L7.29.54z" fill="#FFF" mask="url(#c)"/><\/g><\/g><\/svg>',u}(ot),kr=function(n){function t(t){var i=this;if(t){var r=t.getRootElement(),u=new st(0,0);i=n.call(this,r,1,u)||this}return i}return v(t,n),t}(tr),k=function(){function n(){}return n.logAddressChange=function(t,i){var r={logData:{feature:a.Commutability,action:n.AddressChange,data:{METHOD:t,IS:i}}};e.invokeHandler(f.instrumentationDataHandlerKey,r)},n.logButtonClick=function(n){var t={logData:{feature:a.Commutability,action:d.Clicked,data:{BID:n}}};e.invokeHandler(f.instrumentationDataHandlerKey,t)},n.logColtrolActivation=function(){var n={logData:{feature:a.Commutability,action:d.Activated,data:{EP:l.ContextMenu}}};e.invokeHandler(f.instrumentationDataHandlerKey,n)},n.logColtrolDeactivation=function(){var n={logData:{feature:a.Commutability,action:d.Deactivated,data:{EP:l.ContextMenu}}};e.invokeHandler(f.instrumentationDataHandlerKey,n)},n}(),pt;(function(i){function b(t,f){var a=this,l,e;(r=n("#b_TriviaOverlay"),r&&r.length!==0)&&(h=f,c=t,i.serializableObjectChanged=new o,s=0,l=c.getContainer(),l.instanceAsync("BrowserHistoryManager",function(n){u=n;u&&u.register("MktTourHelper",a)},null,!0),e=r.select(".ulcSlides .slideImage"),e.length>0&&(e.for_each(function(n){var i=n.getAttribute("data-task"),t;i&&(t=n.getAttribute("data-serpquery"),t||n.addEventListener("click",function(n){return k(n)}))}),tt(),it()),w(e),ut())}function k(n){var t=n.currentTarget,i,u,o;t.classList.contains("sldShown")||t.classList.contains("inactive")||(t.classList.add("sldShown"),s=Number(t.getAttribute("data-slideid")),v(),w(r.select(".ulcSlides .slideImage")),y(),p(t),a(),i=JSON.parse(t.getAttribute("data-task")),u=i&&i.state,e.invokeHandler(f.taskDataHandlerKey,i),o=u.query||u.taskTitle||u.title,l(o))}function d(t){if(t!==null&&t.activeSlideId!=="undefined"&&t.activeSlideId>-1){var i=t.activeSlideId,u=r.select(".ulcSlides .slideImage");u.length>0&&(u.for_each(function(t){var r=Number(t.getAttribute("data-slideId"));r<=i?n(t).add_class("sldShown"):n(t).remove_class("sldShown")}),y(i),a(),p(u[i]))}}function g(){return{activeSlideId:s}}function nt(n){d(n)}function tt(){var n=r.select(".nextULC .slideImage.btSINext");n&&n.length>0&&n.add_event("click",function(t){var o=_w.btULCinfo,h=n.get_attr("data-slideid"),c=Number(h),i,u;c===o.totalSlide?(t.preventDefault(),t.stopImmediatePropagation(),s=0,i=JSON.parse(n.get_attr("data-task")),i&&(v(),o.summaryPageUrl="",n.set_attr("data-url",""),e.invokeHandler(f.taskDataHandlerKey,i),l(""),rt()),r.select("#rqCloseBtn").fireEvent("click")):(u=r.select(".btsImg"+n.get_attr("data-slideid")),u&&u.fireEvent("click"))})}function it(){var n=r.select("#rqCloseBtn");n&&n.length>0&&n.add_event("click",function(){u&&u.unregister("MktTourHelper")})}function rt(){var n=document.getElementById("maps_sb");n&&(n.placeholder=t.SearchGhostText,n.focus())}function l(n){var t=document.getElementById("maps_sb");t&&(t.value=n)}function a(){var n="_SS";sj_cook.set(n,"BTQID","-",!1,"/");sj_cook.set(n,"BTSID","-",!1,"/");sj_cook.set(n,"BTSlClk","-",!1,"/");sj_cook.set(n,"BTOID","-",!1,"/");sj_cook.set(n,"BTMC","-",!1,"/");sj_cook.set(n,"BTULCTtl","-",!1,"/")}function v(){h.removeAllStacks(!1)}function y(n){var i=r.select(".slideImage.btSINext"),f,t,e,u;i.length>0&&(n=n===null||n===undefined?Number(i.get_attr("data-slideid")):n,f=n+1,t=_w.btULCinfo,t&&(t.currentSlide=n,e=r.select(".btsImg"+f),u=r.select(".btULCTeaser"),i.set_attr("data-slideId",f.toString()),f===t.totalSlide?(u.length>0&&u.set_text(i.get_attr("data-title")),t.summaryPageUrl=i.get_attr("data-Url"),t.slideCompleted=!0):e.length>0&&u.length>0&&u.set_text(e.get_attr("title"))))}function p(n){var i=r.select(".bt_title"),t;i.set_text(n.getAttribute("data-title"));t=r.select(".bt_desc");t.set_text(n.getAttribute("data-description"))}function ut(){r.select(".ulcSlides").set_style({width:"calc(100% - 280px)"})}function w(n){if(n.length!==0){var t=-1;n.for_each(function(n){n.classList.contains("sldShown")?t=Number(n.getAttribute("data-slideid")):Number(n.getAttribute("data-slideid"))-t>1?n.classList.contains("inactive")||n.classList.add("inactive"):n.classList.contains("inactive")&&n.classList.remove("inactive")})}}var r,h,c,u,s;i.initialize=b;i.serialize=g;i.deserialize=nt})(pt||(pt={}));var y=function(){function n(){}return n.log=function(t,i,r){e.invokeHandler(f.instrumentationDataHandlerKey,{logData:{feature:n.Feature,action:t,data:i},flush:r})},n.Feature="PRT",n.Submit="S",n.Activate="A",n.Deactivate="D",n.TaskBar="T",n.Filter="FLTR",n.TaskCardHeader="H",n.TaskType="TYP",n.MapOnly="MO",n.TextOnly="TO",n.MapAndText="MAT",n}(),dr=function(r){function u(i){var u=this,e={},s=t,f={};return u=r.call(this,ar,"PrintContainer",f,e,s)||this,u._poiLayers=[],u._map=i,u._window=n(window),u.resources=s,u._printMapReady=!1,u._printDisplayOption=0,u.onPrintDialogClose=new o,u.onPrintDialogOpen=new o,u.generateContextMapUrl(),f.onPrintClick=function(n){return u._onPrintClick(n)},f.onCloseClick=function(n){return u._onCloseClick(n)},f.onMouseWheel=function(n){return u._onMouseWheel(n)},f.onMapTextClick=function(){u._toggleMapAndText(!0,!0,u.getRootElement().select(".printMapAndText"))},f.onMapOnlyClick=function(){u._toggleMapAndText(!0,!1,u.getRootElement().select(".printMapOnly"))},f.onTextOnlyClick=function(){u._toggleMapAndText(!1,!0,u.getRootElement().select(".printTextOnly"))},u.notesMaxCharSize=g.notesMaxChars,e.defineProperty("printContentList"),u.setPrintContentList(new ni),u}return v(u,r),u.prototype.loadPrintMap=function(){var e=this,t,u,f;r.prototype.OpenDialog.call(this);t=this.getRootElement();u=t.getParent().select(".defaultPrintMessage");u.swap_class("showPrintErrorMessage","hidePrintErrorMessage");t.select(".PrintContainer").set_attr("data-tag","PrintContainer");this._hasPrintableTasks=this._getPrintTasksAvailable();this._hasPrintableTasks&&(n(".PrintContainer .baseMapPrint").removeFromParent(),this._addPrintPreviewContent());this._mapHolder=n(".PrintContainer .printMap");f={mapType:this._map.getMapType().id,zoom:this._map.getMercatorZoomLevel(),credentials:g.credentials,navigationOptions:{lockCameraAltitude:!1,lockCameraHeading:!0},enableInertia:!1,disableDiffFrame:!0,showLandmarks:!0,isPrintMode:!0,showLogo:!0,showLocateMeButton:!1,disableStreetside:!0,disableStreetsideAutoCoverage:!0,labelOptions:{labelVisibility:this._map.getLabelController().getIsLabelsEnabled()?ii.visible:ii.hidden},heading:this._map.getView().heading};i.loadMap({element:this._mapHolder,mapOptions:f},function(n){return e._finishPrintMapSetup(n)},!0)},u.prototype.addPrintContent=function(n){n&&this.getPrintContentList().insert(n)},u.prototype.setDialogSize=function(n){if(n.height&&n.width){var t=this.getRootElement();t.select(".printContent").set_style({height:(n.height>u.BaseMapHeaderFooterPadding?n.height-u.BaseMapHeaderFooterPadding:0)+"px"})}},u.prototype.onWindowResize=function(){this.setDialogSize(new ti(window.innerWidth,window.innerHeight))},u.prototype._onMouseWheel=function(n){this._mapEditOn&&n.preventDefault();n.stopPropagation()},u.prototype._toggleMapAndText=function(n,t,i){var r=this.getRootElement(),u;r.select(".isMap").swap_class(n?"hideMap":"showMap",n?"showMap":"hideMap");r.select(".isText").swap_class(t?"hideText":"showText",t?"showText":"hideText");u=n&&!t;r.select(".taskMapPrint").swap_class(u?"taskMapPrintPageBreak":"taskMapPrintNoPageBreak",u?"taskMapPrintNoPageBreak":"taskMapPrintPageBreak");this.getRootElement().select(".mapTextOptions").remove_class("selected");i.add_class("selected");this._printDisplayOption=n?t?0:1:2;y.log(y.Filter,{CLK:n?t?y.MapAndText:y.MapOnly:y.TextOnly})},u.prototype._finishPrintMapSetup=function(t){var r=this,o,u,f,e,s;this._printMiniMap=t;o=ft.getMapCenter(this._map);u=ft.getMercatorZoomLevel(this._map);this._map.getMapType().id!==p.birdseye&&(u=u>2&&this._hasPrintableTasks?u-1:u);this._printMiniMap=t;this.disposables.push(this._printMiniMap);this._printMiniMap.setDesiredSize({width:-1,height:-1});this._printMiniMap.setView(new di(i.ZoomLevel.toLocation(o,u,!0),this._map.getView().heading),null);this._showMiniMapNavigationBar(!1);f=this.getRootElement();e=this._hasPrintableTasks?"taskMap":"baseMap";f.select(".printMap").add_class(e);f.select(".printArea").add_class(e);this.setDialogSize(new ti(window.innerWidth,window.innerHeight));this._windowSizeHandler=function(){return r.onWindowResize()};this._window.add_event("resize",this._windowSizeHandler);f.select(".printContent")[0].scrollTop=0;n(".mapAndTextPrint").set_style({display:this._hasPrintableTasks?"inline":"none"});s=t.getContainer();s.instanceAsync("MapInteraction",function(n){r._mapInteraction=n;n.setOptions({disableAllInteractions:!0});n.disableInteractionModes(704)});n(".taskPrintContent").add_event("click",function(n){n.preventDefault();n.stopPropagation();n.cancelBubble=!0});this._printMiniMap.getOverlayManager().then(function(){var e,o,t,i,u,n,f;for(r._updateLandmarkClickBehavior(),e=r.getPrintContentList(),o=r.getRootElement().select(".taskPrintContent"),t=0;t<e.length;t++){for(i=e[t],r._hasPrintableTasks||r._addContentToDom(i,o,t),u=i.getLayers(),n=0;u&&n<u.length;n++)r._addLayer(u[n]);for(f=i.getLayerIds(),n=0;f&&n<f.length;n++)r.addLayerPois(f[n])}r.onPrintDialogOpen.invoke();r._printMapReady=!0;r._addEditButton();r._isPrinted=!1})},u.prototype.generateContextMapUrl=function(){var i=g.printImgOverviewMapUrlFormat,t=ft.getMapCenter(this._map),r=g.credentials,n=ft.getMercatorZoomLevel(this._map);n=n>4?n-2:2;this.overviewContextMap=i.replace("{credentials}",g.credentials).replace("{zoom}",n.toString()).replace("{lat}",t.latitude.toString()).replace("{lon}",t.longitude.toString()).replace("{culture}",s.dynamicProperties.market)},u.prototype._addEditButton=function(){var r=this,i=this.getRootElement().select(".printArea"),t,n;i&&(t=h._createElement("div"),t.add_class("bm_mapEditButton"),t.set_attr("data-tag","mapEditButton"),n=h._createElement("a"),n.add_class("textButton"),n.set_attr("href","#"),n.set_attr("role","button"),n.set_attr("data-tag","editButton"),n[0].innerHTML=this.resources.L_EditMap_Text,t.append(n),i.append(t),n.add_event("click",function(n){n.preventDefault();n.stopPropagation();n.cancelBubble=!0;r._toggleEditMap(n)}))},u.prototype._toggleEditMap=function(n){this._mapEditOn=n.target.innerHTML===this.resources.L_EditMap_Text;n.target.innerHTML=this._mapEditOn?this.resources.L_EditMapDone_Text:this.resources.L_EditMap_Text;this._mapInteraction.setOptions({disableAllInteractions:!this._mapEditOn});this._showMiniMapNavigationBar(this._mapEditOn)},u.prototype._addPrintPreviewContent=function(){for(var i=this.getPrintContentList(),r=this.getRootElement().select(".taskPrintContent"),t=0;t<i.length;t++)this._addContentToDom(i[t],r,t);n(".svg",this.getRootElement()[0]).inlineDataSvgs().remove_class("svg")},u.prototype._addContentToDom=function(n,t,i){var u=n&&n.getHtmlContent(),f=n&&n.getCssScope(),r;u&&(r=h._createElement("div"),r.add_class(i==0?"bm_firstTaskContent":"bm_taskContent"),r.set_attr("data-tag","taskContent-"+i),f&&r.add_class(f),r[0].innerHTML=u,t.append(r))},u.prototype._getPrintTasksAvailable=function(){for(var t=this.getPrintContentList(),n=0;n<t.length;n++)if(t[n].getHtmlContent()!=null)return!0;return!1},u.prototype._updateLandmarkClickBehavior=function(){this._printMiniMap.getLandmarksManager().then(function(n){n.removePrimitiveTapped();n.removePrimitiveHover()})},u.prototype._addLayer=function(n){if(n){var t=this._printMiniMap.getLayers();t.insert(n);this._poiLayers.push(n)}},u.prototype.addLayerPois=function(n){var r=this._printMiniMap.getLayers(),t=fi.getMapLayerById(n,this._map),s=t.getZIndex(),f,o,h,e,i;if(t.getVisible()&&n!=="Microsoft.Maps.StreetsideCoverage")if(t instanceof at){for(f=0;f<r.length;f++)if(o=r[f],o&&o.getId()===n)return;h=t;e=new at(u.PrintLayerPrefix+t.getId(),h.getDataSource(),t.getTemplateSelector(),s);e.setRenderTarget(t.getRenderTarget());r.insert(e);this._poiLayers.push(e)}else if(t instanceof ct){var a=t,c=this._map.getView(),l=a.getScene(null,ft.getMapCenter(this._map),vt.toScale(c.cameraLocation,vt.fromLocation(c.cameraLocation,!0),!0),0);l!=null&&(i=new ct(u.PrintLayerPrefix+t.getId(),s),i.setRenderTarget(t.getRenderTarget()),i.addScene(10,l,0),r.insert(i),this._poiLayers.push(i))}},u.prototype._removeLayerPois=function(){for(var t=this._printMiniMap.getLayers(),n=this._poiLayers.pop();n;)t.remove(n),n.dispose(),n=this._poiLayers.pop()},u.prototype._showMiniMapNavigationBar=function(n){var i=this,t=this._printMiniMap.getNavigationBar();t?n?(t.setVisible(!0),t.setRotateButtonVisible(!1),t.setMapStyleSelectorControlVisible(!1),t.setLocateMeButtonVisible(!1)):t.setVisible(!1):this._printMiniMap.navigationBarLoaded.addOne(function(){return i._showMiniMapNavigationBar(n)})},u.prototype._onPrintClick=function(n){(n.preventDefault(),this._printMapReady)&&(this.prepareForPrint(),window.print(),y.log(y.Submit,{NUM_TASKS:this.getPrintContentList().length,FLTR:this._printDisplayOption==2?y.TextOnly:this._printDisplayOption==1?y.MapOnly:y.MapAndText}),g.dialogOpenAfterPrint?this._isPrinted=!0:(this.revertPrintSetup(),this._closeDialog()))},u.prototype._onCloseClick=function(n){if(n.preventDefault(),y.log(y.Deactivate),this._isPrinted&&g.dialogOpenAfterPrint&&(this._isPrinted=!1,this.revertPrintSetup()),g.dialogOpenAfterPrint){var t=document.getElementsByName("viewport")[0];t&&t.setAttribute("content","user-scalable=no, width=device-width, maximum-scale=1.0")}this._closeDialog()},u.prototype._closeDialog=function(){var n=this.getRootElement(),t=n.getParent().select(".defaultPrintMessage");t.swap_class("hidePrintErrorMessage","showPrintErrorMessage");this._mapInteraction.setOptions({disableAllInteractions:!1});n&&(n.select(".printMap").clear(),n.select(".taskPrintContent").clear());this.onPrintDialogClose.invoke();this.CloseDialog();this.dispose()},u.prototype.prepareForPrint=function(){var t=this.getRootElement(),i=t.select(".screenNotes textarea")[0],r=t.select(".printedNotes")[0];i&&r&&(r.innerHTML=n.Internals.HTMLEncode(i.value).replace(/\n/g,"<BR>"));this._printDisplayOption==2&&(this._removeLayerPois(),t.select(".isMap").removeFromParent());n("#bingLogo").inlineDataSvgs().remove_attr("height").remove_attr("width").set_attr("viewBox","50 0 92 92")},u.prototype.revertPrintSetup=function(){var t=this.getRootElement(),n=t.select(".printedNotes")[0];n&&(n.innerHTML="")},u.prototype.dispose=function(){s.tileRefactoringEnabled?this._printMiniMap.dispose():this._removeLayerPois();this._windowSizeHandler&&(this._window.remove_event("resize",this._windowSizeHandler),this._windowSizeHandler=null);r.prototype.dispose.call(this)},u.BaseMapHeaderFooterPadding=136,u.PrintLayerPrefix="Print_",u}(lt),fi=function(){function n(t,i){this._map=t;this._taskManager=i;n.onPrintDialogClose=new o;n.onPrintDialogOpen=new o}return n.prototype.showPrintDialog=function(t){var u,r,i;t&&(tt.isFullScreen&&tt.exitFullScreen(),u=window.matchMedia("(orientation: portrait)"),g.dialogOpenAfterPrint&&u&&(r=document.getElementsByName("viewport")[0],r&&r.setAttribute("content","user-scalable=no, maximum-scale=1.0")),i=new dr(this._map),i.onPrintDialogClose.addOne(function(){return n.onPrintDialogClose.invoke()}),i.onPrintDialogOpen.addOne(function(){return n.onPrintDialogOpen.invoke()}),this._createPrintContent(i,t),i.loadPrintMap(),y.log(y.Activate,{EP:t.source==1?y.TaskBar:y.TaskCardHeader,TYP:t.taskType?t.taskType:"",CD:t.data}))},n.getMapLayerById=function(n,t){for(var r=t.getLayers(),i=0;i<r.length;i++)if(n===r[i].getId())return r[i]},n.prototype._createPrintContent=function(n,t){var r,f,i;if(t.source==2&&t.taskId)r=this._taskManager.getTaskById(t.taskId),r&&r.hasPrintContent()&&n.addPrintContent(r.getPrintContent());else{var u=null,h=this._taskManager.getFocusedStack(),e=h&&h.getForegroundTask();e&&e.hasPrintContent()&&(u=e.getPrintContent(),n.addPrintContent(u));var o=new ni,c=this._map.getLayers(),s=u&&u.getLayerIds();for(f=0;f<c.length;f++)if(i=c[f],i instanceof at||i instanceof ct){if(s&&s.length>0&&s[0]===i.getId()||i.getId().indexOf("TrafficIncidents")>=0)continue;o.insert(i.getId())}o.length>0&&n.addPrintContent(new rr(null,o))}},n}(),gr=function(i){function r(){var r=this,u={};return r=i.call(this,u)||this,r._privates=u,u.defineProperty("sharingLinkAvailable",null,null,{defaultValue:!1,isPrivate:!0}),u.defineProperty("permalinkString",null,null,{defaultValue:t.L_Link_Generating_Text,isPrivate:!0}),u.defineProperty("isShortPermalinkDisplayed",null,null,{defaultValue:!1,isPrivate:!0}),u.defineProperty("errorMessage",null,null,{defaultValue:"",isPrivate:!0}),u.defineProperty("enableSharingVisibility",null,null,{defaultValue:b.isShorteningEnabled?"visible":"hidden",isPrivate:!0}),u.defineProperty("hasAtLeastOneSharableStack",null,null,{defaultValue:!1,isPrivate:!0}),u.defineProperty("enableSocialSharing",null,null,{defaultValue:b.isShorteningEnabled?"visible":"hidden",isPrivate:!0}),r.controlUpdated=new o,r.setTemplate(new nt(vr,{availableToLinkClass:function(n){return n?"":"nonClickable"},availableToShareButtonClass:function(n){return n?"shareButton":"shareButton nonClickable"},availableToButtonClass:function(n){return n?"textButton":" textButton nonClickable"},displayStateToLinkText:function(n){return n?t.L_LengthenButton_Text:t.L_ShortenButton_Text},errorMessageToVisibility:function(n){return n&&n.length>0?"visible":"hidden"},errorMessageToNotDisplay:function(n){return n&&n.length>0?"none":""},boolToDisplay:function(n){return n?"":"none"},boolToNotDisplay:function(n){return n?"none":""},onDlgKeydown:function(n){var t=n,i=t.keyCode||t.which;i===27&&r._rootElement.select("*[data-tag='Share.CloseButton']")[0].click()},resources:t})),r._keydownEventHandler=function(n){return r._onKeydownEvent(n)},n(".taskLayoutContainer").add_event("keydown",r._keydownEventHandler),r.rendered.addOne(function(n){var i=n||r,t;r._rootElement=i.getRootElement();t=document.execCommand&&window.clipboardData;t||r._rootElement.select("a[data-tag='Share.Copy']").set_style({visibility:"hidden"})}),r.dataContext=r,r._lvlParam="",r._cpParam="",r._setTwitterUrl(""),r._setFacebookUrl(""),r}return v(r,i),r.prototype.toggleLinkLength=function(n){this._isDisposed||(n.preventDefault(),this.getIsShortPermalinkDisplayed()?this._updateLongPermalink():this._updateShortPermalink())},r.prototype.copyToClipboard=function(n){this._isDisposed||(n.preventDefault(),this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select(),document.execCommand("Copy"))},r.prototype.openEmbedPage=function(n){if(!this._isDisposed){n.preventDefault();var t=b.embedPageUrl;this._lvlParam.length>0&&(t+="&"+this._lvlParam);this._cpParam.length>0&&(t+="&"+this._cpParam);t+="&form=LMLTEW";window.open(t,"EmbeddedMap");this._logEmbed(t)}},r.prototype.openEmail=function(n){var u=this,o,s,e,p,h,c,l,a;if(!this._isDisposed){n.preventDefault();o=t.L_Link_EmailTitleManyCards_Text;s=this._getOneCardShared();s!=null&&(o="Bing Maps: "+s.getTitle());var i="{0}\n",v=this._taskManager.getStacks(),f,r,y=0;for(e=0,p=v.length;e<p;e++)f=v[e],f&&f.getIsSelected()&&(r=f.getForegroundTask())&&(i+="{bullet}{0}\n".replace("{0}",r.getTitle()),(r.type==="LocalDetailsTask"||r.type==="PolygonEntityDetailsTask")&&(h=r.getOriginalName(),h&&(i+="{bullet}{0}\n".replace("{0}",h)),c=r.getNotes(),c&&(i+="{bullet}{0}\n".replace("{0}",c))),y++);i=i.replace(/{bullet}/g,y>1?" - ":"");i+="\n "+t.L_Link_EmailFooter_Text;l="mailto:?subject={0}&body={1}".replace("{0}",encodeURIComponent(o));a=function(){u._permalink.getCurrentLink(u._map,function(n){u._openEmail(n,l,i)},function(){window.console.log("Could not update permalink on the server, hence not showing email popup for stale content.")})};this.getIsShortPermalinkDisplayed()?this._permalink.shorten(function(n){u._openEmail(n,l,i)},a):a()}},r.prototype.openFacebook=function(n){if(!this._isDisposed){n.preventDefault();var i=this._getPopUpOptions(),t=this._getFacebookUrl();t&&(window.open(t,"",i),this._logSocialMedia(t,1))}},r.prototype.openTwitter=function(n){if(!this._isDisposed){n.preventDefault();var i=this._getPopUpOptions(),t=this._getTwitterUrl();t&&(window.open(t,"",i),this._logSocialMedia(t,2))}},r.prototype.setInitialData=function(n){n.container&&(this._container=n.container)},r.prototype.onSelectionChanged=function(n,t){if(!this._isDisposed&&this._selectedPermalinkParts&&this._selectedPermalinkParts[n]){if(this._selectedPermalinkParts[n].isEnabled=t,b.isShorteningEnabled){var i=this._permalink.isShorteningAvailable();this._privates.setEnableSharingVisibility(i?"visible":"hidden");this._privates.setEnableSocialSharing(i?"visible":"hidden")}this._updateLongPermalink()}},r.prototype.refresh=function(){var n=this;if(!this._container)throw"SharePanel cannot work without access to container";this._setState(1);this._permalink&&this._taskManager?this._recomputePanelDataAndUX():this._container.instanceAsyncAll([{name:"Permalink"},{name:"TaskManager"},{name:"Map"},{name:"ShareDataHandler"}],function(t){n._permalink=t.Permalink;n._taskManager=t.TaskManager;n._map=t.Map;n._currentSharingOptions=t.ShareDataHandler.currentSharingOptions;t.ShareDataHandler.currentSharingOptions=null;n._permalink.getGeneralPermalink(n._map,function(){return n._recomputePanelDataAndUX()},function(){n._resetSharePanelUX();n._setState(3)},n._currentSharingOptions.entryPoint)})},r.prototype._setTwitterUrl=function(n){this._twitterUrl=n},r.prototype._getTwitterUrl=function(){return this._twitterUrl},r.prototype._setFacebookUrl=function(n){this._facebookUrl=n},r.prototype._getFacebookUrl=function(){return this._facebookUrl},r.prototype._onKeydownEvent=function(t){var i=t,f=i.keyCode||i.which,r,u;f===9&&(r=this.getFirstTabbableChild(n(".taskLayoutContainer")[0]),u=this._rootElement.select("*[data-tag='Share.Email']")[0],i.target!==u||i.shiftKey?i.target===r&&i.shiftKey&&(u.focus(),i.preventDefault()):(r.focus(),i.preventDefault()))},r.prototype._trimEmailBodyIfNecessary=function(n,i,r){var u=i.replace("{0}",r),f=n.length+encodeURIComponent(u).length-3,e;return f>=w.maxIeUrlLength&&(e=f+t.L_Link_EmailFooter_Text.length+10-w.maxIeUrlLength,u=u.substr(0,u.length-e)+(" ...\n\n "+t.L_Link_EmailFooter_Text)),u},r.prototype._getOneCardShared=function(){for(var n,r=this._taskManager.getStacks(),t=null,i=0,u=r.length;i<u;i++)if(n=r[i],n&&n.getIsSelected()){if(t!=null)return null;t=n.getForegroundTask()}return t},r.prototype._recomputePanelDataAndUX=function(){var n=this;this._setState(1);this._recomputeDataModel(function(){n._resetSharePanelUX();b.isShorteningEnabled?n._updateShortPermalink():n._updateLongPermalink();var t=n._rootElement.select("*[data-tag='Share.UrlBox']")[0];t.focus();t.select()})},r.prototype.dispose=function(){i.prototype.dispose.call(this);n(".taskLayoutContainer").remove_event("keydown",this._keydownEventHandler);this._selectedPermalinkParts=null;this._taskManager=null;this._permalink=null;this._isDisposed=!0},r.prototype._recomputeDataModel=function(n){function h(n,t,i){n._permalink.getCurrentLink(n._map,function(u){var c,e,o,f,l,a,s;if(u&&u.length>=w.maxAllowedSharingLinkLength){c=n._findFarthestTaskId();n._selectedPermalinkParts[c].isEnabled=!1;h(n,!0,i);return}for(e=n._taskManager.getStacks(),o=n._taskManager.getFocusedStack(),f=0,l=e.length;f<l;f++)a=e[f].getForegroundTask().id,s=n._selectedPermalinkParts[a],e[f].setIsSelected(s&&s.isEnabled);o&&n._taskManager.focusTask(o.getForegroundTask().id);t==!0&&r.logError(u,3);i&&i()},function(){n._setState(3)})}var f,e,t,u,i,o;if(this._selectedPermalinkParts=this._permalink.getPermalinkParts(),this._currentSharingOptions&&this._currentSharingOptions.taskIds&&this._currentSharingOptions.taskIds.length>0)for(var s=Object.keys(this._selectedPermalinkParts),u=s.length,t=0;t<u;t++)f=s[t],this._currentSharingOptions.taskIds.indexOf(f)<0&&(this._selectedPermalinkParts[f].isEnabled=!1);for(e=this._taskManager.getStacks(),t=0,u=e.length;t<u;t++)i=e[t].getForegroundTask(),!i||i.isSharable()&&(i.type!=="CollectionsTask"||i.isPublicCollection())||(o=this._selectedPermalinkParts[i.id],o&&(o.isEnabled=!1));h(this,!1,n)},r.prototype._findFarthestTaskId=function(){for(var u,n=this._taskManager.getStacks(),o=this._taskManager.getFocusedStack(),e=0,t=0,s=n.length;t<s;t++)if(n[t]===o){e=t;break}for(var i=n.length-1,r=0,f=n[i].getForegroundTask().id;i>=e&&!this._selectedPermalinkParts[f]||!this._selectedPermalinkParts[f].isEnabled;)i--,f=n[i].getForegroundTask().id;for(u=n[r].getForegroundTask().id;r<=e&&!this._selectedPermalinkParts[u]||!this._selectedPermalinkParts[u].isEnabled;)r++,u=n[r].getForegroundTask().id;return t-r>i-t?u:f},r.prototype._resetSharePanelUX=function(){var u,i,t,f,r,e;if(this._privates.setHasAtLeastOneSharableStack(!1),this._rootElement.select(".svg").inlineDataSvgs().remove_class("svg"),this._setLightOrDark(this._map.getMode().mapModeType),u=this._map.getMode(),u.mapModeType===0)for(i=this._taskManager.getStacks(),t=0,f=i.length;t<f;t++)if(r=i[t],r&&(e=r.getForegroundTask())&&e.isSharable()){this._privates.setHasAtLeastOneSharableStack(!0);break}n(".taskLayoutContainer").select(".cardTitleText").set_attr("tabindex","-1")},r._getStackIndex=function(n,t,i){for(var u,r=0,f=t.length;r<f;r++)if(u=t[r],u&&(n!=null&&n==u.id||i!=null&&u.getForegroundTask().id==i))return r;return-1},r.prototype._updateLongPermalink=function(){var n=this,t;if(this._setState(1),this._selectedPermalinkParts==null){this.refresh();return}t=this._permalink.getCurrentLink(this._map,function(t){t.length>=w.maxAllowedSharingLinkLength?(n._setState(2),r.logError(t,2)):(n._privates.setPermalinkString(t),n._setTempParamValues(t),n._createSocialMediaLink(t),n._privates.setIsShortPermalinkDisplayed(!1),n._setState(0))},function(){n._setState(3);r.logError("",4)})},r.prototype._updateShortPermalink=function(){var n=this;this._currentState!=2&&(this._setState(1),this._permalink.shorten(function(t,i){n._privates.setEnableSharingVisibility("visible");n._privates.setIsShortPermalinkDisplayed(!0);n._privates.setPermalinkString(t);n._createSocialMediaLink(t);i&&n._setTempParamValues(i);n._setState(0)},function(){n._privates.setEnableSharingVisibility("hidden");n._updateLongPermalink();r.logError("",1)}))},r.prototype._setState=function(n){this._currentState=n;switch(n){case 0:this._privates.setErrorMessage("");this._privates.setSharingLinkAvailable(!0);this._privates.setEnableSocialSharing(b.isShorteningEnabled?"visible":"hidden");this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select();break;case 1:this._privates.setErrorMessage("");this._privates.setSharingLinkAvailable(!1);this._privates.setPermalinkString(t.L_Link_Generating_Text);break;case 2:this._privates.setSharingLinkAvailable(!1);this._privates.setIsShortPermalinkDisplayed(!1);this._privates.setPermalinkString("");this._privates.setErrorMessage(t.L_Link_TooManyItemsSelected_Text);this._privates.setEnableSocialSharing("hidden");break;default:this._privates.setErrorMessage(t.L_Link_GenerationFailed_Text);this._privates.setIsShortPermalinkDisplayed(!1);this._privates.setSharingLinkAvailable(!1);this._privates.setPermalinkString("");this._privates.setEnableSocialSharing("hidden");this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select()}this.controlUpdated.invoke({state:n,control:this})},r.prototype._logEmail=function(n){var t={PL:n};w.instLog(rt.EC,t)},r.prototype._logEmbed=function(n){var t={PL:n};w.instLog(rt.EMC,t)},r.prototype._logSocialMedia=function(n,t){var i={PL:n},r=t==1?rt.FB:rt.TW;w.instLog(r,i)},r.logError=function(n,t){var i={PL:n,ERR:t};w.instLog(rt.SEW,i)},r.prototype._setLightOrDark=function(n){var i=!0,r=this._rootElement.select(".header"),u="dark",t;n===0&&(t=this._map.getMapType().id,i=t===p.aerial||t===p.birdseye);i?r.add_class(u):r.remove_class(u)},r.prototype._setTempParamValues=function(n){var t=/lvl=([^&]*)/ig.exec(n),i=/cp=([^&]*)/ig.exec(n),r=/style=[o|b]&/ig.exec(n);t&&t.length&&(this._lvlParam=t[0]);i&&i.length&&(this._cpParam=i[0])},r.prototype._createSocialMediaLink=function(n){var t,i;n?(t=b.twitterShareUrl.replace("{text}","").replace("{related}",encodeURIComponent("BingMaps,Bing")),this._setTwitterUrl(t.replace("{url}",encodeURIComponent(n))),i=b.facebookShareUrl.replace("{facebookpage}",encodeURIComponent(b.facebookRedirectUrl)),this._setFacebookUrl(i.replace("{url}",encodeURIComponent(n)))):this._privates.setEnableSocialSharing("hidden")},r.prototype._getPopUpOptions=function(){var n=(screen.availWidth-r._popupWidth)/2,t=(screen.availHeight-r._popupHeight)/2;return"width="+r._popupWidth+",height="+r._popupHeight+",screenX="+n+",screenY="+t+",left="+n+",top="+t+",status,scrollbars,resizable"},r.prototype._openEmail=function(n,t,i){i=this._trimEmailBodyIfNecessary(t,i,n);this._logEmail(n);window.location.href=t.replace("{1}",encodeURIComponent(i))},r._minEmbedHeight=530,r._minEmbedWidth=800,r._popupWidth=550,r._popupHeight=420,r}(ot);nt.registerControl("SharePanel",gr);var nu=function(t){function i(n,i,r,u){var f=this,e={};return f=t.call(this,yr,"shareContainer",{emailClick:function(n){return f._onEmailClick(n)},shortenClick:function(n){return f._onShortenClick(n)}},e)||this,e.defineProperty("permalinkString"),e.defineProperty("shortenButtonText"),f._permalink=u,f._map=n,f._taskManager=r,f.setPermalinkString(f.resources.L_Link_Generating_Text),f.setShortenButtonText(f.resources.L_ShortenButton_Text),f._isShortLinkDisplayed=!1,f.getRootElement().set_attr("data-tag","Share.Container"),f}return v(i,t),i.prototype._onPermalinkSuccess=function(t){b.isShorteningEnabled&&t.queryParameters?(n(".shareUrlShortenLink").add_class("visible"),this._permalinkResponse=t,this._makeShortenRequest(t)):this.setPermalinkString(t.permalink)},i.prototype._onPermalinkFail=function(){this.setPermalinkString(this.resources.L_Link_GenerationFailed_Text)},i.prototype._makeShortenRequest=function(n){var t=this,i=n.queryParameters,r;i.charAt(0)==="?"&&(i=n.queryParameters.substr(1));r=w.getShortenServiceUrl(i);gi.downloadJson(r,"sharedlg",function(n){t._shortPermalink=n.d;t._onShortenClick(null)},function(){t.setShortenButtonText(t.resources.L_ShortenButton_Text);t.setPermalinkString(t._permalinkResponse.permalink);t._isShortLinkDisplayed=!1})},i.prototype._onEmailClick=function(n){n&&n.preventDefault&&n.preventDefault();var t=this.getPermalinkString(),i={PL:t};window.location.href="mailto:?body="+encodeURIComponent(t);w.instLog(rt.EC,i)},i.prototype._onShortenClick=function(n){n&&n.preventDefault&&n.preventDefault();this._isShortLinkDisplayed?(this.setPermalinkString(this._permalinkResponse.permalink),this.setShortenButtonText(this.resources.L_ShortenButton_Text),this._isShortLinkDisplayed=!this._isShortLinkDisplayed):this._shortPermalink?(this.setPermalinkString(this._shortPermalink),this.setShortenButtonText(this.resources.L_LengthenButton_Text),this._isShortLinkDisplayed=!this._isShortLinkDisplayed):(this.setPermalinkString(this.resources.L_Link_Generating_Text),this._makeShortenRequest(this._permalinkResponse))},i.prototype.show=function(n){var t=this;this.OpenDialog();this._permalink.getGeneralPermalink(this._map,function(n){return t._onPermalinkSuccess(n)},function(){return t._onPermalinkFail()},n)},i}(lt),ei=function(){function n(){}return n}(),tu=function(i){function r(n,t,r,u,f){var e=this;return e=i.call(this,{},f,u)||this,e._slideOutMenu=n,e._container=t,e._map=r,e._initializeMenuItems(),e}return v(r,i),r.prototype.showMenu=function(){this._initMapTypeSelector();this.getControl().add_class("opened")},r.prototype.hideMenu=function(){this.getControl().remove_class("opened")},r.prototype.clickBackgroundHandler=function(){this.hideMenu()},r.prototype._clickHandler=function(){this.hideMenu()},r.prototype._initializeMenuItems=function(){this.menuItems=[];this._createAndAddDirectionsMenu();this._createAndAddTrafficMenu();this._createAndAddMapTypeMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddSeeAllCardsMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddBingHomeMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddFeedbackExitPreivewMenu()},r.prototype._createMenuSeparater=function(){var n=new ei;return n.type="menuSeparater",n},r.prototype._createMenuItem=function(n,t,i,r){var f=this,u;return i===void 0&&(i=undefined),r===void 0&&(r=!1),u=new ei,u.type="menuItem",u.name=n,u.cssClass=t,u.clickHandler=function(n){n.preventDefault();i&&i();r||f._clickHandler()},u},r.prototype._createAndAddMenuItem=function(n,t,i,r){i===void 0&&(i=undefined);r===void 0&&(r=!1);var u=this._createMenuItem(n,t,i,r);return this.menuItems.push(u),u},r.prototype._createAndAddDirectionsMenu=function(){this._createAndAddMenuItem(t.L_TaskBar_Label_Directions,"directionsMenu",function(){var n={type:c.directionsTask,state:{entryPoint:8}};e.invokeHandler(f.taskDataHandlerKey,n)})},r.prototype._createAndAddTrafficMenu=function(){var n=this;this._container.instanceAsync("TrafficLayerV2",function(t){n._trafficLayer=t;t&&n._showTrafficLayerAfterInstantiation&&t.show(4)});this._createAndAddMenuItem(t.L_TaskBar_Label_Traffic,"trafficMenu",function(){n._map.getMapType().id!==p.birdseye&&(n._trafficLayer?n._trafficLayer.toggle(4):n._showTrafficLayerAfterInstantiation=!0)})},r.prototype._createAndAddMapTypeMenu=function(){var n=this;this._createAndAddMenuItem(t.L_SlideOutMenu_MapType,"mapMenu",null,!0);this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Road,"mapTypeItem",function(){n._changeMapType(p.road)});this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Aerial,"mapTypeItem",function(){n._changeMapType(p.aerial)});this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Birdseye,"mapTypeItem",function(){n._changeMapType(p.birdseye)})},r.prototype._createAndAddSeeAllCardsMenu=function(){this._createAndAddMenuItem(t.L_SlideOutMenu_SeeAllCards,"allCardsMenu",function(){e.invokeHandler(f.layoutDataHandlerKey,{action:"updateLayout",state:{layoutType:"listView"}})})},r.prototype._createAndAddBingHomeMenu=function(){this._createAndAddMenuItem(t.L_SlideOutMenu_BingHome,"homeMenu",function(){window.location.href="/"})},r.prototype._createAndAddFeedbackExitPreivewMenu=function(){var i=this,r=this._createAndAddMenuItem(t.L_SlideOutMenu_Feedback,"feedbackMenu",function(){var n={type:c.feedbackTask,state:{entryPoint:5,feedbackTaskType:1,activeTaskId:null,title:t.L_SlideOutMenu_Feedback}};e.invokeHandler(f.taskDataHandlerKey,n)}),n;r.htmlId="sli_feedback";n=this._createAndAddMenuItem(t.L_SlideOutMenu_ExitPreview,"exitMenu",function(){i._slideOutMenu.exitPreview.invoke()});n.htmlId="sli_exit"},r.prototype._changeMapType=function(n){this._map.getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(n);var t=this._map.getMapTypes()[n];if(t)this._map.setBaseLayers(t);else throw"Invalid map type id"+n;},r.prototype._initMapTypeSelector=function(){var t=this._map.getMapType().id,n=-1,i;t===p.road?n=0:t===p.aerial?(i=this._map.getNavigationBar(),n=i&&i.getAerialBirdsEyeTransitionManager().hasRequestedBirdsEye()?2:1):t===p.birdseye&&(n=2);n>=0&&this._selectMapType(n)},r.prototype._selectMapType=function(t){var i=n(".mapTypeItem");i.length==3&&(i.remove_class("selected"),n(i[t]).add_class("selected"))},r}(kt),oi=function(){function n(n,t,i){this._viewModel=new tu(this,n,t,hr,i);this.exitPreview=new o;var u=this._viewModel.getControl(),r=t.getRootElement();r.getParent().insertBefore(u,r);Feedback.Bootstrap.InitializeFeedback({structured:!0},"sli_feedback",!1,!0,!1);Feedback.Bootstrap.InitializeFeedback({structured:!0},"sli_exit",!1,!0,!1)}return n.prototype.showMenu=function(){this._viewModel.showMenu()},n}(),iu=function(n){function i(){var r=this,o={},f,s,e,h,i;if(r=n.call(this,o)||this,o.defineProperty("categoryList"),o.defineProperty("checkCount"),o.defineProperty("dropdownButtonName"),o.defineProperty("showCreateAlertButton"),o.defineProperty("showImage"),r.setCheckCount(0),f=u.categoryLayers,s=[],f)for(e=0,h=f.length;e<h;e++){switch(f[e]){case"school":i=new ut(t.L_CategoryLayer_Schools,f[e]);i.setIcon("schoolsIcon");break;case"transit":i=new ut(t.L_CategoryLayer_Transit,f[e]);i.setIcon("transitIcon");break;case"commutability":i=new ut(t.L_CategoryLayer_Commutability,f[e]);i.setIcon("commuteIcon");break;case"coffee":i=new ut("Coffee",f[e]);break;case"grocery":i=new ut("Grocery Stores",f[e]);break;case"gasstation":i=new ut("Gas Stations",f[e]);break;case"attraction":i=new ut("Attractions",f[e])}i&&(i.onCheckedChanged.add(function(n){r._updateCheckCount(n)}),s.push(i))}return r.setCategoryList(s),r.setDropdownButtonName(t.L_CategoryLayerDropdownButton.replace("{0}","")),r.setShowCreateAlertButton(u.showCreateAlertUIForRealEstate),r.dropdownTitle=t.L_CategoryLayerDropdownTitle,r.setTemplate(new nt(cr,{boolToDisplay:function(n){return r._boolToDisplay(n)},itemCheckedClass:function(n){return r._itemCheckedClass(n)},countClassConverter:function(n){return r._countClassConverter(n)}})),r}return v(i,n),i.prototype.setRecommendedCategories=function(n){for(var t,u,i,f=this.getCategoryList(),e=n.length,r=0,o=f.length;r<o;r++){for(t=f[r],u=!1,i=0;i<e;i++)if(t.getCategory()===n[i]){t.setRecommended(!0);u=!0;break}u||t.setRecommended(!1)}},i.prototype.clearCategories=function(){for(var t=this.getCategoryList(),n=0,i=t.length;n<i;n++)t[n].setChecked(!1);this.setCheckCount(0);e.invokeHandler(f.layerManagerDataHandlerKey,{action:"removeAllLayers"})},i.prototype._countClassConverter=function(n){return n>0?"someCategoriesPadding":"noCategoriesPadding"},i.prototype._boolToDisplay=function(n){return n?"":"none"},i.prototype._itemCheckedClass=function(n){return"multiselectCheckbox"+(n?" checked":"")},i.prototype._updateCheckCount=function(n){var i=this.getCheckCount();n?i++:i--;this.setCheckCount(i);this.setDropdownButtonName(t.L_CategoryLayerDropdownButton.replace("{0}",i===0?"":"("+i+")"))},i}(ot);nt.registerControl("CategoryDropdown",iu);var ut=function(n){function t(t,i){var r=this,u={};return r=n.call(this,t,u)||this,u.defineProperty("category"),u.defineProperty("recommended"),r.setCategory(i),r.onCheckedChanged.add(function(n){r._onCheckedChanged(n)}),r}return v(t,n),t.prototype._onCheckedChanged=function(n){n?this._makeActivateLayerRequest(this.getCategory()):this._makeRemoveLayerRequest(this.getCategory())},t.prototype._makeActivateLayerRequest=function(n){e.invokeHandler(f.layerManagerDataHandlerKey,{action:"activateLayer",category:n,entryPoint:l.TaskBar});var t={logData:{feature:it.ShowMeCategoryLayers,action:d.Clicked,data:{Cat:n,S:!0}}};e.invokeHandler(f.instrumentationDataHandlerKey,t)},t.prototype._makeRemoveLayerRequest=function(n){e.invokeHandler(f.layerManagerDataHandlerKey,{action:"removeLayer",category:n,entryPoint:l.TaskBar});var t={logData:{feature:it.ShowMeCategoryLayers,action:d.Clicked,data:{Cat:n,S:!1}}};e.invokeHandler(f.instrumentationDataHandlerKey,t)},t}(bi),et=function(){function t(){}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.initialize=function(){if(!this.initialized){n(".bm_contextualAndShowMe").add_class("enabled");var t=n("#bm_categoryLayerDropdownContainer");this._categoryDropdownControl=nt.createControl("CategoryDropdown");t.append(this._categoryDropdownControl.getRootElement());t.add_class("enabled");this.initialized=!0;h._isSmallMapShownOnSerp()&&n("#MicrosoftNav").add_class("OnSerp")}},t.prototype.setRecommendedCategories=function(n){n&&n.length>0&&this.initialize();this._categoryDropdownControl&&this.initialized&&this._categoryDropdownControl.setRecommendedCategories(n)},t.prototype.clearCategories=function(){this._categoryDropdownControl&&this.initialized&&this._categoryDropdownControl.clearCategories()},t}(),wt=function(){function t(){this._taskIdToContextualTaskbarMapping={}}return t.prototype.isEnabled=function(){return!0},t.prototype.initialize=function(n){this._map=n;!this._initialized&&this.isEnabled()&&(this._initialized=!0)},t.prototype.hasContent=function(){return this._currentContextualTaskbar&&this._currentContextualTaskbar.length!==0},t.prototype.getContainer=function(){return this._contextualTaskbarContainer||n("#"+this._contextualTaskBarContainerId)},t.prototype.showOrHideContainer=function(){var n=this.getContainer();n.set_style({display:this.hasContent()?"":"none"})},t.prototype.onCardFocusHandler=function(n){return this._populateTaskbar(n)},t.prototype.onCardRefreshHandler=function(n,t,i){return n&&n===i?(delete this._taskIdToContextualTaskbarMapping[i],this._populateTaskbar(t,i)):null},t.prototype.onAllTaskStacksRemovedHandler=function(){this._currentContextualTaskbar&&(this._currentContextualTaskbar.removeFromParent(),this._currentContextualTaskbar=null)},t.prototype.removeCurrentContextualTaskBar=function(){var n=this._currentContextualTaskbar;return this._currentContextualTaskbar&&(this.removeContextualTaskBar(this._currentTaskId),this._currentContextualTaskbar.removeFromParent(),this._currentContextualTaskbar=null,this._currentTaskId=null),n!==null},t.prototype.removeContextualTaskBar=function(n){delete this._taskIdToContextualTaskbarMapping[n]},t.prototype.getContextualTaskBlock=function(n){return n.select("#"+this._contextualTaskBarId)},t.prototype.handleInitialCardSetup=function(){return},t.prototype.refreshBarStyle=function(){return},t.prototype._populateTaskbar=function(t,i){var s=this,o=null;if(this._contextualTaskbarContainer=this.getContainer(),t&&this._contextualTaskbarContainer){var e=i||t.get_attr("data-taskid"),f=this.getContextualTaskBlock(t),u=this._taskIdToContextualTaskbarMapping[e],r=void 0;u?u===f||f[0]===u[0]?r=u:u.length>0&&f.length===0?r=u:u[0]!==f[0]&&(r=f):(r=f,this.handleInitialCardSetup(t));this._taskIdToContextualTaskbarMapping[e]=r;r!==this._currentContextualTaskbar&&(this._currentContextualTaskbar&&this._currentContextualTaskbar.removeFromParent(),r&&(this._currentContextualTaskbar=r,this._currentTaskId=e,o=e,this._currentContextualTaskbar.getParent()!==this._contextualTaskbarContainer&&(this._currentContextualTaskbar.removeFromParent(),this._currentContextualTaskbar.set_style({display:""})),this._contextualTaskbarContainer.append(this._currentContextualTaskbar),this.refreshBarStyle(),sj_evt.fire("filterattached")))}return n(window).add_event("resize",function(n){s._onResizeHandler(n)}),o},t.prototype._updateCategoryIconAfterDownload=function(n,t){this._selectorReady().then(function(i){i.getCategoryIconTemplate(function(n){if(n){var i=n.renderIcon();i&&(t.clear(),t.remove_class("hidden"),t.append(i))}},n,null,25,25)})},t.prototype._selectorReady=function(){var n=this;return this._baseMapTemplateSelector?this._baseMapTemplateSelector.selectorReady():this._map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._baseMapTemplateSelector.selectorReady()})},t.prototype._onResizeHandler=function(n){this.refreshBarStyle();n.preventDefault},t}(),si=function(t){function i(){var n=t.call(this)||this;return n._contextualTaskBarId="bm_categoriesBar",n._contextualTaskBarContainerId="bm_directionsTaskbarContainer",n}return v(i,t),i.getInstance=function(){return i._instance||(i._instance=new i),i._instance},i.prototype.isEnabled=function(){return u.directionsSearchEnabled},i.prototype.handleInitialCardSetup=function(){this._addXSRIcons()},i.prototype.refreshBarStyle=function(){this._addXSRIcons()},i.prototype.getContextualTaskBlock=function(n){return n.select("."+this._contextualTaskBarId)},i.prototype._addXSRIcons=function(){var e=n("."+this._contextualTaskBarId),r,i,t,u,f,o;if(e.length>0&&(r=n(".categories",e[0]),r.length>0))for(i=n(".category",r[0]),t=0;t<i.length;t++)u=n(i[t].querySelector("a")),f=u.length>0?u.get_attr("data-category"):null,f&&(o=n(".bm_itemImage",i[t]),this._updateCategoryIconAfterDownload(f,o))},i}(wt),hi=function(n){function i(i,r,u,f,e,s,h){var c=this,l={},v,a;return c=n.call(this,l)||this,l.defineProperty("title"),l.defineProperty("signInTitle"),l.defineProperty("messageLines"),l.defineProperty("isFaded"),l.defineProperty("isHidden"),l.defineProperty("showClose"),l.defineProperty("showBeak"),l.defineProperty("isDark"),l.defineProperty("preLink"),l.defineProperty("link"),l.defineProperty("postLink"),h?u&&u.length&&(c._linkMessage=u[0],c._parseLinkMessage()):c.setMessageLines(u),c.setTitle(r),c.setShowClose(!0),c.setShowBeak(!1),c.setIsDark(s),c.resources=t,c.tipRemoved=new o,c.signedIn=new o,c.messageLinkClicked=new o,c._map=i,c._autoFadeHandlers=[],v=c._createTemplate(),c.setTemplate(v),c._tipElement=c.getRootElement(),a=function(){window.clearTimeout(c._fadeTimeout);c._tipElement&&c.removeTip()},f||(c._map&&(c._autoFadeHandlers.push(c._map.mapPanStarted.addOne(a)),c._autoFadeHandlers.push(c._map.mapTapped.addOne(a)),c._autoFadeHandlers.push(c._map.mapZoomStarted.addOne(a))),c._fadeTimeout=Microsoft.Maps.setTimeout(function(){c._tipElement&&c.fadeTip()},4e3)),e&&(c._windowClickEventHandler=function(n){var i=n.target,t=c.getRootElement();t&&t.has(i)||Microsoft.Maps.setTimeout(function(){c.removeTip()},1)},Microsoft.Maps.setTimeout(function(){window.addEventListener("click",c._windowClickEventHandler)},1)),c}return v(i,n),i.prototype.fadeTip=function(){var n=this;this.setIsFaded(!0);Microsoft.Maps.setTimeout(function(){n.removeTip()},1e3)},i.prototype.removeTip=function(){this._tipElement&&this._tipElement.removeFromParent();this._tipElement=null;this.tipRemoved&&this.tipRemoved.invoke();window.removeEventListener("click",this._windowClickEventHandler);this.dispose()},i.prototype.dispose=function(){h._clearDisposables(this._autoFadeHandlers);n.prototype.dispose.call(this)},i.prototype._createTemplate=function(){var n=this;return new nt(wr,{boolToDisplay:function(t){return n._boolToDisplay(t)},boolToNotDisplay:function(t){return n._boolToDisplay(!t)},boolToFadedClass:function(t){return n._boolToFadedClass(t)},nullToDisplayNone:function(t){return n._nullToDisplayNone(t)},closeClicked:function(t){t.preventDefault();n.removeTip()},onSignedIn:function(){n.signedIn.invoke();n.removeTip()},onTipHoverOver:function(n){n&&n.stopPropagation();n&&n.preventDefault()},onTipHoverOut:function(n){n&&n.stopPropagation();n&&n.preventDefault()},onLinkClicked:function(t){t&&t.stopPropagation();t&&t.preventDefault();n.messageLinkClicked.invoke();n.removeTip()}})},i.prototype._boolToDisplay=function(n){return n?"":"none"},i.prototype._boolToFadedClass=function(n){return"bm_tooltips"+(this.getIsDark()?" dark":"")+(n?" reminderHiddenFade":"")},i.prototype._nullToDisplayNone=function(n){return n?"":"none"},i.prototype._parseLinkMessage=function(){var n=this._linkMessage,t,i,r;n&&(t=n.indexOf("<link>"),t!==-1&&(i=n.slice(0,t),i&&this.setPreLink(i),n=n.substr(t).replace("<link>",""),t=n.indexOf("<\/link>"),r=n.slice(0,t),r&&this.setLink(r),n=n.substr(t).replace("<\/link>",""),n&&this.setPostLink(n)))},i}(ot),ru=function(n){function i(i,r,u){var f=this,e=[t.L_Tooltip_Itinerary_Saved_Text];return f=n.call(this,i,"",e,!1,!0,!0)||this,f.separator=" "+String.fromCharCode(183)+" ",f._privates.defineProperty("name",null,null,{defaultValue:u}),f._privates.defineProperty("showEditName",null,null,{defaultValue:!1}),f._relatedTaskId=r,f.setShowClose(!1),f.setShowBeak(!0),f}return v(i,n),i.prototype._createTemplate=function(){var n=this;return new nt(pr,{boolToDisplay:function(t){return n._boolToDisplay(t)},boolToNotDisplay:function(t){return n._boolToDisplay(!t)},boolToFadedClass:function(t){return n._boolToFadedClass(t)},nullToDisplayNone:function(t){return n._nullToDisplayNone(t)},closeClicked:function(t){t.preventDefault();n.removeTip()},renameClicked:function(t){t.preventDefault();n._onRenameClick()},onKeyPressed:function(t){t.keyCode===13&&n._onSaveLinkClick()},onSaveLinkClick:function(t){t.preventDefault();n._onSaveLinkClick()}})},i.prototype._onRenameClick=function(){window.clearTimeout(this._fadeTimeout);h._clearDisposables(this._autoFadeHandlers);var n=this.getRootElement().select(".nameEditBox");n&&n.length&&(n[0].value=this.getName());this.setIsDark(!1);this.setShowEditName(!0);this.setShowClose(!0);window.removeEventListener("click",this._windowClickEventHandler)},i.prototype._onSaveLinkClick=function(){var n=this.getRootElement().select(".nameEditBox"),t=n&&n.length&&n[0].value,i,r;t&&(i={action:6,title:t},r={type:c.itineraryDetailsTask,requestState:i,taskId:this._relatedTaskId},e.invokeHandler(f.taskProcessDataHandlerKey,r));this.fadeTip()},i}(hi),ci=function(t){function i(){var n=t.call(this)||this;return n._contextualTaskBarId="bm_contextualTaskbar",n._contextualTaskBarContainerId="bm_contextualTaskbarContainer",n}return v(i,t),i.getInstance=function(){return i._instance||(i._instance=new i),i._instance},i.prototype.refreshBarStyle=function(){var t=n(".bm_filterBar"),i,r,u;t.length>0&&(i=t.get_attr("seg"),r=window.innerWidth,i&&i.toLowerCase().indexOf("hotel")>-1?r&&r<=1340&&(u=n(".ftrH",t[0]),u.length===3?t.set_style({"min-width":"1340px"}):t.set_style({"min-width":"1260px"})):i&&i.toLowerCase().indexOf("restaurant")>-1?t.set_style({"min-width":"690px"}):t.set_style({"min-width":""}))},i}(wt),li=function(t){function i(){var n=t.call(this)||this;return n._contextualTaskBarId="bm_relatedSearchesTaskbar",n._contextualTaskBarContainerId="bm_relatedSearchesTaskbarContainer",n}return v(i,t),i.getInstance=function(){return i._instance||(i._instance=new i),i._instance},i.prototype.isEnabled=function(){return u.relatedSearchesEnabled},i.prototype.handleInitialCardSetup=function(n){t.prototype.handleInitialCardSetup.call(this,n);this.logRelatedSearchesShownEvent(n);this.hideRecommendedSearches(n);this._getCategoryIconsForButtons()},i.prototype.refreshBarStyle=function(){this._getCategoryIconsForButtons()},i.prototype.hideRecommendedSearches=function(n){if(n&&n.length>0){var t=n.select(".bm_relatedSearchesTaskbar"),i=t.get_attr("data-keyword");i&&n.select(".searchSuggestionModule").set_style({display:"none"})}},i.prototype.logRelatedSearchesShownEvent=function(n){var o;if(n&&n.length>0){var t=n.select(".bm_relatedSearchesTaskbar"),r=t.get_attr("data-keyword"),u=t.get_attr("data-suggestions");r&&u&&(o={logData:{feature:i.featureName,action:i.actionName,data:{KEY:r,SUGG:u}},isMapsAction:!0},e.invokeHandler(f.instrumentationDataHandlerKey,o))}},i.prototype._getCategoryIconsForButtons=function(){var h=n("#bm_relatedSearchesTaskbar"),c=h.get_attr("data-categories"),t=c?c.split("~"):"",i,r,l,u,f,e,o,s;if(t&&t.length>0&&(i=n(".bm_relatedSearch",h[0]),i.length>0))for(r=0;r<t.length;r++)for(l=t[r],u=l.split("-"),f=0;f<i.length;f++)e=n(i[f]),o=e.get_attr("data-keyword").match(u[0]),o&&o.length>0&&wi.getBucketForCategory(u[1])&&(s=n(".bm_itemImage",e[0]),s.length>0&&this._updateCategoryIconAfterDownload(u[1],s))},i.featureName="RSTB",i.actionName="DSP",i}(wt),uu=function(){function t(){this._taskIdToRecommendedLayers={}}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.initialize=function(n){this._initialized||(this._map=n,this._barManagers=[],this._addToBarManager(ci.getInstance()),this._addToBarManager(li.getInstance()),u.directionsSearchEnabled&&this._addToBarManager(si.getInstance()),this._initialized=!0,this._subscribeToTaskFocusEvent())},t.prototype._addToBarManager=function(n){n&&n.isEnabled()&&(n.initialize(this._map),this._barManagers.push(n))},t.prototype._subscribeToTaskFocusEvent=function(){var t=this;typeof sj_evt!="undefined"&&(sj_evt.bind("OnCardFocus",function(n){t.onCardFocusHandler(n&&n[1])}),sj_evt.bind("OnCardRefresh",function(n){if(n)t.onCardRefreshHandler(n[2],n[1])}),sj_evt.bind("OnAllTaskStacksRemoved",function(){t.onAllTaskStacksRemovedHandler()}),sj_evt.bind("OnTaskStackRemoved",function(n){t.onTaskStackRemovedHandler(n)}),sj_evt.bind("HideContextualTaskbar",function(){n(".bm_contextualAndShowMe").set_style({display:"none"})}),sj_evt.bind("ShowContextualTaskbar",function(){n(".bm_contextualAndShowMe").set_style({display:""})}))},t.prototype.onCardFocusHandler=function(n){for(var i,r=!1,t=0;t<this._barManagers.length;t++)i=this._barManagers[t].onCardFocusHandler(n),i&&!r&&(this._currentTaskId=i,r=!0);this._promoteMapLayersInTaskBar(n);this.adjustElements()},t.prototype.onCardRefreshHandler=function(n,t){var r,i,u;if(n&&n===this._currentTaskId){for(delete this._taskIdToRecommendedLayers[this._currentTaskId],r=!1,i=0;i<this._barManagers.length;i++)u=this._barManagers[i].onCardRefreshHandler(n,t,this._currentTaskId),u&&!r&&(this._currentTaskId=u,r=!0);this._promoteMapLayersInTaskBar(t,this._currentTaskId)}this.adjustElements()},t.prototype.onAllTaskStacksRemovedHandler=function(){for(var n=0;n<this._barManagers.length;n++)this._barManagers[n].onAllTaskStacksRemovedHandler();this.adjustElements();this._currentTaskId=null;et.getInstance().setRecommendedCategories([])},t.prototype.onTaskStackRemovedHandler=function(n){var t=n&&n[1];t&&(t.id===this._currentTaskId?this.removeCurrentContextualTaskBar():this.removeContextualTaskBar(t.id),this.adjustElements())},t.prototype.removeContextualTaskBar=function(n){for(var t=0;t<this._barManagers.length;t++)this._barManagers[t].removeContextualTaskBar(n)},t.prototype.removeCurrentContextualTaskBar=function(){for(var n=!1,t=0;t<this._barManagers.length;t++)n=this._barManagers[t].removeCurrentContextualTaskBar()||n;n&&(delete this._taskIdToRecommendedLayers[this._currentTaskId],this._currentTaskId=null,et.getInstance().setRecommendedCategories([]))},t.prototype._promoteMapLayersInTaskBar=function(n,t){if(n){var r=t||n.get_attr("data-taskid"),i=this._taskIdToRecommendedLayers[r];i||(i=this._getMapLayers(n)||[]);et.getInstance().setRecommendedCategories(i);this._taskIdToRecommendedLayers[r]=i}},t.prototype._getMapLayers=function(n){var r,t,i;return n&&(t=n.select("div[data-maplayers]"),t&&t.length&&(i=t.get_attr("data-maplayers"),i&&(r=i.split(",")))),r},t.prototype.adjustElements=function(){for(var u,s,h,l,c,r=null,t=null,f=null,i=!1,e=n(".toggleButton"),o=0;o<this._barManagers.length;o++)u=this._barManagers[o],u instanceof ci?r=u:u instanceof li?t=u:u instanceof si&&(f=u);r&&(i=r.hasContent(),r.showOrHideContainer());t&&(s=t.hasContent(),t.showOrHideContainer(),h=t.getContainer(),!i&&s?h.add_class("relatedSearchOnly"):h.remove_class("relatedSearchOnly"),i=i||s);f&&(l=f.hasContent(),f.showOrHideContainer(),i||(r&&!r.hasContent()&&r.getContainer().set_style({display:"none"}),t&&!t.hasContent()&&t.getContainer().set_style({display:"none"})),i=i||l);c=e&&e.getParent().has_class("slideout");i||et.getInstance().initialized?(n(".taskLayoutContainer").add_class("WithContextualTaskBar"),n("#MicrosoftNav").add_class("WithContextualTaskBar"),c||e.add_class("noSlideout")):(n(".taskLayoutContainer").remove_class("WithContextualTaskBar"),n("#MicrosoftNav").remove_class("WithContextualTaskBar"),c||e.remove_class("noSlideout"))},t}(),bt=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,t.defineProperty("isActive"),t.defineProperty("cssClass"),t.defineProperty("dataTag"),t.defineProperty("showLabel"),t.defineProperty("popoutClass"),t.defineProperty("ariaExpanded"),i.url="#",i}return v(t,n),t}(nr),tt=function(i){function r(f,e,c,l,a){var v=this,y={},w;return v=i.call(this,y,l,c)||this,y.defineProperty("searchTerm"),y.defineProperty("className"),y.defineProperty("asExpanded"),y.defineProperty("selectedSuggestionId"),y.defineProperty("isOnVertical"),v._isMapsAnswer=Microsoft&&Microsoft.Maps&&Microsoft.Maps.GlobalConfig&&Microsoft.Maps.GlobalConfig.isMapsAnswer,u.fullScreen=v._isMapsAnswer?!1:u.fullScreen,v._minimumActionButtonsWidth=u.minimumActionButtonsWidth,v._maxIdControlsWidth=u.maxIdControlsWidth,v._minIdControlsWidth=u.minIdControlWidth,v._searchBoxWidth=u.searchBoxWidth,v._navButtonWidth=u.navButtonWidth,v._minSearchBoxWidth=u.minSearchBoxWidth,v._searchButtonWidth=u.searchButtonWidth,v._noTextBuffer=u.taskbarTextBuffer,v._resizeBuffer=u.taskBarResizeBuffer,v._maxActionButtonsWidth=u.maximumActionButtonsWidth,v._searchBoxLeftBuffer=u.taskbarLeftBuffer,v._rightTaskbarBuffer=u.taskbarRightBuffer,v._smallSearchControlsWidth=v._minSearchBoxWidth,v._fullSearchControlsWidth=v._searchBoxWidth,v.setClassName("taskBar"),v.setSearchTerm(""),v._taskManager=a,v.taskBarItems=[],r._taskItems=[],v.createTaskItems(),v._map=e,r._staticMap=e,u.alwaysShowHomeWork&&v.setUpAlwaysOnPoi(),v._container=f,v.launchFeedbackMenu=new o,v.hideFeedbackMenu=new o,v.focusFeedback=new o,v.exitFullScreen=new o,v.exitFullScreen.add(function(){return r.exitFullScreen()}),v.setAsExpanded(!1),v._map&&(v.disposables.push(v._map.viewChanged.add(function(){s.tileRefactoringEnabled&&v._map.isPanning()||v.mapInteractedEvent()})),v.disposables.push(v._map.mapTapped.add(function(){return v.mapInteractedEvent()})),v.disposables.push(v._map.mapZoomStarted.add(function(){return v.mapInteractedEvent()})),v.disposables.push(v._map.primitiveTapped.add(function(){return v.mapInteractedEvent()}))),v.disposables.push(v._taskManager.stackFocused.add(function(){r.enableDirectionsSearch=!1})),v._menuList=[],v._touchByPassMouseout=!1,(v._trafficItem||v.isFeatureEnabled("traffic"))&&v._container.instanceAsync("TrafficLayerV2",function(n){v._trafficLayer=n;n&&(v._showTrafficLayerAfterInstantiation&&n.show(1),v._setTrafficButtonSelected(n.getIsShowing()),v.disposables.push(v._trafficLayer.changed.add(function(n){n.name==="isShowing"&&v._setTrafficButtonSelected(n.newValue)})))}),v.resources=t,v.searchInstData=v.createInstrumentationData(r._searchFeatureName),e&&(v.disposables.push(a.stackRemoved.add(function(){a.getStacks().length===0&&(v.setSearchTerm(""),v._searchBox&&v._searchBox.focus())})),v.disposables.push(e.mapTypeChanged.add(function(n){n.newMapTypeId===p.birdseye?(v._trafficItem&&v._trafficItem.setCssClass("trafficIcon realign disabled"),v._trafficIsDisabled=!0):n.oldMapTypeId===p.birdseye&&(v._trafficIsDisabled=!1,v._trafficLayer&&v._setTrafficButtonSelected(v._trafficLayer.getIsShowing()));v._setTextAlignment(v.taskBarItems)}))),v._isMapsAnswer||v._setTextAlignment(v.taskBarItems),u.showTaskBarLabels&&(n(window).add_event("resize",function(n){v._onResizeHandler(n)}),u.fullScreen&&n(window).add_event("fullscreenChange,webkitfullscreenChange,mozfullscreenChange,msfullscreenchange,msfullscreenChange,MSFullscreenChange",function(n){v._onResizeHandler(n)})),w=u.isEnabled?"block":"none",h._isSmallMapShownOnSerp()&&(w="none"),v.getControl().set_style({display:w}),v.setIsOnVertical(s.isMapsVertical),v._isMapsAnswer&&(v.disposables.push(e.actualSizeChanged.addOne(function(){var i=n(".actions")[0],t;if(i&&(v.actionBarSize=i.getBoundingClientRect().width),t=n(".b_searchboxForm")[0],t){var r=n(".searchButton")[0],u=r?r.getBoundingClientRect().width:40,f=t.getBoundingClientRect().width-u;v._setSearchControlsWidth(n(".inputbox",v.getControl()[0])[0],f)}v._setTextAlignment(v.taskBarItems)})),v.disposables.push(e.actualSizeChanged.add(function(){v._setTextAlignment(v.taskBarItems)}))),v}return v(r,i),r.prototype.setSearchBox=function(t){var i=this;this._searchBox=t;n(this._searchBox).add_event("keydown",function(n){i._onSearchBoxEnter(n)})},r.prototype.dispose=function(){n(window).remove_event("keyup",this._windowEventHandler);n(window).remove_event("keyup",this.onEscapeEvent);n(window).remove_event("keydown",this._firefoxEscapeEventHandler);n(window).remove_event("fullscreenChange,webkitfullscreenChange,mozfullscreenchange,msfullscreenChange,MSFullscreenChange,msfullscreenchange",this._onResizeHandler)},r.prototype.setActionsOptions=function(i){for(var e,o,s,f=this.taskBarItems,u=0;u<f.length;u++)i===1023&&(f[u].action===8||f[u].action===256)?f[u].setIsActive(!1):(f[u].setIsActive((i&f[u].action)!=0),r.isFullScreen&&f[u].name===t.L_TaskBar_Label_Fullscreen&&(e=r._getTaskbarFullScreenButton(null),e.add_class("selected"),o=r.getMenuItem(t.L_TaskBar_Label_Fullscreen),s=n(".fullscreenIcon",o),s.add_class("selected")))},r.prototype.setActionsState=function(n,t){for(var i,o,u,e=this.taskBarItems,s=this.getControl(),f=0;f<e.length;f++)i=e[f],(n&i.action)!=0&&(o=i.getDataTag(),u=s.select('*[data-tag="'+o+'"]'),t==1?u.remove_class(r._pressedButtonClass):t==2&&u.add_class(r._pressedButtonClass),i.setCssClass(u.get_attr("class")))},r.prototype.stringify=function(t){return n.Internals.stringify(t)},r.prototype.setSearchBoxFocus=function(){if(this._searchBox)if(this._searchBox.focus(),r.enableDirectionsSearch=!0,typeof this._searchBox.selectionStart=="number")this._searchBox.selectionStart=this._searchBox.selectionEnd=this._searchBox.value.length;else if(typeof this._searchBox.createTextRange!="undefined"){var n=this._searchBox.createTextRange();n.collapse(!1);n.select()}},r.prototype.mapInteractedEvent=function(){r.enableDirectionsSearch=!1;this.hideMenu()},r.prototype.hideMenu=function(){var t=this;window.clearTimeout(r._mouseOverDelayHandle);r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){var i=n(".dropdownEntry",t._taskBarPopOutElement[0]),f,u,r;if(i&&i.length>0&&i[0].blur(),f=!1,u=n(".popOutTemplate",t._taskBarPopOutElement[0]),u&&u.length>0){if(u[0].querySelector(":focus")||u[0].querySelector(":hover")||u[0].querySelector(":active"))f=!0;else for(r=0;r<i.length;r++)if(i[r].parentElement.querySelector(":hover")||i[r].parentElement.querySelector(":active")||i[r].parentElement.querySelector(":focus")||i[r].querySelector(":focus")||i[r].querySelector(":hover")||i[r].querySelector(":active")){f=!0;break}f&&u.get_style("display")!=="none"||t.clearMenuElements()}},r._mouseTimeout*2)},r.prototype.mouseoverMenuHandler=function(t){var i=this;window.clearTimeout(r._mouseOverDelayHandle);r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i._setMoreTaskItemState(!0);n(".taskBarPopout",i._map.getRootElement().getParent()[0]).set_style({display:"block"});i._initializeMenu(t)},r._mouseTimeout-100);t&&t.preventDefault&&t.preventDefault()},r.prototype.onFullScreenClick=function(i){var e=this;this._windowEventHandler||(this._windowEventHandler=function(n){return e.onEscapeEvent(n)},document.addEventListener("mozfullscreenchange",this.onEscapeEvent),document.addEventListener("webkitfullscreenchange",this.onEscapeEvent),document.addEventListener("msfullscreenChange",this.onEscapeEvent),document.addEventListener("MSFullscreenChange",this.onEscapeEvent),document.addEventListener("msfullscreenchange",this.onEscapeEvent),document.addEventListener("fullscreenchange",this.onEscapeEvent),n(window).add_event("keyup",this.onEscapeEvent));r.enableDirectionsSearch=!1;var u=r._getTaskbarFullScreenButton(i),o=r.getMenuItem(t.L_TaskBar_Label_Fullscreen),f=n(".fullscreenIcon",o),s=n("#container");u&&(u.has_class("selected")?(n(u).exit_full_screen(),u.remove_class("selected"),f.remove_class("selected"),r.isFullScreen=!1):(n(u).set_full_screen(s[0]),u.add_class("selected"),f.add_class("selected"),r.isFullScreen=!0,r._logFullScreen(!0)),r._adjustContainerTop());i&&i.preventDefault()},r.prototype.setPartnerNavBarState=function(){var b=s&&s.features&&s.features.localSearch,u,a,v,p,t,it,w,r,y,f;if(b&&b.enablePartnerPageOnMapsExperience){var k=n(".partnerPageContainer"),d=n(".nonajaxCardPrimer"),f=n(".partnerPageNavBar"),g=k&&k.length>0;if((g||d&&d.length)&&(u=n(".bm_partnerNavBarList"),u&&u.length)){var nt="Travel Guide",tt="Things to do",e=h._createElement("li"),o=h._createElement("li"),c=h._createElement("span"),i=h._createElement("a"),l="#";g?(a=n(".poiMod"),a&&a.length&&(v=a.select("div[data-resultsoverlay]"),v&&v.length&&(p=v.get_attr("data-resultsoverlay"),p&&(t=JSON.parse(p),t&&t.query&&(it=t.poiCount?"&count="+t.poiCount+"&ecount="+t.poiCount:"&count=20&ecount=20",l="/maps?uncrunched=1&traveldirect=true&addfeaturesnoexpansion=partnerdirect&first=0&efirst=1&maptype=m&q="+encodeURIComponent(t.query)+it)))),c.set_text(nt),i.set_text(tt),i.set_attr("href",l),c.appendTo(e),i.appendTo(o),e.set_attr("class","b_active")):(w=n(".overlay-listings").get_attr("data-listingMetadata"),w&&(r=JSON.parse(w),r&&r.entityName&&r.entityId&&(l="/maps?uncrunched=1&traveldirect=true&addfeaturesnoexpansion=partnerdirect&q="+encodeURIComponent(r.entityName)+"&l2sid="+r.entityId)),i.set_text(nt),i.set_attr("href",l),c.set_text(tt),i.appendTo(e),c.appendTo(o),o.set_attr("class","b_active"));e.appendTo(u);o.appendTo(u);y=n(".bm_contextualAndShowMe");y&&y.length&&y.removeFromParent();f=n(".partnerPageNavBar");f&&f.length&&f.set_style({display:""})}}},r.getMenuItem=function(t){var e=n(".taskBarPopout",r._staticMap.getRootElement().getParent()[0])[0],f=n(".popOutInner",e)[0],u,i;if(f&&f.childElementCount>0)for(u=f.children,i=0;i<u.length;i++)if(u[i].innerHTML.indexOf(t)>-1)return u[i];return null},r.prototype.clearMenuElements=function(){this.hideFeedbackMenu.invoke();this._taskbarPopOutButtonViewModel&&this._taskbarPopOutButtonViewModel.setIsDisplayed(!1);n(".taskBarPopout",this._map.getRootElement().getParent()[0]).set_style({display:"none"});this._setMoreTaskItemState(!1)},r.prototype._setMoreTaskItemState=function(n){for(var i,t=r._taskItems.length-1;t>0;t--)if(r._taskItems[t].getCssClass().indexOf("moreIcon")>-1){i=r._taskItems[t];break}r._handleSelectedClass(i,n);i.setAriaExpanded(n)},r._handleSelectedClass=function(t,i){if(t)if(i)t.getCssClass().indexOf("selected")===-1&&t.setCssClass(t.getCssClass()+" selected");else while(t.getCssClass().indexOf("selected")>-1)t.setCssClass(t.getCssClass().replace(" selected","")),n(".moreIcon").fireEvent("blur")},r.prototype.mouseoutMenuHandler=function(n){var t=this;this._touchByPassMouseout||(window.clearTimeout(r._mouseOverDelayHandle),r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){t.hideFeedbackMenu.invoke()},r._mouseTimeout));this._touchByPassMouseout=!1;n&&n.preventDefault&&n.preventDefault()},r.prototype.hoverFeedbackButton=function(){var t=n(".fullscreenMenuLink",this._taskBarPopOutElement[0]);t&&t.length>0&&t[0].parentElement.parentElement.focus()},r.prototype.boolToDisplay=function(n){return n?"":"none"},r.prototype.boolToHide=function(n){return n?"none":""},r.prototype.onEscapeEvent=function(n){var t=n,i=document.mozFullScreenElement||document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;(t&&t.key&&(t.key==="Escape"||t.key==="Esc")||t.keyCode&&t.keyCode===27||(n.type==="mozfullscreenchange"||n.type==="webkitfullscreenchange"||n.type==="fullscreenchange"||n.type==="msfullscreenchange"||n.type==="MSFullscreenChange"||n.type==="msfullscreenChange")&&!i)&&(r.exitFullScreen(),r._logFullScreen(!1));n.preventDefault()},r.prototype.onOverlayCloseButtonClicked=function(){et.getInstance().clearCategories();var n={logData:{feature:it.TaskBar,action:d.Clicked,data:{FN:r._featureNameToAction.Overlay,CN:"Close"}}};s.dynamicProperties.serpIG&&(n.impressionGuid=s.dynamicProperties.serpIG);e.invokeHandler(f.instrumentationDataHandlerKey,n)},r.exitFullScreen=function(){var i=this._getTaskbarFullScreenButton(null),u=r.getMenuItem(t.L_TaskBar_Label_Fullscreen),f=n(".fullscreenIcon",u);i.has_class("selected")&&(n("#container").exit_full_screen(),i.remove_class("selected"),f.remove_class("selected"));r.isFullScreen=!1;r._adjustContainerTop()},r.prototype.setIconClass=function(){var f=this._getShowTaskBarItemLabel(),u=n(".actions",this.getControl()[0])[0],t,i,r;if(u&&u.style&&u.style.display!="none")if(t=n(".action"),!f&&t&&t.length>0)for(i=0;i<t.length;i++)r=t[i].firstElementChild,r&&r.classList.contains("realign")&&r.classList.remove("realign");else if(t&&t.length>0)for(i=0;i<t.length;i++)r=t[i].firstElementChild,r&&!r.classList.contains("realign")&&r.classList.add("realign")},r._getTaskbarFullScreenButton=function(t){var i=t&&t.target;return i?i.className.indexOf("actionLabel")>-1?n(i.parentElement):i.className.indexOf("action")>-1?n(i.firstChild):n(i):n(".taskBar .fullScreenIcon")},r.prototype._onSearchBoxEnter=function(t){var u=t,s=u.keyCode||u.which,o,i;s===13&&(o=this._getInstData(r._searchFeatureName),e.invokeHandler(f.instrumentationDataHandlerKey,o),i=n(".searchButton")[0],i.setAttribute("tabindex","-1"),i.focus(),i.removeAttribute("tabindex"))},r.prototype._createTaskItemWithTaskOption=function(n,t,i,r,u){var f=new bt;return f.setCssClass(n),f.taskOption=t,f.action=i,f.setIsActive(!0),f.setDataTag(u?u:""),f.setShowLabel(r),f},r.prototype.createTaskItemWithClickHandler=function(n,t,i,r,u){var e=this,f=new bt;return f.setCssClass(n),f.clickHandler=function(n){t(n);n.preventDefault();e._logEventForMapsOverlay(i)},f.action=i,f.setIsActive(!0),f.setDataTag(u?u:""),f.setShowLabel(r),f},r.prototype.createTaskItemWithMouseHandlers=function(n,t,i,u,f){var o=this,e=new bt;return e.setCssClass(n),e.mouseoverHandler=function(n){window.clearTimeout(r._mouseOverDelayHandle);r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){t(n)},r._mouseTimeout);n&&n.preventDefault&&n.preventDefault()},e.mouseoutHandler=function(n){o._touchByPassMouseout||(window.clearTimeout(r._mouseOverDelayHandle),r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){n.target.tagName==="A"&&(n&&n.preventDefault&&n.preventDefault(),o.hideMenu())},r._mouseTimeout));o._touchByPassMouseout=!1},e.clickHandler=function(n){(n.type==="touchend"||n.type==="pointerup")&&(o._touchByPassMouseout=!0);n&&n.preventDefault&&n.preventDefault();t(n);n.cancelBubble=!0;n.stopPropagation();o._logEventForMapsOverlay(i)},e.keydownHandler=function(n){var i=n,u=i.keyCode||i.which;u===40&&e.getCssClass().indexOf("selected")===-1&&(window.clearTimeout(r._mouseOverDelayHandle),r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){t(n)},r._mouseTimeout),n&&n.preventDefault&&n.preventDefault())},e.action=i,e.setIsActive(!0),e.setDataTag(f?f:""),e.setShowLabel(u),e.setPopoutClass("taskBarPopout"),e},r.prototype.createTaskItems=function(){var n=this._getShowTaskBarItemLabel();this.addDirectionsItem(n);this.addTrafficItem(n);this.addCollectionItem(n);this.addSharingItem(n);this.addMoreMenuItem(n);this.addfullScreenItem(n)},r.prototype.addCollectionItem=function(n){if(this.isFeatureEnabled("collections")){var i=this.createTaskItemWithClickHandler("placesIcon realign",function(n){if(n.type!=="pointerup"){r.enableDirectionsSearch=!1;var t={entryPoint:1,action:dt.GetAllCollections},i={type:c.collectionsTask,state:t};e.invokeHandler(f.taskDataHandlerKey,i);n.preventDefault()}},2,n,"TaskBar.CollectionsButton");i.name=t.L_TaskBar_Label_Favorites;i.url="/maps/myplaces";i.instrumentationData=this.createInstrumentationData(c.collectionsTask);this.taskBarItems.push(i);r._taskItems.push(i)}},r.prototype.makeHomeWorkRequest=function(){var t={entryPoint:1,action:dt.ProcessCardlessPrimitives},i={type:c.collectionsTask,requestorType:"TaskBar",requestState:t,hiddenTask:!0},n=this._map.getFrameManager();n&&n.frameRendered&&n.frameRendered.addOne(function(){e.invokeHandler(f.taskProcessDataHandlerKey,i)})},r.prototype.setUpAlwaysOnPoi=function(){var t=this,n;h._isSmallMapShownOnSerp()?(n=function(){t.makeHomeWorkRequest();sj_evt.unbind("LargeMapShown",n)},sj_evt.bind("LargeMapShown",n)):this.makeHomeWorkRequest()},r.prototype.addSharingItem=function(n){var u=s.features.sharing,i;u&&u.isEnabled&&!u.disableOutboardSharing&&(i=this.createTaskItemWithClickHandler("shareIcon realign",function(n){n.type!=="pointerup"&&(r.enableDirectionsSearch=!1,e.invokeHandler(f.shareDataHandlerKey,{entryPoint:l.TaskBar}))},8,n,"TaskBar.ShareButton"),i.name=t.L_TaskBar_Label_Share,i.instrumentationData=this.createInstrumentationData(r._shareFeatureName),i.setIsActive(!1),i.setAriaExpanded(undefined),this.taskBarItems.push(i),r._taskItems.push(i))},r.prototype.addMoreMenuItem=function(n){var u=this,i;i=this.createTaskItemWithMouseHandlers("moreIcon realign",function(n){u.mouseoverMenuHandler(n)},128,n,"Taskbar.MoreButton");i.name=t.L_TaskBar_Label_More;i.setAriaExpanded(!1);this.taskBarItems.push(i);r._taskItems.push(i)},r.prototype.addfullScreenItem=function(n){var f=this,i;u.fullScreen&&(i=this.createTaskItemWithClickHandler("fullScreenIcon",function(n){if(n.type!=="pointerup")f.onFullScreenClick(n)},256,n,"Taskbar.FullscreenButton"),i.name=t.L_TaskBar_Label_Fullscreen,i.setIsActive(!1),i.setAriaExpanded(undefined),this.taskBarItems.push(i),r._taskItems.push(i))},r.prototype.addTrafficItem=function(n){var u=this,i;this.isFeatureEnabled("traffic")&&(this._trafficItem=i=this.createTaskItemWithClickHandler("trafficIcon",function(n){n.type!=="pointerup"&&(r.enableDirectionsSearch=!1,u._map.getMapType().id!==p.birdseye&&(u._trafficLayer?u._trafficLayer.toggle(1):u._showTrafficLayerAfterInstantiation=!0))},32,n,"TaskBar.TrafficButton"),i.name=t.L_TaskBar_Label_Traffic,i.url="/maps/traffic",i.setAriaExpanded(undefined),i.instrumentationData=this.createInstrumentationData(r._trafficFeatureName),this.taskBarItems.push(i),r._taskItems.push(i))},r.prototype.addDirectionsItem=function(n,i){var u=this,r;this.isFeatureEnabled("directions")&&(i?r=this._createTaskItemWithTaskOption("directionsIcon realign",{type:c.directionsTask,state:i},1,n,"TaskBar.DirectionsButton"):(r=this.createTaskItemWithClickHandler("directionsIcon realign",function(n){if(n.type!="pointerup")u.onDirectionsClick(n)},1,n,"TaskBar.DirectionsButton"),r.name=t.L_TaskBar_Label_Directions,r.url="/maps/directions",r.setAriaExpanded(undefined),r.instrumentationData=this.createInstrumentationData(c.directionsTask)),this.taskBarItems.push(r))},r.prototype.isFeatureEnabled=function(n){return s&&s.features[n]&&s.features[n].isEnabled},r.prototype.createInstrumentationData=function(n){var t=this._getInstData(n);return this.stringify(t)},r.prototype.onDirectionsClick=function(n){var t=this._taskManager.getFocusedStack()?this._taskManager.getFocusedStack().getForegroundTask():null,i,u;t&&(t.type===c.localDetailsTask||t.type===c.polygonEntityDetailsTask)&&!r.enableDirectionsSearch?(this._logDirectionsSearch(),this._getCardDetailsForDirections(t.type)):r.enableDirectionsSearch&&this._searchBox.value.length>0?(this._logDirectionsSearch(),this._getDetailsForDirections()):(i={entryPoint:1},u={type:c.directionsTask,state:i},e.invokeHandler(f.taskDataHandlerKey,u));r.enableDirectionsSearch=!1;n.preventDefault()},r.prototype._getCardDetailsForDirections=function(n){var t={searchEntitiesRequested:!0,entryPoint:l.TaskBar},i={requestorType:"TaskBar",type:n,requestState:t,useActiveTasks:!0};e.invokeHandler(f.taskProcessDataHandlerKey,i)},r.prototype._getDetailsForDirections=function(){var n={disableTaskActivate:!0,query:this._searchBox.value,entryPoint:l.TaskBar},t={requestorType:"TaskBar",type:c.localDetailsTask,requestState:n,useActiveTasks:!1};e.invokeHandler(f.taskProcessDataHandlerKey,t)},r.prototype._logDirectionsSearch=function(){var n={logData:{feature:it.TaskBar,action:d.Selected,data:{C:"DS"}}};e.invokeHandler(f.instrumentationDataHandlerKey,n)},r._logFullScreen=function(n){var t=n?"FSO":"FSE",i={logData:{feature:it.TaskBar,action:"C",data:{FN:t}}};e.invokeHandler(f.instrumentationDataHandlerKey,i)},r.prototype._getInstData=function(n){return{logData:{feature:it.TaskBar,action:d.Clicked,data:{FN:r._featureNameToAction[n]}}}},r.prototype._getMenuInstData=function(n){return{logData:{feature:it.TaskBar,action:d.Clicked,data:{FN:n}}}},r.prototype._initializeMenu=function(t){var r=this,f,e,i;t&&t.preventDefault();f=n(".taskBarPopout",this._map.getRootElement().getParent()[0]);f&&f.length>0&&(e=n(".feedbackPopOut")[0],e&&this._map.getRootElement().getParent().insertBefore(e,this._map.getRootElement()));this._menuList.length===0&&(i=s.features.sharing,i&&i.isEnabled&&!i.disableOutboardSharing&&this._menuList.push(this._createShareMenuItem()),this.isFeatureEnabled("print")&&this._menuList.push(this._createPrintMenuItem()),this.isFeatureEnabled("feedback")&&this._menuList.push(this._createFeedbackMenuItem()),u.fullScreen&&this._menuList.push(this._createFullscreenMenuItem()),u.embedInMoreMenu&&this._menuList.push(this._createEmbedMenuItem()));this._showDropdown(t);n(".feedbackMenuLink").add_event("touchend",function(t){var i=n(".feedbackMenuLink").parent(),u;r.launchFeedbackMenu.invoke(i);u=r._map.getMode();t&&t.preventDefault&&t.preventDefault();r._touchByPassMouseout=!0});h._setFocusOnFirstMenuItem(this._taskBarPopOutElement)},r.prototype._createShareMenuItem=function(){var n=this;return{name:t.L_TaskBar_Label_Share,handler:function(){e.invokeHandler(f.shareDataHandlerKey,{entryPoint:l.TaskBar});n._setMoreTaskItemState(!1);n._logEventForMapsOverlay(8)},mouseouthandler:function(t){n.hideMenu();t&&t.stopPropagation()&&t.preventDefault()},cssClass:"shareMenuLink",iconClass:"shareIcon menuLinkIcon",instData:this._getMenuInstData(a.Share)}},r.getCurrentActiveTask=function(n){var i="",t;return n&&(t=n.getFocusedStack(),t?t.getForegroundTask()&&(i=t.getForegroundTask().type):i="BaseMap"),i},r.prototype._createPrintMenuItem=function(){var n=this,i=this._taskManager;return{name:t.L_TaskBar_Label_Print,handler:function(){var t=r.getCurrentActiveTask(i);e.invokeHandler(f.printDataHandlerKey,{source:1,fullScreen:r.isFullScreen,taskType:t});n._setMoreTaskItemState(!1);n._logEventForMapsOverlay(4)},mouseouthandler:function(t){n.hideMenu();t&&t.stopPropagation()&&t.preventDefault()},cssClass:"printMenuLink",iconClass:"printIcon menuLinkIcon",instData:this._getMenuInstData(a.Print)}},r.prototype._createFeedbackMenuItem=function(){var i=this;return{name:t.L_Menu_Feedback_Text,mouseoverhandler:function(){window.clearTimeout(r._submenuMouseOverDelayHandle);r._submenuMouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){var t=n(".feedbackMenuLink").parent();i.launchFeedbackMenu.invoke(t)},r._mouseTimeout)},handler:function(){var t=n(".feedbackMenuLink").parent();i.launchFeedbackMenu.invoke(t)},mouseouthandler:function(n){i._touchByPassMouseout||(window.clearTimeout(r._submenuMouseOverDelayHandle),r._submenuMouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i.hideFeedbackMenu.invoke()},r._mouseTimeout*2));i._touchByPassMouseout=!1;n&&n.stopPropagation()&&n.preventDefault()},cssClass:"feedbackMenuLink",iconClass:"feedbackIcon menuLinkIcon",subMenu:!0,instData:this._getMenuInstData(a.Feedback)}},r.prototype._createFullscreenMenuItem=function(){var i=this,u=n(".fullScreenIcon.realign"),r="fullscreenIcon menuLinkIcon";return u.has_class("selected")&&(r+=" selected"),{name:t.L_TaskBar_Label_Fullscreen,handler:function(n){i.onFullScreenClick(n);i._setMoreTaskItemState(!1);i._logEventForMapsOverlay(256)},mouseouthandler:function(n){i.hideMenu();n&&n.stopPropagation()&&n.preventDefault()},cssClass:"fullscreenMenuLink",iconClass:r,instData:this._getMenuInstData(a.Fullscreen)}},r.prototype._createEmbedMenuItem=function(){var n=this,i=this._taskManager;return{name:t.L_PermalinkEmbed_Text,handler:function(t){n._openEmbedPage(t);n._logEventForMapsOverlay(512)},mouseouthandler:function(t){n.hideMenu();t&&t.stopPropagation()&&t.preventDefault()},cssClass:"embedMenuLink",iconClass:"embedIcon menuLinkIcon",instData:this._getMenuInstData(a.Embed)}},r.prototype._openEmbedPage=function(){if(this._map){var n=h._formatString(b.embedPageUrl,this._map.getBounds().center.latitude,this._map.getBounds().center.longitude,this._map.getMercatorZoomLevel());window.open(n,"EmbeddedMap");this._logEmbed(n)}},r.prototype._showDropdown=function(t){var e=this,i=t.target,u;i.className.indexOf("actionLabel")>-1?i=t.target.parentElement.parentElement:i.className.indexOf("Icon")>-1&&(i=i.parentElement);this._taskbarDropdownViewModel?this._taskbarPopOutButtonViewModel&&this._taskbarPopOutButtonViewModel.getIsDisplayed()===!0&&(this._taskbarPopOutButtonViewModel.setIsDisplayed(!1),this._taskbarDropdownViewModel.setDropdown(this._menuList),this._taskbarDropdownViewModel.setButtonElement(n(i)),this._taskbarPopOutButtonViewModel.setDropdown(this._taskbarDropdownViewModel)):(this._taskbarDropdownViewModel=new sr(this._menuList,n(i)),this._taskbarPopOutButtonViewModel=new ir(this._taskbarDropdownViewModel,null,this._taskbarDropdownViewModel.taskBarListDropDownTemplate),u=this._taskbarPopOutButtonViewModel.buildPopOut(),this._taskBarPopOutElement=n(".taskBarPopout",this._map.getRootElement().getParent()[0]),this._taskBarPopOutElement.append(u));var r=i.getBoundingClientRect(),o=r.height+10,f=n(window).get_scroll_pos().x,s=window.innerHeight/window.document.documentElement.offsetHeight*100<80,h=!(f===0||s);h?(this._taskBarPopOutElement.set_style({left:r.left+f+"px"}),this._taskBarPopOutElement.set_style({right:""})):(this._taskBarPopOutElement.set_style({left:r.left+"px"}),this._taskBarPopOutElement.set_style({right:""}));this._taskBarPopOutElement.set_style({top:o+"px"});n(".taskBarPopout").add_event("keydown",function(n){e._onMenuKeyDown(n)});this._taskbarPopOutButtonViewModel.setIsDisplayed(!0)},r.prototype._showIdControls=function(){var c=n("#b_header")[0],e,t,o,i,h;if(c&&(e=n("#id_h",c),e.length>0))if(t=n(".id_nc",e[0]),o=t&&t.length>0&&!t.has_class("bnc-hide"),s.isMapsAnswer)i=n("#id_sc"),h=o?this._minIdControlsWidth:i.length>0?i[0].clientWidth:0,window.innerWidth<u.taskbarButtonsShowTextWidth+h?(t.length>0&&!t.has_class("hide")&&t.add_class("hide"),i.length>0&&!i.has_class("hide")&&i.add_class("hide")):(t.length>0&&t.has_class("hide")&&t.remove_class("hide"),i.length>0&&i.has_class("hide")&&i.remove_class("hide"));else{var r=n("#id_l",e[0]),f=n("#id_rh",e[0]),h=o?this._maxIdControlsWidth:100;window.innerWidth<u.taskbarButtonsShowTextWidth+h?(r.length>0&&!r.has_class("hide")&&r.add_class("hide"),f.length>0&&!f.has_class("hide")&&f.add_class("hide"),o&&t.length>0&&!t.has_class("hide")&&t.add_class("hide")):(r.length>0&&r.has_class("hide")&&r.remove_class("hide"),f.length>0&&f.has_class("hide")&&f.remove_class("hide"),o&&t.length>0&&t.has_class("hide")&&t.remove_class("hide"))}},r.prototype._setTextAlignment=function(n){for(var i=n,r=this._getShowTaskBarItemLabel(),t=0;t<i.length;t++)i[t].setShowLabel(r);this._adjustSearchBoxWidth();this._showIdControls()},r.prototype._adjustSearchBoxWidth=function(){var f=this.getControl()[0],t,i,e,u;if(f.clientWidth>0)if(t=n(".inputbox",f)[0],i=n("#taskbarPrimer")[0],i&&i.clientWidth>0)e=n(".inputbox",i)[0],this._setSearchControlsWidth(t,e.getBoundingClientRect().width);else if(this._isMapsAnswer&&this.actionBarSize<this._minimumActionButtonsWidth&&(this.actionBarSize=this._maxActionButtonsWidth),t){var s=n("#b_header")[0],h=n("#id_h",s),r=n(".id_nc",h[0]),c=r&&r.length>0&&!r.has_class("bnc-hide"),l=c?47:0,a=this._rightTaskbarBuffer+this._searchBoxLeftBuffer+this._navButtonWidth+this._maxActionButtonsWidth+l,v=this._fullSearchControlsWidth-this._minSearchBoxWidth,o=window.innerWidth-(this._fullSearchControlsWidth+a);o>0?this._setSearchControlsWidth(t,this._searchBoxWidth):(u=v-Math.abs(o),u<0?this._setSearchControlsWidth(t,this._minSearchBoxWidth):this._setSearchControlsWidth(t,this._minSearchBoxWidth+u))}},r.prototype._setSearchControlsWidth=function(t,i){var u,f,r;t&&(u=38,f=n("#maps_sb",t)[0],t.setAttribute("style","width: "+i+"px"),r=n(".as_container_search",t),r&&r.get_style("visibility")==="visible"&&this._searchBox.value.length>-1&&r.set_style({width:i+"px"}))},r.prototype.insertPopoutInMap=function(){var t=n(".taskBarPopout",this._map.getRootElement().getParent()[0]);t&&t.length!==0||(this._taskBarPopOutElement=h._createElement("div"),this._taskBarPopOutElement.set_attr("class","taskBarPopout"),this._map.getRootElement().getParent().insertBefore(this._taskBarPopOutElement[0],this._map.getRootElement()))},r.prototype._onResizeHandler=function(){var l=this._getShowTaskBarItemLabel(),e,f,o,s,i,t,c,r;for(this._showIdControls(),this._setTextAlignment(this.taskBarItems),e=this.taskBarItems,f=0;f<e.length;f++)e[f].setShowLabel(l);if(this.setIconClass(),h._isLargeMapShownOnSerp()||h._isTravelOverlayShownOnSerp()){if(o=window.innerWidth,s=document.getElementById("b_header"),s)if(i=n(".id_button",s),o<=u.taskBarMapTypeTextMinWidth)for(t=0;t<i.length;t++)i[t].style.padding="0";else for(t=0;t<i.length;t++)i[t].removeAttribute("style");c=document.getElementsByTagName("html")[0];r=n(".b_footer.b_slimFoot.bm_oneMap")[0];o<=u.windowMinWidth?(c.style.overflowX="auto",r&&(r.style.zIndex="1001")):(c.style.overflowX="hidden",r&&r.removeAttribute("style"))}},r._adjustContainerTop=function(){var t=n("#container")[0];r.isFullScreen&&(t.style.top="0",t.style.bottom="0")},r.prototype._onMenuKeyDown=function(t){var s=this,o=t,u=o.keyCode||o.which,i,f,e;u===9?this.hideMenu():u===37?this.clearMenuElements():u===13||u===39?(i=t.target,i.className.indexOf("dropdownEntry")>-1&&(i=i.children[0],i&&(i=i.children[0])),i.className.indexOf("feedback")>-1&&this.launchFeedbackMenu.invoke(n(".feedbackMenuLink").parent()),window.clearTimeout(r._mouseOverDelayHandle),r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){s.focusFeedback.invoke()},r._mouseTimeout*2)):u===40?(f=t.target.nextElementSibling,f&&n(f)[0].focus()):u===38&&(e=t.target.previousElementSibling,e?n(e)[0].focus():this.clearMenuElements())},r.prototype._setTrafficButtonSelected=function(t){var i=n(".trafficIcon")[0];i&&(t&&!i.classList.contains("selected")?i.classList.add("selected"):!t&&i.classList.contains("selected")&&i.classList.remove("selected"));this._trafficIsSelected=t},r.prototype._getShowTaskBarItemLabel=function(){return this._searchBoxWidth==null?!1:u.showTaskBarLabels&&window.innerWidth>u.taskbarButtonsShowTextWidth+(h._isLargeMapShownOnSerp()?50:0)},r.prototype._logEventForMapsOverlay=function(n){var i=s.dynamicProperties.serpIG,t;s.features.localSearch.sendMoreInstrumentationForOverlay&&i&&(t=Microsoft.Maps.logger,t&&t.logObject({T:"CI.OverlayTaskBarClick",feature:"MapsOverlay",action:"CI.OverlayTaskBarClick",data:{AN:n}},i,!1))},r.prototype._logEmbed=function(n){var t={PL:n};w.instLog(rt.EMC,t)},r._shareFeatureName="Share",r._searchFeatureName="Search",r._trafficFeatureName="Traffic",r._fullscreenFeatureName="Fullscreen",r._embedFeatureName="Embed",r._overlayFeatureName="Overlay",r._taskbarStyleSet="",r._taskbarStyle="",r._mouseTimeout=150,r._featureNameToAction=function(){var n={};return n[c.collectionsTask]=a.Collections,n[c.directionsTask]=a.Directions,n[r._shareFeatureName]=a.Share,n[r._searchFeatureName]=a.Search,n[r._trafficFeatureName]=a.Traffic,n[r._fullscreenFeatureName]=a.Fullscreen,n[r._embedFeatureName]=a.Embed,n[r._overlayFeatureName]=a.Overlay,n}(),r.hiddenStyle={visibility:"hidden"},r.visibleStyle={visibility:"visible"},r._pressedButtonClass="pressed",r._fullScreenModalDialogContentTemplate='<div class="fullscreenEscape"><p>{escText}<\/p><\/div>',r.isFullScreen=!1,r}(kt),fu=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i,r,u,f)||this;return e._slideOutMenuItem&&t.instanceAsync("SlideOutMenu",function(n){e._slideOutMenu=n}),e}return v(t,n),t.prototype.createTaskItems=function(){var i=this,n;this.addDirectionsItem(!1,{entryPoint:1});this.isFeatureEnabled("slideOutMenu")&&(this._slideOutMenuItem=n=this.createTaskItemWithClickHandler("slideOutIcon",function(){i._slideOutMenu&&i._slideOutMenu.showMenu()},64,!1,"TaskBar.SlideOutMenu"),n.instrumentationData=this.createInstrumentationData(t._slideOutMenuFeatureName),this.taskBarItems.push(n))},t._slideOutMenuFeatureName="SlideOutMenu",t}(tt),eu=function(){function r(t,i,r,f){var e=this,c,h,l;if(ht)this._taskManager=f,this._viewModel=this._CreateTaskBarViewModel(t,i,ht,r,this._taskManager),c=this._viewModel.getControl(),this._map=i,this._controlTemplateFactory=r,h=i.getRootElement(),this.feedbackInitialize=new o,this._viewModel.launchFeedbackMenu.add(function(n){e.feedbackInitialize.invoke(n)}),this.dismissMenu=new o,this.dismissMenu.add(function(){e._viewModel.hideMenu()}),this.dismissFeedbackMenu=new o,this.focusFeedbackMenu=new o,this._viewModel.focusFeedback.add(function(){e.focusFeedbackMenu.invoke()}),this._viewModel.hideFeedbackMenu.add(function(){e.dismissFeedbackMenu.invoke()}),this.hoverFeedbackButton=new o,this.hoverFeedbackButton.add(function(){e._viewModel.hoverFeedbackButton()}),this.exitFullScreen=new o,this.exitFullScreen.add(function(){e._viewModel.exitFullScreen.invoke()}),this._visibilityChangedEvent=new o,this._visibilityChangedEvent.add(function(n){e._viewModel.setAsExpanded(n)}),this._selectionChangedEvent=new o,this._selectionChangedEvent.add(function(n){e._viewModel.setSelectedSuggestionId(n)}),this._map.mapTapped.add(function(){e._searchBox.blur()}),h.getParent().insertBefore(c,h),l=n("#maps_sb"),this._viewModel.setIconClass(),this._viewModel._adjustSearchBoxWidth(),this._searchBox=l[0],this._viewModel.setSearchBox(this._searchBox),this._viewModel.setPartnerNavBarState(),n(".searchIcon").add_event("click",function(n){e.handleSearchButtonEvents(n)}),s.features.autosuggest.isEnabled&&(this._suggestionItemSelected=new o,this._suggestionItemSelected.add(function(n){e._onSuggestionItemSelected(n)}),this._suggestionItemClicked=new o,this._suggestionItemClicked.add(function(n){e._onSuggestionItemClicked(n)}),this._onAutosuggestKeydown=new o,this._onAutosuggestKeydown.add(function(n){e.onAutosuggestKeydownFunction(n)}),this._clickHandler=new o,this._clickHandler.add(function(){e.handleClick()})),Feedback.Bootstrap.InitializeFeedback({structured:!0},"tdd_feedback",!1,!0,!1),Feedback.Bootstrap.InitializeFeedback({structured:!0},"tdd_exit",!1,!0,!1),this._viewModel.insertPopoutInMap(),this.fullScreenEnabled=u.fullScreen;else throw"Template is not defined!";this._clearSuggestions=!1;u.showCategoryLayers&&et.getInstance().initialize();uu.getInstance().initialize(this._map);pt.initialize(this._map,this._taskManager)}return r.prototype.initializeAutosuggest=function(){var r=n("#maps_sb_container"),u=n("#maps_sb"),t=new er,i;this._searchBoxAutosuggestDataModel=t;this._autosuggestViewModel=new yi(t,this._controlTemplateFactory,!0,"TaskBarSearch",this._visibilityChangedEvent,this._selectionChangedEvent);i="as_container_search";this._autosuggest=new pi(r,u,i,this._autosuggestViewModel,this._map);this._autosuggest.setAutosuggestKeydownHandler(this._onAutosuggestKeydown);this._autosuggest.setItemSelectionEventHandler(this._suggestionItemSelected);this._autosuggest.setItemClickEventHandler(this._suggestionItemClicked);this._autosuggest.setClickEventHandler(this._clickHandler)},r.prototype.handleSearchButtonEvents=function(n){tt.enableDirectionsSearch=!1;this._autosuggest&&this._autosuggest.instrumentSearchButtonClickEvent();var t=this._autosuggestViewModel&&this._autosuggestViewModel.getSelectedSuggestion(),i=t?l.Autosuggest:l.SearchButton;this._performSearch(i,t);n&&n.preventDefault&&n.preventDefault()},r.prototype.handleClick=function(){tt.enableDirectionsSearch=!0;this._autosuggest&&this._autosuggest.refreshAutosuggest();this._clearSuggestions&&(tt.enableDirectionsSearch=!1,this._clearSuggestions=!1,this._searchBox&&this._searchBox.removeAttribute("placeholder"),this._searchBoxAutosuggestDataModel.clearDefaultSuggestions())},r.prototype.onAutosuggestKeydownFunction=function(n){var r=n,u=r.keyCode||r.which,t,i;u==13&&(tt.enableDirectionsSearch=!1,i=l.SearchBox,this._autosuggestViewModel&&(t=this._autosuggestViewModel.getSelectedSuggestion()),t&&(i=l.Autosuggest),this._performSearch(i,t))},r.prototype.processCallback=function(n){var t,i,r,u,o,s;n&&n.inData&&n.processorType&&n.outData&&(n.processorType===c.localDetailsTask||n.processorType===c.polygonEntityDetailsTask)&&(t={entryPoint:1},i=n.inData.requestState,i&&(i.searchEntitiesRequested||i.disableTaskActivate)&&n.outData&&n.outData.length>0&&(r=this._getEventTime(n.outData),r&&(u={dateTime:r,timeType:or.arrival}),o=this._getWaypoint(n.outData),o&&(t.waypoints=[o],u&&(t.options=u))),s={type:c.directionsTask,state:t},e.invokeHandler(f.taskDataHandlerKey,s))},r.prototype._getWaypoint=function(n){var u=null,i,r,f,t;if(n.length>1||n[0]&&n[0].processorId){for(i=0;i<n.length;i++)if(n[i]&&n[i].data&&(r=n[i],f=r.processorId,this._taskManager.getFocusedStack()&&this._taskManager.getFocusedStack().getForegroundTask().id===f&&(t=r.data&&r.data.length>0?r.data[0]:null,t&&!t.isApproximateLocation))){u=new ri(t.getAddress(),t.getLocation(),t.getTitle(),!1,null,t.id,null,null,null,2,5);break}}else n[0]&&n[0]&&n[0].data.entities&&n[0].data.entities.length>0&&(t=n[0].data.entities[0],t&&!t.isApproximateLocation&&(u=new ri(t.getAddress(),t.getLocation(),t.getTitle(),!1,null,t.id,null,null,null,2,5)));return u},r.prototype._getEventTime=function(n){var f,r,u,e,t,o,s;if(n[0]&&n[0]&&n[0].data&&n[0].data.length==1)for(r=0;r<n.length;r++)n[r]&&n[r].data&&(u=n[r],e=u.processorId,this._taskManager.getFocusedStack()&&this._taskManager.getFocusedStack().getForegroundTask().id===e&&(t=u.data&&u.data.length>0?u.data[0]:null,t&&t.id&&t.id.indexOf("event")>-1&&(o=i.GlobalConfig.features.localSearch.eventPreArrivalTime,t.getDateTime&&t.getDateTime()&&(s=new Date(t.getDateTime()),f=t.getDateTime()+t.getUtcOffset()*6e4-o*6e4))));return f},r.prototype._onSuggestionItemSelected=function(n){this.getSearchTerm()===n.searchText&&(this._searchBox.value=n.searchText);this.setSearchTerm(n.searchText)},r.prototype._onSuggestionItemClicked=function(n){this._performSearch(l.Autosuggest,n)},r.prototype._performSearch=function(n,i){var l=this,h=this._searchBox?this._searchBox.value.trim():this._viewModel.getSearchTerm().trim(),r,u,a,v,o,y;if(this._autosuggest&&this._autosuggest.stopAutosuggest(),r={},r.query=h,r.entryPoint=n,i&&(this.setSearchTerm(i.searchText),r.query=i.searchText,r.fullQuery=i.searchText,r.filterUrlParam=i.entityId,r.mapBounds=i.mapBounds,i.type==="Favorite"?(!i.entityId&&i.location&&(r.query=i.location.latitude+","+i.location.longitude,r.fullQuery=r.query),r.taskTitle=i.alternateName||i.name,r.asName=i.name,r.asFormattedAddress=i.formatedAddress):(r.asName=i.formatedLine1,r.asFormattedAddress=i.formatedLine2)),u=this._map.getMode(),u&&(u.mapModeType===2||u.mapModeType===3)&&h?(a=u.getPreviousMapType(),this._map.setMapType(a),v=u.getPreviousMode(),this._map.setMode(v),this.setActionsOptions(1023)):this._map.getMapType().id===p.birdseyeV2&&h&&this._map.getBirdseyeV2Manager().then(function(n){var t=l._map.getMapTypes()[n.previousMapState.mapTypeId||p.road];t&&l._map.setBaseLayers(t)}),o=s.features,i&&i.title===t.L_SearchNearbyTransit&&o&&o.transit&&o.transit.isEnabled){y={location:ft.getMapCenter(this._map),title:this._nearbyLocationTitle,entryPoint:1};e.invokeHandler(f.taskDataHandlerKey,{state:y,type:c.nearbyTransitTask});return}e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:r,type:c.localSearchTask})},r.prototype.setActionsOptions=function(n){this._viewModel.setActionsOptions(n)},r.prototype.setActionsState=function(n,t){this._viewModel.setActionsState(n,t)},r.prototype.setSearchTerm=function(n,t){this._viewModel.setSearchTerm(n);t&&e.invokeHandler(f.taskProcessDataHandlerKey,{type:c.localSearchTask,requestState:{query:n}})},r.prototype.getSearchTerm=function(){return this._viewModel.getSearchTerm()},r.prototype.setSearchBoxFocus=function(){this._viewModel.setSearchBoxFocus()},r.prototype.getSearchBox=function(){return n(this._searchBox)},r.prototype.setSearchBoxGhostText=function(n){this._searchBox&&(this.setSearchTerm(""),this._searchBox.setAttribute("placeholder",n),this.setSearchBoxFocus(),this._clearSuggestions=!0)},r.prototype.updateSearchBoxAutosuggestDefault=function(n,t){this._searchBoxAutosuggestDataModel.updateDefaultSuggestions(n,t);this._autosuggest.refreshAutosuggest()},r.prototype.setNearbyLocationTitle=function(n){this._nearbyLocationTitle=n},r.prototype._CreateTaskBarViewModel=function(n,t,i,r,u){return s.isMobile?new fu(n,t,ht,r,u):new tt(n,t,ht,r,u)},r}();i.TaskBar=eu;r.SharingDialogViewModel=nu;r.PrintManager=fi;r.SlideOutMenu=typeof oi!="undefined"?oi:undefined;r.BirdsEyeV2DialogViewModel=typeof ui!="undefined"?ui:undefined;r.CommutabilityControl=br;r.CommutabilityControlOverlay=kr;r.UserTipControl=hi;r.SaveSuccessTipControl=ru}catch(ai){if(i.logger)i.logger.logCriticalError(ai);else throw ai;}}).call(window)