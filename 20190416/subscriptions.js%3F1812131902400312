/*!
 * Блок с кодом подписки на важные новости (subscriptions)
 *
 * © 2018 АО «Коммерсантъ»
 * All rights reserved
 */
var yandexRefs=["news.yandex.ru","news.yandex.kz","news.yandex.by","news.yandex.ua","news-clck.yandex.ru"];kommersant.user.subscriptionTypes=[{Id:1,Name:"Подписка на срочные новости",Title:"Срочные новости в течение дня в рассылке «Коммерсантъ»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:yandexRefs,Publishing:null,Region:null},Priority:1,LogoHtml:"",ClassSubscriptionPopupContent:""},{Id:2,Name:"Подписка на Weekend",Title:"Подпишитесь на&nbsp;рассылку<br> «Свежий номер Коммерсантъ Weekend»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:14,Region:null},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"weekend"},{Id:3,Name:"Подписка на Деньги",Title:"Подпишитесь на&nbsp;рассылку<br> материалов «Коммерсантъ Деньги»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:3,Region:null},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"money"},{Id:4,Name:"Подписка на Огонёк",Title:"Подпишитесь на&nbsp;рассылку<br> «Свежий номер Огонёк»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:84,Region:null},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"ogonek"},{Id:6,Name:"Подписка на газету",Title:"Подпишитесь на&nbsp;рассылку",SubTitle:"Свежий номер газеты<br><strong>Коммерсантъ</strong>",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:1,Region:null},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"newspaper"},{Id:7,Name:"Подписка на дайджест новостей региона Пермь",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Пермь»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:59},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:8,Name:"Подписка на дайджест новостей региона Самара",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Самара»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:63},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:9,Name:"Подписка на дайджест новостей региона Волгоград",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Волгоград»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:34},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:10,Name:"Подписка на дайджест новостей региона Красноярск",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Красноярск»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:24},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:11,Name:"Подписка на дайджест новостей региона Воронеж",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Воронеж»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:36},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:12,Name:"Подписка на дайджест новостей региона Новосибирск",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Новосибирск»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:54},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:13,Name:"Подписка на дайджест новостей региона Екатеринбург",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Екатеринбург»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:66},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:14,Name:"Подписка на дайджест новостей региона Санкт-Петербург",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Санкт-Петербург»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:78},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:15,Name:"Подписка на дайджест новостей региона Челябинск",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Челябинск»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:74},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:17,Name:"Подписка на дайджест новостей региона Ростов-на-Дону",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Ростов-на-Дону»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:61},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:18,Name:"Подписка на дайджест новостей региона Казань",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Казань»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:16},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:19,Name:"Подписка на дайджест новостей региона Краснодар",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Краснодар»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:23},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:20,Name:"Подписка на дайджест новостей региона Нижний Новгород",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Нижний Новгород»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:52},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:21,Name:"Подписка на дайджест новостей региона Уфа",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Уфа»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:2},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:22,Name:"Подписка на дайджест новостей региона Саратов",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Саратов»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:64},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:23,Name:"Подписка на дайджест новостей региона Ижевск",Title:"Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ Ижевск»",SubTitle:"",ShowInterval:1440,SubscribingInterval:10080,SubscribingIntervalRejected:43200,SubscribingIntervalAnotherWindow:60,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:null,Region:18},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"region"},{Id:101,Name:"Подписка на выбор редакции",Title:"Подпишитесь на&nbsp;дайджест «Выбор редакции»",SubTitle:"Главные события — утром и вечером",ShowInterval:0,SubscribingInterval:0,SubscribingIntervalRejected:0,SubscribingIntervalAnotherWindow:0,SubscribingIntervalAfterSubscribe:43200,Conditions:{Referrers:null,Publishing:-1,Region:null},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"choice"},{Id:102,Name:"",Title:'Добавьте Коммерсантъ<br>в "Мои источники"<br>на Яндекс.Новости',SubTitle:"",ShowInterval:0,SubscribingInterval:0,SubscribingIntervalRejected:1440,SubscribingIntervalAnotherWindow:0,SubscribingIntervalAfterSubscribe:0,Conditions:{Referrers:yandexRefs,Publishing:null,Region:null},Priority:2,LogoHtml:"",ClassSubscriptionPopupContent:"yandex",linkA:"https://news.yandex.ru/index.html?from=rubric&favid=1048"}],kommersant.subscriptions.disabledSubcriptions=[3,5];var noSubscriptionPopup=kommersant.subscriptions.noSubscriptionPopup;kommersant.user.ready.then(function(){var i={domain:"."+kommersant.domain,path:"/"};return"phone"==kommersant.media||"tablet"==kommersant.media?void noSubscriptionPopup():void kommersant.prepareFixed().then(function(){for(var n=kommersant.user.subscriptionTypes,e=0;e<n.length;e++)for(var t in n[e])n[e][t[0].toLowerCase()+t.slice(1,t.length)]=kommersant.user.subscriptionTypes[e][t];var o=function(){return{domain:"."+kommersant.domain,path:"/",expires:kommersant.utils.dateAdd(new Date,26352e5)}};Object.assign||(Object.assign=function(i,n){for(var e in n)n.hasOwnProperty(e)&&(i[e]=n[e]);return i}),window.initSubscriptionKommers=function(){kommersant.user.currentShowsSubscription=0;var i=kommersant.user.subscriptionTypes.length,n=!1;window.sbtypes=null;for(var e=!1,t=0;t<kommersant.user.subscriptionTypes.length;t++){var o=Object.assign({},kommersant.user.subscriptionKommers);o.showSubscribePopup(Object.assign({},kommersant.user.subscriptionTypes[t]),function(t,o,s){i--,t&&(n=!0,window.sbtypes=s,e=o)})}var s=setInterval(function(){i<=0&&(n?window.sbtypes&&window.sbtypes.conditions&&window.sbtypes.conditions.Publishing==-1?(kommersant.subscriptions.noSubscriptionPopup(),e()):kommersant.subscriptions.yesSubscriptionPopup(e):kommersant.subscriptions.noSubscriptionPopup(),clearInterval(s))},100)},kommersant.user.subscriptionKommers||(kommersant.user.subscriptionKommers={getMinutsLeftFromDateSeconds:kommersant.subscriptions.globalFunctions.getMinutsLeftFromDateSeconds,data:{LastShownPopup:null,Status:2},getDataFromServer:function(n,e){var t=[],o={ErrorCode:0,Subscriptions:[]},s=kommersant.utils.getCookie("SubscSigned");if(s){var r=JSON.parse(s);if(t=[],r)for(var a in r)t.push({Email:r[a].Email,UserId:r[a].UserId,SubscriptionId:parseInt(a)})}t.length>0&&kommersant.user.data.UserId&&kommersant.user.data.UserId!=t[0].UserId&&(t=[],kommersant.utils.deleteCookie("SubscSigned",i));var u={data:JSON.stringify(t)};if(!kommersant.user.isAuthorized&&t&&t.length<=0)return void e(o);t&&t.length<=0&&(u={});var l=kommersant.personalHost+"/lk/UserSiteSubscriptions";$.ajax({xhrFields:{withCredentials:!0},type:"POST",data:u,url:l,success:function(i){e(i)},error:function(i,n,e){}})},assignOnlyServerData:function(i,n){i.Status=0+n.Status,i.WasSubscribed=0+n.WasSubscribed,i.IsEmailVerified=0+n.IsEmailVerified,i.DateSubscribed=0+n.DateSubscribed,i.DateUpdate=0+n.DateUpdate},getDateFromDateFormat:function(i){return i?parseInt(i.match(/[0-9]+/,"g")[0])/1e3:null},renderSubscription:function(i,n){var e=this;e.getDataFromServer(e.config,function(i){e.cnfgs=i;var t=null;if(i.Subscriptions)for(var o=0;o<i.Subscriptions.length;o++)if(i.Subscriptions[o].SubscriptionId==e.config.Id){t=i.Subscriptions[o],t.DateSubscribed=e.getDateFromDateFormat(t.DateSubscribed),t.DateUpdate=e.getDateFromDateFormat(t.DateUpdate);break}return t&&(!e.data.DateUpdate||t.DateUpdate>e.data.DateUpdate?Object.assign(e.data,t):e.assignOnlyServerData(e.data,t)),e.save(!1),3==e.data.Status?void n(!1):kommersant.user.currentShowsSubscription>0?void n(!1):void e.showPopup(function(i,e,t){n(i,e,t)})})},showSubscribePopup:function(i,n){var e=this;if(kommersant.user.currentShowsSubscription>0)return void n(!1);e.config={},e.data={},e.localData={newMessage:!1,emailSended:!1,alreadySigned:!1,RegisteredUser:!1,emailSendedManyTimeAgo:!1,emailBlocked:!1},Object.assign(e.config,i);var t=e.load();t&&(e.data=t);var o=window.kommersant.subscriptions.checkConditions(e.config.conditions,kommersant.subscriptions.disabledSubcriptions,e.config);return o.ok?e.config.conditions.Region&&kommersant.subscriptions.regionId&&e.config.conditions.Region!=kommersant.subscriptions.regionId?void n(!1):void e.renderSubscription({},function(i,t,s){o.fromYandexNews&&!i&&e.showYandexInfoPopup(),n(i,t,s)}):void n(!1)},showYandexInfoPopup:function(i){},setEvents:function(i){var n=this;$(".subscription_popup__content .vicon--close").on("click",n,n.remaindLater),$(document).keyup(function(i){27==i.keyCode&&(i.data=n,$(".subscription_popup__content").length>0&&!$(".subscription_popup__content").hasClass("hide")&&$(".subscription_popup__input").is(":focus")&&n.remaindLater.call(n,i))}),$(".subscription_popup__holder .subscription_popup__button--deny").on("click",n,n.noThanks),$(".subscription_popup__content_form").off("submit"),$(".subscription_popup__content_form").on("submit",n,n.subscribeMe),i||n.setEventsEmailInput()},eventsTimers:{},createBuffered:function(i,n,e,t,o){var s=this;$.each(i,function(i,r){var a=r.id;a in s.eventsTimers||(s.eventsTimers[a]=null),$(r).on(n,t,function(i){if(clearTimeout(s.eventsTimers[a]),document.all&&!window.setTimeout.isPolyfill){var n=window.setTimeout;window.setTimeout=function(i,e){var t=Array.prototype.slice.call(arguments,2);return n(i instanceof Function?function(){i.apply(null,t)}:i,e)},window.setTimeout.isPolyfill=!0}if(document.all&&!window.setInterval.isPolyfill){var r=window.setInterval;window.setInterval=function(i,n){var e=Array.prototype.slice.call(arguments,2);return r(i instanceof Function?function(){i.apply(null,e)}:i,n)},window.setInterval.isPolyfill=!0}s.eventsTimers[a]=setTimeout(e,o?o:250,t,i,this)})})},setEventsEmailInput:function(){var i=this;$(".subscription_popup__input").off("keyup"),i.createBuffered($(".subscription_popup__input"),"keyup",i.onChangeEmailInput,i,300)},setText:function(i){$(".subscription_popup__alert").text(i).removeClass("hide")},onChangeEmailInput:function(i,n,e){var t=jQuery.trim($(e).val()).toLowerCase(),o=i.validateEmail(t);return 1!=o?void i.drawTextValidationEmail(o,i.setText):void i.hideAlertText()},drawTextValidationEmail:function(i,n){return i==-1?void n("Введите email адрес"):i==-2?void n("Введите корректный email адрес"):i==-3?void n("Данный e-mail не совпадает с указанным при регистрации"):void me.hideAlertText()},hideAlertText:function(i){$(".subscription_popup__alert").addClass("hide")},validateEmail:function(i){function n(i){var n=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return n.test(i)}return i.length<=0?-1:n(i)?kommersant.user&&kommersant.user.data&&kommersant.user.data.Email&&i.toLowerCase()!=kommersant.user.data.Email.toLowerCase()?-3:1:-2},remaindLater:function(i){var n=i.data;n.closePopup(kommersant.user.isAuthorized)},closePopup:function(i){var n=this,e=$(".subscription_popup__content .vicon--close").attr("data-status");$(".subscription_popup__content").addClass("hide"),$(".subscription_popup").remove(),e&&"-1"==e&&kommersant.sendEvent("subscriptions","close",n.config.Name);var t=$(".vicon--close").attr("data-close");n.config.conditions&&n.config.conditions.Publishing==-1&&$(".editorial_choice_subscription").remove(),2!=t&&(n.data.Status=2,n.data.LastShownPopup=parseInt((new Date).getTime()/1e3),n.LastShownAnySubsrPopup=parseInt((new Date).getTime()/1e3),n.save(i))},noThanks:function(i){var n=i.data;n.closePopup(!1),n.data.Status=4,n.data.LastShownPopup=parseInt((new Date).getTime()/1e3),n.LastShownAnySubsrPopup=parseInt((new Date).getTime()/1e3),n.save(kommersant.user.isAuthorized)},subscribeMe:function(i,n){var e=i.data;if(i.stopPropagation(),i.preventDefault(),kommersant.sendEvent("subscriptions","subscribe",e.config.Name),e.alreadyTrySubscr)return!1;var e=i.data,t=jQuery.trim($("#subscription_popup__input_"+e.config.id).val()).toLowerCase(),o=e.validateEmail(t);return 1!=o&&o!=-3?(e.drawTextValidationEmail(o,e.setText),!1):(e.hideAlertText(),e.readyToSubscribe(t,function(i){e.data.Status=i,e.data.LastShownPopup=parseInt((new Date).getTime()/1e3),e.LastShownAnySubsrPopup=parseInt((new Date).getTime()/1e3),e.save(kommersant.user.isAuthorized)},!1),!1)},readyToSubscribe:function(i,n){var e=this;e.config.id,e.data.LastShownPopup=parseInt((new Date).getTime()/1e3);var t=kommersant.personalHost+"/lk/UserSiteSubscriptionSubscribe";e.alreadyTrySubscr=!0;var o=kommersant.templates.apply("loading");$(".subscription_popup__content_form").after(o),$.ajax({xhrFields:{withCredentials:!0},url:t,method:"POST",data:{SubscriptionId:e.config.id,Email:i},success:function(t){var o=3,s=!1,r=!0;e.localData.emailSended=!0,"-2"==t.ErrorCode&&(r=!1,e.localData.alreadySigned=!0,s=!0,o=3),"-3"==t.ErrorCode&&(r=!1,e.localData.emailSendedManyTimeAgo=!0,s=!0,o=3),"-4"==t.ErrorCode&&(r=!1,e.localData.emailBlocked=!0,s=!0,o=1),(r||e.localData.emailSendedManyTimeAgo)&&e.sucessSigned(t),e.localData.newMessage=!0,e.showCode(e.getCode(o,i),void 0,!0),e.setEvents(s),3==o&&e.saveCookieSubscription(e.config.id,i),n(r?o:o)},error:function(i,n,e){kommersant.checkOutdated.apply(null,arguments)}})},saveCookieSubscription:function(i,n){var e=kommersant.utils.getCookie("SubscSigned");e||(e="{}");var t=JSON.parse(e);t||(t={}),t[i]={},t[i].Email=n,t[i].UserId=kommersant.user.data.UserId,kommersant.utils.setCookie("SubscSigned",JSON.stringify(t),o())},sucessSigned:function(i){var n=this;n.LastShownAnySubsrPopup=parseInt((new Date).getTime()/1e3)},getCode:function(i,n){var e=this,t="";kommersant.user.data.Email&&(t=kommersant.user.data.Email);var o=!1,s="",r="";e.config.Conditions.Region&&(o=!0,window.regionInfo&&(s=window.regionInfo.name,r=window.regionInfo.id),window.docInfo&&window.docInfo.region&&(s=window.docInfo.region.name,r=window.docInfo.region.id),e.config.title="Подпишитесь на&nbsp;дайджест<br> новостей в рассылке «Коммерсантъ "+s+"» ");var a=e.config.title,u=!1,l=1,p="newspaper"==e.config.ClassSubscriptionPopupContent,c="choice"==e.config.ClassSubscriptionPopupContent,b=['<div class="subscription_popup__holder">','<input type="email"  id="subscription_popup__input_'+e.config.id+'" class="subscription_popup__input" value="'+t+'" placeholder="Ваш E-mail">','<button type="submit" class="subscription_popup__button subscription_popup__button--accept">Подписаться</button>',c?"":'<button type="button" class="subscription_popup__button subscription_popup__button--deny">Спасибо, не сейчас</button>',"</div>"],d=!1;e.localData.emailSended&&(a="Проверьте Вашу почту",b=['<div class="subscription_popup__text">На указанный адрес ('+n+") отправлено письмо для подтверждения подписки.</div>"],l=2,d=!0,u=!0),e.localData.alreadySigned&&(a="Вы уже подписаны на эту рассылку",b=['<div class="subscription_popup__text">На указанный адрес ('+n+") уже оформлена эта подписка.</div>"],l=2,d=!0,u=!0),e.localData.RegisteredUser&&(a="Такой email уже зарегистрирован",b=['<div class="subscription_popup__text">Вы пытаетесь подписаться на email ('+n+"), который уже зарегистрирован на сайте, авторизуйтесь перед подпиской.</div>"],l=2,d=!0,u=!0),e.localData.emailSendedManyTimeAgo&&(!n&&kommersant.user&&kommersant.user.data&&kommersant.user.data.Email&&(n=kommersant.user.data.Email),a="Проверьте вашу почту",b=['<div class="subscription_popup__text">Проверьте вашу почту '+n+", письмо отправлено еще раз</div>"],l=2,d=!0,u=!0),e.localData.emailBlocked&&(a="Этот email заблокирован",b=['<div class="subscription_popup__text">Указанный email ('+n+") был заблокирован.</div>"],l=2,d=!0,u=!0);var m=e.config.ClassSubscriptionPopupContent,g=null,S="",v="",f="";if("subscription_popup__content--weekend"==m||"weekend"==m)v='<div class="subscription_popup__logo subscription_popup__logo--weekend"></div>',g="subscription_popup__content--weekend";else if(m.length>0){var h="";o&&(h=" subscription_popup__logo--region"+r+" "),v='<div class="subscription_popup__logo subscription_popup__logo--'+m+h+'" ></div>',g="subscription_popup__content--"+m}o&&(S+="background-image:url(//im.kommersant.ru/ContentFlex/images/subscriptions/subscription_bg_region"+r+".jpg?3)",g=" subscription_popup__content--region subscription_popup__content--region"+r),"yandex"==m&&(f='<a target="_blank" href="'+e.config.linkA+'">'),p&&d&&(S+="background-image:url(//im.kommersant.ru/ContentFlex/images/subscriptions/subscription_newspaper_bg_2.jpg)");var _=e.config.subTitle?['<div class="subscription_popup__subtitle_holder">','<div class="subscription_popup__subtitle">',e.config.subTitle,"</div>","</div>"].join(""):"";u&&(_="");var I=['<span class="vicon vicon--kommersant_logo">','<svg class="vicon__body"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#vicon-kommersant_logo"></use></svg>',"</span>"].join("");return['<form class="subscription_popup__content_form" novalidate><div class="hide1 hide2 subscription_popup__content '+(g?g:" ")+'" style="'+S+'">','<div class="subscription_popup__wrapper">',c?"":v,c?"":I,c?'<div class="subscription_popup__text_holder">':"",f.length>0?f:"",'<div class="subscription_popup__title">'+a+"</div><br>",f.length>0?"</a>":"",_,c?"</div>":""].concat(b).concat(["</div>",'<div class="subscription_popup__alert hide">Данный e-mail ('+n+") не совпадает с указанным при регистрации ("+kommersant.user.UserEmail+")</div>",'<span class="vicon vicon--close" data-close="'+l+'" data-status="'+(i?i:"-1")+'">','<svg class="vicon__body"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#vicon-close"></use></svg>',"</span>","</div>","</form>"]).join("")},showCode:function(i,n,e){var t=this;if(!t.localData.newMessage&&kommersant.user.currentShowsSubscription>0)return void(n&&n(!1));var s=function(){var n=!1;t.config.conditions&&t.config.conditions.Publishing==-1&&(n=!0);var s="subscription_popup";"newspaper"==t.config.classSubscriptionPopupContent?(s="subscription_popup_left",$(".fixed_bottom__item--subscriptions_left").length>0?$(".fixed_bottom__item--subscriptions_left").html('<div class="subscription_popup subscription_popup_left"></div>'):$(".fixed_bottom__item--subscriptions").html('<div class="subscription_popup subscription_popup_left"></div>')):(!t.config.conditions||t.config.conditions&&t.config.conditions.Publishing!=-1)&&(s="subscription_popup_right",$(".fixed_bottom__item--subscriptions_right").length>0?$(".fixed_bottom__item--subscriptions_right").html('<div class="subscription_popup subscription_popup_right"></div>'):$(".fixed_bottom__item--subscriptions").html('<div class="subscription_popup subscription_popup_right"></div>')),n?($(".editorial_choice_subscription").html('<div class="subscription_popup subscription_popup--choice "></div>'),$(".subscription_popup").html(i),$(".subscription_popup").removeClass("hide")):$("."+s).html(i),e||kommersant.sendEvent("subscriptions","show",t.config.Name),t.LastShownAnySubsrPopup=parseInt((new Date).getTime()/1e3),t.setEvents();var r=new Date;n||kommersant.utils.setCookie("SubscrpCache",parseInt(r.getTime()/1e3),o())};kommersant.user.currentShowsSubscription+=1,n?n(!0,function(){s(),t.save(!1)},t.config):s()},showPopup:function(i){var n=this,e=n.data,t=n.getMinutsLeftFromDateSeconds(e.LastShownPopup),o=n.getMinutsLeftFromDateSeconds(n.LastShownAnySubsrPopup),s=n.getMinutsLeftFromDateSeconds(n.data.DateSubscribed),r=-1;return 5==e.Status&&(r=5),1!=e.Status&&2!=e.Status&&4!=e.Status&&5!=e.Status||void 0==e.LastShownPopup||1==e.Status&&e.LastShownPopup&&t>n.config.showInterval||2==e.Status&&e.LastShownPopup&&t>n.config.subscribingInterval||(4==e.Status||5==e.Status)&&e.LastShownPopup&&t>n.config.SubscribingIntervalRejected?3==e.Status&&!e.IsEmailVerified&&s<n.config.SubscribingIntervalAfterSubscribe?void i(!1):!e.Status&&o<n.config.subscribingIntervalAnotherWindow?void i(!1):5==e.Status&&s<n.config.SubscribingIntervalAfterSubscribe?void i(!1):void((!e.Status||0==e.Status||void 0==e.LastShownPopup||!n.LastShownAnySubsrPopup||o>=n.config.subscribingIntervalAnotherWindow)&&(n.LastShownAnySubsrPopup=0,$(".subscription_popup").empty(),5!=r&&(e.Status=1),e.LastShownPopup=parseInt((new Date).getTime()/1e3),n.initPopap(i,r))):void i(!1)},initPopap:function(i,n){var e=this;5==n?(e.data,e.localData.emailSendedManyTimeAgo=!1,e.showCode(e.getCode(1,void 0),i)):e.showCode(e.getCode(void 0,void 0),i)},load:function(){var i=this;i.LastShownAnySubsrPopup=kommersant.utils.getCookie("LastShownAnySubsrPopup"),i.LastShownAnySubsrPopup||(i.LastShownAnySubsrPopup=0);var n=kommersant.utils.getCookie("SubscriptionKommers_"+i.config.id),e=kommersant.utils.getCookie("subscriptionKommers_"+i.config.id);if(n)try{var t=JSON.parse(n);return t}catch(i){for(var o=0;o<10;o++)kommersant.utils.deleteCookie("SubscriptionKommers_"+o);kommersant.utils.deleteCookie("LastShownAnySubsrPopup")}if(e)try{var t=JSON.parse(e),s={};for(var r in t){var a=r.charAt(0).toUpperCase()+r.substr(1);a in t?s[a]=t[a]:s[a]=t[r]}return t=s,5==t.Status&&(t.Status=3),t}catch(i){for(var o=0;o<10;o++)kommersant.utils.deleteCookie("SubscriptionKommers_"+o);kommersant.utils.deleteCookie("LastShownAnySubsrPopup")}return null},save:function(i){var n=this;n.config.id&&(kommersant.utils.setCookie("SubscriptionKommers_"+n.config.id,JSON.stringify(n.data),o()),n.config.conditions&&n.config.conditions.Publishing==-1||kommersant.utils.setCookie("LastShownAnySubsrPopup",n.LastShownAnySubsrPopup,o()),i&&n.saveDataOnServer(n.config.id))},saveDataOnServer:function(i){var n=this,e=kommersant.personalHost+"/lk/UserSiteSubscriptionStatusSave";$.ajax({xhrFields:{withCredentials:!0},url:e,method:"POST",data:{SubscriptionId:i,Status:n.data.Status},success:function(i){},error:function(i,e,t){n.setText("Не удалось сохранить данные на сервере, возможно отсутствует соединение с сетью!")}})}},$(function(){window.initSubscriptionKommers()}))},function(){})});