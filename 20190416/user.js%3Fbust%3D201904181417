define(["vendors/ua-parser","common/utils"],function(e,t){"use strict";function o(){return this.tabXitiAlreadySent=[],this.alreadySentXiti=!1,this.alreadySentLogged=!1,this.alreadySentUnlogged=!1,this.windowWidth=window.innerWidth,this.isFromSocialNetwork=null,r=new e,i=r.getResult(),this}var r=!1,i=!1;o.prototype={getDevice:function(){return r.getDevice()},getOS:function(){return i.os},getBrowser:function(){return i.browser},getViewportDevice:function(){var e="desktop";return this.windowWidth<767?e="mobile":this.windowWidth<1024&&(e="tablet"),e},isSupportedBrowser:function(){var e=this.getBrowser();return!("IE"==e.name&&e.major<9)&&(!("Firefox"==e.name&&e.major<10)&&!("Safari"==e.name&&e.major<5))},isAuthenticated:function(){var e=this.getCookie("isAuthenticated");return null!==e&&""!==e&&1==e}},o.prototype.getCookie=function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},o.prototype.setCookie=function(e,t,o,r,i,n){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var a="";if(o)switch(o.constructor){case Number:a=o===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+o;break;case String:a="; expires="+o;break;case Date:a="; expires="+o.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+a+(i?"; domain="+i:"")+(r?"; path="+r:"")+(n?"; secure":""),!0},o.prototype.removeCookie=function(e,t,o){return!!this.hasCookie(e)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(o?"; domain="+o:"")+(t?"; path="+t:""),!0)},o.prototype.hasCookie=function(e){return!!e&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},o.prototype.getAllCookies=function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,o=0;o<t;o++)e[o]=decodeURIComponent(e[o]);return e},o.prototype.checkTracking=function(){var e=this.getCookie("dxSent");if(e){var t=e.split("#"),o=[];if(t[0]&&(this.alreadySentUnlogged=!0),t[1]&&(this.alreadySentLogged=!0),o=t[0],this.isAuthenticated()&&(o=t[1]),o){this.tabXitiAlreadySent=o.split(","),console.log(this.tabXitiAlreadySent);for(var r=this.tabXitiAlreadySent.length,i=0;i<r;i++)if(this.tabXitiAlreadySent[i]==xtsite||this.tabXitiAlreadySent[i]==xtn2){this.alreadySentXiti=!0;break}}}},o.prototype.exelate=function(){if(console.log("test exelate"),console.log(this.alreadySentXiti),!this.alreadySentXiti){var e=1,o="",r="";1==e?(e="001",o=xtsite,r=xtn2):o=xtn2;var i="&g="+e+"&CMS="+o;if(r&&(i+="&subctg="+r),this.isAuthenticated()){var n=this.getCookie("session"),a=JSON.parse(t.decode64(n));console.log(a),i+="&puid="+a.mso.idMD5;var s="male"===a.mso.sex?1:2;s&&(i+="&gd="+s);var c=a.mso.zipcode;c&&(i+="&zip="+c);var d=a.mso.birthdate;if(d){var h=new Date,u=0,l=d.substr(6,4),p=h.getFullYear();u=p-l;var m=h.getMonth()-d.substr(3,2);m<0?u-=1:0==m&&h.getDay()-d.substr(0,2)>0&&(u-=1),u>=13&&u<120&&(i+="&ag="+u)}}console.log("add exelate"),console.log(i),t.evalScript({src:"https://loadeu.exelator.com/load/?p=268"+i+"&j=d"}),this.tabXitiAlreadySent.push(o)}},o.prototype.axciom=function(){if(this.isAuthenticated()&&!this.alreadySentLogged){console.log("add Axciom");var e=this.getCookie("session"),o=JSON.parse(t.decode64(e)),r=o.mso.mailMD5||!1,i=document.createElement("iframe");i.name="_acxiom",i.width=0,i.height=0,i.src="https://p-eu.acxiom-online.com/pixel/ema?eml="+r+"&ha=md5&pid=2011&sc=mytf1&t=201101&ot=iframe;",document.body.appendChild(i)}},o.prototype.finishTrack=function(){var e=["",""],t=this.getCookie("dxSent");t&&(e=t.split("#"));var o="";o=this.isAuthenticated()?e[0]+"#"+this.tabXitiAlreadySent.join(","):this.tabXitiAlreadySent.join(",")+"#"+e[1],this.setCookie("dxSent",o)};var n={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,o,r,i,a,s,c,d="",h=0;for(e=n._utf8_encode(e);h<e.length;)t=e.charCodeAt(h++),o=e.charCodeAt(h++),r=e.charCodeAt(h++),i=t>>2,a=(3&t)<<4|o>>4,s=(15&o)<<2|r>>6,c=63&r,isNaN(o)?s=c=64:isNaN(r)&&(c=64),d=d+this._keyStr.charAt(i)+this._keyStr.charAt(a)+this._keyStr.charAt(s)+this._keyStr.charAt(c);return d},decode:function(e){var t,o,r,i,a,s,c,d="",h=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<e.length;)i=this._keyStr.indexOf(e.charAt(h++)),a=this._keyStr.indexOf(e.charAt(h++)),s=this._keyStr.indexOf(e.charAt(h++)),c=this._keyStr.indexOf(e.charAt(h++)),t=i<<2|a>>4,o=(15&a)<<4|s>>2,r=(3&s)<<6|c,d+=String.fromCharCode(t),64!=s&&(d+=String.fromCharCode(o)),64!=c&&(d+=String.fromCharCode(r));return d=n._utf8_decode(d)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",o=0;o<e.length;o++){var r=e.charCodeAt(o);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){for(var t="",o=0,r=c1=c2=0;o<e.length;)r=e.charCodeAt(o),r<128?(t+=String.fromCharCode(r),o++):r>191&&r<224?(c2=e.charCodeAt(o+1),t+=String.fromCharCode((31&r)<<6|63&c2),o+=2):(c2=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),t+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),o+=3);return t}};return o.prototype.decode64=function(e){if(window.atob)return unescape(decodeURIComponent(window.atob(e)));var t=n.decode(e);return t},o.prototype.comeFromSocialNetwork=function(){if("boolean"==typeof this.isFromSocialNetwork)return this.isFromSocialNetwork;var e=document.referrer,t=["facebook.com","twitter.com"];return this.isFromSocialNetwork=t.some(function(t){var o=new RegExp("https?://[^/]*".concat(t));return o.test(e)}),this.isFromSocialNetwork},new o});