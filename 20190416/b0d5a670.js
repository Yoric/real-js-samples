var GlobalActionMenu;(function(n){function d(n){var i=n.querySelector(".actionmenuexp"),r=n.querySelector("."+o),t=n.querySelector(".actionmenucontent"),u=n.querySelector("."+v);t&&(tt(u,i,r,t,n),nt(u,i,r,t,n))}function t(n,t,i,e,o){var p,w,s,v,h;if(!Lib.CssClass.contains(e,f)&&(it(n,t,i),p=Lib.CssClass.contains(e,u),w=Lib.CssClass.contains(e,r),Lib.CssClass.add(e,f),sb_st(function(){var i,t,n;for(Lib.CssClass.add(e,a),Lib.CssClass.remove(e,r),Lib.CssClass.remove(o,l),Lib.CssClass.remove(e,u),i=o.firstElementChild,t=i.getElementsByTagName("a"),n=0;n<t.length;n++)t[n].setAttribute("aria-expanded","false")},y),sb_st(function(){return sj_evt.fire("GlobalActionMenu:Closed")},1e3),p||b(!1,e),w)){if(s=c(),v=!1,s)for(h=0;h<s.length;h++)s[h].parentElement==i.parentElement&&(s[h].focus(),v=!0);!v&&t&&t.focus()}}function g(n,t){var i=Lib.CssClass.contains(n,u);Lib.CssClass.add(t,l);Lib.CssClass.remove(n,a);Lib.CssClass.remove(n,f);sb_st(function(){return sj_evt.fire("GlobalActionMenu:Opened")},1e3);i||b(!0,n)}function nt(n,i,r,f,e){var c,o,h;if(sj_evt.bind(s,function(){return t(n,i,r,f,e)}),c=function(){return sj_evt.fire(s)},sj_be(_d,"touchstart",c),sj_be(_d,"mousedown",c),sj_be(f,"touchstart",function(n){return n.stopPropagation()}),sj_be(f,"mousedown",function(n){return n.stopPropagation()}),Lib.CssClass.contains(f,u)||sj_be(f,"click",function(){return t(n,i,r,f,e)}),sj_be(f,"touchmove",function(){return t(n,i,r,f,e)}),sj_be(_d,"focus",function(u){f.contains(u.target)||i&&i.contains(u.target)||t(n,i,r,f,e)},!0),AccessibilityHelpers.activateButtonByKey(f,[13,32],function(){return t(n,i,r,f,e)}),e&&(o=e.querySelectorAll("a"),o))for(h=0;h<o.length;h++)sj_be(o[h],"keydown",function(u){u.keyCode==27&&t(n,i,r,f,e)});i&&(sj_be(i,"touchstart",function(n){return n.stopPropagation()}),sj_be(i,"mousedown",function(n){return n.stopPropagation()}),sj_be(i,"touchmove",function(){return t(n,i,r,f,e)}),sj_be(i,"keydown",function(u){u.keyCode==27&&t(n,i,r,f,e)}));r&&(sj_be(r,"touchstart",function(n){return n.stopPropagation()}),sj_be(r,"mousedown",function(n){return n.stopPropagation()}),sj_be(r,"touchmove",function(){return t(n,i,r,f,e)}),sj_be(r,"keydown",function(u){u.keyCode==27&&t(n,i,r,f,e)}));n&&(sj_be(n,"touchstart",function(n){return n.stopPropagation()}),sj_be(n,"mousedown",function(n){return n.stopPropagation()}),sj_be(n,"touchmove",function(){return t(n,i,r,f,e)}),sj_be(n,"keydown",function(u){u.keyCode==27&&t(n,i,r,f,e)}))}function tt(n,t,h,l,a){var k=l.offsetWidth,b,w;Lib.CssClass.add(l,r);b=l.offsetWidth;Lib.CssClass.remove(l,r);w=function(h){h.setAttribute("aria-expanded","true");var it=function(n,t){n?(Lib.CssClass.add(l,r),p(a,h,l,b)):t?Lib.CssClass.add(l,u):p(a,h,l,k);g(l,a)},w=Lib.CssClass.contains(h,o),tt=Lib.CssClass.contains(h,v),d=Lib.CssClass.contains(l,f),rt=!d&&Lib.CssClass.contains(l,r),ut=!d&&Lib.CssClass.contains(l,u),ft=d||rt!=w||ut!=tt,nt=c();sj_evt.fire(s);ft?(w?(i(n,-1),i(t,-1),e(nt,-1)):(i(n,0),i(t,0),e(nt,0)),sb_st(function(){return it(w,tt)},y)):(i(n,0),i(t,0),e(nt,0))};t&&(sj_be(t,"click",function(){return w(t)}),AccessibilityHelpers.activateButtonByKey(t,[13,32],function(){return w(t)}));h&&(sj_be(h,"click",function(){return w(h)}),AccessibilityHelpers.activateButtonByKey(h,[13,32],function(){return w(h)}));n&&(sj_be(n,"click",function(){return w(n)}),AccessibilityHelpers.activateButtonByKey(n,[13,32],function(){return w(n)}))}function it(n,t,r){e(c(),0);i(n,0);i(t,0);i(r,0)}function i(n,t){n&&(n.tabIndex=t)}function e(n,t){if(n)for(var r=0;r<n.length;r++)i(n[r],t)}function p(n,t,i,r){if(t&&i){var c=t.getBoundingClientRect(),f=c.left,e=_w.innerWidth-f-t.offsetWidth,o=c.top,l=_w.innerHeight-o-t.offsetHeight;i.style.position="fixed";f>e?f+t.offsetWidth<r?(i.style.left="0",i.style.right=""):(i.style.left="",i.style.right=e+"px"):e+t.offsetWidth<r?(i.style.left="",i.style.right="0"):(i.style.left=f+"px",i.style.right="");o>l?(i.style.top="",i.style.bottom=l+t.offsetHeight+"px"):(i.style.bottom="",i.style.top=o+t.offsetHeight+"px");var a=n.getBoundingClientRect(),u=i.getBoundingClientRect(),s=u.left-a.left,h=u.top-a.top,v=u.top,y=u.left;i.style.right="";i.style.bottom="";i.style.left=s+"px";i.style.top=h+"px";i.style.position="absolute";u=i.getBoundingClientRect();s+=y-u.left;h+=v-u.top;i.style.top=h+"px";i.style.left=s+"px"}}function w(n,t){var r=n.querySelectorAll(t),i,u,f;if(r)for(i=0;i<r.length;i++)u=r[i],f=u.getAttribute("data-medium"),Sharing.logEvent(f,Sharing.ShareStage.Visible,n)}function b(n,t){_w.Log2?Log2.LogEvent("ClientInst",{FID:"GlobalAction.Expansion"},n?"Open":"Close",null,null,null,null,null):Log.Log(n?"Open":"Close","GlobalAction.Expansion","ClientInst",!1);n&&w(t,"[data-type='shareMedium']")}function h(){var r=_d.querySelectorAll(n.globalActionMenuSelector),u,i,t;if(r)for(u="data-initialized",i=0;i<r.length;i++)(t=r[i],t.getAttribute(u)!=="1")&&(d(t),w(t,".topactions [data-type='shareMedium']"),t.setAttribute(u,"1"))}function c(){return typeof PrintAction!="undefined"?PrintAction.getPrintActions():null}function rt(){h();typeof ShareAction!="undefined"&&ShareAction.initShareActions();typeof PrintAction!="undefined"&&PrintAction.initPrintActions();typeof FeedbackAction!="undefined"&&FeedbackAction.initFeedbackActions();typeof CustomAction!="undefined"&&CustomAction.initCustomActions()}function ut(n,t){var i=n&&_qs("."+o,n);ft(i,t)}function ft(t,i){t&&(n.promoteActionImpl?n.promoteActionImpl(t,i):et(function(){n.promoteActionImpl&&n.promoteActionImpl(t,i)}))}function et(n){var t=k+"?IG="+_G.IG,i={callback:function(t,i){t&&(i.appendTo(sj_b),n())}};sj_ajax(t,i)}var l="openmenu",f="hiddenmenu",a="nonemenu",r="sharemenu",o="shareactionexp",s="menuDismiss",v="cortanaactionexp",u="cortanamenu",y=200,k="/shared/gamp/";n.globalActionMenuSelector=".actionmenu";n.bindGlobalActionMenuEvents=rt;n.promoteShareAction=ut;sj_be(_w,"load",function(){return h()});sj_evt.bind("ajax.load",function(){return h()})})(GlobalActionMenu||(GlobalActionMenu={}))