$(document).ready(function(){$.getJSON("/restapi/marketing/geo").done(function(data){createAutocomplete(data);console.log(data.response.domains);});function createAutocomplete(data){var EmailDomainSuggester={domains:data.response.domains,$bindTo:$('#email'),init:function(){this.addElements();this.bindEvents();},addElements:function(){this.$datalist=$("<ul id='email-options'>").insertAfter(this.$bindTo);},bindEvents:function(){this.$bindTo.on("keyup",this.testValue);this.$datalist.on("click",this.selectFromList);},testValue:function(){var $el=$(this),value=$el.val();var splitArr=value.split("@"),value=splitArr[0];if(splitArr.length>1){var domain=splitArr[1];var isDotFlag=false;if(~domain.indexOf(".",1))isDotFlag=true;}
if(!value.length||isDotFlag){EmailDomainSuggester.hideList();return;}
var domainsArr=domain?EmailDomainSuggester.filterDomains(EmailDomainSuggester.domains,domain):EmailDomainSuggester.domains;EmailDomainSuggester.addDatalist(value,domainsArr);},addDatalist:function(value,domains){var i,newOptionsString="";for(i=0;i<domains.length;i++){newOptionsString+="<li class='div'>"+value+"@"+domains[i]+"</li >";}
this.$datalist.html(newOptionsString).show();},selectFromList:function(event){event.preventDefault();event.stopPropagation();var text=event.target.innerText;EmailDomainSuggester.$bindTo.val(text);EmailDomainSuggester.hideList();},hideList:function(){this.$datalist.hide();},filterDomains:function(arr,value){var newArr=[];for(var i=0;i<arr.length;i++){if(~arr[i].indexOf(value))newArr.push(arr[i]);}
return newArr;}}
EmailDomainSuggester.init();};});