(function(){window.RegisterEmbedder||(window.RegisterEmbedder=function(){return this.config={targetId:"",iframeUrl:"",_lang:"zh_S",_regfrom:"",cssStyle:"",queryStr:"",resizeIframeWidthFix:!1,resizeIframeHeightFix:!1,iframeWidth:990,iframeHeight:500},this.temp={target:null,iframe:null},this._listeners={},this._hashCodeCounter=0,this._messageType=null,this._bakWindowName=window.name,this._windowNameHash=null,this._windowNameTimer=null,this},window.RegisterEmbedder.prototype={merge:function(){for(var e,n={},t=Array.prototype.slice.call(arguments),o=0;e=t[o++];)for(var s in e)n[s]=e[s];return n},json2str:function(e){switch(e.constructor){case Object:var n="{";for(var t in e)e[t]&&(n+='"'+t+'":'+arguments.callee(e[t])+",");return","===n.substr(n.length-1)&&(n=n.substr(0,n.length-1)),n+"}";case Array:var n="[";for(var t in e)n+=arguments.callee(e[t])+",";return","===n.substr(n.length-1)&&(n=n.substr(0,n.length-1)),n+"]";default:return'"'+(""+e)+'"'}},str2json:function(e){return Function("return "+e)()},toQueryPair:function(e,n){return n===void 0?e:e+"="+encodeURIComponent(null===n?"":n+"")},toQueryString:function(e){var n=this,t=[];for(var o in e){o=encodeURIComponent(o);var s=e[o];if(s&&s.constructor===Array){for(var r,i=[],a=0,l=s.length;l>a;a++)r=s[a],i.push(n.toQueryPair(o,r));t=t.concat(i)}else t.push(n.toQueryPair(o,s))}return t.join("&")},get:function(e){return"string"==typeof e?document.getElementById(e):e},hasClass:function(e,n){return e.className.match(RegExp("(\\s|^)"+n+"(\\s|$)"))},addClass:function(e,n){return""===e.className?(e.className=n,void 0):(this.hasClass(e,n)||(e.className+=" "+n),void 0)},removeClass:function(e,n){if(this.hasClass(e,n)){var t=RegExp("(\\s|^)"+n+"(\\s|$)");e.className=e.className.replace(t," ")}},on:function(e,n,t){var o=this.get(e);o.attachEvent?(o["e"+n+t]=t,o[n+t]=function(){o["e"+n+t](window.event)},o.attachEvent("on"+n,o[n+t])):o.addEventListener(n,t,!1)},addEvent:function(e,n){if("function"==typeof n){var t=this._listeners[e];t||(t=this._listeners[e]={}),t[this._toHashCode(n)]=n}},fireEvent:function(e,n){if(this._listeners[e])for(var t in this._listeners[e])this._listeners[e][t].call(this,n)},_toHashCode:function(e){return e._hashCode?e._hashCode:e._hashCode="_"+(this._hashCodeCounter++).toString(32)},_tempOnInit:function(){this.temp.target=this.get(this.config.targetId)},_parseWindowNameData:function(e){var n=e.split("[@]").pop().split("[register-iframe-message]");return{origin:n[0],data:n[1]}},init:function(e){this.config=this.merge(this.config,e||{});var n=this,t=(this.config,this.temp);n._tempOnInit(),n._renderIframe(),window.postMessage?(n._messageType="postMessage",n.on(window,"message",function(e){n.messageHanlder.call(n,e)})):(n._messageType="windowName",window.name="",n._windowNameHash="",n._windowNameTimer=setInterval(function(){""!==window.name&&-1!==window.name.indexOf("[register-iframe-message]")&&window.name!==n._windowNameHash&&(n._windowNameHash=window.name,n.messageHanlder(n._parseWindowNameData(window.name)))},50)),n.on(window,"beforeunload",function(){t.iframe.style.visibility="hidden"}),this.fireEvent("onInit",{_self:this}),this.free()},messageHanlder:function(e){var n=this,t=this.config,o=this.temp,s=n.str2json(decodeURIComponent(e.data));switch(s.showIframe&&("visible"!==o.iframe.style.visibility&&(o.iframe.style.visibility="visible"),this.fireEvent("onIframeShow",{_self:o.iframe}),n.addClass(o.target,"iframe-show")),s.hideIframe&&("hidden"!==o.iframe.style.visibility&&(o.iframe.style.visibility="hidden"),this.fireEvent("onIframeHide",{_self:o.iframe}),n.removeClass(o.target,"iframe-show")),s.action){case"resizeIframe":if(0===o.iframe.offsetHeight)return;t.resizeIframeWidthFix||(o.iframe.width=s.width),t.resizeIframeHeightFix||(o.iframe.height=s.height),n._bakOriginalIframeWidth||(t.resizeIframeWidthFix||(n._originalIframeWidth=s.width),t.resizeIframeHeightFix||(n._originalIframeHeight=s.height),n._bakOriginalIframeWidth=!0);break;case"otherAction":break;default:}this.fireEvent("onMessage",s)},restoreOriginalWidth:function(){this.iframe.width=this._originalIframeWidth},restoreOriginalHeight:function(){this.iframe.height=this._originalIframeHeight},_renderIframe:function(){var e,n=this,t=this.config,o=this.temp,s=o.target,r=this.temp.iframe=document.createElement("iframe");e={_lang:t._lang,_regfrom:t._regfrom,cssStyle:t.cssStyle},r.id="alibaba-register-box",r.src=t.iframeUrl+"?"+n.toQueryString(e)+n.config.queryStr+"&rnd="+Math.random(),r.width=t.iframeWidth,r.height=t.iframeHeight,r.frameBorder="none",r.scrolling="no",r.style.border="none",r.allowTransparency="true",n.on(r,"load",function(){n.addClass(s,"iframe-loaded")}),s.appendChild(r),this.fireEvent("afterRenderIframe",{iframe:r})},free:function(){/msie/i.test(navigator.userAgent)&&CollectGarbage()},sleep:function(){var e=this;"windowName"===e._messageType&&(clearInterval(e._windowNameTimer),window.name=this._bakWindowName),this.free()},destory:function(){var e=this;"windowName"===e._messageType&&(clearInterval(e._windowNameTimer),window.name=this._bakWindowName),this.free()}})})();